# atlisp å‡½æ•°åº“ä½¿ç”¨æŒ‡å— 

## ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
- [å®‰è£…ä¸é…ç½®](#å®‰è£…ä¸é…ç½®)
- [åŸºæœ¬ä½¿ç”¨æ–¹æ³•](#åŸºæœ¬ä½¿ç”¨æ–¹æ³•)
- [ä¸»è¦åŠŸèƒ½æ¨¡å—](#ä¸»è¦åŠŸèƒ½æ¨¡å—)
- [é«˜çº§åŠŸèƒ½](#é«˜çº§åŠŸèƒ½)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [å¼€å‘ç¤ºä¾‹](#å¼€å‘ç¤ºä¾‹)
- [å¸¸è§é—®é¢˜è§£ç­”](#å¸¸è§é—®é¢˜è§£ç­”)
- [è¿›é˜¶æŠ€å·§](#è¿›é˜¶æŠ€å·§)
- [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#æ€§èƒ½ä¼˜åŒ–å»ºè®®)
- [è°ƒè¯•æŠ€å·§](#è°ƒè¯•æŠ€å·§)
- [ç¤¾åŒºä¸æ”¯æŒ](#ç¤¾åŒºä¸æ”¯æŒ)
- [è®¸å¯åè®®](#è®¸å¯åè®®)
- [ç‰ˆæœ¬æ›´æ–°](#ç‰ˆæœ¬æ›´æ–°)
- [å¿«é€Ÿå‚è€ƒ](#å¿«é€Ÿå‚è€ƒ)


## æ¦‚è¿°

atlisp å‡½æ•°åº“æ˜¯ä¸€ä¸ªå¼€æºã€å…±äº«ã€å¯äº‘ç«¯åŠ è½½çš„ AutoLISP å‡½æ•°åº“ï¼Œä¸“ä¸º AutoCADã€ä¸­æœ›CADã€æµ©è¾°CAD ç­‰å…¼å®¹çš„ CAD ç³»ç»Ÿè®¾è®¡ã€‚å®ƒæä¾›äº†ä¸Šåƒä¸ªå¸¸ç”¨å‡½æ•°ï¼Œæ¶µç›–å›¾å…ƒæ“ä½œã€å›¾å—ç®¡ç†ã€å®ä½“å¯¹è±¡ã€é€‰æ‹©é›†ã€Excel é›†æˆã€å‰ªè´´æ¿æ“ä½œã€æ›²çº¿å¤„ç†ã€é¢œè‰²ç®¡ç†ç­‰å„ä¸ªæ–¹é¢ï¼Œæ˜¯ CAD äºŒæ¬¡å¼€å‘çš„å¼ºå¤§å·¥å…·åº“ã€‚

## æ ¸å¿ƒç‰¹æ€§

### ğŸŒ äº‘ç«¯åŠ è½½
- **ä¸€è¡Œä»£ç åŠ è½½**ï¼šæ— éœ€æ‰‹åŠ¨ä¸‹è½½å’Œé…ç½®ï¼Œä¸€è¡Œä»£ç å³å¯åŠ è½½æ‰€éœ€å‡½æ•°
- **è‡ªåŠ¨æ›´æ–°**ï¼šå‡½æ•°åº“ä¿æŒäº‘ç«¯åŒæ­¥ï¼Œå§‹ç»ˆä½¿ç”¨æœ€æ–°ç‰ˆæœ¬
- **æŒ‰éœ€åŠ è½½**ï¼šåªåŠ è½½éœ€è¦çš„å‡½æ•°æ¨¡å—ï¼Œæé«˜æ•ˆç‡

### ğŸ“š ä¸°å¯Œçš„å‡½æ•°åº“
- **1000+ å‡½æ•°**ï¼šæ¶µç›– CAD å¼€å‘çš„å„ä¸ªæ–¹é¢
- **57ä¸ªåˆ†ç±»**ï¼šæŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ï¼Œä¾¿äºæŸ¥æ‰¾å’Œä½¿ç”¨
- **å¼€æºå…±äº«**ï¼šéµå¾ªå¼€æ”¾è®¸å¯åè®®ï¼Œå¯è‡ªç”±ä½¿ç”¨å’Œè´¡çŒ®

### ğŸ”§ æ˜“äºé›†æˆ
- **æ ‡å‡† AutoLISP**ï¼šå®Œå…¨å…¼å®¹ AutoLISP è¯­æ³•
- **è·¨å¹³å°æ”¯æŒ**ï¼šæ”¯æŒå¤šç§ CAD å¹³å°
- **æ— ä¾èµ–å®‰è£…**ï¼šé€šè¿‡ @lisp åº”ç”¨ç®¡ç†å™¨è½»æ¾å®‰è£…

## å®‰è£…ä¸é…ç½®

### ç¬¬ä¸€æ­¥ï¼šå®‰è£… @lisp åº”ç”¨ç®¡ç†å™¨

å°†ä»¥ä¸‹ä»£ç å¤åˆ¶åˆ° CAD å‘½ä»¤è¡Œå†…ï¼Œå›è½¦å³å¯å¼€å§‹å®‰è£…ï¼š

```lisp
(progn(vl-load-com)(setq s strcat h "http" o(vlax-create-object (s"win"h".win"h"request.5.1"))v vlax-invoke e eval r read)(v o'open "get" (s h"://atlisp.""cn/@"):vlax-true)(v o'send)(v o'WaitforResponse 1000)(e(r(vlax-get-property o'ResponseText))))
```

### ç¬¬äºŒæ­¥ï¼šé…ç½®å‡½æ•°åº“

å®‰è£…å®Œæˆåï¼Œåœ¨ CAD å‘½ä»¤è¡Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š

- `@` - é‡æ–°åŠ è½½ @lisp
- `@@` - æ˜¾ç¤º @lisp å‘½ä»¤é¢æ¿
- `@P` - æ‰“å¼€åº”ç”¨ç®¡ç†å™¨
- `@H` - æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯

## åŸºæœ¬ä½¿ç”¨æ–¹æ³•

### å‡½æ•°åŠ è½½æ¨¡å¼

@lisp å‡½æ•°åº“æ”¯æŒä¸¤ç§åŠ è½½æ¨¡å¼ï¼š

#### 1. äº‘ç«¯å®æ—¶åŠ è½½ï¼ˆæ¨èï¼‰
```lisp
;; åŠ è½½å•ä¸ªå‡½æ•°
(load-function "base64:encode")

;; åŠ è½½æ•´ä¸ªæ¨¡å—
(load-module "string")
```

#### 2. æœ¬åœ°æ‰¹é‡åŠ è½½
```lisp
;; åŠ è½½æ‰€æœ‰å‡½æ•°åˆ°æœ¬åœ°
(@lisp-load-all)
```

### å‡½æ•°å‘½åè§„èŒƒ

atlisp å‡½æ•°åº“é‡‡ç”¨æ¨¡å—åŒ–å‘½åè§„èŒƒï¼š

```
æ¨¡å—å:å‡½æ•°å
```

ä¾‹å¦‚ï¼š
- `string:split` - å­—ç¬¦ä¸²åˆ†å‰²å‡½æ•°
- `list:remove-duplicates` - åˆ—è¡¨å»é‡å‡½æ•°
- `entity:make-line` - åˆ›å»ºç›´çº¿å®ä½“å‡½æ•°

## ä¸»è¦åŠŸèƒ½æ¨¡å—

### ğŸ“ å­—ç¬¦ä¸²å¤„ç† (string)
```lisp
;; å­—ç¬¦ä¸²åˆ†å‰²
(string:split "a,b,c" ",")  ; è¿”å› ("a" "b" "c")

;; å­—ç¬¦ä¸²æ›¿æ¢
(string:subst-all "hello world" "o" "0")  ; è¿”å› "hell0 w0rld"

;; æ•°å­—æ ¼å¼åŒ–
(string:number-format 3.14159 2)  ; è¿”å› "3.14"

;; å­—ç¬¦ä¸²é•¿åº¦ï¼ˆæ”¯æŒä¸­æ–‡ï¼‰
(string:length "Helloä¸–ç•Œ")  ; è¿”å›æ­£ç¡®çš„å­—ç¬¦æ•°

;; å­—ç¬¦ä¸²åè½¬
(string:reverse "hello")  ; è¿”å› "olleh"

;; æ•°å­—è½¬ä¸­æ–‡
(string:number2chinese 123)  ; è¿”å› "ä¸€ç™¾äºŒåä¸‰"
```

### ğŸ” Base64 ç¼–ç  (base64)
```lisp
;; Base64 ç¼–ç 
(base64:encode '(72 101 108 108 111))  ; è¿”å› "SGVsbG8="

;; Base64 è§£ç 
(base64:decode "SGVsbG8=")  ; è¿”å› (72 101 108 108 111)

;; æ–‡ä»¶è½¬ Base64
(base64:encode-from-file "C:\\test.txt")

;; Base64 è½¬æ–‡ä»¶
(base64:base64-to-file "C:\\output.txt" "SGVsbG8=")
```

### ğŸ“‹ åˆ—è¡¨æ“ä½œ (list)
```lisp
;; åˆ—è¡¨å»é‡
(list:remove-duplicates '(1 2 2 3 3 3))  ; è¿”å› (1 2 3)

;; åˆ—è¡¨äº¤é›†
(list:intersection '(1 2 3) '(2 3 4))  ; è¿”å› (2 3)

;; åˆ—è¡¨æ’åº
(list:sort '(3 1 4 1 5) '<)  ; è¿”å› (1 1 3 4 5)
```

### ğŸ¨ å›¾å…ƒæ“ä½œ (entity)
```lisp
;; åˆ›å»ºç›´çº¿
(entity:make-line '(0 0 0) '(100 100 0))

;; åˆ›å»ºåœ†
(entity:make-circle '(0 0 0) 50)

;; åˆ›å»ºæ–‡å­—
(entity:make-text "Hello World" '(0 0 0) 10)
```

### ğŸ”² é€‰æ‹©é›†å¤„ç† (pickset)
```lisp
;; é€‰æ‹©é›†è½¬åˆ—è¡¨
(pickset:to-entlist ss)

;; é€‰æ‹©é›†æ’åº
(pickset:sort ss)

;; é€‰æ‹©é›†è¿‡æ»¤
(pickset:ssget "X" '((0 . "LINE")))
```

### ğŸ“Š Excel é›†æˆ (excel)
```lisp
;; æ‰“å¼€ Excel æ–‡ä»¶
(setq xl (excel:open "C:\\data.xlsx"))

;; è¯»å–å•å…ƒæ ¼
(excel:get-rangevalue xl "A1")

;; å†™å…¥å•å…ƒæ ¼
(excel:set-rangevalue xl "A1" "Hello")

;; ä¿å­˜å¹¶å…³é—­
(excel:save xl)
(excel:quit xl)
```

### ğŸ¯ å‡ ä½•è®¡ç®— (geometry)
```lisp
;; è®¡ç®—ä¸¤ç‚¹è·ç¦»
(geometry:distance '(0 0 0) '(3 4 0))  ; è¿”å› 5.0

;; è®¡ç®—è§’åº¦
(geometry:angle '(0 0 0) '(1 1 0))  ; è¿”å› Ï€/4

;; ç‚¹åˆ°ç›´çº¿è·ç¦»
(geometry:dist-pt-line pt line-start line-end)
```

## é«˜çº§åŠŸèƒ½

### ğŸ”„ æ›²çº¿å¤„ç† (curve)
```lisp
;; å¤šæ®µçº¿ä¼˜åŒ–
(curve:optimize-lwpl ename)

;; æ›²çº¿é•¿åº¦è®¡ç®—
(curve:length ename)

;; æ›²çº¿ä¸­ç‚¹
(curve:midpoint ename)

;; ä¸‰ç‚¹æ±‚åœ†å¼§å‡¸åº¦
(curve:3pt2bulge pt1 pt2 pt3)

;; æ£€æŸ¥å¼§çº¿æ–¹å‘
(curve:clockwisep pt1 pt2 pt3)  ; è¿”å› T è¡¨ç¤ºé¡ºæ—¶é’ˆ

;; åœ†è½¬å¤šæ®µçº¿
(curve:circle2lwpl center radius)
```

### ğŸ•’ æ—¥æœŸæ—¶é—´ (datetime)
```lisp
;; è·å–å½“å‰æ—¶é—´
(datetime:current-time)  ; è¿”å›å½“å‰æ—¶é—´å­—ç¬¦ä¸²

;; è·å–å½“å‰å¹´ä»½
(datetime:get-current-year)  ; è¿”å›å½“å‰å¹´ä»½

;; åˆ¤æ–­é—°å¹´
(datetime:leap-yearp 2024)  ; è¿”å› T è¡¨ç¤ºæ˜¯é—°å¹´

;; æ—¶é—´æˆ³è½¬æ¢
(datetime:mktime year month day hour minute second)
```

### ğŸ¨ é¢œè‰²ç®¡ç† (color)
```lisp
;; ACI é¢œè‰²è½¬ RGB
(color:aci2rgb 1)  ; è¿”å›çº¢è‰² RGB å€¼ (255 0 0)

;; RGB è½¬çœŸå½©è‰²
(color:rgb2truecolor 255 0 0)  ; è¿”å›çº¢è‰²çœŸå½©è‰²å€¼

;; çœŸå½©è‰²è½¬ RGB
(color:truecolor2rgb 16711680)  ; è¿”å› (255 0 0)

;; RGB è½¬ CSS æ ¼å¼
(color:rgb2css 255 0 0)  ; è¿”å› "#FF0000"
```

### ğŸ¨ é¢œè‰²ç®¡ç† (color)
```lisp
;; ACI é¢œè‰²è½¬ RGB
(color:aci2rgb 1)  ; è¿”å›çº¢è‰² RGB å€¼

;; RGB è½¬çœŸå½©è‰²
(color:rgb2truecolor 255 0 0)  ; è¿”å›çº¢è‰²çœŸå½©è‰²å€¼
```

### ğŸ“ æ–‡ä»¶æ“ä½œ (file)
```lisp
;; è¯»å–æ–‡ä»¶å†…å®¹
(file:read-stream "C:\\test.txt")

;; åˆå¹¶æ–‡ä»¶
(file:merge '("file1.txt" "file2.txt") "merged.txt")
```

## æœ€ä½³å®è·µ

### 1. æ¨¡å—åŒ–å¼€å‘
```lisp
;; åœ¨ç¨‹åºå¼€å¤´åŠ è½½æ‰€éœ€æ¨¡å—
(load-module "string")
(load-module "list")
(load-module "entity")

;; ä½¿ç”¨å‡½æ•°
(defun my-function ()
  (let ((text-list (string:split input-text ",")))
    (entity:make-text (car text-list) insert-point text-height)
  )
)
```

### 2. é”™è¯¯å¤„ç†
```lisp
(defun safe-function (/ result)
  (if (and (load-function "string:split")
           (setq result (string:split input ",")))
    result
    (progn
      (princ "\nå‡½æ•°åŠ è½½å¤±è´¥æˆ–æ‰§è¡Œå‡ºé”™")
      nil
    )
  )
)
```

### 3. æ€§èƒ½ä¼˜åŒ–
```lisp
;; æ‰¹é‡æ“ä½œæ—¶ï¼Œé¢„å…ˆåŠ è½½ç›¸å…³æ¨¡å—
(load-module "entity")
(load-module "pickset")

;; ä½¿ç”¨å±€éƒ¨å˜é‡å‡å°‘é‡å¤è®¡ç®—
(let ((entities (pickset:to-entlist ss)))
  (mapcar 'entity:process-entity entities)
)
```

## å¼€å‘ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæ‰¹é‡æ–‡å­—å¤„ç†
```lisp
(defun batch-text-process (/ ss ent-list)
  ;; åŠ è½½æ‰€éœ€æ¨¡å—
  (load-module "pickset")
  (load-module "entity")
  (load-module "string")
  
  ;; é€‰æ‹©æ‰€æœ‰æ–‡å­—
  (setq ss (pickset:ssget "X" '((0 . "TEXT"))))
  (setq ent-list (pickset:to-entlist ss))
  
  ;; å¤„ç†æ¯ä¸ªæ–‡å­—
  (mapcar 
    '(lambda (ent)
       (let ((text (entity:getdxf ent 1)))
         (entity:putdxf ent 1 (string:case text "upper"))
       )
     )
    ent-list
  )
)
```

### ç¤ºä¾‹2ï¼šExcel æ•°æ®å¯¼å…¥
```lisp
(defun import-from-excel (filename / xl data)
  ;; åŠ è½½ Excel æ¨¡å—
  (load-module "excel")
  (load-module "entity")
  
  ;; æ‰“å¼€ Excel æ–‡ä»¶
  (setq xl (excel:open filename))
  
  ;; è¯»å–æ•°æ®å¹¶åˆ›å»ºå›¾å…ƒ
  (setq row 1)
  (while (setq data (excel:get-rangevalue xl (strcat "A" (itoa row))))
    (entity:make-text 
      data 
      (list (* row 100) 0 0) 
      10
    )
    (setq row (1+ row))
  )
  
  ;; å…³é—­ Excel
  (excel:quit xl)
)
```

## è¿›é˜¶æŠ€å·§

### 1. è‡ªå®šä¹‰å‡½æ•°å°è£…
```lisp
;; å°è£…å¸¸ç”¨æ“ä½œä¸ºè‡ªå®šä¹‰å‡½æ•°
(defun my-create-layer (layer-name color / )
  (load-function "layer:make")
  (load-function "layer:set-color")
  (layer:make layer-name)
  (layer:set-color layer-name color)
)
```

### 2. æ‰¹å¤„ç†æ¨¡å¼
```lisp
;; æ‰¹é‡å¤„ç†æ—¶å…³é—­é‡ç»˜æé«˜æ€§èƒ½
(defun batch-process (entity-list / old-regen)
  (setq old-regen (getvar "REGENMODE"))
  (setvar "REGENMODE" 0)

  ;; æ‰¹é‡å¤„ç†
  (mapcar 'process-single-entity entity-list)

  ;; æ¢å¤è®¾ç½®
  (setvar "REGENMODE" old-regen)
  (command "REGEN")
)
```

### 3. é”™è¯¯æ¢å¤æœºåˆ¶
```lisp
(defun robust-function (/ *error* old-error result)
  (setq old-error *error*)
  (setq *error*
    (lambda (msg)
      (princ (strcat "\né”™è¯¯: " msg))
      (setq *error* old-error)
      (princ)
    )
  )

  ;; ä¸»è¦é€»è¾‘
  (setq result (main-logic))

  ;; æ¢å¤é”™è¯¯å¤„ç†
  (setq *error* old-error)
  result
)
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. é¢„åŠ è½½ç­–ç•¥
```lisp
;; åœ¨ç¨‹åºå¼€å§‹æ—¶é¢„åŠ è½½æ‰€æœ‰éœ€è¦çš„æ¨¡å—
(defun init-modules ()
  (mapcar 'load-module
    '("string" "list" "entity" "pickset" "geometry")
  )
)
```

### 2. ç¼“å­˜æœºåˆ¶
```lisp
;; ç¼“å­˜è®¡ç®—ç»“æœé¿å…é‡å¤è®¡ç®—
(setq *calculation-cache* (list))

(defun cached-calculation (input / result)
  (if (setq result (assoc input *calculation-cache*))
    (cdr result)
    (progn
      (setq result (expensive-calculation input))
      (setq *calculation-cache*
        (cons (cons input result) *calculation-cache*)
      )
      result
    )
  )
)
```

### 3. å†…å­˜ç®¡ç†
```lisp
;; åŠæ—¶é‡Šæ”¾å¤§å‹æ•°æ®ç»“æ„
(defun process-large-data (data / result)
  (setq result (process data))
  (setq data nil)  ; é‡Šæ”¾å†…å­˜
  result
)
```

## è°ƒè¯•æŠ€å·§

### 1. è°ƒè¯•è¾“å‡º
```lisp
(defun debug-print (msg value)
  (princ (strcat "\n[DEBUG] " msg ": "))
  (prin1 value)
  (princ)
  value
)

;; ä½¿ç”¨ç¤ºä¾‹
(setq result (debug-print "è®¡ç®—ç»“æœ" (+ 1 2 3)))
```

### 2. å‡½æ•°è·Ÿè¸ª
```lisp
(defun trace-function (func-name)
  (princ (strcat "\n[TRACE] è°ƒç”¨å‡½æ•°: " func-name))
  (princ)
)
```

### 3. æ€§èƒ½ç›‘æ§
```lisp
(defun time-function (func / start-time end-time)
  (setq start-time (getvar "MILLISECS"))
  (setq result (func))
  (setq end-time (getvar "MILLISECS"))
  (princ (strcat "\næ‰§è¡Œæ—¶é—´: "
    (rtos (- end-time start-time) 2 2) " æ¯«ç§’"))
  result
)
```

## å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥
| å‘½ä»¤ | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| `@` | é‡æ–°åŠ è½½ atlisp | ä¿®å¤æˆ–æ›´æ–°ç³»ç»Ÿ |
| `@@` | æ˜¾ç¤ºå‘½ä»¤é¢æ¿ | å›¾å½¢ç•Œé¢æ“ä½œ |
| `@P` | åº”ç”¨ç®¡ç†å™¨ | ç®¡ç†åº”ç”¨åŒ… |
| `@H` | å¸®åŠ©ä¿¡æ¯ | æŸ¥çœ‹ä½¿ç”¨è¯´æ˜ |
| `@I` | å®‰è£…åº”ç”¨åŒ… | å‘½ä»¤è¡Œå®‰è£… |
| `@L` | åˆ—å‡ºåº”ç”¨åŒ… | æŸ¥çœ‹å·²å®‰è£…åŒ… |
| `@U` | å‡çº§ç³»ç»Ÿ | æ›´æ–°åˆ°æœ€æ–°ç‰ˆ |
| `@W` | è®¿é—®ç½‘ç«™ | æ‰“å¼€å®˜ç½‘ |

### å‡½æ•°æ¨¡å—é€ŸæŸ¥
| æ¨¡å— | ä¸»è¦åŠŸèƒ½ | å¸¸ç”¨å‡½æ•°ç¤ºä¾‹ |
|------|----------|--------------|
| `string` | å­—ç¬¦ä¸²å¤„ç† | `split`, `subst-all`, `length` |
| `list` | åˆ—è¡¨æ“ä½œ | `remove-duplicates`, `sort`, `intersection` |
| `entity` | å›¾å…ƒæ“ä½œ | `make-line`, `make-circle`, `getdxf` |
| `pickset` | é€‰æ‹©é›†å¤„ç† | `to-entlist`, `sort`, `ssget` |
| `excel` | Excel é›†æˆ | `open`, `get-rangevalue`, `save` |
| `geometry` | å‡ ä½•è®¡ç®— | `distance`, `angle`, `midpoint` |
| `curve` | æ›²çº¿å¤„ç† | `length`, `optimize-lwpl`, `midpoint` |
| `color` | é¢œè‰²ç®¡ç† | `aci2rgb`, `rgb2truecolor` |
| `layer` | å›¾å±‚ç®¡ç† | `make`, `set-color`, `freeze` |
| `block` | å›¾å—æ“ä½œ | `insert`, `get-attributes`, `list` |

### é”™è¯¯ä»£ç é€ŸæŸ¥
| é”™è¯¯ä¿¡æ¯ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ³• |
|----------|----------|----------|
| å‡½æ•°æœªå®šä¹‰ | å‡½æ•°æœªåŠ è½½ | æ£€æŸ¥å‡½æ•°åï¼Œé‡æ–°åŠ è½½æ¨¡å— |
| ç½‘ç»œè¿æ¥å¤±è´¥ | ç½‘ç»œé—®é¢˜ | æ£€æŸ¥ç½‘ç»œï¼Œç¨åé‡è¯• |
| å‚æ•°é”™è¯¯ | å‚æ•°ç±»å‹ä¸åŒ¹é… | æ£€æŸ¥å‚æ•°ç±»å‹å’Œæ•°é‡ |
| æƒé™ä¸è¶³ | æ–‡ä»¶è®¿é—®æƒé™ | ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ CAD |

---


# atlisp å‡½æ•°åº“å®Œæ•´æ–‡æ¡£

æœ¬æ–‡æ¡£åŒ…å« atlisp å‡½æ•°åº“çš„å®Œæ•´ä½¿ç”¨è¯´æ˜ï¼Œé€‚ç”¨äº AutoLISP å¼€å‘ã€‚

## ğŸ“Š ç»Ÿè®¡ä¿¡æ¯

- **æ€»å‡½æ•°æ•°é‡**: 827
- **åŠŸèƒ½åˆ†ç±»**: 57
- **æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2025-07-31 15:35:47

## ğŸŒŸ æ¦‚è¿°

atlisp æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ AutoLISP å‡½æ•°åº“ï¼Œæä¾›äº†ä¸°å¯Œçš„å·¥å…·å‡½æ•°æ¥ç®€åŒ– AutoCAD å¼€å‘ã€‚
æœ¬åº“é‡‡ç”¨äº‘ç«¯åŠ è½½æ¨¡å¼ï¼Œæ”¯æŒæŒ‰éœ€åŠ è½½ï¼ŒåŒ…å«ä»¥ä¸‹ä¸»è¦åŠŸèƒ½æ¨¡å—ï¼š

### ğŸ”¥ ä¸»è¦åŠŸèƒ½æ¨¡å—

1. **vectra** - 152 ä¸ªå‡½æ•°
2. **list** - 62 ä¸ªå‡½æ•°
3. **entity** - 61 ä¸ªå‡½æ•°
4. **m** - 56 ä¸ªå‡½æ•°
5. **curve** - 45 ä¸ªå‡½æ•°
6. **string** - 38 ä¸ªå‡½æ•°
7. **excel** - 33 ä¸ªå‡½æ•°
8. **pickset** - 30 ä¸ªå‡½æ•°
9. **std** - 29 ä¸ªå‡½æ•°
10. **dcl** - 24 ä¸ªå‡½æ•°

## ğŸ“š å‡½æ•°åˆ†ç±»ç›®å½•

| åˆ†ç±» | å‡½æ•°æ•°é‡ | ä¸»è¦åŠŸèƒ½ |
|------|----------|----------|
| [base](#base) | 1 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [base64](#base64) | 4 | Base64ç¼–ç è§£ç  |
| [block](#block) | 22 | å›¾å—æ“ä½œã€å±æ€§å¤„ç† |
| [cl](#cl) | 6 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [clipboard](#clipboard) | 4 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [color](#color) | 8 | é¢œè‰²ç®¡ç†ã€æ ¼å¼è½¬æ¢ |
| [crypto](#crypto) | 1 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [curve](#curve) | 45 | æ›²çº¿å¤„ç†ã€é•¿åº¦è®¡ç®—ã€ä¼˜åŒ– |
| [datetime](#datetime) | 9 | æ—¥æœŸæ—¶é—´å¤„ç†ã€æ ¼å¼åŒ– |
| [dbx](#dbx) | 3 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [dcl](#dcl) | 24 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [demo](#demo) | 1 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [entity](#entity) | 61 | å›¾å…ƒåˆ›å»ºã€ä¿®æ”¹ã€æŸ¥è¯¢æ“ä½œ |
| [env](#env) | 2 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [example](#example) | 17 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [excel](#excel) | 33 | Excelæ–‡ä»¶è¯»å†™ã€æ•°æ®å¤„ç† |
| [ext](#ext) | 4 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [file](#file) | 6 | æ–‡ä»¶æ“ä½œã€è¯»å†™å¤„ç† |
| [filename](#filename) | 2 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [fun](#fun) | 1 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [g](#g) | 2 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [geometry](#geometry) | 15 | å‡ ä½•è®¡ç®—ã€åæ ‡å˜æ¢ |
| [group](#group) | 6 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [hdinfo](#hdinfo) | 3 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [ini](#ini) | 5 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [json](#json) | 4 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [layer](#layer) | 23 | å›¾å±‚ç®¡ç†ã€å±æ€§è®¾ç½® |
| [layout](#layout) | 7 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [line](#line) | 3 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [list](#list) | 62 | åˆ—è¡¨æ“ä½œã€æ’åºã€å»é‡ã€æŸ¥æ‰¾ |
| [m](#m) | 56 | æ•°å­¦è¿ç®—ã€ä¸‰è§’å‡½æ•° |
| [matrix](#matrix) | 20 | çŸ©é˜µè¿ç®—ã€å˜æ¢è®¡ç®— |
| [music-die](#musicdie) | 3 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [orance](#orance) | 1 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [p](#p) | 19 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [pickset](#pickset) | 30 | é€‰æ‹©é›†å¤„ç†ã€è¿‡æ»¤ã€è½¬æ¢ |
| [point](#point) | 9 | ç‚¹åæ ‡å¤„ç†ã€å˜æ¢ |
| [py](#py) | 1 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [re](#re) | 3 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [reg](#reg) | 1 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [stat](#stat) | 5 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [std](#std) | 29 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [string](#string) | 38 | å­—ç¬¦ä¸²å¤„ç†ã€æ ¼å¼åŒ–ã€ç¼–ç è½¬æ¢ |
| [style](#style) | 1 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [svg](#svg) | 1 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [sys](#sys) | 2 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [system](#system) | 11 | ç³»ç»Ÿä¿¡æ¯ã€ç¯å¢ƒå˜é‡ |
| [table](#table) | 3 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [tbl](#tbl) | 3 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [text](#text) | 10 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [timer](#timer) | 2 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [ui](#ui) | 17 | ç”¨æˆ·ç•Œé¢ã€å¯¹è¯æ¡† |
| [vectra](#vectra) | 152 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [vitalgg](#vitalgg) | 2 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [vla](#vla) | 13 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [word](#word) | 7 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |
| [xdata](#xdata) | 4 | ä¸“ç”¨åŠŸèƒ½æ¨¡å— |

## base

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### base:init

**è¯´æ˜**: atlisp å‡½æ•°åº“åŸºæœ¬ç¬¦å·åŠç®€åŒ–å‡½æ•°ã€‚ä¸ºäº†ä¿è¯atlispå‡½æ•°åº“èƒ½æ­£å¸¸è¿è¡Œï¼Œéœ€å…ˆæ‰§è¡Œè¯¥å‡½æ•°ã€‚è¯¥å‡½æ•°è¢« atlisp è‡ªåŠ¨è°ƒç”¨ã€‚

**ç”¨æ³•**:
```lisp
(base:init )
```

**å‚æ•°**: æ²¡æœ‰

**ç¤ºä¾‹**:
```lisp
(base:init)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun base:init nil "atlisp å‡½æ•°åº“åŸºæœ¬ç¬¦å·åŠç®€åŒ–å‡½æ•°ã€‚ä¸ºäº†ä¿è¯atlispå‡½æ•°åº“èƒ½æ­£å¸¸è¿è¡Œï¼Œéœ€å…ˆæ‰§è¡Œè¯¥å‡½æ•°ã€‚è¯¥å‡½æ•°è¢« atlisp è‡ªåŠ¨è°ƒç”¨ã€‚"
  ""
  "(base:init)"
  "å¸¸ç”¨ visuallisp å…¨å±€ç¬¦å·ã€‚"
  (or (eq $platform (quote linux))
    (setq *acad* (vlax-get-acad-object)
      *doc* (vla-get-activedocument *acad*)
      *docs* (vla-get-documents *acad*)
      *ms* (vla-get-modelspace *doc*)
      *ps* (vla-get-paperspace *doc*)
      *blks* (vla-get-blocks *doc*)
      *lays* (vla-get-layers *doc*)
      *lts* (vla-get-linetypes *doc*)
      *sts* (vla-get-textstyles *doc*)
      *grps* (vla-get-groups *doc*)
      *dims* (vla-get-dimstyles *doc*)
      *louts* (vla-get-layouts *doc*)
      *vps* (vla-get-viewports *doc*)
      *vs* (vla-get-views *doc*)
      *dics* (vla-get-dictionaries *doc*)
      *layouts* (vla-get-layouts *doc*)
      *display* (vla-get-display (vla-get-preferences (vla-get-application *acad*)))))
  "ç®€åŒ–å‡½æ•°"
  (setq o2e vlax-vla-object->ename)
  (setq e2o vlax-ename->vla-object)
  (setq vlap p:vlap stringp p:stringp realp p:realp enamep p:enamep variantp p:variantp picksetp p:picksetp intp p:intp safearrayp p:safearrayp ename-listp p:ename-listp vla-listp p:vla-listp string-listp p:string-listp dotpairp p:dotpairp curvep p:curvep)
  (setq @:*units* (list "m"
      "kg"
      "s"
      "h"
      "A"
      "K"
      "mol"
      "cd"
      (setq m2 (strcat "m"
          (chr 178)))
      (setq m3 (strcat "m"
          (chr 179)))
      (strcat m3 "/mol")
      (strcat m3 "/kg")
      "Hz"
      (strcat "kg/"
        m3)
      "kg/mol"
      "m/s"
      "rad/s"
      "N"
      "Pa"
      "N/m"
      "NÂ·s"
      "J"
      "NÂ·m"
      "J/mol"
      "W"
      "J/s"
      "J/K"
      "J/(molÂ·K)"
      "J/(kgÂ·K)"
      (strcat "NÂ·s/"
        m2)
      "W/(mÂ·K)"
      (strcat m2 "/s")
      "C"
      "V"
      "Î©"
      "m"
      "mm"
      "cm"
      "dm"
      "km"
      "g"
      "mg"
      "k"
      "M"
      "kN"
      "MPa"
      "kPa"
      "dB"
      "â„ƒ"
      "ppm"
      "äºº"
      (chr 178)
      (chr 179)
      (chr 181)
      "/"
      "Â·"
      "("
        ")"
      (strcat "W/"
        m2 "Â·K")
      "â„‰"
      "Bq"
      "lx"
      "lm"
      "S"
      "H"
      "Wb"
      "T"
      "F"
      "W"))
  (setq *linefile* (cond (is-bricscad "default.lin")
      (is-gcad "gcad.lin")
      (is-zwcad "zwcad.lin")
      (t "acad.lin")))
  (setq *isolinefile* (cond (is-bricscad "iso.lin")
      (is-gcad "gcadiso.lin")
      (is-zwcad "zwcadiso.lin")
      (t "acadiso.lin")))
  (setq *patfile* (cond (is-bricscad "default.pat")
      (is-gcad "gcad.pat")
      (is-zwcad "zwcad.pat")
      (t "acad.pat")))
  (setq *isopatfile* (cond (is-bricscad "iso.pat")
      (is-gcad "gcadiso.pat")
      (is-zwcad "zwcadiso.pat")
      (t "acadiso.pat")))
  t)
```
</details>

---

## base64

**æ¨¡å—è¯´æ˜**: Base64ç¼–ç è§£ç 

### base64:base64-to-file

**ç”¨æ³•**:
```lisp
(base64:base64-to-file file str-base64)
```

**å‚æ•°**: 1 file  : æ–‡ä»¶å;2 str-base64  : å­—ç¬¦ä¸²;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun base64:base64-to-file (file str-base64 / xmldom node stream)
  (if is-gcad (progn (princ "This function CAN NOT support GstarCAD.")
      nil)
    (progn (setq xmldom (vlax-get-or-create-object "MSXML2.DOMDocument"))
      (setq node (vlax-invoke-method xmldom (quote createelement)
          "binary"))
      (vlax-put-property node (quote datatype)
        "bin.base64")
      (vlax-put-property node (quote text)
        str-base64)
      (setq stream (vlax-get-or-create-object "ADODB.Stream"))
      (vlax-put-property stream (quote type)
        1)
      (vlax-invoke stream (quote open))
      (vlax-invoke-method stream (quote write)
        (vlax-get-property node (quote nodetypedvalue)))
      (vlax-invoke-method stream (quote savetofile)
        file 2)
      (vlax-invoke stream (quote close))
      (vlax-release-object stream)
      (vlax-release-object node)
      (vlax-release-object xmldom)
      t)))
```
</details>

---

### base64:decode

**è¯´æ˜**: Decode base64 string.

**ç”¨æ³•**:
```lisp
(base64:decode str-base64)
```

**å‚æ•°**: 1 str-base64  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: list of unsigned 8bit integer.

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun base64:decode (str-base64 / i res lst-base64 h%)
  "Decode base64 string."
  "list of unsigned 8bit integer."
  (if (p:stringp str-base64)
    (progn (setq lst-base64 (vl-string->list "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"))
      (setq i 0)
      (setq res (quote nil))
      (setq h% 0)
      (foreach b (mapcar (quote (lambda (x)
              (vl-position x lst-base64)))
          (vl-string->list str-base64))
        (if b (cond ((= i 0)
              (setq h% b)
              (setq i 1))
            ((= i 1)
              (setq res (cons (+ (lsh h% 2)
                    (/ b 16))
                  res))
              (setq h% (logand b 15))
              (setq i 2))
            ((= i 2)
              (setq res (cons (+ (lsh h% 4)
                    (/ b 4))
                  res))
              (setq h% (logand b 2))
              (setq i 3))
            ((= i 3)
              (setq res (cons (+ (lsh h% 6)
                    b)
                  res))
              (setq h% 0)
              (setq i 0)))))
      (reverse res))))
```
</details>

---

### base64:encode

**è¯´æ˜**: å°†å­—èŠ‚åˆ—è¡¨å†…å®¹è½¬ä¸º base64 ç¼–ç ã€‚

**ç”¨æ³•**:
```lisp
(base64:encode lst-uint8)
```

**å‚æ•°**: 1 lst-uint8  : åˆ—è¡¨;

**è¿”å›å€¼**: String

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun base64:encode (lst-uint8 / i res lst-str rem%)
  "å°†å­—èŠ‚åˆ—è¡¨å†…å®¹è½¬ä¸º base64 ç¼–ç ã€‚"
  "String"
  (if (and (listp lst-uint8)
      (apply (quote and)
        (mapcar (quote numberp)
          lst-uint8)))
    (progn (setq lst-base64 (vl-string->list "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"))
      (setq i 0)
      (setq res (quote nil))
      (setq rem% 0)
      (foreach b lst-uint8 (cond ((= i 0)
            (setq res (cons (/ b 4)
                res))
            (setq rem% (logand b 3))
            (setq i 1))
          ((= i 1)
            (setq res (cons (+ (lsh rem% 4)
                  (/ b 16))
                res))
            (setq rem% (logand b 15))
            (setq i 2))
          ((= i 2)
            (setq res (cons (+ (lsh rem% 2)
                  (/ b 64))
                res))
            (setq res (cons (logand b 63)
                res))
            (setq rem% 0)
            (setq i 0))))
      (cond ((= i 1)
          (setq res (cons (lsh rem% 4)
              res)))
        ((= i 2)
          (setq res (cons (lsh rem% 2)
              res))))
      (setq res (mapcar (quote (lambda (x)
              (nth x lst-base64)))
          res))
      (if (/= i 0)
        (repeat (- 3 i)
          (setq res (cons (ascii "=")
              res))))
      (vl-list->string (reverse res)))))
```
</details>

---

### base64:encode-from-file

**è¯´æ˜**: å°†æ–‡ä»¶ file è½¬ä¸º base64 ç¼–ç ã€‚æ–‡ä»¶è¿‡å¤§ä¼šè½¬æ¢å¤±è´¥ã€‚

**ç”¨æ³•**:
```lisp
(base64:encode-from-file file)
```

**å‚æ•°**: 1 file  : æ–‡ä»¶å;

**è¿”å›å€¼**: String

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun base64:encode-from-file (file / fp b)
  "å°†æ–‡ä»¶ file è½¬ä¸º base64 ç¼–ç ã€‚æ–‡ä»¶è¿‡å¤§ä¼šè½¬æ¢å¤±è´¥ã€‚"
  "String"
  ""
  (princ "CAN NOT read long file.\n")
  (if (and (findfile file)
      (setq fp (open file "r")))
    (progn (setq lst-base64 (vl-string->list "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"))
      (setq i 0)
      (setq res (quote nil))
      (setq rem% 0)
      (while (setq b (read-char fp))
        (cond ((= i 0)
            (setq res (cons (/ b 4)
                res))
            (setq rem% (logand b 3))
            (setq i 1))
          ((= i 1)
            (setq res (cons (+ (lsh rem% 4)
                  (/ b 16))
                res))
            (setq rem% (logand b 15))
            (setq i 2))
          ((= i 2)
            (setq res (cons (+ (lsh rem% 2)
                  (/ b 64))
                res))
            (setq res (cons (logand b 63)
                res))
            (setq rem% 0)
            (setq i 0))))
      (close fp)
      (cond ((= i 1)
          (setq res (cons (lsh rem% 4)
              res)))
        ((= i 2)
          (setq res (cons (lsh rem% 2)
              res))))
      (setq res (mapcar (quote (lambda (x)
              (nth x lst-base64)))
          res))
      (if (/= i 0)
        (repeat (- 3 i)
          (setq res (cons (ascii "=")
              res))))
      (reverse res))))
```
</details>

---

## block

**æ¨¡å—è¯´æ˜**: å›¾å—æ“ä½œã€å±æ€§å¤„ç†

### block:attach

**è¯´æ˜**: é™„ç€å¤–éƒ¨å‚ç…§ã€‚æµ©è¾°CAD,ä¸­æœ›CADä»¥å—æ–¹å¼æ’å…¥ã€‚

**ç”¨æ³•**:
```lisp
(block:attach path pt ang scale)
```

**å‚æ•°**: 1 path  : æ–‡ä»¶è·¯å¾„;2 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 ang  : è§’åº¦å€¼;4 scale  : æ¯”ä¾‹å€¼;

**ç¤ºä¾‹**:
```lisp
(block:attach "D:/a.dwg" (getpoint) 0 1)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:attach (path pt ang scale)
  "é™„ç€å¤–éƒ¨å‚ç…§ã€‚æµ©è¾°CAD,ä¸­æœ›CADä»¥å—æ–¹å¼æ’å…¥ã€‚"
  ""
  "(block:attach \"D:/a.dwg\"
    (getpoint)
    0 1)"
  (cond ((or is-gcad is-zwcad (< (@:acadver)
          18))
      (block:insert (vl-filename-base path)
        path pt ang scale))
    ((>= (@:acadver)
        18)
      (setvar "cmdecho"
        0)
      (command "-attach"
        path "A"
        pt scale scale ang)
      (setvar "cmdecho"
        1)))
  (entlast))
```
</details>

---

### block:bcs2wcs

**è¯´æ˜**: å°†å—å®šä¹‰å†…çš„åæ ‡è½¬ä¸ºå—å¼•ç”¨ä¸­çš„å®é™…çš„ä¸–ç•Œåæ ‡

**ç”¨æ³•**:
```lisp
(block:bcs2wcs pt pt-base pt-ins ang scale)
```

**å‚æ•°**: 1 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt-base  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 pt-ins  : å•ä¸ª2D/3Dåæ ‡ç‚¹;4 ang  : è§’åº¦å€¼;5 scale  : æ¯”ä¾‹å€¼;

**è¿”å›å€¼**: åæ ‡å€¼

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:bcs2wcs (pt pt-base pt-ins ang scale)
  "å°†å—å®šä¹‰å†…çš„åæ ‡è½¬ä¸ºå—å¼•ç”¨ä¸­çš„å®é™…çš„ä¸–ç•Œåæ ‡"
  "åæ ‡å€¼"
  (setq pt (mapcar (quote -)
      pt pt-base))
  (m:coordinate pt-ins (m:coordinate-scale (m:coordinate-rotate pt ang)
      scale)))
```
</details>

---

### block:ent-list

**è¯´æ˜**: è¿”å›å—å†…å„å›¾å…ƒçš„åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(block:ent-list blkname)
```

**å‚æ•°**: 1 blkname  : å—åç§°;

**è¿”å›å€¼**: å›¾å…ƒåˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(block:ent-list "å›¾æ¡†")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:ent-list (blkname / blk)
  "è¿”å›å—å†…å„å›¾å…ƒçš„åˆ—è¡¨"
  "å›¾å…ƒåˆ—è¡¨"
  "(block:ent-list \"å›¾æ¡†\")"
  (if (setq blk (tblobjname "block"
        blkname))
    (progn (setq ent blk)
      (setq entlst nil)
      (while (setq ent (entnext ent))
        (setq entlst (cons ent entlst)))
      (reverse entlst))))
```
</details>

---

### block:get-attdef

**è¯´æ˜**: å–å—å®šä¹‰ä¸­çš„å±æ€§å®šä¹‰ååŠæç¤ºå

**ç”¨æ³•**:
```lisp
(block:get-attdef blkname)
```

**å‚æ•°**: 1 blkname  : å—åç§°;

**è¿”å›å€¼**: list

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:get-attdef (blkname)
  "å–å—å®šä¹‰ä¸­çš„å±æ€§å®šä¹‰ååŠæç¤ºå"
  "list"
  (setq ents (vl-remove-if-not (quote (lambda (x)
          (equal "ATTDEF"
            (entity:getdxf x 0))))
      (block:ent-list blkname)))
  (mapcar (quote (lambda (x)
        (entity:getdxf x (quote (2 3)))))
    ents))
```
</details>

---

### block:get-attrib-ents

**è¯´æ˜**: è·å–å—å‚ç…§çš„å±æ€§å›¾å…ƒã€‚

**ç”¨æ³•**:
```lisp
(block:get-attrib-ents blkref)
```

**å‚æ•°**: 1 blkref  : å—å›¾å…ƒ/å¯¹è±¡;

**è¿”å›å€¼**: å›¾å…ƒåˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(block:get-attrib-ents (car(entsel)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:get-attrib-ents (blkref / lst)
  "è·å–å—å‚ç…§çš„å±æ€§å›¾å…ƒã€‚"
  "å›¾å…ƒåˆ—è¡¨"
  "(block:get-attrib-ents (car(entsel)))"
  (if (= (quote vla-object)
      (type blkref))
    (setq blkref (o2e blkref)))
  (if (and (= (quote ename)
        (type blkref))
      (eq "INSERT"
        (entity:getdxf blkref 0))
      (= 1 (entity:getdxf blkref 66)))
    (progn (setq att (entnext blkref))
      (while (eq "ATTRIB"
          (entity:getdxf att 0))
        (setq lst (cons att lst))
        (setq att (entnext att)))
      (reverse lst))))
```
</details>

---

### block:get-attributes

**è¯´æ˜**: è·å–å—å±æ€§,è¿”å›å±æ€§åå’Œå€¼çš„ç‚¹å¯¹åˆ—è¡¨ã€‚

**ç”¨æ³•**:
```lisp
(block:get-attributes blkref)
```

**å‚æ•°**: 1 blkref  : å—å›¾å…ƒ/å¯¹è±¡;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:get-attributes (blkref / lst)
  "è·å–å—å±æ€§,è¿”å›å±æ€§åå’Œå€¼çš„ç‚¹å¯¹åˆ—è¡¨ã€‚"
  (if (= (quote ename)
      (type blkref))
    (setq blkref (e2o blkref)))
  (if (p:functionp vla-getattributes)
    (if (= (quote vla-object)
        (type blkref))
      (if (safearray-value (setq lst (vlax-variant-value (vla-getattributes blkref))))
        (mapcar (quote (lambda (x)
              (cons (vla-get-tagstring x)
                (vla-get-textstring x))))
          (vlax-safearray->list lst)))
      nil)
    (progn (setq att (entnext blkref))
      (while (eq "ATTRIB"
          (entity:getdxf att 0))
        (setq lst (cons (cons (entity:getdxf att 2)
              (entity:getdxf att 1))
            lst))
        (setq att (entnext att)))
      (reverse lst))))
```
</details>

---

### block:get-clip-boundary

**è¯´æ˜**: å–å‰ªè£å—å‚ç…§çš„è¾¹ç•Œçº¿ç‚¹WCSåæ ‡

**ç”¨æ³•**:
```lisp
(block:get-clip-boundary blkref)
```

**å‚æ•°**: 1 blkref  : å—å›¾å…ƒ/å¯¹è±¡;

**è¿”å›å€¼**: list

**ç¤ºä¾‹**:
```lisp
(block:get-clip-boundary (car(ensel)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:get-clip-boundary (blkref / ent-sf boundary-in-blk mt ms mr)
  "å–å‰ªè£å—å‚ç…§çš„è¾¹ç•Œçº¿ç‚¹WCSåæ ‡"
  "list"
  "(block:get-clip-boundary (car(ensel)))"
  (if (setq ent-sf (entity:getdxf (entity:getdxf (entity:getdxf blkref 360)
          360)
        360))
    (progn (setq matrixs (list:split (entity:getdxf ent-sf 40)
          12))
      (setq pts (entity:getdxf ent-sf 10))
      (if (= 2 (length pts))
        (setq pts (apply (quote point:rec-2pt->4pt)
            pts)))
      (setq boundary-in-blk (mapcar (quote (lambda (x)
              (matrix:mxp (list:split (car matrixs)
                  4)
                x)))
          pts))
      (setq mt (apply (quote matrix:translation)
          (entity:getdxf blkref 10)))
      (setq ms (matrix:scale (entity:getdxf blkref 41)
          (entity:getdxf blkref 42)
          (entity:getdxf blkref 43)))
      (setq mr (matrix:rotation-z (- (* 2 pi)
            (entity:getdxf blkref 50))))
      (mapcar (quote (lambda (x)
            (matrix:transform mt ms mr x)))
        boundary-in-blk))))
```
</details>

---

### block:get-dynamic-prop-cons-name-value

**è¯´æ˜**: è·å–åŠ¨æ€å—çš„åŠ¨æ€ç‰¹æ€§ä¸å€¼çš„ç‚¹å¯¹åˆ—è¡¨ã€‚

**ç”¨æ³•**:
```lisp
(block:get-dynamic-prop-cons-name-value blkref)
```

**å‚æ•°**: 1 blkref  : å—å›¾å…ƒ/å¯¹è±¡;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:get-dynamic-prop-cons-name-value (blkref / props n lst)
  "è·å–åŠ¨æ€å—çš„åŠ¨æ€ç‰¹æ€§ä¸å€¼çš„ç‚¹å¯¹åˆ—è¡¨ã€‚"
  (setq props (block:get-dynamic-properties blkref))
  (setq n 0)
  (setq lst nil)
  (repeat (length (car props))
    (setq lst (append lst (list (cons (nth n (car props))
            (nth n (cadr props))))))
    (setq n (1+ n)))
  lst)
```
</details>

---

### block:get-dynamic-properties

**è¯´æ˜**: è·å–åŠ¨æ€å—çš„åŠ¨æ€ç‰¹æ€§(è‡ªå®šä¹‰)åˆ—è¡¨ï¼šç‰¹æ€§åï¼Œå½“å‰å€¼ï¼Œåªè¯»æ€§ï¼Œæ˜¯å¦æ˜¾ç¤ºï¼Œå…è®¸å€¼

**ç”¨æ³•**:
```lisp
(block:get-dynamic-properties blk)
```

**å‚æ•°**: 1 blk  : å—å›¾å…ƒ/å¯¹è±¡;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:get-dynamic-properties (blk / oblk props)
  "è·å–åŠ¨æ€å—çš„åŠ¨æ€ç‰¹æ€§(è‡ªå®šä¹‰)åˆ—è¡¨ï¼šç‰¹æ€§åï¼Œå½“å‰å€¼ï¼Œåªè¯»æ€§ï¼Œæ˜¯å¦æ˜¾ç¤ºï¼Œå…è®¸å€¼"
  (if (= (quote ename)
      (type blk))
    (progn (setq oblk (vlax-ename->vla-object blk))
      (setq props (vlax-invoke oblk (quote getdynamicblockproperties)))
      (list (mapcar (quote (lambda (x)
              (vlax-get-property x (quote propertyname))))
          props)
        (mapcar (quote (lambda (x)
              (vlax-get-property x (quote value))))
          props)
        (mapcar (quote vla-get-readonly)
          props)
        (mapcar (quote vla-get-show)
          props)
        (mapcar (quote (lambda (x)
              (vlax-get-property x (quote allowedvalues))))
          props)))
    nil))
```
</details>

---

### block:get-dynprop

**è¯´æ˜**: å–åŠ¨æ€å—çš„æŸä¸€ç‰¹æ€§çš„å€¼

**ç”¨æ³•**:
```lisp
(block:get-dynprop blkref prp)
```

**å‚æ•°**: 1 blkref  : å—å›¾å…ƒ/å¯¹è±¡;2 prp  : å—ç‰¹æ€§;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:get-dynprop (blkref prp)
  "å–åŠ¨æ€å—çš„æŸä¸€ç‰¹æ€§çš„å€¼"
  (cdr (assoc prp (block:get-properties blkref))))
```
</details>

---

### block:get-effectivename

**è¯´æ˜**: å–å¾—å—çœŸå®åç§°ï¼Œæ”¯æŒ MAC

**ç”¨æ³•**:
```lisp
(block:get-effectivename blkref)
```

**å‚æ•°**: 1 blkref  : å—å›¾å…ƒ/å¯¹è±¡;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:get-effectivename (blkref / tem blkname *error*)
  "å–å¾—å—çœŸå®åç§°ï¼Œæ”¯æŒ MAC"
  (defun *error* (msg)
    (princ "å›¾å—å®šä¹‰å¼‚å¸¸")
    "")
  (cond ((and (= (quote ename)
          (type blkref))
        (entget blkref))
      (progn (setq blkname (cdr (assoc 2 (entget blkref))))
        (if (wcmatch blkname "`**")
          (if (and (setq tem (cdadr (assoc -3 (entget (cdr (assoc 330 (entget (tblobjname "block"
                              blkname))))
                      (quote ("AcDbBlockRepBTag"))))))
              (setq tem (handent (cdr (assoc 1005 tem)))))
            (setq blkname (cdr (assoc 2 (entget tem))))))
        blkname))
    ((= (quote vla-object)
        (type blkref))
      (vla-get-effectivename blkref))
    (t "")))
```
</details>

---

### block:get-obj-by-name

**è¯´æ˜**: é€šè¿‡å—åè·å–å—çš„AXå¯¹è±¡

**ç”¨æ³•**:
```lisp
(block:get-obj-by-name blk-name)
```

**å‚æ•°**: 1 blk-name  : å—å›¾å…ƒ/å¯¹è±¡;

**è¿”å›å€¼**: vla-object

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:get-obj-by-name (blk-name)
  "é€šè¿‡å—åè·å–å—çš„AXå¯¹è±¡"
  "vla-object"
  (car (vl-remove-if-not (quote (lambda (x)
          (= (vla-get-name x)
            blk-name)))
      (block:list-blk-objs))))
```
</details>

---

### block:get-properties

**è¯´æ˜**: è·å–åŠ¨æ€å—çš„åŠ¨æ€ç‰¹æ€§å’Œå€¼çš„ç‚¹å¯¹è¡¨

**ç”¨æ³•**:
```lisp
(block:get-properties blkref)
```

**å‚æ•°**: 1 blkref  : å—å›¾å…ƒ/å¯¹è±¡;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:get-properties (blkref / oblkref)
  "è·å–åŠ¨æ€å—çš„åŠ¨æ€ç‰¹æ€§å’Œå€¼çš„ç‚¹å¯¹è¡¨"
  (if (= (quote ename)
      (type blkref))
    (mapcar (function (lambda (prop)
          (cons (vla-get-propertyname prop)
            (vla:get-value (vla-get-value prop)))))
      (vlax-invoke (e2o blkref)
        (quote getdynamicblockproperties)))))
```
</details>

---

### block:insert

**è¯´æ˜**: æ’å…¥å—å‚ç…§ï¼Œå‚æ•°ï¼šblkname å—åï¼Œpath å—æ–‡ä»¶è·¯å¾„(ä»¥/ç»“å°¾,ä¸å«å—æ–‡ä»¶å)ï¼Œ pt æ’å…¥ç‚¹, ang æ—‹è½¬è§’åº¦ï¼Œscale æ¯”ä¾‹ã€‚

**ç”¨æ³•**:
```lisp
(block:insert blkname path pt ang scale)
```

**å‚æ•°**: 1 blkname  : å—åç§°;2 path  : æ–‡ä»¶è·¯å¾„;3 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;4 ang  : è§’åº¦å€¼;5 scale  : æ¯”ä¾‹å€¼;

**è¿”å›å€¼**: å—å®ä½“

**ç¤ºä¾‹**:
```lisp
(block:insert "aa" "C:/design/" (getpoint) 0 1)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:insert (blkname path pt ang scale)
  "æ’å…¥å—å‚ç…§ï¼Œå‚æ•°ï¼šblkname å—åï¼Œpath å—æ–‡ä»¶è·¯å¾„(ä»¥/ç»“å°¾,ä¸å«å—æ–‡ä»¶å)ï¼Œ pt æ’å…¥ç‚¹, ang æ—‹è½¬è§’åº¦ï¼Œscale æ¯”ä¾‹ã€‚"
  "å—å®ä½“"
  "(block:insert \"aa\"
    \"C:/design/\"
    (getpoint)
    0 1)"
  (if (tblsearch "block"
      blkname)
    (progn (if vla-insertblock (vla-insertblock (if (string-equal "Model"
              (getvar "ctab"))
            *ms* (vla-get-block (vla-get-activelayout *doc*)))
          (point:to-ax pt)
          blkname scale scale scale ang)
        (entmakex (list (quote (0 . "INSERT"))
            (quote (100 . "AcDbEntity"))
            (quote (100 . "AcDbBlockReference"))
            (cons 2 blkname)
            (cons 10 pt)
            (cons 41 scale)
            (cons 42 scale)
            (cons 43 scale)
            (cons 50 ang))))
      (entlast))
    (if (findfile (strcat path blkname ".dwg"))
      (progn (if vla-insertblock (vla-insertblock (if (string-equal "Model"
                (getvar "ctab"))
              *ms* (vla-get-block (vla-get-activelayout *doc*)))
            (point:to-ax pt)
            (findfile (strcat path blkname ".dwg"))
            scale scale scale ang)
          (progn (setvar "attreq"
              0)
            (command "-insert"
              (strcat path blkname)
              pt scale scale (angtos ang 0 0))
            (setvar "attreq"
              1)))
        (entlast)))))
```
</details>

---

### block:list

**è¯´æ˜**: åˆ—å—çš„åç§°

**ç”¨æ³•**:
```lisp
(block:list )
```

**å‚æ•°**: æ²¡æœ‰ä¸€ä¸ª

**è¿”å›å€¼**: list

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:list (/ res name)
  "åˆ—å—çš„åç§°"
  "list"
  (if (setq name (cdr (assoc 2 (tblnext "block"
            t))))
    (setq res (cons name nil)))
  (while (setq name (tblnext "block"))
    (setq res (cons (cdr (assoc 2 name))
        res)))
  res)
```
</details>

---

### block:list-blk-objs

**è¯´æ˜**: è·å–å—å¯¹è±¡åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(block:list-blk-objs )
```

**å‚æ•°**: None

**è¿”å›å€¼**: è·å–å—åŠå¤–éƒ¨å‚ç…§å¯¹è±¡åˆ—è¡¨

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:list-blk-objs (/ res)
  "è·å–å—å¯¹è±¡åˆ—è¡¨"
  "è·å–å—åŠå¤–éƒ¨å‚ç…§å¯¹è±¡åˆ—è¡¨"
  ""
  (setq res nil)
  (vlax-for blk *blks* (setq res (cons blk res)))
  res)
```
</details>

---

### block:list-xref-objs

**è¯´æ˜**: è·å–å¤–éƒ¨å‚ç…§å¯¹è±¡åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(block:list-xref-objs )
```

**å‚æ•°**: None

**è¿”å›å€¼**: å¤–éƒ¨å‚ç…§å¯¹è±¡åˆ—è¡¨

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:list-xref-objs (/ res)
  "è·å–å¤–éƒ¨å‚ç…§å¯¹è±¡åˆ—è¡¨"
  "å¤–éƒ¨å‚ç…§å¯¹è±¡åˆ—è¡¨"
  ""
  (setq res nil)
  (vlax-for blk *blks* (if (= :vlax-true (vla-get-isxref blk))
      (setq res (cons blk res))))
  res)
```
</details>

---

### block:readme

**è¯´æ˜**: å›¾å—åŠå¤–éƒ¨å‚ç…§æ“ä½œç›¸å…³å‡½æ•°ã€‚

**ç”¨æ³•**:
```lisp
(block:readme )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:readme nil "å›¾å—åŠå¤–éƒ¨å‚ç…§æ“ä½œç›¸å…³å‡½æ•°ã€‚"
  (princ "å›¾å—åŠå¤–éƒ¨å‚ç…§æ“ä½œç›¸å…³å‡½æ•°ã€‚ä½¿ç”¨ (require 'block:*)
    åŠ è½½è¿™äº›å‡½æ•°")
  (princ))
```
</details>

---

### block:set-attributes

**è¯´æ˜**: è®¾ç½®å—å±æ€§å€¼ï¼Œblkref ä¸ºå—å‚ç…§çš„å›¾å…ƒåï¼Œlst ä¸ºå¤šä¸ªå±æ€§åå’Œå±æ€§å€¼ç»„æˆçš„ç‚¹å¯¹è¡¨ã€‚

**ç”¨æ³•**:
```lisp
(block:set-attributes blkref lst)
```

**å‚æ•°**: 1 blkref  : å—å›¾å…ƒ/å¯¹è±¡;2 lst  : åˆ—è¡¨;

**ç¤ºä¾‹**:
```lisp
(block:set-attributes blkref '(("att1" . "value1")("att2" . "value2")))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:set-attributes (blkref lst / n atts)
  "è®¾ç½®å—å±æ€§å€¼ï¼Œblkref ä¸ºå—å‚ç…§çš„å›¾å…ƒåï¼Œlst ä¸ºå¤šä¸ªå±æ€§åå’Œå±æ€§å€¼ç»„æˆçš„ç‚¹å¯¹è¡¨ã€‚"
  ""
  "(block:set-attributes blkref '((\"att1\"
        . \"value1\")(\"att2\"
        . \"value2\")))"
  (if (= (quote ename)
      (type blkref))
    (setq blkref (e2o blkref)))
  (if (= (quote vla-object)
      (type blkref))
    (if (safearray-value (setq atts (vlax-variant-value (vla-getattributes blkref))))
      (progn (foreach n lst (mapcar (quote (lambda (x)
                (if (= (strcase (car n))
                    (strcase (vla-get-tagstring x)))
                  (vla-put-textstring x (cdr n)))))
            (vlax-safearray->list atts)))
        (vla-update blkref)))
    nil))
```
</details>

---

### block:set-dynprop

**è¯´æ˜**: è®¾ç½®åŠ¨æ€å—ç‰¹æ€§å€¼

**ç”¨æ³•**:
```lisp
(block:set-dynprop blkref prp val)
```

**å‚æ•°**: 1 blkref  : å—å›¾å…ƒ/å¯¹è±¡;2 prp  : å—ç‰¹æ€§;3 val  : å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:set-dynprop (blkref prp val)
  "è®¾ç½®åŠ¨æ€å—ç‰¹æ€§å€¼"
  (setq prp (strcase prp))
  (vl-some (quote (lambda (x)
        (if (= prp (strcase (vla-get-propertyname x)))
          (progn (vla-put-value x (vlax-make-variant val (vlax-variant-type (vla-get-value x))))
            (cond (val)
              (t))))))
    (vlax-invoke (vlax-ename->vla-object blkref)
      (quote getdynamicblockproperties))))
```
</details>

---

### block:ssget

**è¯´æ˜**: é€‰æ‹©æ»¡è¶³æŒ‡å®šå±æ€§æ ‡è®°åŠå¯¹åº”å€¼çš„å—ã€‚å‚æ•°ï¼šsel-method å‚ç…§ssgetã€‚å½“ä¸ºxæ—¶é€‰æ‹©å…¨éƒ¨ï¼Œæ— éœ€äº¤äº’ã€‚å¦‚éœ€ç›¸åº”çš„ç‚¹å‚æ•°æ—¶ï¼Œéœ€ä»¥åˆ—è¡¨çš„å½¢å¼ç»™å‡ºå¦‚'("c" pt1 pt2)ï¼Œéœ€æ‰‹åŠ¨é€‰æ‹©æ—¶è®¾ä¸ºnilã€‚å‚æ•°: blknames å—å(æ”¯æŒé€šé…ç¬¦)ï¼Œæˆ–å—ååˆ—è¡¨,æˆ–nilå‚æ•°: lst-attr å±æ€§åä¸å€¼çš„ç‚¹å¯¹è¡¨æˆ–nil

**ç”¨æ³•**:
```lisp
(block:ssget sel-method blknames lst-attr)
```

**å‚æ•°**: 1 sel-method  : é€‰æ‹©é›†;2 blknames  : å—åç§°;3 lst-attr  : åˆ—è¡¨;

**è¿”å›å€¼**: æ»¡è¶³æ¡ä»¶çš„é€‰æ‹©é›†

**ç¤ºä¾‹**:
```lisp
(block:ssget "x" '("å—1" "å—2")'(("å±æ€§1" . "å€¼1")("å±æ€§2" . "å€¼2")))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:ssget (sel-method blknames lst-attr / ss ss-res ss0)
  "é€‰æ‹©æ»¡è¶³æŒ‡å®šå±æ€§æ ‡è®°åŠå¯¹åº”å€¼çš„å—ã€‚\nå‚æ•°ï¼šsel-method å‚ç…§ssgetã€‚å½“ä¸ºxæ—¶é€‰æ‹©å…¨éƒ¨ï¼Œæ— éœ€äº¤äº’ã€‚å¦‚éœ€ç›¸åº”çš„ç‚¹å‚æ•°æ—¶ï¼Œéœ€ä»¥åˆ—è¡¨çš„å½¢å¼ç»™å‡ºå¦‚'(\"c\"
    pt1 pt2)ï¼Œéœ€æ‰‹åŠ¨é€‰æ‹©æ—¶è®¾ä¸ºnilã€‚\nå‚æ•°: blknames å—å(æ”¯æŒé€šé…ç¬¦)ï¼Œæˆ–å—ååˆ—è¡¨,æˆ–nil\nå‚æ•°: lst-attr å±æ€§åä¸å€¼çš„ç‚¹å¯¹è¡¨æˆ–nil"
  "æ»¡è¶³æ¡ä»¶çš„é€‰æ‹©é›†"
  "(block:ssget \"x\"
    '(\"å—1\"
      \"å—2\")'((\"å±æ€§1\"
        . \"å€¼1\")(\"å±æ€§2\"
        . \"å€¼2\")))"
  (cond ((= (quote str)
        (type blknames))
      (setq blknames (list blknames))))
  (setq ss-res (ssadd))
  (cond ((null sel-method)
      (setq ss0 (ssget (quote ((0 . "insert"))))))
    ((p:stringp sel-method)
      (setq ss0 (ssget sel-method (quote ((0 . "insert"))))))
    ((and sel-method (listp sel-method))
      (setq ss0 (apply (quote ssget)
          (append sel-method (list (quote ((0 . "insert"))))))))
    (t (setq ss0 (ssget "x"
          (quote ((0 . "insert")))))))
  (if (setq lst-ent (pickset:to-list ss0))
    (foreach ent% lst-ent (if (and (or (null blknames)
            (member (block:get-effectivename ent%)
              blknames)
            (apply (quote or)
              (mapcar (quote (lambda (x)
                    (wcmatch (block:get-effectivename ent%)
                      x)))
                blknames)))
          (or (null lst-attr)
            (apply (quote and)
              (mapcar (quote (lambda (x)
                    (member x (block:get-attributes ent%))))
                lst-attr))))
        (ssadd ent% ss-res))))
  (sssetfirst nil ss-res)
  ss-res)
```
</details>

---

### block:wcs2bcs

**è¯´æ˜**: å°†ç›¸å¯¹äºå—å¼•ç”¨æ’å…¥ç‚¹çš„ä¸–ç•Œåæ ‡è½¬ä¸ºå—å®šä¹‰å†…çš„åæ ‡

**ç”¨æ³•**:
```lisp
(block:wcs2bcs pt pt-base pt-ins ang scale)
```

**å‚æ•°**: 1 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt-base  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 pt-ins  : å•ä¸ª2D/3Dåæ ‡ç‚¹;4 ang  : è§’åº¦å€¼;5 scale  : æ¯”ä¾‹å€¼;

**è¿”å›å€¼**: åæ ‡å€¼

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun block:wcs2bcs (pt pt-base pt-ins ang scale / v1)
  "å°†ç›¸å¯¹äºå—å¼•ç”¨æ’å…¥ç‚¹çš„ä¸–ç•Œåæ ‡è½¬ä¸ºå—å®šä¹‰å†…çš„åæ ‡"
  "åæ ‡å€¼"
  (setq v1 (mapcar (quote -)
      pt pt-ins))
  (m:coordinate (mapcar (quote *)
      pt-base (quote (1 1 1)))
    (m:coordinate-scale (m:coordinate-rotate v1 (- (* 2 pi)
          ang))
      (/ 1.0 scale))))
```
</details>

---

## cl

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### cl:acons

**è¯´æ˜**: å‘ alist å‰æ·»åŠ é”®å€¼å¯¹ã€‚

**ç”¨æ³•**:
```lisp
(cl:acons key value alist)
```

**å‚æ•°**: 1 key  : é”®ï¼Œå…³é”®å­—;2 value  : å€¼;3 alist  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: alist

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun cl:acons (key value alist)
  "å‘ alist å‰æ·»åŠ é”®å€¼å¯¹ã€‚"
  "alist"
  (cons (cons key value)
    alist))
```
</details>

---

### cl:format

**è¯´æ˜**: common lisp ä¸­ åŠŸèƒ½å¼ºå¤§çš„æ ¼å¼åŒ–è¾“å‡ºå­—ç¬¦ä¸²å‡½æ•°ã€‚

**ç”¨æ³•**:
```lisp
(cl:format stream ctrl-string variables)
```

**å‚æ•°**: 1 stream  : å­—ç¬¦ä¸²;2 ctrl-string  : æœªè¯†åˆ«å®šä¹‰;3 variables  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: String

**ç¤ºä¾‹**:
```lisp
(cl:format "~{~a ~}" (list '("a""b""c")))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun cl:format (stream ctrl-string variables / flag-instruct flag-comma number1 number2 result to-string tmp-str init-flag)
  "common lisp ä¸­ åŠŸèƒ½å¼ºå¤§çš„æ ¼å¼åŒ–è¾“å‡ºå­—ç¬¦ä¸²å‡½æ•°ã€‚"
  "String"
  "(cl:format \"~{~a ~}\"
    (list '(\"a\"\"b\"\"c\")))"
  (defun to-string (para)
    (cond ((= (quote int)
          (type-of para))
        (itoa para))
      ((= (quote real)
          (type-of para))
        (rtos para 2 3))
      ((= (quote str)
          (type-of para))
        para)
      ((= (quote list)
          (type-of para))
        (vl-prin1-to-string para))
      ((= (quote sym)
          (type-of para))
        (vl-symbol-name para))))
  (defun init-flag nil (setq flag-instruct nil flag-comma nil number1 ""
      number2 ""))
  (init-flag)
  (setq result "")
  (while (/= ""
      ctrl-string)
    (if flag-instruct (cond ((= (ascii ",")
            (ascii ctrl-string))
          (setq flag-comma t))
        ((= (ascii "v")
            (ascii ctrl-string))
          (setq number1 (to-string (car variables)))
          (setq variables (cdr variables)))
        ((= (ascii "#")
            (ascii ctrl-string))
          (setq number1 (to-string (length variables)))
          (setq variables (cdr variables)))
        ((and (> (ascii ctrl-string)
              47)
            (> 58 (ascii ctrl-string)))
          (if flag-comma (setq number2 (strcat number2 (substr ctrl-string 1 1)))
            (setq number1 (strcat number1 (substr ctrl-string 1 1)))))
        ((= (ascii "~")
            (ascii ctrl-string))
          (setq result (strcat result "~"))
          (init-flag))
        ((= (ascii "%")
            (ascii ctrl-string))
          (setq result (strcat result "\n"))
          (init-flag))
        ((= (ascii "&")
            (ascii ctrl-string))
          (setq result (strcat result "\n"))
          (init-flag))
        ((= (ascii "A")
            (ascii (strcase (substr ctrl-string 1 1))))
          (setq result (strcat result (to-string (car variables))))
          (setq variables (cdr variables))
          (init-flag))
        ((= (ascii "S")
            (ascii (strcase (substr ctrl-string 1 1))))
          (setq result (strcat result (vl-prin1-to-string (car variables))))
          (setq variables (cdr variables))
          (init-flag))
        ((= (ascii "D")
            (ascii (strcase (substr ctrl-string 1 1))))
          (if (/= ""
              number1)
            (progn (setq tmp-str (to-string (car variables)))
              (if (> (atoi number1)
                  (strlen tmp-str))
                (repeat (- (atoi number1)
                    (strlen tmp-str))
                  (setq result (strcat result "
                      "))))
              (setq tmp-str "")))
          (setq result (strcat result (to-string (fix (car variables)))))
          (setq variables (cdr variables))
          (init-flag))
        ((= (ascii "B")
            (ascii (strcase (substr ctrl-string 1 1))))
          (if (/= ""
              number1)
            (progn (setq tmp-str (to-string (car variables)))
              (if (> (atoi number1)
                  (strlen tmp-str))
                (repeat (- (atoi number1)
                    (strlen tmp-str))
                  (setq result (strcat result "
                      "))))
              (setq tmp-str "")))
          (setq result (strcat result (m:dec->base (fix (car variables))
                2)))
          (setq variables (cdr variables))
          (init-flag))
        ((= (ascii "O")
            (ascii (strcase (substr ctrl-string 1 1))))
          (if (/= ""
              number1)
            (progn (setq tmp-str (to-string (car variables)))
              (if (> (atoi number1)
                  (strlen tmp-str))
                (repeat (- (atoi number1)
                    (strlen tmp-str))
                  (setq result (strcat result "
                      "))))
              (setq tmp-str "")))
          (setq result (strcat result (m:dec->base (fix (car variables))
                8)))
          (setq variables (cdr variables))
          (init-flag))
        ((= (ascii "X")
            (ascii (strcase (substr ctrl-string 1 1))))
          (if (/= ""
              number1)
            (progn (setq tmp-str (to-string (car variables)))
              (if (> (atoi number1)
                  (strlen tmp-str))
                (repeat (- (atoi number1)
                    (strlen tmp-str))
                  (setq result (strcat result "
                      "))))
              (setq tmp-str "")))
          (setq result (strcat result (m:dec->base (fix (car variables))
                16)))
          (setq variables (cdr variables))
          (init-flag))
        ((= (ascii "F")
            (ascii (strcase (substr ctrl-string 1 1))))
          (if (= ""
              number2)
            (setq tmp-str (rtos (car variables)
                2 3))
            (setq tmp-str (rtos (car variables)
                2 (atoi number2))))
          (if (/= ""
              number1)
            (progn (if (> (atoi number1)
                  (strlen tmp-str))
                (repeat (- (atoi number1)
                    (strlen tmp-str))
                  (setq result (strcat result "
                      "))))))
          (setq result (strcat result tmp-str))
          (setq tmp-str "")
          (setq variables (cdr variables))
          (init-flag))
        ((= (ascii "E")
            (ascii (strcase (substr ctrl-string 1 1))))
          (if (= ""
              number2)
            (setq tmp-str (rtos (car variables)
                1 3))
            (setq tmp-str (rtos (car variables)
                1 (atoi number2))))
          (if (/= ""
              number1)
            (progn (if (> (atoi number1)
                  (strlen tmp-str))
                (repeat (- (atoi number1)
                    (strlen tmp-str))
                  (setq result (strcat result "
                      "))))))
          (setq result (strcat result tmp-str))
          (setq tmp-str "")
          (setq variables (cdr variables))
          (init-flag))
        ((= (ascii "$")
            (ascii (strcase (substr ctrl-string 1 1))))
          (if (= ""
              number1)
            (setq result (strcat result (rtos (car variables)
                  2 2)))
            (setq result (strcat result (rtos (car variables)
                  2 (atoi number1)))))
          (setq variables (cdr variables))
          (init-flag))
        ((= (ascii "{")
            (ascii (strcase (substr ctrl-string 1 1))))
          (setq ctrl-string (substr ctrl-string 2))
          (setq sub-ctrl-string "")
          (while (and (<= 2 (strlen ctrl-string))
              (/= "~}"
                (substr ctrl-string 1 2)))
            (setq sub-ctrl-string (strcat sub-ctrl-string (substr ctrl-string 1 1)))
            (setq ctrl-string (substr ctrl-string 2)))
          (setq ctrl-string (substr ctrl-string 3))
          (foreach para (car variables)
            (if (atom para)
              (setq para (list para)))
            (setq result (strcat result (cl:format nil sub-ctrl-string para))))
          (setq variables (cdr variables))
          (init-flag))
        ((= (ascii "[")
            (ascii (strcase (substr ctrl-string 1 1))))
          (setq ctrl-string (substr ctrl-string 2))
          (setq sub-ctrl-string "")
          (while (and (<= 2 (strlen ctrl-string))
              (/= "~]"
                (substr ctrl-string 1 2)))
            (setq sub-ctrl-string (strcat sub-ctrl-string (substr ctrl-string 1 1)))
            (setq ctrl-string (substr ctrl-string 2)))
          (setq ctrl-string (substr ctrl-string 3))
          (setq sub-lst (string:parse-by-lst sub-ctrl-string (quote ("~;"
                  "~:;"))))
          (cond ((< (car variables)
                (length sub-lst))
              (setq result (strcat result (nth (car variables)
                    sub-lst))))
            (t (if (vl-string-search "`~:;"
                  sub-ctrl-string)
                (setq result (strcat result (last sub-lst))))))
          (setq variables (cdr variables))
          (init-flag)))
      (cond ((= (ascii "~")
            (ascii ctrl-string))
          (setq flag-instruct t))
        (t (setq result (strcat result (substr ctrl-string 1 1))))))
    (setq ctrl-string (substr ctrl-string 2)))
  (cond ((= t stream)
      (princ result)
      (princ))
    ((= nil stream)
      result)
    ((= (type stream)
        (quote file))
      (write-line result stream))))
```
</details>

---

### cl:handle-keywords

**è¯´æ˜**: å¤„ç†lispè¡¨è¾¾å¼æˆ–formä¸­çš„ å…³é”®å­—ç¬¦å·ï¼Œå› autolispçš„evalä¸æ”¯æŒã€‚åœ¨evalå‰è¿›è¡Œå¤„ç†ã€‚

**ç”¨æ³•**:
```lisp
(cl:handle-keywords expr)
```

**å‚æ•°**: 1 expr  : è¡¨è¾¾å¼ï¼Œä¸€èˆ¬æŒ‡lispè¡¨è¾¾å¼;

**è¿”å›å€¼**: expr

**ç¤ºä¾‹**:
```lisp
(cl:handle-keywords '(:a 1 :b 2 :c 3 :d "abc"))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun cl:handle-keywords (expr)
  "å¤„ç†lispè¡¨è¾¾å¼æˆ–formä¸­çš„ å…³é”®å­—ç¬¦å·ï¼Œå› autolispçš„evalä¸æ”¯æŒã€‚åœ¨evalå‰è¿›è¡Œå¤„ç†ã€‚"
  "expr"
  "(cl:handle-keywords '(:a 1 :b 2 :c 3 :d \"abc\"))"
  (cond ((listp expr)
      (mapcar (quote handle-keywords)
        expr))
    ((= (type expr)
        (quote sym))
      (if (and (= (ascii ":")
            (ascii (vl-symbol-name expr)))
          (null expr))
        (progn (setq sym-str (vl-symbol-name expr))
          (set (read sym-str)
            (read sym-str)))
        (read (vl-symbol-name expr))))
    (t expr)))
```
</details>

---

### cl:let

**è¯´æ˜**: commonlispä¸­çš„letï¼Œåœ¨autolispä¸­éœ€è¦åœ¨å‚æ•°å‰åŠ quoteï¼Œå½“bodyä¸ºå¤šæ¡è¯­å¥æ—¶éœ€è¦ç”¨ progn åŒ…è£¹ã€‚

**ç”¨æ³•**:
```lisp
(cl:let bindings body)
```

**å‚æ•°**: 1 bindings  : æœªè¯†åˆ«å®šä¹‰;2 body  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: any

**ç¤ºä¾‹**:
```lisp
(let '((a 3) (b 5)) '(* a b)) => 15
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun cl:let (bindings body)
  "commonlispä¸­çš„letï¼Œåœ¨autolispä¸­éœ€è¦åœ¨å‚æ•°å‰åŠ quoteï¼Œå½“bodyä¸ºå¤šæ¡è¯­å¥æ—¶éœ€è¦ç”¨ progn åŒ…è£¹ã€‚"
  "any"
  "(let '((a 3)
      (b 5))
    '(* a b))
  => 15"
  (eval (cons (list (quote lambda)
        (mapcar (quote car)
          bindings)
        body)
      (mapcar (quote cadr)
        bindings))))
```
</details>

---

### cl:pairlis

**è¯´æ˜**: ä¸¤ä¸ªåˆ—è¡¨æ„æˆ alisp

**ç”¨æ³•**:
```lisp
(cl:pairlis keys values)
```

**å‚æ•°**: 1 keys  : é”®ï¼Œå…³é”®å­—;2 values  : å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun cl:pairlis (keys values)
  "ä¸¤ä¸ªåˆ—è¡¨æ„æˆ alisp"
  (mapcar (quote (lambda (x y)
        (cons x y)))
    keys values))
```
</details>

---

### cl:rassoc

**è¯´æ˜**: åå‘æŸ¥è¯¢ alist,å³ä½¿ç”¨æ¯ä¸ªå…ƒç´ çš„CDRä¸­çš„å€¼ä½œä¸º key

**ç”¨æ³•**:
```lisp
(cl:rassoc key alist)
```

**å‚æ•°**: 1 key  : é”®ï¼Œå…³é”®å­—;2 alist  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun cl:rassoc (key alist / x)
  "åå‘æŸ¥è¯¢ alist,å³ä½¿ç”¨æ¯ä¸ªå…ƒç´ çš„CDRä¸­çš„å€¼ä½œä¸º key"
  (setq x (assoc key (mapcar (quote (lambda (x)
            (cons (cdr x)
              (car x))))
        alist)))
  (if x (cons (cdr x)
      (car x))))
```
</details>

---

## clipboard

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### clipboard:cleardata

**è¯´æ˜**: æ¸…ç©ºå‰ªè´´æ¿å†…å®¹

**ç”¨æ³•**:
```lisp
(clipboard:cleardata )
```

**å‚æ•°**: None

**è¿”å›å€¼**: -1

**ç¤ºä¾‹**:
```lisp
(clipboard:cleardata)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun clipboard:cleardata (/ cb)
  "æ¸…ç©ºå‰ªè´´æ¿å†…å®¹"
  "-1"
  "(clipboard:cleardata)"
  (clipboard:init)
  (vlax-invoke @:*clipboard* (quote cleardata)
    "text"))
```
</details>

---

### clipboard:getdata

**è¯´æ˜**: è·å–å‰ªè´´æ¿å†…å®¹

**ç”¨æ³•**:
```lisp
(clipboard:getdata )
```

**å‚æ•°**: None

**è¿”å›å€¼**: string or nil

**ç¤ºä¾‹**:
```lisp
(clipboard:getdata)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun clipboard:getdata (/ cb)
  "è·å–å‰ªè´´æ¿å†…å®¹"
  "string or nil"
  "(clipboard:getdata)"
  (clipboard:init)
  (vlax-invoke @:*clipboard* (quote getdata)
    "TEXT"))
```
</details>

---

### clipboard:init

**è¯´æ˜**: åˆå§‹åŒ–å‰ªè´´æ¿å¯¹è±¡ã€‚

**ç”¨æ³•**:
```lisp
(clipboard:init )
```

**å‚æ•°**: æ²¡æœ‰ä¸€ä¸ª

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun clipboard:init nil "åˆå§‹åŒ–å‰ªè´´æ¿å¯¹è±¡ã€‚"
  ""
  (setq @:*clipboard* (vlax-get (vlax-get-property (vlax-get-or-create-object "HTMLFILE")
        (quote parentwindow))
      (quote clipboarddata))))
```
</details>

---

### clipboard:setdata

**è¯´æ˜**: è®¾ç½®å‰ªè´´æ¿å†…å®¹ä¸º str.

**ç”¨æ³•**:
```lisp
(clipboard:setdata str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: -1

**ç¤ºä¾‹**:
```lisp
(clipboard:setdata "the string in clipboard.")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun clipboard:setdata (str / cb)
  "è®¾ç½®å‰ªè´´æ¿å†…å®¹ä¸º str."
  "-1"
  "(clipboard:setdata \"the string in clipboard.\")"
  (clipboard:init)
  (vlax-invoke @:*clipboard* (quote setdata)
    "text"
    str))
```
</details>

---

## color

**æ¨¡å—è¯´æ˜**: é¢œè‰²ç®¡ç†ã€æ ¼å¼è½¬æ¢

### color:aci2rgb

**è¯´æ˜**: ç´¢å¼•è‰²è½¬rgb, num èŒƒå›´ 1 - 255

**ç”¨æ³•**:
```lisp
(color:aci2rgb num)
```

**å‚æ•°**: 1 num  : æ•°å€¼;

**è¿”å›å€¼**: lst, çº¢ç»¿è“ä¸‰è‰²å€¼

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun color:aci2rgb (num)
  "ç´¢å¼•è‰²è½¬rgb, num èŒƒå›´ 1 - 255"
  "lst, çº¢ç»¿è“ä¸‰è‰²å€¼"
  (if (numberp num)
    (setq num (fix num))
    (setq num 0))
  (if (< 0 num 256)
    (progn (setq aci (quote ((1 255 0 0)
            (2 255 255 0)
            (3 0 255 0)
            (4 0 255 255)
            (5 0 0 255)
            (6 255 0 255)
            (7 255 255 255)
            (8 128 128 128)
            (9 192 192 192)
            (10 255 0 0)
            (11 255 127 127)
            (12 204 0 0)
            (13 204 102 102)
            (14 153 0 0)
            (15 153 76 76)
            (16 127 0 0)
            (17 127 63 63)
            (18 76 0 0)
            (19 76 38 38)
            (20 255 63 0)
            (21 255 159 127)
            (22 204 51 0)
            (23 204 127 102)
            (24 153 38 0)
            (25 153 95 76)
            (26 127 31 0)
            (27 127 79 63)
            (28 76 19 0)
            (29 76 47 38)
            (30 255 127 0)
            (31 255 191 127)
            (32 204 102 0)
            (33 204 153 102)
            (34 153 76 0)
            (35 153 114 76)
            (36 127 63 0)
            (37 127 95 63)
            (38 76 38 0)
            (39 76 57 38)
            (40 255 191 0)
            (41 255 223 127)
            (42 204 153 0)
            (43 204 178 102)
            (44 153 114 0)
            (45 153 133 76)
            (46 127 95 0)
            (47 127 111 63)
            (48 76 57 0)
            (49 76 66 38)
            (50 255 255 0)
            (51 255 255 127)
            (52 204 204 0)
            (53 204 204 102)
            (54 153 153 0)
            (55 153 153 76)
            (56 127 127 0)
            (57 127 127 63)
            (58 76 76 0)
            (59 76 76 38)
            (60 191 255 0)
            (61 223 255 127)
            (62 153 204 0)
            (63 178 204 102)
            (64 114 153 0)
            (65 133 153 76)
            (66 95 127 0)
            (67 111 127 63)
            (68 57 76 0)
            (69 66 76 38)
            (70 127 255 0)
            (71 191 255 127)
            (72 102 204 0)
            (73 153 204 102)
            (74 76 153 0)
            (75 114 153 76)
            (76 63 127 0)
            (77 95 127 63)
            (78 38 76 0)
            (79 57 76 38)
            (80 63 255 0)
            (81 159 255 127)
            (82 51 204 0)
            (83 127 204 102)
            (84 38 153 0)
            (85 95 153 76)
            (86 31 127 0)
            (87 79 127 63)
            (88 19 76 0)
            (89 47 76 38)
            (90 0 255 0)
            (91 127 255 127)
            (92 0 204 0)
            (93 102 204 102)
            (94 0 153 0)
            (95 76 153 76)
            (96 0 127 0)
            (97 63 127 63)
            (98 0 76 0)
            (99 38 76 38)
            (100 0 255 63)
            (101 127 255 159)
            (102 0 204 51)
            (103 102 204 127)
            (104 0 153 38)
            (105 76 153 95)
            (106 0 127 31)
            (107 63 127 79)
            (108 0 76 19)
            (109 38 76 47)
            (110 0 255 127)
            (111 127 255 191)
            (112 0 204 102)
            (113 102 204 153)
            (114 0 153 76)
            (115 76 153 114)
            (116 0 127 63)
            (117 63 127 95)
            (118 0 76 38)
            (119 38 76 57)
            (120 0 255 191)
            (121 127 255 223)
            (122 0 204 153)
            (123 102 204 178)
            (124 0 153 114)
            (125 76 153 133)
            (126 0 127 95)
            (127 63 127 111)
            (128 0 76 57)
            (129 38 76 66)
            (130 0 255 255)
            (131 127 255 255)
            (132 0 204 204)
            (133 102 204 204)
            (134 0 153 153)
            (135 76 153 153)
            (136 0 127 127)
            (137 63 127 127)
            (138 0 76 76)
            (139 38 76 76)
            (140 0 191 255)
            (141 127 223 255)
            (142 0 153 204)
            (143 102 178 204)
            (144 0 114 153)
            (145 76 133 153)
            (146 0 95 127)
            (147 63 111 127)
            (148 0 57 76)
            (149 38 66 76)
            (150 0 127 255)
            (151 127 191 255)
            (152 0 102 204)
            (153 102 153 204)
            (154 0 76 153)
            (155 76 114 153)
            (156 0 63 127)
            (157 63 95 127)
            (158 0 38 76)
            (159 38 57 76)
            (160 0 63 255)
            (161 127 159 255)
            (162 0 51 204)
            (163 102 127 204)
            (164 0 38 153)
            (165 76 95 153)
            (166 0 31 127)
            (167 63 79 127)
            (168 0 19 76)
            (169 38 47 76)
            (170 0 0 255)
            (171 127 127 255)
            (172 0 0 204)
            (173 102 102 204)
            (174 0 0 153)
            (175 76 76 153)
            (176 0 0 127)
            (177 63 63 127)
            (178 0 0 76)
            (179 38 38 76)
            (180 63 0 255)
            (181 159 127 255)
            (182 51 0 204)
            (183 127 102 204)
            (184 38 0 153)
            (185 95 76 153)
            (186 31 0 127)
            (187 79 63 127)
            (188 19 0 76)
            (189 47 38 76)
            (190 127 0 255)
            (191 191 127 255)
            (192 102 0 204)
            (193 153 102 204)
            (194 76 0 153)
            (195 114 76 153)
            (196 63 0 127)
            (197 95 63 127)
            (198 38 0 76)
            (199 57 38 76)
            (200 191 0 255)
            (201 223 127 255)
            (202 153 0 204)
            (203 178 102 204)
            (204 114 0 153)
            (205 133 76 153)
            (206 95 0 127)
            (207 111 63 127)
            (208 57 0 76)
            (209 66 38 76)
            (210 255 0 255)
            (211 255 127 255)
            (212 204 0 204)
            (213 204 102 204)
            (214 153 0 153)
            (215 153 76 153)
            (216 127 0 127)
            (217 127 63 127)
            (218 76 0 76)
            (219 76 38 76)
            (220 255 0 191)
            (221 255 127 223)
            (222 204 0 153)
            (223 204 102 178)
            (224 153 0 114)
            (225 153 76 133)
            (226 127 0 95)
            (227 127 63 111)
            (228 76 0 57)
            (229 76 38 66)
            (230 255 0 127)
            (231 255 127 191)
            (232 204 0 102)
            (233 204 102 153)
            (234 153 0 76)
            (235 153 76 114)
            (236 127 0 63)
            (237 127 63 95)
            (238 76 0 38)
            (239 76 38 57)
            (240 255 0 63)
            (241 255 127 159)
            (242 204 0 51)
            (243 204 102 127)
            (244 153 0 38)
            (245 153 76 95)
            (246 127 0 31)
            (247 127 63 79)
            (248 76 0 19)
            (249 76 38 47)
            (250 51 51 51)
            (251 91 91 91)
            (252 132 132 132)
            (253 173 173 173)
            (254 214 214 214)
            (255 255 255 255))))
      (cdr (assoc num aci)))
    (quote (0 0 0))))
```
</details>

---

### color:bookcolor2rgb

**è¯´æ˜**: å°†é…è‰²ç³»ç»Ÿé¢œè‰²åè½¬ä¸ºrgbã€‚

**ç”¨æ³•**:
```lisp
(color:bookcolor2rgb bookcolor)
```

**å‚æ•°**: 1 bookcolor  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: list

**ç¤ºä¾‹**:
```lisp
(color:bookcolor2rgb "DIC COLOR GUIDE(R)$DIC 4")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun color:bookcolor2rgb (bookcolor / bc ci)
  "å°†é…è‰²ç³»ç»Ÿé¢œè‰²åè½¬ä¸ºrgbã€‚"
  "list"
  "(color:bookcolor2rgb \"DIC COLOR GUIDE(R)$DIC 4\")"
  (setq bc (string:to-list bookcolor "$"))
  (vla-setcolorbookcolor (setq ci (color:interface))
    (car bc)
    (cadr bc))
  (list (vla-get-red ci)
    (vla-get-green ci)
    (vla-get-blue ci)))
```
</details>

---

### color:interface

**è¯´æ˜**: CAD é¢œè‰²æ¥å£å¯¹è±¡

**ç”¨æ³•**:
```lisp
(color:interface )
```

**å‚æ•°**: æ²¡æœ‰ä¸€ä¸ª

**è¿”å›å€¼**: ActiveX

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun color:interface nil "CAD é¢œè‰²æ¥å£å¯¹è±¡"
  "ActiveX"
  (vlax-create-object (strcat "AutoCAD.AcCmColor."
      (substr (getvar "ACADVER")
        1 2))))
```
</details>

---

### color:rgb

**è¯´æ˜**: è®¡ç®—rgbé¢œè‰²å¯¹åº”çš„æ•´æ•°å€¼ã€‚red green blue å–å€¼èŒƒå›´ä¸º [0,255]çš„æ•´æ•°æˆ–[0,1)çš„å°æ•°ã€‚

**ç”¨æ³•**:
```lisp
(color:rgb red green blue)
```

**å‚æ•°**: 1 red  : æœªè¯†åˆ«å®šä¹‰;2 green  : æœªè¯†åˆ«å®šä¹‰;3 blue  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: rgbé¢œè‰²å€¼

**ç¤ºä¾‹**:
```lisp
(color:rgb 255 0 0) or (color:rgb 0.999 0 0);çº¢è‰²
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun color:rgb (red green blue)
  "è®¡ç®—rgbé¢œè‰²å¯¹åº”çš„æ•´æ•°å€¼ã€‚red green blue å–å€¼èŒƒå›´ä¸º [0,255]çš„æ•´æ•°æˆ–[0,1)çš„å°æ•°ã€‚"
"rgbé¢œè‰²å€¼"
"(color:rgb 255 0 0)
or (color:rgb 0.999 0 0);çº¢è‰²"
(cond ((and (<= 0 red)
      (< red 1)
      (<= 0 green)
      (< green 1)
      (<= 0 blue)
      (< blue 1))
    (+ (fix (* 256 red))
      (* 256 (fix (* 256 green)))
      (* 65536 (fix (* 256 blue)))))
  ((and (<= 0 red 255)
      (<= 0 green 255)
      (<= 0 blue 255))
    (+ (fix red)
      (* 256 (fix green))
      (* 65536 (fix blue))))
  (t (+ 255 (* 256 255)
      (* 65536 255)))))
```
</details>

---

### color:rgb2css

**è¯´æ˜**: å°† color çš„ä¸‰è‰²å€¼è½¬æ¢ä¸º #FFFFFF æ ·å¼çš„å­—ç¬¦ä¸²

**ç”¨æ³•**:
```lisp
(color:rgb2css lst-color)
```

**å‚æ•°**: 1 lst-color  : åˆ—è¡¨;

**è¿”å›å€¼**: String

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun color:rgb2css (lst-color)
  "å°† color çš„ä¸‰è‰²å€¼è½¬æ¢ä¸º #FFFFFF æ ·å¼çš„å­—ç¬¦ä¸²"
  "String"
  (strcat "#"
    (string:from-list (mapcar (quote (lambda (x / c)
            (setq c (substr (vl-symbol-name (m:dec2hex x))
                3))
            (if (= 1 (strlen c))
              (strcat "0"
                c)
              c)))
        lst-color)
      "")))
```
</details>

---

### color:rgb2truecolor

**è¯´æ˜**: RGBå€¼åˆ—è¡¨è½¬ä¸ºçœŸå½©è‰²å€¼

**ç”¨æ³•**:
```lisp
(color:rgb2truecolor rgb)
```

**å‚æ•°**: 1 rgb  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: long

**ç¤ºä¾‹**:
```lisp
(color:rgb2truecolor (list 3 5 8))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun color:rgb2truecolor (rgb / ci)
  "RGBå€¼åˆ—è¡¨è½¬ä¸ºçœŸå½©è‰²å€¼"
  "long"
  "(color:rgb2truecolor (list 3 5 8))"
  (setq ci (color:interface))
  (vla-put-red ci (car rgb))
  (vla-put-green (cadr ci))
  (vla-put-blue (caddr ci))
  (vla-get-entitycolor ci))
```
</details>

---

### color:truecolor2aci

**è¯´æ˜**: çœŸå½©è‰²å·è½¬ä¸ºè¿‘ä¼¼çš„ç´¢å¼•è‰²å·

**ç”¨æ³•**:
```lisp
(color:truecolor2aci long)
```

**å‚æ•°**: 1 long  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: int

**ç¤ºä¾‹**:
```lisp
(color:truecolor2aci 2076128) => 142
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun color:truecolor2aci (long / ci)
  "çœŸå½©è‰²å·è½¬ä¸ºè¿‘ä¼¼çš„ç´¢å¼•è‰²å·"
  "int"
  "(color:truecolor2aci 2076128)
  => 142"
  (setq ci (color:interface))
  (vla-put-entitycolor ci long)
  (vla-get-colorindex ci))
```
</details>

---

### color:truecolor2rgb

**è¯´æ˜**: çœŸå½©è‰²å·è½¬ä¸ºRGBå€¼åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(color:truecolor2rgb long)
```

**å‚æ•°**: 1 long  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: list

**ç¤ºä¾‹**:
```lisp
(color:truecolor2rgb 2076128)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun color:truecolor2rgb (long / ci)
  "çœŸå½©è‰²å·è½¬ä¸ºRGBå€¼åˆ—è¡¨"
  "list"
  "(color:truecolor2rgb 2076128)"
  (setq ci (color:interface))
  (vla-put-entitycolor ci long)
  (list (vla-get-red ci)
    (vla-get-green ci)
    (vla-get-blue ci)))
```
</details>

---

## crypto

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### crypto:md5

**è¯´æ˜**: å¯¹å­—ç¬¦ä¸²strè¿›è¡Œmd5æ•£åˆ—ï¼Œæ³¨æ„ï¼šå¯¹äºå®½å­—èŠ‚æ–‡å­—ï¼Œå…¶ç¼–ç ä¸ºunicodeï¼Œè€Œä¸æ˜¯utf8æˆ–ansi

**ç”¨æ³•**:
```lisp
(crypto:md5 str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: str

**ç¤ºä¾‹**:
```lisp
(crypto:md5 "abc") ;;=> 900150983cd24fb0d6963f7d28e17f72
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun crypto:md5 (str)
  "å¯¹å­—ç¬¦ä¸²strè¿›è¡Œmd5æ•£åˆ—ï¼Œæ³¨æ„ï¼šå¯¹äºå®½å­—èŠ‚æ–‡å­—ï¼Œå…¶ç¼–ç ä¸ºunicodeï¼Œè€Œä¸æ˜¯utf8æˆ–ansi"
  "str"
  "(crypto:md5 \"abc\")
  ;;=> 900150983cd24fb0d6963f7d28e17f72"
  (@:post (strcat (@:uri)
      "/crypto.php?method=md5")
    (strcat "q="
      str)))
```
</details>

---

## curve

**æ¨¡å—è¯´æ˜**: æ›²çº¿å¤„ç†ã€é•¿åº¦è®¡ç®—ã€ä¼˜åŒ–

### curve:3pt+chord2pt

**è¯´æ˜**: å·²çŸ¥åœ†å¼§ä¸Šä¸‰ç‚¹pt1,pt2,pt3,æ±‚æ­¤åœ†å¼§ä¸Šå’Œpt-on-arcå¼¦é•¿ä¸ºchord-lengthçš„ç‚¹

**ç”¨æ³•**:
```lisp
(curve:3pt+chord2pt pt1 pt2 pt3 chord-length pt-on-arc)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 pt3  : å•ä¸ª2D/3Dåæ ‡ç‚¹;4 chord-length  : æœªè¯†åˆ«å®šä¹‰;5 pt-on-arc  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: pt

**ç¤ºä¾‹**:
```lisp
(curve:3pt+chord2pt pt1 pt2 pt3 chord-length pt-on-arc)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:3pt+chord2pt (pt1 pt2 pt3 chord-length pt-on-arc / angle1 angle2 center half-chord-angle pt-other radius)
  "å·²çŸ¥åœ†å¼§ä¸Šä¸‰ç‚¹pt1,pt2,pt3,æ±‚æ­¤åœ†å¼§ä¸Šå’Œpt-on-arcå¼¦é•¿ä¸ºchord-lengthçš„ç‚¹"
  "pt"
  "(curve:3pt+chord2pt pt1 pt2 pt3 chord-length pt-on-arc)"
  (setq center (curve:3pt2o pt1 pt2 pt3)
    radius (distance center pt1))
  (setq half-chord-angle (m:acos (- 1 (/ (expt chord-length 2)
          (* 2 (expt radius 2))))))
  (setq angle1 (angle center pt-on-arc))
  (if (> (geometry:turn-right-p pt1 pt2 pt3)
      0)
    (setq angle2 (+ angle1 half-chord-angle))
    (setq angle2 (- angle1 half-chord-angle)))
  (setq pt-other (polar center angle2 radius))
  pt-other)
```
</details>

---

### curve:3pt2bulge

**è¯´æ˜**: ä¸‰ç‚¹æ±‚å‡¸åº¦ï¼Œä»»æ„ä¸¤ç‚¹çš„å‚çº¿çš„äº¤ç‚¹å³åœ†å¿ƒã€‚

**ç”¨æ³•**:
```lisp
(curve:3pt2bulge pt1 pt2 pt3)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 pt3  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: number

**ç¤ºä¾‹**:
```lisp
(curve:3pt2bulge (getpoint)(getpoint)(getpoint))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:3pt2bulge (pt1 pt2 pt3 / ptm1 ptm2)
  "ä¸‰ç‚¹æ±‚å‡¸åº¦ï¼Œä»»æ„ä¸¤ç‚¹çš„å‚çº¿çš„äº¤ç‚¹å³åœ†å¿ƒã€‚"
  "number"
  "(curve:3pt2bulge (getpoint)(getpoint)(getpoint))"
  (* (if (> (geometry:turn-right-p pt1 pt2 pt3)
        0)
      1 -1)
    ((if (> (geometry:turn-right-p pt1 pt2 pt3)
          0)
        curve:o2bulge curve:o2bulge-clockwise)
      pt1 pt3 (curve:3pt2o pt1 pt2 pt3))))
```
</details>

---

### curve:3pt2bulge-plus

**è¯´æ˜**: ä¸‰ç‚¹æ±‚å‡¸åº¦ï¼Œä»»æ„ä¸¤ç‚¹çš„å‚çº¿çš„äº¤ç‚¹å³åœ†å¿ƒã€‚å¢åŠ pt2æ˜¯å¦åœ¨åœ†å¼§ä¸Šçš„åˆ¤æ–­

**ç”¨æ³•**:
```lisp
(curve:3pt2bulge-plus pt1 pt2 pt3)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 pt3  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: number

**ç¤ºä¾‹**:
```lisp
(curve:3pt2bulge-plus (getpoint)(getpoint)(getpoint))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:3pt2bulge-plus (pt1 pt2 pt3)
  "ä¸‰ç‚¹æ±‚å‡¸åº¦ï¼Œä»»æ„ä¸¤ç‚¹çš„å‚çº¿çš„äº¤ç‚¹å³åœ†å¿ƒã€‚å¢åŠ pt2æ˜¯å¦åœ¨åœ†å¼§ä¸Šçš„åˆ¤æ–­"
  "number"
  "(curve:3pt2bulge-plus (getpoint)(getpoint)(getpoint))"
  (if (curve:pt-in-arc-p pt2 pt1 pt3 (curve:3pt2bulge pt1 pt2 pt3))
    (curve:3pt2bulge pt1 pt2 pt3)
    (curve:3pt2bulge-clockwise pt1 pt2 pt3)))
```
</details>

---

### curve:3pt2o

**è¯´æ˜**: ä¸‰ç‚¹æ±‚åœ†å¿ƒï¼Œä»»æ„ä¸¤ç‚¹çš„å‚çº¿çš„äº¤ç‚¹å³åœ†å¿ƒã€‚

**ç”¨æ³•**:
```lisp
(curve:3pt2o pt1 pt2 pt3)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 pt3  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: number

**ç¤ºä¾‹**:
```lisp
(curve:3pt2o (getpoint)(getpoint)(getpoint))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:3pt2o (pt1 pt2 pt3 / ptm1 ptm2)
  "ä¸‰ç‚¹æ±‚åœ†å¿ƒï¼Œä»»æ„ä¸¤ç‚¹çš„å‚çº¿çš„äº¤ç‚¹å³åœ†å¿ƒã€‚"
  "number"
  "(curve:3pt2o (getpoint)(getpoint)(getpoint))"
  (inters (setq ptm1 (point:mid pt1 pt2))
    (polar ptm1 (m:fix-angle (+ (* 0.5 pi)
          (angle pt1 pt2)))
      1000)
    (setq ptm2 (point:mid pt1 pt3))
    (polar ptm2 (m:fix-angle (+ (* 0.5 pi)
          (angle pt1 pt3)))
      1000)
    nil))
```
</details>

---

### curve:arc2lwpl

**è¯´æ˜**: å°†åœ†å¼§è½¬æ¢æˆ ç”± int æ®µç»„æˆçš„å¤šæ®µçº¿, int ä¸å°äº 1

**ç”¨æ³•**:
```lisp
(curve:arc2lwpl ent-arc int)
```

**å‚æ•°**: 1 ent-arc  : å•ä¸ªå›¾å…ƒ;2 int  : æ•´æ•°;

**è¿”å›å€¼**: å¤šæ®µçº¿å›¾å…ƒ

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:arc2lwpl (ent-arc int / pt-center r pts bulge convexity ent i)
  "å°†åœ†å¼§è½¬æ¢æˆ ç”± int æ®µç»„æˆçš„å¤šæ®µçº¿, int ä¸å°äº 1"
  "å¤šæ®µçº¿å›¾å…ƒ"
  (setq int (fix int))
  (if (< (fix int)
      1)
    (setq int 1))
  (setq pt-center (entity:getdxf ent-arc 10)
    r (entity:getdxf ent-arc 40))
  (setq pts (quote nil))
  (setq begin-ang (entity:getdxf ent-arc 50))
  (setq end-ang (entity:getdxf ent-arc 51))
  (setq rad (- (entity:getdxf ent-arc 51)
      (entity:getdxf ent-arc 50)))
  (if (< rad 0)
    (setq rad (+ rad (* 2 pi))))
  (setq bulge (curve:o2bulge (polar pt-center begin-ang r)
      (polar pt-center (+ begin-ang (/ rad int))
        r)
      pt-center))
  (setq i 0)
  (repeat (1+ int)
    (setq pts (cons (polar pt-center (+ begin-ang (* i (/ rad int)))
          r)
        pts))
    (setq i (1+ i))
    (setq convexity (cons (- bulge)
        convexity)))
  (push-var)
  (setvar "osmode"
    0)
  (setq ent (entity:putdxf (entity:putdxf (entity:make-lwpline-bold pts convexity nil 0 0)
        8 (entity:getdxf ent-arc 8))
      62 (if (entity:getdxf ent-arc 62)
        (entity:getdxf ent-arc 62)
        256)))
  (pop-var)
  ent)
```
</details>

---

### curve:bulge2o

**è¯´æ˜**: æ±‚å‡¸åº¦bulge å’Œä¸¤ç‚¹ pt1 pt2 è¡¨ç¤ºçš„å¼§çš„åœ†å¿ƒã€‚

**ç”¨æ³•**:
```lisp
(curve:bulge2o pt1 pt2 bulge)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 bulge  : å‡¸åº¦;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:bulge2o (pt1 pt2 bulge / b x1 y1 x2 y2)
  "æ±‚å‡¸åº¦bulge å’Œä¸¤ç‚¹ pt1 pt2 è¡¨ç¤ºçš„å¼§çš„åœ†å¿ƒã€‚"
  (setq b (* 0.5 (- (/ 1.0 bulge)
        bulge)))
  (setq x1 (car pt1)
    y1 (cadr pt1)
    x2 (car pt2)
    y2 (cadr pt2)
    z1 (caddr pt1)
    z2 (caddr pt2))
  (if z1 (list (* 0.5 (- (+ x1 x2)
          (* b (- y2 y1))))
      (* 0.5 (+ (+ y1 y2)
          (* b (- x2 x1))))
      z1)
    (list (* 0.5 (- (+ x1 x2)
          (* b (- y2 y1))))
      (* 0.5 (+ (+ y1 y2)
          (* b (- x2 x1)))))))
```
</details>

---

### curve:chain-line

**ç”¨æ³•**:
```lisp
(curve:chain-line pt1)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:chain-line (pt1 / segments pts-ent i%)
  (setq lst-ss1 (pickset:to-list (ssget "C"
        (polar pt1 (* 1.25 pi)
          1)
        (polar pt1 (* 0.25 pi)
          1)
        (quote ((0 . "LINE,LWPOLYLINE,POLYLINE"))))))
  (setq pts (quote nil))
  (setq segments (quote nil))
  (setq pts (curve:pline-3dpoints (car lst-ss1)))
  (print pts)
  (defun ssget-by-point (pt1 / lst-ss1)
    (push-var)
    (setvar "osmode"
      0)
    (setq lst-ss1 (pickset:to-list (ssget "C"
          (polar pt1 (* 1.25 pi)
            10)
          (polar pt1 (* 0.25 pi)
            10)
          (quote ((0 . "LINE,LWPOLYLINE,POLYLINE"))))))
    (pop-var)
    lst-ss1)
  (setq i% 0)
  (setq pt-old nil)
  (while (and (> (length (setq lst-ss-pre (ssget-by-point (car pts))))
        1)
      (/= pt-old (car pts))
      (< i% 50))
    (setq pt-old (car pts))
    (entity:make-point (car pts))
    (foreach ent% lst-ss-pre (if (null (member ent% lst-ss1))
        (progn (setq lst-ss1 (cons ent% lst-ss1))
          (setq pts-ent (curve:pline-3dpoints ent%))
          (if (< (distance (car pts-ent)
                (car pts))
              0.001)
            (setq pts (append (reverse pts-ent)
                (cdr pts)))
            (if (< (distance (last pts-ent)
                  (car pts))
                0.001)
              (setq pts (append pts-ent (cdr pts))))))))
    (setq i% (1+ i%)))
  (while (and (> (length (setq lst-ss-pre (ssget-by-point (last pts))))
        1)
      (/= pt-old (last pts))
      (< i% 50))
    (setq pt-old (last pts))
    (entity:make-point (car pts))
    (foreach ent% lst-ss-pre (if (null (member ent% lst-ss1))
        (progn (setq lst-ss1 (append lst-ss1 (list ent%)))
          (setq pts-ent (curve:pline-3dpoints ent%))
          (if (< (distance (car pts-ent)
                (last pts))
              0.001)
            (setq pts (append pts (cdr pts-ent)))
            (if (< (distance (last pts-ent)
                  (last pts))
                0.001)
              (setq pts (append pts (cdr (reverse pts-ent)))))))))
    (setq i% (1+ i%)))
  (setq pl-new (entity:make-lwpline-bold pts nil 0 0 0.3))
  (print pts))
```
</details>

---

### curve:checkarc

**è¯´æ˜**: åˆ¤æ–­å¤šæ®µçº¿æ˜¯å¦æœ‰åœ†å¼§(å‡¸åº¦/=0)çš„å­æ®µ

**ç”¨æ³•**:
```lisp
(curve:checkarc en)
```

**å‚æ•°**: 1 en  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:checkarc (en / g)
  "åˆ¤æ–­å¤šæ®µçº¿æ˜¯å¦æœ‰åœ†å¼§(å‡¸åº¦/=0)çš„å­æ®µ"
  (setq g (vl-remove-if-not (quote (lambda (x)
          (= (car x)
            42)))
      (entget en)))
  (not (vl-every (quote zerop)
      (mapcar (quote cdr)
        g))))
```
</details>

---

### curve:circle2lwpl

**è¯´æ˜**: å°†åœ†è½¬æ¢æˆ ç”± int æ®µç»„æˆçš„å¤šæ®µçº¿ã€‚

**ç”¨æ³•**:
```lisp
(curve:circle2lwpl ent-circle int)
```

**å‚æ•°**: 1 ent-circle  : å•ä¸ªå›¾å…ƒ;2 int  : æ•´æ•°;

**è¿”å›å€¼**: å¤šæ®µçº¿å›¾å…ƒ

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:circle2lwpl (ent-circle int / pt-center r pts bulge convexity ent i)
  "å°†åœ†è½¬æ¢æˆ ç”± int æ®µç»„æˆçš„å¤šæ®µçº¿ã€‚"
  "å¤šæ®µçº¿å›¾å…ƒ"
  (setq int (fix int))
  (if (< (fix int)
      2)
    (setq int 2))
  (setq pt-center (entity:getdxf ent-circle 10)
    r (entity:getdxf ent-circle 40))
  (setq pts (quote nil))
  (setq bulge (curve:o2bulge (polar pt-center 0 r)
      (polar pt-center (/ (* 2 pi)
          int)
        r)
      pt-center))
  (setq i 0)
  (repeat int (setq pts (cons (polar pt-center (* i (/ (* 2 pi)
              int))
          r)
        pts))
    (setq i (1+ i))
    (setq convexity (cons (- bulge)
        convexity)))
  (push-var)
  (setvar "osmode"
    0)
  (setq ent (entity:putdxf (entity:putdxf (entity:make-lwpline-bold pts convexity nil 1 0)
        8 (entity:getdxf ent-circle 8))
      62 (if (entity:getdxf ent-circle 62)
        (entity:getdxf ent-circle 62)
        256)))
  (pop-var)
  ent)
```
</details>

---

### curve:circle2pts

**è¯´æ˜**: æ±‚åœ†ä¸Š int ä¸ªå‡åˆ†çš„ç‚¹ã€‚

**ç”¨æ³•**:
```lisp
(curve:circle2pts ent-circle int)
```

**å‚æ•°**: 1 ent-circle  : å•ä¸ªå›¾å…ƒ;2 int  : æ•´æ•°;

**è¿”å›å€¼**: list

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:circle2pts (ent-circle int / pt-center r pts bulge convexity ent i)
  "æ±‚åœ†ä¸Š int ä¸ªå‡åˆ†çš„ç‚¹ã€‚"
  "list"
  (setq int (fix int))
  (if (< (fix int)
      2)
    (setq int 2))
  (setq pt-center (entity:getdxf ent-circle 10)
    r (entity:getdxf ent-circle 40))
  (setq pts (quote nil))
  (setq i 0)
  (repeat int (setq pts (cons (polar pt-center (* i (/ (* 2 pi)
              int))
          r)
        pts))
    (setq i (1+ i)))
  pts)
```
</details>

---

### curve:clockwisep

**è¯´æ˜**: åˆ¤æ–­å¤šæ®µçº¿æ–¹å‘

**ç”¨æ³•**:
```lisp
(curve:clockwisep ent)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: é¡ºæ—¶é’ˆè¿”å›tï¼Œåä¹‹nil

**ç¤ºä¾‹**:
```lisp
(curve:clockwisep (car(entsel)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:clockwisep (ent / fx offsetobj plineobj)
  "åˆ¤æ–­å¤šæ®µçº¿æ–¹å‘"
  "é¡ºæ—¶é’ˆè¿”å›tï¼Œåä¹‹nil"
  "(curve:clockwisep (car(entsel)))"
  (setq plineobj (vlax-ename->vla-object ent))
  (setq offsetplineobj (car (vlax-safearray->list (vlax-variant-value (vla-offset plineobj 0.0001)))))
  (if (> (vlax-curve-getdistatparam plineobj (vlax-curve-getendparam plineobj))
      (vlax-curve-getdistatparam offsetplineobj (vlax-curve-getendparam offsetplineobj)))
    (setq fx t)
    (setq fx nil))
  (vla-delete offsetplineobj)
  fx)
```
</details>

---

### curve:get-angles

**è¯´æ˜**: å–å¾—é—­åˆå¤šæ®µçº¿å„ç‚¹ç›¸é‚»è¾¹çš„å¤¹è§’è§’åº¦å€¼

**ç”¨æ³•**:
```lisp
(curve:get-angles lwpl)
```

**å‚æ•°**: 1 lwpl  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: list

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:get-angles (lwpl / pts angles)
  "å–å¾—é—­åˆå¤šæ®µçº¿å„ç‚¹ç›¸é‚»è¾¹çš„å¤¹è§’è§’åº¦å€¼"
  "list"
  (setq pts (curve:get-points lwpl))
  (setq pts (append (list (last pts))
      pts (list (car pts))))
  (setq angles (quote nil))
  (while (> (length pts)
      2)
    (setq angles (cons (m:fix-angle (- (angle (cadr pts)
              (caddr pts))
            (angle (car pts)
              (cadr pts))))
        angles))
    (setq pts (cdr pts)))
  (reverse angles))
```
</details>

---

### curve:get-points

**è¯´æ˜**: æ›²çº¿æ§åˆ¶ç‚¹åŠç«¯ç‚¹åˆ—è¡¨ï¼Œè¿”å›ç‚¹åæ ‡ã€‚

**ç”¨æ³•**:
```lisp
(curve:get-points ent)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: ç‚¹åæ ‡åˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(curve:get-points (car (entsel)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:get-points (ent)
  "æ›²çº¿æ§åˆ¶ç‚¹åŠç«¯ç‚¹åˆ—è¡¨ï¼Œè¿”å›ç‚¹åæ ‡ã€‚"
  "ç‚¹åæ ‡åˆ—è¡¨"
  "(curve:get-points (car (entsel)))"
  (if (p:vlap ent)
    (setq ent (o2e ent)))
  (if (= (quote ename)
      (type ent))
    (cond ((wcmatch (entity:getdxf ent 0)
          "*POLYLINE,LINE,MLINE,CIRCLE,SPLINE,REGION")
        (mapcar (quote cdr)
          (vl-remove-if-not (quote (lambda (x)
                (or (= 10 (car x))
                  (= 11 (car x)))))
            (entget ent))))
      ((wcmatch (entity:getdxf ent 0)
          "ELLIPSE")
        (mapcar (quote cdr)
          (vl-remove-if-not (quote (lambda (x)
                (= 10 (car x))))
            (entget ent))))
      ((wcmatch (entity:getdxf ent 0)
          "ARC")
        (list (polar (entity:getdxf ent 10)
            (entity:getdxf ent 50)
            (entity:getdxf ent 40))
          (polar (entity:getdxf ent 10)
            (entity:getdxf ent 51)
            (entity:getdxf ent 40)))))))
```
</details>

---

### curve:inters

**è¯´æ˜**: è·å–å¯¹è±¡äº¤ç‚¹åˆ—è¡¨å‚æ•° obj1 obj2 : é€‰æ‹©é›†ï¼Œvlaå¯¹è±¡ï¼Œå›¾å…ƒåï¼Œvlaå¯¹è±¡è¡¨ï¼Œå›¾å…ƒè¡¨ï¼Œnilå‚æ•° mode: è¯¥å‚æ•°åªæœ‰obj1ã€obj2ä¸ºå›¾å…ƒæˆ–vlaå¯¹è±¡æ—¶ï¼Œæœä»ä¸‹åˆ—è®¾ç½®ï¼Œå…¶ä»–æƒ…å†µå‡é»˜è®¤å¯¹è±¡ä¸å»¶ä¼¸     obj1 å’Œ obj2 å‚æ•°å¯ä»»æ„ç»„åˆï¼Œä½†ä¸èƒ½å…¨ä¸ºnil     acExtendNone å¯¹è±¡ä¸å»¶ä¼¸     acExtendThisEntity å»¶ä¼¸obj1     acExtendOtherEntity å»¶ä¼¸obj2     acExtendBoth å¯¹è±¡éƒ½å»¶ä¼¸     nil = acExtendNone å¯¹è±¡ä¸å»¶ä¼¸

**ç”¨æ³•**:
```lisp
(curve:inters obj1 obj2 mode)
```

**å‚æ•°**: 1 obj1  : activeX å¯¹è±¡;2 obj2  : activeX å¯¹è±¡;3 mode  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: å¯¹è±¡äº¤ç‚¹åˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(curve:inters obj1 obj2 acExtendNone)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:inters (obj1 obj2 mode / getinterpts inter-objlist inter-objlists inter-ss-obj res)
  "è·å–å¯¹è±¡äº¤ç‚¹åˆ—è¡¨\nå‚æ•° obj1 obj2 : é€‰æ‹©é›†ï¼Œvlaå¯¹è±¡ï¼Œå›¾å…ƒåï¼Œvlaå¯¹è±¡è¡¨ï¼Œå›¾å…ƒè¡¨ï¼Œnil\nå‚æ•° mode: è¯¥å‚æ•°åªæœ‰obj1ã€obj2ä¸ºå›¾å…ƒæˆ–vlaå¯¹è±¡æ—¶ï¼Œæœä»ä¸‹åˆ—è®¾ç½®ï¼Œå…¶ä»–æƒ…å†µå‡é»˜è®¤å¯¹è±¡ä¸å»¶ä¼¸\n     obj1 å’Œ obj2 å‚æ•°å¯ä»»æ„ç»„åˆï¼Œä½†ä¸èƒ½å…¨ä¸ºnil\n     acExtendNone å¯¹è±¡ä¸å»¶ä¼¸\n     acExtendThisEntity å»¶ä¼¸obj1\n     acExtendOtherEntity å»¶ä¼¸obj2\n     acExtendBoth å¯¹è±¡éƒ½å»¶ä¼¸\n     nil = acExtendNone å¯¹è±¡ä¸å»¶ä¼¸"
  "å¯¹è±¡äº¤ç‚¹åˆ—è¡¨"
  "(curve:inters obj1 obj2 acExtendNone)"
  (or mode (setq mode acextendnone))
  (defun getinterpts (obj1 obj2 mode / iplist)
    (or (p:vlap obj1)
      (setq obj1 (e2o obj1)))
    (or (p:vlap obj2)
      (setq obj2 (e2o obj2)))
    (setq iplist (vl-catch-all-apply (quote vlax-safearray->list)
        (list (vlax-variant-value (vla-intersectwith obj1 obj2 mode)))))
    (if (vl-catch-all-error-p iplist)
      nil (list:split-3d iplist)))
  (defun inter-ss-obj (ss obj / res1)
    (cond ((p:picksetp ss)
        (setq ss (pickset:to-vlalist ss)))
      ((p:ename-listp ss)
        (setq ss (mapcar (quote e2o)
            ss))))
    (foreach i ss (setq res1 (append res1 (getinterpts i obj acextendnone))))
    res1)
  (defun inter-objlist (lst / ob1 rtn)
    (cond ((= (quote pickset)
          (type lst))
        (setq lst (pickset:to-vlalist lst)))
      ((p:ename-listp lst)
        (setq lst (mapcar (quote e2o)
            lst))))
    (while (setq ob1 (car lst))
      (foreach ob2 (setq lst (cdr lst))
        (setq rtn (cons (getinterpts ob1 ob2 acextendnone)
            rtn))))
    (apply (quote append)
      (reverse rtn)))
  (defun inter-objlists (ol1 ol2 / rtn)
    (cond ((= (quote pickset)
          (type ol1))
        (setq ol1 (pickset:to-vlalist ol1)))
      ((p:ename-listp ol1)
        (setq ol1 (mapcar (quote e2o)
            ol1))))
    (cond ((= (quote pickset)
          (type ol2))
        (setq ol2 (pickset:to-vlalist ol2)))
      ((p:ename-listp ol1)
        (setq ol2 (mapcar (quote e2o)
            ol2))))
    (foreach ob1 ol1 (foreach ob2 ol2 (setq rtn (cons (getinterpts ob1 ob2 acextendnone)
            rtn))))
    (apply (quote append)
      (reverse rtn)))
  (cond ((and (or (p:vlap obj1)
          (p:enamep obj1))
        (or (p:vlap obj2)
          (p:enamep obj2)))
      (setq res (getinterpts obj1 obj2 mode)))
    ((and (or (p:vlap obj1)
          (p:enamep obj1))
        (or (p:picksetp obj2)
          (p:ename-listp obj2)
          (p:vla-listp obj2)))
      (setq res (inter-ss-obj obj2 obj1)))
    ((and (or (p:vlap obj2)
          (p:enamep obj2))
        (p:picksetp obj1))
      (setq res (inter-ss-obj obj1 obj2)))
    ((and (not obj1)
        (or (p:picksetp obj2)
          (p:ename-listp obj2)
          (p:vla-listp obj2)))
      (setq res (inter-objlist obj2)))
    ((and (not obj2)
        (or (p:picksetp obj1)
          (p:ename-listp obj1)
          (p:vla-listp obj1)))
      (setq res (inter-objlist obj1)))
    ((and (or (p:vla-listp obj1)
          (p:picksetp obj1)
          (p:ename-listp obj1))
        (or (p:vla-listp obj2)
          (p:picksetp obj2)
          (p:ename-listp obj2)))
      (setq res (inter-objlists obj1 obj2)))
    (t (setq res nil)))
  res)
```
</details>

---

### curve:join

**è¯´æ˜**: åˆå¹¶å¤šæ®µçº¿å‡½æ•°

**ç”¨æ³•**:
```lisp
(curve:join entlst fuzz)
```

**å‚æ•°**: 1 entlst  : å•ä¸ªå›¾å…ƒ;2 fuzz  : å®¹å·®;

**è¿”å›å€¼**: return:åˆå¹¶åçš„å¤šæ®µçº¿å›¾å…ƒå

**ç¤ºä¾‹**:
```lisp
example:(curve:join '(ent1 ent2 ent3 ..) 0.000001)   (curve:join (ssget) 0.000001)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:join (entlst fuzz)
  "åˆå¹¶å¤šæ®µçº¿å‡½æ•°"
  "return:åˆå¹¶åçš„å¤šæ®µçº¿å›¾å…ƒå"
  "example:(curve:join '(ent1 ent2 ent3 ..)
    0.000001)\n   (curve:join (ssget)
    0.000001)\n"
  (setq oldpeditaccept (getvar "PEDITACCEPT"))
  (setvar "PEDITACCEPT"
    1)
  (if (= fuzz nil)
    (setq fuzz 1.0e-006))
  (if (not (p:picksetp entlst))
    (cond ((p:ename-listp entlst)
        (setq entlst (entlist->pickset entlst)))
      ((p:vla-listp entlst)
        (setq entlst (entlist->pickset (mapcar (quote vla->e)
              entlst))))))
  (command "_.pedit"
    "_M"
    entlst ""
    "_J"
    "_J"
    "_B"
    fuzz "")
  (setvar "cmdecho"
    0)
  (setvar "PEDITACCEPT"
    oldpeditaccept)
  (entlast))
```
</details>

---

### curve:length

**è¯´æ˜**: å‚æ•°curve:æ›²çº¿ï¼Œç›´çº¿ã€åœ†å¼§ã€åœ†ã€å¤šæ®µçº¿ã€ä¼˜åŒ–å¤šæ®µçº¿ã€æ ·æ¡æ›²çº¿,å¤šçº¿ï¼ˆæ§åˆ¶ç‚¹ï¼‰ç­‰å›¾å…ƒ

**ç”¨æ³•**:
```lisp
(curve:length curve)
```

**å‚æ•°**: 1 curve  : æ›²çº¿;

**è¿”å›å€¼**: æ›²çº¿çš„é•¿åº¦

**ç¤ºä¾‹**:
```lisp
(curve:Length (car (entsel)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:length (curve)
  "å‚æ•°curve:æ›²çº¿ï¼Œç›´çº¿ã€åœ†å¼§ã€åœ†ã€å¤šæ®µçº¿ã€ä¼˜åŒ–å¤šæ®µçº¿ã€æ ·æ¡æ›²çº¿,å¤šçº¿ï¼ˆæ§åˆ¶ç‚¹ï¼‰ç­‰å›¾å…ƒ"
  "æ›²çº¿çš„é•¿åº¦"
  "(curve:Length (car (entsel)))"
  (if (= (quote ename)
      (type curve))
    (setq curve (e2o curve)))
  (cond ((string-equal "AcDbMline"
        (vla-get-objectname curve))
      (setq pts (curve:get-points curve))
      (setq len 0)
      (while (>= (length pts)
          2)
        (setq len (+ len (distance (car pts)
              (cadr pts))))
        (setq pts (cdr pts)))
      len)
    (t (vlax-curve-getdistatparam curve (vlax-curve-getendparam curve)))))
```
</details>

---

### curve:lwpl-is-circle-p

**è¯´æ˜**: æ£€æµ‹å¤šæ®µçº¿æ˜¯å¦ä¸ºåœ†

**ç”¨æ³•**:
```lisp
(curve:lwpl-is-circle-p ent)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: T or nil

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:lwpl-is-circle-p (ent / vertexs bulges flag o)
  "æ£€æµ‹å¤šæ®µçº¿æ˜¯å¦ä¸ºåœ†"
  "T or nil"
  (setq vertexs (curve:pline-3dpoints ent))
  (setq bulges (curve:pline-convexity ent))
  (if (> (length vertexs)
      (length bulges))
    (setq vertexs (reverse (cdr (reverse vertexs)))))
  (setq flag t)
  (setq o (curve:bulge2o (car vertexs)
      (cadr vertexs)
      (car bulges)))
  (repeat (length vertexs)
    (if (> (distance o (curve:bulge2o (car vertexs)
            (cadr vertexs)
            (car bulges)))
        0.001)
      (setq flag nil))
    (setq vertexs (append (cdr vertexs)
        (list (car vertexs))))
    (setq bulges (append (cdr bulges)
        (list (car bulges)))))
  flag)
```
</details>

---

### curve:lwpl-turn-clockwise

**è¯´æ˜**: åè½¬å¤šæ®µçº¿ï¼Œè°ƒæ•´é¡ºæ—¶é’ˆæˆ–é€†æ—¶é’ˆæ–¹å‘ã€‚

**ç”¨æ³•**:
```lisp
(curve:lwpl-turn-clockwise ent)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: æ–°å¤šæ®µçº¿å›¾å…ƒ

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:lwpl-turn-clockwise (ent / pts convexity)
  "åè½¬å¤šæ®µçº¿ï¼Œè°ƒæ•´é¡ºæ—¶é’ˆæˆ–é€†æ—¶é’ˆæ–¹å‘ã€‚"
  "æ–°å¤šæ®µçº¿å›¾å…ƒ"
  (setq pts (curve:pline-3dpoints ent))
  (setq convexity (curve:pline-convexity ent))
  (if (> (length pts)
      (entity:getdxf ent 90))
    (setq pts (reverse (cdr (reverse pts)))))
  (if (> (length convexity)
      (entity:getdxf ent 90))
    (setq convexity (reverse (cdr (reverse convexity)))))
  (setq pts (reverse pts))
  (setq convexity (mapcar (quote -)
      (reverse convexity)))
  (setq convexity (append (cdr convexity)
      (list (car convexity))))
  (entity:make-lwpline-bold pts convexity nil 1 0))
```
</details>

---

### curve:midpoint

**è¯´æ˜**: æ±‚æ›²çº¿ä¸­ç‚¹

**ç”¨æ³•**:
```lisp
(curve:midpoint curve)
```

**å‚æ•°**: 1 curve  : æ›²çº¿;

**è¿”å›å€¼**: ä¸­ç‚¹åæ ‡

**ç¤ºä¾‹**:
```lisp
(curve:midpoint (car (entsel)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:midpoint (curve)
  "æ±‚æ›²çº¿ä¸­ç‚¹"
  "ä¸­ç‚¹åæ ‡"
  "(curve:midpoint (car (entsel)))"
  (if (= (quote vla-object)
      (type curve))
    (setq curve (o2e curve)))
  (if (= (quote ename)
      (type curve))
    (cond ((= "MLINE"
          (entity:getdxf curve 0))
        (setq midlen (* 0.5 (curve:length curve)))
        (setq pts (curve:get-points curve))
        (while (< (distance (car pts)
              (cadr pts))
            midlen)
          (setq midlen (- midlen (distance (car pts)
                (cadr pts))))
          (setq pts (cdr pts)))
        (setq pts (cdr pts))
        (polar (car pts)
          (angle (car pts)
            (cadr pts))
          (- midlen (distance (car pts)
              (cadr pts)))))
      (t (setq o-curve (e2o curve))
        (vlax-curve-getpointatdist o-curve (/ (curve:length curve)
            2))))))
```
</details>

---

### curve:o2bulge

**è¯´æ˜**: æ±‚ä¸¤ç‚¹ pt1 pt2 å’Œ åœ†å¿ƒ O å’Œè¡¨ç¤ºçš„å¼§çš„å‡¸åº¦ã€‚ç›®å‰æš‚æ—¶æ²¡æœ‰è€ƒè™‘æ–¹å‘ï¼ŒåŠæ­£è´Ÿã€‚

**ç”¨æ³•**:
```lisp
(curve:o2bulge pt1 pt2 o)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 o  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:o2bulge (pt1 pt2 o / l)
  "æ±‚ä¸¤ç‚¹ pt1 pt2 å’Œ åœ†å¿ƒ O å’Œè¡¨ç¤ºçš„å¼§çš„å‡¸åº¦ã€‚ç›®å‰æš‚æ—¶æ²¡æœ‰è€ƒè™‘æ–¹å‘ï¼ŒåŠæ­£è´Ÿã€‚"
  (/ (if (> (geometry:turn-right-p pt1 o pt2)
        0)
      (+ (distance o pt1)
        (distance o (point:mid pt1 pt2)))
      (- (distance o pt1)
        (distance o (point:mid pt1 pt2))))
    (* 0.5 (distance pt1 pt2))))
```
</details>

---

### curve:o2bulge-clockwise

**è¯´æ˜**: æ±‚ä¸¤ç‚¹ pt1 pt2 å’Œ åœ†å¿ƒ O è¡¨ç¤ºçš„é¡ºæ—¶é’ˆå¼§çš„å‡¸åº¦ã€‚

**ç”¨æ³•**:
```lisp
(curve:o2bulge-clockwise pt1 pt2 o)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 o  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:o2bulge-clockwise (pt1 pt2 o / l)
  "æ±‚ä¸¤ç‚¹ pt1 pt2 å’Œ åœ†å¿ƒ O è¡¨ç¤ºçš„é¡ºæ—¶é’ˆå¼§çš„å‡¸åº¦ã€‚"
  (* -1 (/ (if (> (geometry:turn-right-p pt1 o pt2)
          0)
        (- (distance o pt1)
          (distance o (point:mid pt1 pt2)))
        (+ (distance o pt1)
          (distance o (point:mid pt1 pt2))))
      (* 0.5 (distance pt1 pt2)))))
```
</details>

---

### curve:optimize-lwpl

**è¯´æ˜**: ä¼˜åŒ–å¤šæ®µçº¿é¡¶ç‚¹ã€‚å½“è¿ç»­å¤šç‚¹å…±çº¿æˆ–å…±åœ†æ—¶ï¼Œå‡å°‘é¡¶ç‚¹ã€‚ä¼˜åŒ–é¡ºæ—¶é’ˆçš„å¤šæ®µçº¿æœ‰é—®é¢˜å¾…ä¿®å¤ã€‚ä¼˜åŒ–ä¼šä¸¢å¤±å®½åº¦ä¿¡æ¯ï¼ï¼

**ç”¨æ³•**:
```lisp
(curve:optimize-lwpl ent)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: ä¼˜åŒ–åçš„æ–°å›¾å…ƒ

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:optimize-lwpl (ent / segs res n1 n2 n3 fuzz)
  "ä¼˜åŒ–å¤šæ®µçº¿é¡¶ç‚¹ã€‚å½“è¿ç»­å¤šç‚¹å…±çº¿æˆ–å…±åœ†æ—¶ï¼Œå‡å°‘é¡¶ç‚¹ã€‚ä¼˜åŒ–é¡ºæ—¶é’ˆçš„å¤šæ®µçº¿æœ‰é—®é¢˜å¾…ä¿®å¤ã€‚ä¼˜åŒ–ä¼šä¸¢å¤±å®½åº¦ä¿¡æ¯ï¼ï¼"
  "ä¼˜åŒ–åçš„æ–°å›¾å…ƒ"
  (if (numberp tmp-fuzz)
    (setq fuzz tmp-fuzz)
    (setq fuzz 1.0e-08))
  (setq segs (mapcar (quote (lambda (x y)
          (cons x y)))
      (curve:pline-3dpoints ent)
      (curve:pline-convexity ent)))
  (setq n1 (car segs))
  (setq res (cons n1 nil))
  (setq segs (cdr segs))
  (setq n2 (car segs))
  (setq res (cons n2 res))
  (setq segs (cdr segs))
  (while (setq n3 (car segs))
    (cond ((and (= 0 (cdr n1))
          (= 0 (cdr n2))
          (equal (angle (car n1)
              (car n2))
            (angle (car n2)
              (car n3))
            fuzz)
          (setq res (cons n3 (cdr res)))))
      ((and (/= 0 (cdr n1))
          (/= 0 (cdr n2))
          (equal 0 (distance (curve:bulge2o (car n1)
                (car n2)
                (cdr n1))
              (curve:bulge2o (car n2)
                (car n3)
                (cdr n2)))
            fuzz))
        (setq res (cons (cons (car n1)
              (curve:o2bulge (car n1)
                (car n3)
                (curve:bulge2o (car n1)
                  (car n2)
                  (cdr n1))))
            (cddr res)))
        (setq res (cons n3 res)))
      (t (setq res (cons n3 res))))
    (setq n1 (cadr res))
    (setq n2 (car res))
    (setq segs (cdr segs)))
  (if (= 1 (entity:getdxf ent 70))
    (progn (setq n3 (last res))
      (cond ((and (= 0 (cdr n1))
            (= 0 (cdr n2))
            (equal (angle (car n1)
                (car n2))
              (angle (car n2)
                (car n3))
              fuzz)
            (setq res (cdr res))))
        ((and (/= 0 (cdr n1))
            (/= 0 (cdr n2))
            (equal 0 (distance (curve:bulge2o (car n1)
                  (car n2)
                  (cdr n1))
                (curve:bulge2o (car n2)
                  (car n3)
                  (cdr n2)))
              fuzz))
          (setq res (cons (cons (car n1)
                (curve:o2bulge (car n1)
                  (car n3)
                  (curve:bulge2o (car n1)
                    (car n2)
                    (cdr n1))))
              (cddr res)))))
      (setq n1 (car res))
      (setq n2 (last res))
      (setq n3 (cadr (reverse res)))
      (cond ((and (= 0 (cdr n1))
            (= 0 (cdr n2))
            (equal (angle (car n1)
                (car n2))
              (angle (car n2)
                (car n3))
              fuzz)
            (setq res (reverse (cdr (reverse res))))))
        ((and (/= 0 (cdr n1))
            (/= 0 (cdr n2))
            (equal 0 (distance (curve:bulge2o (car n1)
                  (car n2)
                  (cdr n1))
                (curve:bulge2o (car n2)
                  (car n3)
                  (cdr n2)))
              fuzz))
          (setq res (cons (cons (car n1)
                (curve:o2bulge (car n1)
                  (car n3)
                  (curve:bulge2o (car n1)
                    (car n2)
                    (cdr n1))))
              (cddr res)))))))
  (setq res (reverse res))
  (entity:make-lwpline-bold (mapcar (quote car)
      res)
    (mapcar (quote cdr)
      res)
    0 (entity:getdxf ent 70)
    0))
```
</details>

---

### curve:param-firstangle

**è¯´æ˜**: æ›²çº¿å‚æ•°paramå¤„çš„åˆ‡çº¿æ–¹å‘çš„è§’åº¦

**ç”¨æ³•**:
```lisp
(curve:param-firstangle obj param)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;2 param  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:param-firstangle (obj param / pt)
  "æ›²çº¿å‚æ•°paramå¤„çš„åˆ‡çº¿æ–¹å‘çš„è§’åº¦"
  (setq pt (vlax-curve-getpointatparam obj param))
  (angle (quote (0 0 0))
    (vlax-curve-getfirstderiv obj param)))
```
</details>

---

### curve:param-secondangle

**è¯´æ˜**: æ›²çº¿å‚æ•°paramå¤„çš„æ³•çº¿æ–¹å‘çš„è§’åº¦

**ç”¨æ³•**:
```lisp
(curve:param-secondangle obj param)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;2 param  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:param-secondangle (obj param / pt)
  "æ›²çº¿å‚æ•°paramå¤„çš„æ³•çº¿æ–¹å‘çš„è§’åº¦"
  (setq pt (vlax-curve-getpointatparam obj param))
  (angle (quote (0 0 0))
    (vlax-curve-getsecondderiv obj param)))
```
</details>

---

### curve:pickclosepointto

**è¯´æ˜**: å¤šæ®µçº¿ä¸Šè·ç¦»ç‚¹å‡»ç‚¹æœ€è¿‘çš„ä¸€ä¸ªé¡¶ç‚¹

**ç”¨æ³•**:
```lisp
(curve:pickclosepointto obj p)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;2 p  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:pickclosepointto (obj p / p1 p2 pp)
  "å¤šæ®µçº¿ä¸Šè·ç¦»ç‚¹å‡»ç‚¹æœ€è¿‘çš„ä¸€ä¸ªé¡¶ç‚¹"
  (setq pp (curve:subsegment-picked-points obj p))
  (setq p1 (car pp))
  (setq p2 (cadr pp))
  (if (< (distance p p1)
      (distance p p2))
    p1 p2))
```
</details>

---

### curve:pline-2dpoints

**è¯´æ˜**: å¤šæ®µçº¿ç«¯ç‚¹åˆ—è¡¨ï¼Œè¿”å›äºŒç»´ç‚¹åæ ‡,LWPOLYLINEç»„ç æœ¬æ¥å°±æ˜¯äºŒç»´ç‚¹ã€‚

**ç”¨æ³•**:
```lisp
(curve:pline-2dpoints ent)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: äºŒç»´ç‚¹åæ ‡åˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(curve:Pline-2dpoints (car (entsel)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:pline-2dpoints (ent)
  "å¤šæ®µçº¿ç«¯ç‚¹åˆ—è¡¨ï¼Œè¿”å›äºŒç»´ç‚¹åæ ‡,LWPOLYLINEç»„ç æœ¬æ¥å°±æ˜¯äºŒç»´ç‚¹ã€‚"
  "äºŒç»´ç‚¹åæ ‡åˆ—è¡¨"
  "(curve:Pline-2dpoints (car (entsel)))"
  (mapcar (quote cdr)
    (vl-remove-if-not (quote (lambda (x)
          (or (= (car x)
              10)
            (= (car x)
              11))))
      (entget ent))))
```
</details>

---

### curve:pline-3dpoints

**è¯´æ˜**: å¤šæ®µçº¿ç«¯ç‚¹åˆ—è¡¨ï¼Œè¿”å›ä¸‰ç»´ç‚¹åæ ‡ã€‚æ³¨æ„ï¼šå½“å¤šæ®µçº¿ä¸ºé—­åˆæ—¶ï¼Œæœ€ç»ˆç‚¹ä¸ºèµ·å§‹ç‚¹ï¼Œæ¯”å›¾å…ƒå¤šä¸€ä¸ªç‚¹ã€‚

**ç”¨æ³•**:
```lisp
(curve:pline-3dpoints ent)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: ä¸‰ç»´ç‚¹åæ ‡åˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(curve:pline-3dpoints (car (entsel)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:pline-3dpoints (ent / i lst v)
  "å¤šæ®µçº¿ç«¯ç‚¹åˆ—è¡¨ï¼Œè¿”å›ä¸‰ç»´ç‚¹åæ ‡ã€‚æ³¨æ„ï¼šå½“å¤šæ®µçº¿ä¸ºé—­åˆæ—¶ï¼Œæœ€ç»ˆç‚¹ä¸ºèµ·å§‹ç‚¹ï¼Œæ¯”å›¾å…ƒå¤šä¸€ä¸ªç‚¹ã€‚"
  "ä¸‰ç»´ç‚¹åæ ‡åˆ—è¡¨"
  "(curve:pline-3dpoints (car (entsel)))"
  (cond ((and (= (quote ename)
          (type ent))
        (= "LINE"
          (entity:getdxf ent 0)))
      (list (entity:getdxf ent 10)
        (entity:getdxf ent 11)))
    (t (setq i -1)
      (while (setq v (vlax-curve-getpointatparam ent (setq i (1+ i))))
        (setq lst (cons v lst)))
      (reverse lst))))
```
</details>

---

### curve:pline-convexity

**è¯´æ˜**: å¤šæ®µçº¿å‡¸åº¦åˆ—è¡¨ã€‚

**ç”¨æ³•**:
```lisp
(curve:pline-convexity ent)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: æ•°å€¼åˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(curve:pline-convexity (car (entsel)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:pline-convexity (ent / i lst v)
  "å¤šæ®µçº¿å‡¸åº¦åˆ—è¡¨ã€‚"
  "æ•°å€¼åˆ—è¡¨"
  "(curve:pline-convexity (car (entsel)))"
  (cond ((and (= (quote ename)
          (type ent))
        (= "LINE"
          (entity:getdxf ent 0)))
      (list 0))
    (t (mapcar (quote cdr)
        (vl-remove-if-not (quote (lambda (x)
              (= 42 (car x))))
          (entget ent))))))
```
</details>

---

### curve:point-firstangle

**è¯´æ˜**: æ›²çº¿ä¸€ç‚¹çš„åˆ‡çº¿æ–¹å‘çš„è§’åº¦

**ç”¨æ³•**:
```lisp
(curve:point-firstangle obj pt)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;2 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:point-firstangle (obj pt / param)
  "æ›²çº¿ä¸€ç‚¹çš„åˆ‡çº¿æ–¹å‘çš„è§’åº¦"
  (setq param (vlax-curve-getparamatpoint obj pt))
  (angle (quote (0 0 0))
    (vlax-curve-getfirstderiv obj param)))
```
</details>

---

### curve:point-secondangle

**è¯´æ˜**: æ›²çº¿ä¸€ç‚¹çš„æ³•çº¿æ–¹å‘çš„è§’åº¦

**ç”¨æ³•**:
```lisp
(curve:point-secondangle obj pt)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;2 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:point-secondangle (obj pt / param)
  "æ›²çº¿ä¸€ç‚¹çš„æ³•çº¿æ–¹å‘çš„è§’åº¦"
  (setq param (vlax-curve-getparamatpoint obj pt))
  (angle (quote (0 0 0))
    (vlax-curve-getsecondderiv obj param)))
```
</details>

---

### curve:pt-in-arc-p

**è¯´æ˜**: åˆ¤æ–­ ç‚¹ pt æ˜¯å¦åœ¨ pt1 pt2 åŠ å‡¸åº¦ è¡¨ç¤ºçš„åœ†å¼§ä¸Šã€‚

**ç”¨æ³•**:
```lisp
(curve:pt-in-arc-p pt pt1 pt2 convexity)
```

**å‚æ•°**: 1 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;4 convexity  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:pt-in-arc-p (pt pt1 pt2 convexity / o ang1 ang2 ang)
  "åˆ¤æ–­ ç‚¹ pt æ˜¯å¦åœ¨ pt1 pt2 åŠ å‡¸åº¦ è¡¨ç¤ºçš„åœ†å¼§ä¸Šã€‚"
  (if (equal 0 convexity 0.001)
    (progn (equal (angle pt1 pt)
        (angle pt pt2)
        0.001))
    (progn (setq o (curve:bulge2o pt1 pt2 convexity))
      (setq ang1 (angle o pt1)
        ang2 (angle o pt2)
        ang (angle o pt))
      (and (equal (distance pt o)
          (distance pt1 o)
          0.001)
        (if (> convexity 0)
          (if (> ang1 ang2)
            (or (> ang ang1)
              (> ang2 ang))
            (> ang2 ang ang1))
          (if (> ang1 ang2)
            (> ang1 ang ang2)
            (or (> ang1 ang)
              (> ang ang2))))))))
```
</details>

---

### curve:ptoncurve

**è¯´æ˜**: åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨æ›²çº¿ä¸Š

**ç”¨æ³•**:
```lisp
(curve:ptoncurve pt curve)
```

**å‚æ•°**: 1 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 curve  : æ›²çº¿;

**è¿”å›å€¼**: T or nil

**ç¤ºä¾‹**:
```lisp
(curve:PtOnCurve (getpoint) (car (entsel)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:ptoncurve (pt curve)
  "åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨æ›²çº¿ä¸Š"
  "T or nil"
  "(curve:PtOnCurve (getpoint)
    (car (entsel)))"
  (equal pt (vlax-curve-getclosestpointto curve pt)
    1.0e-005))
```
</details>

---

### curve:put-points

**è¯´æ˜**: æ›´æ”¹æ›²çº¿æ§åˆ¶ç‚¹åŠç«¯ç‚¹åˆ—è¡¨ã€‚ptsä¸ºæ–°çš„ç‚¹ä½ç½®,nilä¸ºä¸æ›¿æ¢ã€‚

**ç”¨æ³•**:
```lisp
(curve:put-points ent pts)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;2 pts  : å¤šä¸ªåæ ‡ç‚¹åˆ—è¡¨;

**è¿”å›å€¼**: ent

**ç¤ºä¾‹**:
```lisp
(curve:put-points (car (entsel)) '((0 0 0)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:put-points (ent pts / dxfent)
  "æ›´æ”¹æ›²çº¿æ§åˆ¶ç‚¹åŠç«¯ç‚¹åˆ—è¡¨ã€‚ptsä¸ºæ–°çš„ç‚¹ä½ç½®,nilä¸ºä¸æ›¿æ¢ã€‚"
  "ent"
  "(curve:put-points (car (entsel))
    '((0 0 0)))"
  (if (p:vlap ent)
    (setq ent (o2e ent)))
  (if (= (quote ename)
      (type ent))
    (cond ((wcmatch (entity:getdxf ent 0)
          "*POLYLINE,LINE,MLINE,CIRCLE,SPLINE,REGION,ELLIPSE,ARC")
        (setq dxfent (entget ent))
        (mapcar (quote (lambda (dxf1011 pt)
              (if pt (setq dxfent (subst (cons (car dxf1011)
                      pt)
                    dxf1011 dxfent)))))
          (vl-remove-if-not (quote (lambda (x)
                (or (= 10 (car x))
                  (= 11 (car x)))))
            (entget ent))
          pts)
        (entmod dxfent)
        (entupd ent)))))
```
</details>

---

### curve:putclosed

**è¯´æ˜**: ä½¿å¤šæ®µçº¿å°é—­

**ç”¨æ³•**:
```lisp
(curve:putclosed obj)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;

**è¿”å›å€¼**: æ— 

**ç¤ºä¾‹**:
```lisp
(curve:putClosed (car (entsel)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:putclosed (obj)
  "ä½¿å¤šæ®µçº¿å°é—­"
  "æ— "
  "(curve:putClosed (car (entsel)))"
  (or (p:vlap obj)
    (setq obj (vlax-ename->vla-object obj)))
  (if (not (vlax-curve-isclosed obj))
    (vla-put-closed obj :vlax-true)))
```
</details>

---

### curve:readme

**è¯´æ˜**: æ›²çº¿æ“ä½œç›¸å…³å‡½æ•°ã€‚

**ç”¨æ³•**:
```lisp
(curve:readme )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:readme nil "æ›²çº¿æ“ä½œç›¸å…³å‡½æ•°ã€‚"
  (princ "æ›²çº¿æ“ä½œç›¸å…³å‡½æ•°ã€‚ä½¿ç”¨ (require 'curve:*)
    åŠ è½½è¿™äº›å‡½æ•°")
  (princ))
```
</details>

---

### curve:rectangle-center

**è¯´æ˜**: çŸ©å½¢ä¸­ç‚¹åæ ‡

**ç”¨æ³•**:
```lisp
(curve:rectangle-center en)
```

**å‚æ•°**: 1 en  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:rectangle-center (en / pl)
  "çŸ©å½¢ä¸­ç‚¹åæ ‡"
  (setq pl (curve:pline-2dpoints en))
  (mapcar (quote (lambda (x y)
        (/ (+ x y)
          2.0)))
    (car pl)
    (caddr pl)))
```
</details>

---

### curve:rectanglep

**è¯´æ˜**: æµ‹è¯•ä¸€ä¸ªå¤šæ®µçº¿æ˜¯å¦ä¸ºçŸ©å½¢,åˆ¤æ–­çŸ©å½¢

**ç”¨æ³•**:
```lisp
(curve:rectanglep ent)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: T or nil

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:rectanglep (ent)
  "æµ‹è¯•ä¸€ä¸ªå¤šæ®µçº¿æ˜¯å¦ä¸ºçŸ©å½¢,åˆ¤æ–­çŸ©å½¢"
  "T or nil"
  (and (= (quote ename)
      (type ent))
    (wcmatch (entity:getdxf ent 0)
      "*POLYLINE")
    (or (and (= (entity:getdxf ent 90)
          4)
        (= (entity:getdxf ent 70)
          1))
      (and (= (entity:getdxf ent 90)
          5)
        (= (entity:getdxf ent 70)
          0)))
    (apply (quote =)
      (entity:getdxf ent 42))
    (progn (setq pts (curve:get-points ent))
      (setq ang (abs (- (angle (nth 0 pts)
              (nth 1 pts))
            (angle (nth 1 pts)
              (nth 2 pts)))))
      (if (> ang pi)
        (setq ang (- ang pi)))
      (and (equal ang (* pi 0.5)
          1.0e-06)
        (equal (distance (nth 0 pts)
            (nth 1 pts))
          (distance (nth 2 pts)
            (nth 3 pts))
          1.0e-06)
        (equal (distance (nth 0 pts)
            (nth 2 pts))
          (distance (nth 1 pts)
            (nth 3 pts))
          1.0e-06)
        (if (nth 4 pts)
          (< (distance (nth 0 pts)
              (nth 4 pts))
            1.0e-06)
          t)))))
```
</details>

---

### curve:similar-p

**è¯´æ˜**: åˆ¤å®šä¸¤æ›²çº¿æ˜¯å¦ç›¸ä¼¼,curve1,curve2 æ›²çº¿å›¾å…ƒ,é»˜è®¤ç›¸ä¼¼åº¦:95%

**ç”¨æ³•**:
```lisp
(curve:similar-p curve1 curve2)
```

**å‚æ•°**: 1 curve1  : æ›²çº¿;2 curve2  : æ›²çº¿;

**è¿”å›å€¼**: bool

**ç¤ºä¾‹**:
```lisp
(curve:similar-p (car(entsel))(car(entsel)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:similar-p (curve1 curve2 / similarity o1 o2 nolength)
  "åˆ¤å®šä¸¤æ›²çº¿æ˜¯å¦ç›¸ä¼¼,curve1,curve2 æ›²çº¿å›¾å…ƒ,é»˜è®¤ç›¸ä¼¼åº¦:95%"
  "bool"
  "(curve:similar-p (car(entsel))(car(entsel)))"
  (setq nolength (quote ("CIRCLE"
        "ARC"
        "SPLINE"
        "ELLIPSE"
        "REGION")))
  (if (@::get-config (quote curve:similarity))
    (setq similarity (- 1 (@::get-config (quote curve:similarity))))
    (setq similarity 0.05))
  (setq o1 (e2o curve1)
    o2 (e2o curve2))
  (and (if (or (member (entity:getdxf curve1 0)
          nolength)
        (member (entity:getdxf curve2 0)
          nolength))
      t (cond ((equal (vla-get-length o1)
            (vla-get-length o2)
            1.0e-06)
          t)
        ((/= (vla-get-length o2)
            0)
          (equal (/ (float (vla-get-length o1))
              (float (vla-get-length o2)))
            1 similarity))))
    (progn (setq area1 (if (= "LINE"
            (entity:getdxf curve1 0))
          0 (vla-get-area o1)))
      (setq area2 (if (= "LINE"
            (entity:getdxf curve2 0))
          0 (vla-get-area o2)))
      (cond ((equal area1 area2 1.0e-06)
          t)
        ((/= area2 0)
          (equal (/ area1 area2)
            1 similarity))
        (t nil)))))
```
</details>

---

### curve:subsegment-length

**è¯´æ˜**: å¤šæ®µçº¿å­æ®µé•¿åº¦ï¼Œå½“æ›²çº¿é—­åˆä¸” pt2 ä¸èµ·ç‚¹ç›¸åŒæ—¶,pt2æŒ‰ç»ˆç‚¹è€ƒè™‘

**ç”¨æ³•**:
```lisp
(curve:subsegment-length curve pt1 pt2)
```

**å‚æ•°**: 1 curve  : æ›²çº¿;2 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:subsegment-length (curve pt1 pt2)
  "å¤šæ®µçº¿å­æ®µé•¿åº¦ï¼Œå½“æ›²çº¿é—­åˆä¸” pt2 ä¸èµ·ç‚¹ç›¸åŒæ—¶,pt2æŒ‰ç»ˆç‚¹è€ƒè™‘"
  (if (p:enamep curve)
    (setq curve (e2o curve)))
  (cond ((equal 0 (distance (vlax-curve-getendpoint curve)
          pt2)
        1.0e-10)
      (- (vla-get-length curve)
        (vlax-curve-getdistatpoint curve pt1)))
    (t (cond ((and (listp pt1)
            (listp pt2))
          (abs (- (vlax-curve-getdistatpoint curve pt1)
              (vlax-curve-getdistatpoint curve pt2))))
        (t (abs (- (vlax-curve-getdistatparam curve pt1)
              (vlax-curve-getdistatparam curve pt2))))))))
```
</details>

---

### curve:subsegment-parameter

**è¯´æ˜**: å¤šæ®µçº¿å­æ®µå‚æ•°

**ç”¨æ³•**:
```lisp
(curve:subsegment-parameter curve pt)
```

**å‚æ•°**: 1 curve  : æ›²çº¿;2 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:subsegment-parameter (curve pt / arclength cenangle center points pt1 pt1param pt2 pt3 radius tlength xangle xbulge)
  "å¤šæ®µçº¿å­æ®µå‚æ•°"
  (setq points (curve:subsegment-picked-points curve pt)
    pt1 (car points)
    pt2 (cadr points)
    pt1param (vlax-curve-getparamatpoint curve pt1)
    arclength (curve:subsegment-length curve pt1 pt2))
  (setq xbulge (vla-getbulge (vlax-ename->vla-object curve)
      pt1param))
  (if (= 0 xbulge)
    (progn (list pt1 pt2 arclength (angle pt1 pt2)))
    (progn (setq xangle (* 4 (atan xbulge))
        cenangle ((if (< xbulge 0)
            - +)
          (- (angle pt1 pt2)
            (/ xangle 2.0))
          (/ pi 2))
        radius (abs (/ (/ (distance pt1 pt2)
              2.0)
            (sin (/ xangle 2.0))))
        center (polar pt1 cenangle radius)
        pt3 (inters pt1 (polar pt1 (+ (angle pt1 center)
              (/ pi 2))
            radius)
          pt2 (polar pt2 (+ (angle pt2 center)
              (/ pi 2))
            radius)
          nil)
        tlength (if (null pt3)
          0 (distance pt2 pt3)))
      (list center pt1 pt2 pt3 radius (abs xangle)
        arclength tlength))))
```
</details>

---

### curve:subsegment-picked-param

**è¯´æ˜**: å¤šæ®µçº¿æ‰€ç‚¹å‡»å­æ®µå‚æ•°

**ç”¨æ³•**:
```lisp
(curve:subsegment-picked-param obj p)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;2 p  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:subsegment-picked-param (obj p / pp)
  "å¤šæ®µçº¿æ‰€ç‚¹å‡»å­æ®µå‚æ•°"
  (setq pp (vlax-curve-getclosestpointto obj (trans p 1 0)))
  (fix (vlax-curve-getparamatpoint obj pp)))
```
</details>

---

### curve:subsegment-picked-points

**è¯´æ˜**: å¤šæ®µçº¿æ‰€ç‚¹å‡»å­æ®µçš„ä¸¤ç«¯ç‚¹åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(curve:subsegment-picked-points obj p)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;2 p  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:subsegment-picked-points (obj p)
  "å¤šæ®µçº¿æ‰€ç‚¹å‡»å­æ®µçš„ä¸¤ç«¯ç‚¹åˆ—è¡¨"
  (curve:subsegment-points obj (fix (vlax-curve-getparamatpoint obj (vlax-curve-getclosestpointto obj (trans p 1 0))))))
```
</details>

---

### curve:subsegment-picked-type

**è¯´æ˜**: å¤šæ®µçº¿å­æ®µå›¾å…ƒç±»å‹

**ç”¨æ³•**:
```lisp
(curve:subsegment-picked-type curve p)
```

**å‚æ•°**: 1 curve  : æ›²çº¿;2 p  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:subsegment-picked-type (curve p / pp)
  "å¤šæ®µçº¿å­æ®µå›¾å…ƒç±»å‹"
  (if (listp p)
    (progn (setq pp (vlax-curve-getclosestpointto curve (trans p 1 0)))
      (setq pp (vlax-curve-getsecondderiv curve (fix (vlax-curve-getparamatpoint curve pp)))))
    (setq pp (vlax-curve-getsecondderiv curve p)))
  (if (equal pp (quote (0.0 0.0 0.0)))
    "line"
    "arc"))
```
</details>

---

### curve:subsegment-points

**è¯´æ˜**: å¤šæ®µçº¿ç¬¬nå­æ®µçš„ç«¯ç‚¹åæ ‡

**ç”¨æ³•**:
```lisp
(curve:subsegment-points curve n)
```

**å‚æ•°**: 1 curve  : æ›²çº¿;2 n  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:subsegment-points (curve n)
  "å¤šæ®µçº¿ç¬¬nå­æ®µçš„ç«¯ç‚¹åæ ‡"
  (list (vlax-curve-getpointatparam curve (fix n))
    (vlax-curve-getpointatparam curve (1+ (fix n)))))
```
</details>

---

### curve:subsegments

**è¯´æ˜**: å¤šæ®µçº¿å­æ®µæ•°

**ç”¨æ³•**:
```lisp
(curve:subsegments obj)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun curve:subsegments (obj)
  "å¤šæ®µçº¿å­æ®µæ•°"
  (fix (vlax-curve-getendparam obj)))
```
</details>

---

## datetime

**æ¨¡å—è¯´æ˜**: æ—¥æœŸæ—¶é—´å¤„ç†ã€æ ¼å¼åŒ–

### datetime:current-time

**è¯´æ˜**: æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´ï¼Œyyyy å¹´ mo æœˆ dd æ—¥ hh æ—¶ mm åˆ† ss ç§’

**ç”¨æ³•**:
```lisp
(datetime:current-time str-fmt)
```

**å‚æ•°**: 1 str-fmt  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: æ—¥æœŸæ—¶é—´å­—ç¬¦ä¸²

**ç¤ºä¾‹**:
```lisp
(datetime:current-time "yyyy-mo-dd hh:mm:ss")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun datetime:current-time (str-fmt)
  "æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´ï¼Œyyyy å¹´ mo æœˆ dd æ—¥ hh æ—¶ mm åˆ† ss ç§’"
  "æ—¥æœŸæ—¶é—´å­—ç¬¦ä¸²"
  "(datetime:current-time \"yyyy-mo-dd hh:mm:ss\")"
  (menucmd (strcat "M=$(edtime,$(getvar,date),"
        str-fmt ")")))
```
</details>

---

### datetime:get-current-day

**è¯´æ˜**: è¿”å›æ—¥æœŸ

**ç”¨æ³•**:
```lisp
(datetime:get-current-day )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun datetime:get-current-day nil "è¿”å›æ—¥æœŸ"
  (substr (itoa (fix (getvar "CDATE")))
    7 2))
```
</details>

---

### datetime:get-current-month

**è¯´æ˜**: è¿”å›æœˆä»½

**ç”¨æ³•**:
```lisp
(datetime:get-current-month )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun datetime:get-current-month nil "è¿”å›æœˆä»½"
  (substr (itoa (fix (getvar "CDATE")))
    5 2))
```
</details>

---

### datetime:get-current-year

**è¯´æ˜**: è¿”å›å¹´ä»½

**ç”¨æ³•**:
```lisp
(datetime:get-current-year )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun datetime:get-current-year nil "è¿”å›å¹´ä»½"
  (substr (itoa (fix (getvar "CDATE")))
    1 4))
```
</details>

---

### datetime:get-universal-time

**è¯´æ˜**: è¿”å›ä¸–ç•Œæ—¶ï¼Œæ ¼æ—ç»´æ²»æ—¶é—´.è‡ª1900å¹´1æœˆ1æ—¥åˆ°ç°åœ¨çš„ç§’æ•°

**ç”¨æ³•**:
```lisp
(datetime:get-universal-time )
```

**å‚æ•°**: None

**è¿”å›å€¼**: Int

**ç¤ºä¾‹**:
```lisp
(datetime:get-universal-time)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun datetime:get-universal-time nil "è¿”å›ä¸–ç•Œæ—¶ï¼Œæ ¼æ—ç»´æ²»æ—¶é—´.è‡ª1900å¹´1æœˆ1æ—¥åˆ°ç°åœ¨çš„ç§’æ•°"
  "Int"
  "(datetime:get-universal-time)"
  (if (@:internetp)
    (datetime:mktime1900 (datetime:mktime (datetime:rfc1123-to-lisp (vlax-invoke @:*request* (quote getresponseheader)
            "Date"))))
    0))
```
</details>

---

### datetime:leap-yearp

**è¯´æ˜**: åˆ¤æ–­æŸä¸ªæ˜¯å¦ä¸ºé—°å¹´ã€‚

**ç”¨æ³•**:
```lisp
(datetime:leap-yearp year)
```

**å‚æ•°**: 1 year  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun datetime:leap-yearp (year)
  "åˆ¤æ–­æŸä¸ªæ˜¯å¦ä¸ºé—°å¹´ã€‚"
  (if (= 0 (mod year 100))
    (if (= 0 (mod year 400))
      t nil)
    (if (= 0 (mod year 4))
      t nil)))
```
</details>

---

### datetime:mktime

**è¯´æ˜**: è®¡ç®—æŸä¸€æ—¶é—´(åˆ—è¡¨)åˆ°1970å¹´01æœˆ01æ—¥ç»è¿‡çš„ç§’æ•°,é€‚åˆè½¬æ¢vl-file-systimeçš„ç»“æœ

**ç”¨æ³•**:
```lisp
(datetime:mktime lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: Timestamp

**ç¤ºä¾‹**:
```lisp
(datetime:mktime (vl-file-systime (findfile "acad.pgp")))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun datetime:mktime (lst /)
  "è®¡ç®—æŸä¸€æ—¶é—´(åˆ—è¡¨)åˆ°1970å¹´01æœˆ01æ—¥ç»è¿‡çš„ç§’æ•°,é€‚åˆè½¬æ¢vl-file-systimeçš„ç»“æœ"
  "Timestamp"
  "(datetime:mktime (vl-file-systime (findfile \"acad.pgp\")))"
  (setq days-of-month (if (datetime:leap-yearp (nth 0 lst))
      (quote (0 31 60 91 121 152 182 213 244 274 305 335 366))
      (quote (0 31 59 90 120 151 181 212 243 273 304 334 365))))
  (+ (* 60.0 (+ (* 60.0 (+ (* 24.0 (+ (* (- (nth 0 lst)
                    1970.0)
                  365.0)
                (fix (/ (- (nth 0 lst)
                      1970)
                    4))
                (nth (1- (nth 1 lst))
                  days-of-month)
                (nth 3 lst)))
            (nth 4 lst)
            (- 8)))
        (nth 5 lst)))
    (nth 6 lst)))
```
</details>

---

### datetime:mktime1900

**è¯´æ˜**: unix timestamp è½¬ åˆ°1900å¹´01æœˆ01æ—¥ç»è¿‡çš„ç§’æ•°.

**ç”¨æ³•**:
```lisp
(datetime:mktime1900 timestamp)
```

**å‚æ•°**: 1 timestamp  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: real

**ç¤ºä¾‹**:
```lisp
(datetime:mktime1900 (datetime:mktime (vl-file-systime (findfile "acad.pgp"))))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun datetime:mktime1900 (timestamp)
  "unix timestamp è½¬ åˆ°1900å¹´01æœˆ01æ—¥ç»è¿‡çš„ç§’æ•°."
  "real"
  "(datetime:mktime1900 (datetime:mktime (vl-file-systime (findfile \"acad.pgp\"))))"
  (+ (* 22089.0 100000.0)
    88800.0 timestamp))
```
</details>

---

### datetime:rfc1123-to-lisp

**è¯´æ˜**: å°†RFC1123æ ¼å¼è½¬åŒ–ä¸º autolisp è¡¨æ ¼å¼

**ç”¨æ³•**:
```lisp
(datetime:rfc1123-to-lisp str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: list

**ç¤ºä¾‹**:
```lisp
(datetime:rfc1123-to-lisp "Mon, 12 Sep 2022 03:58:42 GMT")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun datetime:rfc1123-to-lisp (str)
  "å°†RFC1123æ ¼å¼è½¬åŒ–ä¸º autolisp è¡¨æ ¼å¼"
  "list"
  "(datetime:rfc1123-to-lisp \"Mon, 12 Sep 2022 03:58:42 GMT\")"
  (setq mon (quote ("Jan"
        "Feb"
        "Mar"
        "Apr"
        "May"
        "Jun"
        "Jul"
        "Aug"
        "Sep"
        "Oct"
        "Nov"
        "Dec")))
  (setq week (mapcar (function (lambda (x)
          (substr x 1 3)))
      (quote ("Monday"
          "Tuesday"
          "Wednesday"
          "Thurday"
          "Friday"
          "Saturday"
          "Sunday"))))
  (setq res (string:parse-by-lst str (quote ("
          "
          ":"))))
  (list (atoi (nth 3 res))
    (1+ (vl-position (nth 2 res)
        mon))
    (1+ (vl-position (substr (nth 0 res)
          1 3)
        week))
    (atoi (nth 1 res))
    (atoi (nth 4 res))
    (atoi (nth 5 res))
    (atoi (nth 6 res))
    0))
```
</details>

---

## dbx

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### dbx:interface

**è¯´æ˜**: è¿”å›DBXçš„å®ä¾‹åŒ–æ¥å£

**ç”¨æ³•**:
```lisp
(dbx:interface )
```

**å‚æ•°**: æ²¡æœ‰ä¸€ä¸ª

**è¿”å›å€¼**: Obj

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dbx:interface nil "è¿”å›DBXçš„å®ä¾‹åŒ–æ¥å£"
  "Obj"
  (if (or (null *dbx*)
      (vlax-object-released-p *dbx*))
    (setq *dbx* (vla-getinterfaceobject *acad* (strcat "ObjectDBX.AxDbDocument."
          (itoa (fix (@:acadver))))))))
```
</details>

---

### dbx:open

**è¯´æ˜**: ä»¥DBXæ–¹å¼æ‰“å¼€dwgæ–‡ä»¶

**ç”¨æ³•**:
```lisp
(dbx:open dwg-file)
```

**å‚æ•°**: 1 dwg-file  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: æ‰“å¼€æˆåŠŸè¿”å›DBXå¯¹è±¡ï¼Œæ²¡æœ‰å‘ç°æ–‡ä»¶è¿”å›nil

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dbx:open (dwg-file / dbx)
  "ä»¥DBXæ–¹å¼æ‰“å¼€dwgæ–‡ä»¶"
  "æ‰“å¼€æˆåŠŸè¿”å›DBXå¯¹è±¡ï¼Œæ²¡æœ‰å‘ç°æ–‡ä»¶è¿”å›nil"
  (dbx:interface)
  (if (findfile dwg-file)
    (progn (vla-open *dbx* (findfile dwg-file))
      *dbx*)))
```
</details>

---

### dbx:release

**è¯´æ˜**: é‡Šæ”¾DBXæ¥å£

**ç”¨æ³•**:
```lisp
(dbx:release )
```

**å‚æ•°**: æ²¡æœ‰ä¸€ä¸ª

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dbx:release nil "é‡Šæ”¾DBXæ¥å£"
  (if (and *dbx* (= (quote vla-object)
        (type *dbx*))
      (null (vlax-object-released-p *dbx*)))
    (vlax-release-object *dbx*)))
```
</details>

---

## dcl

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### dcl:accept

**ç”¨æ³•**:
```lisp
(dcl:accept )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:accept nil (setq dcl:dialog-result (mapcar (quote (lambda (x)
          (cons (car x)
            (eval (cdr x)))))
      dcl:accept-hook))
  (done_dialog 2))
```
</details>

---

### dcl:begin-cluster

**è¯´æ˜**: å¼€å§‹ dcl å®¹å™¨ç±»æ§ä»¶ã€‚ä¸ dcl:end-cluster æˆå¯¹ä½¿ç”¨ã€‚cluster-type: row,column,boxed_row,boxed_column,boxed_radio_row,boxed_radio_column

**ç”¨æ³•**:
```lisp
(dcl:begin-cluster cluster-type label)
```

**å‚æ•°**: 1 cluster-type  : æœªè¯†åˆ«å®šä¹‰;2 label  : æ ‡ç­¾;

**ç¤ºä¾‹**:
```lisp
(dcl:begin-cluster "row"    "")(progn (dcl:mtext "mt"      8 100 )(dcl:paging t)    (dcl:end-cluster))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:begin-cluster (cluster-type label)
  "å¼€å§‹ dcl å®¹å™¨ç±»æ§ä»¶ã€‚ä¸ dcl:end-cluster æˆå¯¹ä½¿ç”¨ã€‚cluster-type: row,column,boxed_row,boxed_column,boxed_radio_row,boxed_radio_column"
  ""
  "(dcl:begin-cluster \"row\"\n    \"\")(progn (dcl:mtext \"mt\"\n      8 100 )(dcl:paging t)\n    (dcl:end-cluster))"
  (if (member cluster-type (quote ("row"
          "column"
          "radio_row"
          "radio_column"
          "boxed_row"
          "boxed_column"
          "boxed_radio_row"
          "boxed_radio_column")))
    (write-line (strcat ":"
        cluster-type "{"
        (if (/= ""
            label)
          (strcat "label=\""
            label "\";")
          ""))
      dcl-fp)
    (write-line ":row{"
      dcl-fp)))
```
</details>

---

### dcl:button

**è¯´æ˜**: dcl æŒ‰é’®ã€‚

**ç”¨æ³•**:
```lisp
(dcl:button key label style)
```

**å‚æ•°**: 1 key  : é”®ï¼Œå…³é”®å­—;2 label  : æ ‡ç­¾;3 style  : æœªè¯†åˆ«å®šä¹‰;

**ç¤ºä¾‹**:
```lisp
(dcl:button "btn1" "Button1" "")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:button (key label style)
  "dcl æŒ‰é’®ã€‚"
  ""
  "(dcl:button \"btn1\"
    \"Button1\"
    \"\")"
  (set (read (strcat "cb-"
        key))
    (eval (read (strcat "(lambda()(alert (strcat \"éœ€è¦å®šä¹‰å›è°ƒå‡½æ•° (cb-"
                  key ")\")))"))))
  (write-line (strcat ":button{key=\""
      key "\";"
      "label=\""
      label "\";"
      "action=\"(cb-"
        key ")\";"
      style "}")
    dcl-fp))
```
</details>

---

### dcl:cell

**è¯´æ˜**: åˆ›å»º DCL å¯ç¼–è¾‘è¡¨æ ¼.å‚æ•°: 1. key: æ ‡è¯†      2. rows:æ˜¾ç¤ºè¡Œæ•°ï¼Œ      3. columns æ˜¾ç¤ºåˆ—æ•°(ä¸å¤§äº26),       4. show-line-number? : æ˜¯å¦æ˜¾ç¤ºè¡Œå·ï¼Œ       5. show-column-number?  : æ˜¯å¦æ˜¾ç¤ºåˆ—å·A~Zï¼Œ      6. show-scrollbar? : æ˜¯å¦æ˜¾ç¤ºç«–å‘æ»šåŠ¨æ¡.       7. fixed-title? ,åœ¨ç¬¬ä¸€è¡Œå›ºå®šæ˜¾ç¤ºæ ‡é¢˜ã€‚tile-key: scrollbar header1 header2 headern, A1 B1 ... Z1 , A2 B2 ... Z2 , A99 B99 ... Z99 ......Modeléƒ¨: tbl-widths: åˆ—å®½è¡¨;cell-data åˆ—è¡¨æ•°æ®;Controléƒ¨: (cb-scrollbar)

**ç”¨æ³•**:
```lisp
(dcl:cell key rows columns show-line-number? show-column-number? show-scrollbar? header-title?)
```

**å‚æ•°**: 1 key  : é”®ï¼Œå…³é”®å­—;2 rows  : æœªè¯†åˆ«å®šä¹‰;3 columns  : æœªè¯†åˆ«å®šä¹‰;4 show-line-number?  : æœªè¯†åˆ«å®šä¹‰;5 show-column-number?  : æœªè¯†åˆ«å®šä¹‰;6 show-scrollbar?  : æœªè¯†åˆ«å®šä¹‰;7 header-title?  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: DCLæ ¼å¼å­—ç¬¦ä¸²

**ç¤ºä¾‹**:
```lisp
(dcl:cell "cell1" 10 8 t t t t)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:cell (key rows columns show-line-number? show-column-number? show-scrollbar? header-title? / tbl-widths *error*)
  "åˆ›å»º DCL å¯ç¼–è¾‘è¡¨æ ¼.\nå‚æ•°: 1. key: æ ‡è¯†\n      2. rows:æ˜¾ç¤ºè¡Œæ•°ï¼Œ\n      3. columns æ˜¾ç¤ºåˆ—æ•°(ä¸å¤§äº26), \n      4. show-line-number? : æ˜¯å¦æ˜¾ç¤ºè¡Œå·ï¼Œ \n      5. show-column-number?  : æ˜¯å¦æ˜¾ç¤ºåˆ—å·A~Zï¼Œ\n      6. show-scrollbar? : æ˜¯å¦æ˜¾ç¤ºç«–å‘æ»šåŠ¨æ¡. \n      7. fixed-title? ,åœ¨ç¬¬ä¸€è¡Œå›ºå®šæ˜¾ç¤ºæ ‡é¢˜ã€‚\n\ntile-key: scrollbar header1 header2 headern, A1 B1 ... Z1 , A2 B2 ... Z2 , A99 B99 ... Z99 ......\nModeléƒ¨: tbl-widths: åˆ—å®½è¡¨;cell-data åˆ—è¡¨æ•°æ®;\nControléƒ¨: (cb-scrollbar)"
  "DCLæ ¼å¼å­—ç¬¦ä¸²"
  "(dcl:cell \"cell1\"
    10 8 t t t t)"
  (defun *error* (msg)
    (if (/= (quote file)
        (type dcl-fp))
      (alert "è¯·å…ˆè¿è¡Œ (dcl:dialog  ...)"))
    (@:*error* msg))
  (defun dcl:get-celldata (key /)
    "è¿”å›cell è¡¨æ ¼çš„ç»“æœï¼Œä¼šå‚ç…§åŸå§‹è¡¨è¿›è¡Œæ•°æ®è½¬æ¢ã€‚"
    ""
    ""
    (set (read (strcat key "-data"))
      (mapcar (quote (lambda (x type1)
            (mapcar (quote (lambda (y ty)
                  (if (p:stringp y)
                    (@:to-type y (type ty))
                    y)))
              x type1)))
        (dcl:save-celldata key)
        lst-cellraw)))
  (defun dcl:save-celldata (key / lst-dcl per-page% curr-page% tmp-data% tmp-data-pre tmp-data-last)
    "ä¿å­˜ cell è¡¨çš„ç»“æœåˆ°ä¸´æ—¶è¡¨ *key*tmp-data ä¸­ã€‚æœªè¿›è¡Œç±»å‹è½¬æ¢ï¼ŒæŸ¥çœ‹è¿‡çš„å‡ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚"
    ""
    ""
    (setq per-page% (eval (read (strcat key "per-page")))
      curr-page% (eval (read (strcat key "curr-page")))
      tmp-data% (eval (read (strcat key "tmp-data"))))
    (setq lst-dcl nil r% 0)
    (repeat (min per-page% (- (length (cdr tmp-data%))
          (* curr-page% per-page%)))
      (setq c% 64)
      (setq r% (1+ r%))
      (setq lst-r% (quote nil))
      (repeat (length (car tmp-data%))
        (setq lst-r% (cons (vl-string-left-trim (chr 32)
              (get_tile (strcat key (chr (setq c% (1+ c%)))
                  (itoa r%))))
            lst-r%)))
      (setq lst-dcl (cons (reverse lst-r%)
          lst-dcl)))
    (setq lst-dcl (reverse lst-dcl))
    (setq i% 0)
    (setq tmp-data-pre nil)
    (repeat (min (* curr-page% per-page%)
        (length (cdr tmp-data%)))
      (setq tmp-data-pre (cons (nth (setq i% (1+ i%))
            tmp-data%)
          tmp-data-pre)))
    (setq i% (* (1+ curr-page%)
        per-page%))
    (setq tmp-data-last (quote nil))
    (if (> (- (length (cdr tmp-data%))
          (* (1+ curr-page%)
            per-page%))
        0)
      (repeat (- (length (cdr tmp-data%))
          (* (1+ curr-page%)
            per-page%))
        (setq tmp-data-last (cons (nth (setq i% (1+ i%))
              tmp-data%)
            tmp-data-last))))
    (set (read (strcat key "tmp-data"))
      (setq tmp-data% (append (list (car tmp-data%))
          (reverse tmp-data-pre)
          lst-dcl (reverse tmp-data-last)))))
  (defun dcl:show-celldata (key / tmp-unit curr-page% tmp-data% per-page%)
    (setq per-page% (eval (read (strcat key "per-page")))
      curr-page% (eval (read (strcat key "curr-page")))
      tmp-data% (eval (read (strcat key "tmp-data"))))
    (setq i% 0)
    (repeat (length (car tmp-data%))
      (set_tile (strcat key "header"
          (itoa (setq i% (1+ i%))))
        (nth (1- i%)
          (car tmp-data%))))
    (setq c% 64)
    (repeat (length (car tmp-data%))
      (setq r% 0 c% (1+ c%))
      (repeat (min per-page% (- (length (cdr tmp-data%))
            (* per-page% curr-page%)))
        (setq tmp-unit (nth (- c% 65)
            (nth (1- (+ (setq r% (1+ r%))
                  (* per-page% curr-page%)))
              (cdr tmp-data%))))
        (set_tile (strcat key (chr c%)
            (itoa r%))
          (cond ((or (p:intp tmp-unit)
                (and (= (quote str)
                    (type tmp-unit))
                  (string:intp tmp-unit)))
              (string:number-format (vl-string-left-trim (chr 32)
                  (@:to-string tmp-unit))
                5 0 (chr 32)))
            ((or (numberp tmp-unit)
                (and (= (quote str)
                    (type tmp-unit))
                  (string:numberp tmp-unit)))
              (string:number-format (vl-string-left-trim (chr 32)
                  (@:to-string tmp-unit))
                5 3 (chr 32)))
            (t (@:to-string tmp-unit))))
        (mode_tile (strcat key (chr c%)
            (itoa r%))
          0)
        (set_tile (strcat key "rno"
            (itoa r%))
          (string:number-format (@:to-string (+ r% (* per-page% curr-page%)))
            7 0 (chr 32))))
      (while (< r% per-page%)
        (repeat (length (car tmp-data%))
          (set_tile (strcat key (chr c%)
              (itoa (setq r% (1+ r%))))
            "")
          (mode_tile (strcat key (chr c%)
              (itoa r%))
            1)
          (set_tile (strcat key "rno"
              (itoa r%))
            "")))))
  (setq dcl:accept-hook (cons (list key (quote dcl:get-celldata)
        key)
      dcl:accept-hook))
  (set (read (strcat key "per-page"))
    rows)
  (set (read (strcat key "total-page"))
    (fix (1+ (/ (1- (length (cdr (eval (read (strcat key "tmp-data"))))))
          (eval (read (strcat key "per-page")))))))
  (set (read (strcat "cb-"
        key "scrollbar"))
    (lambda (key)
      "æ»šåŠ¨æ¡äº‹ä»¶çš„å›è°ƒå‡½æ•°"
      (dcl:save-celldata key)
      (set (read (strcat key "curr-page"))
        (- (1- (eval (read (strcat key "total-page"))))
          (atoi (get_tile (strcat key "scrollbar")))))
      (print (eval (read (strcat key "curr-page"))))
      (dcl:show-celldata key)))
  (if (and ui:*table-widths* (apply (quote and)
        (mapcar (quote numberp)
          ui:*table-widths*))
      (> (apply (quote min)
          ui:*table-widths*)
        0)
      (= (length ui:*table-widths*)
        columns))
    (setq tbl-widths ui:*table-widths*)
    (progn (repeat rows (setq tbl-widths (cons 10 tbl-widths)))))
  (write-line ":row{:column{"
    dcl-fp)
  (if show-column-number? (progn (write-line (strcat ": row { ")
        dcl-fp)
      (if show-line-number? (write-line (strcat ":edit_box{value=\"No.\";width=2;fixed_width=true;horizontal_margin=none;vertical_margin=none;is_enabled=false;}")
          dcl-fp))
      (setq c% 64)
      (repeat columns (write-line (strcat ":edit_box{value=\""
            (chr (setq c% (1+ c%)))
            "\";width="
            (itoa (nth (- c% 65)
                tbl-widths))
            ";fixed_width=true;horizontal_margin=none;vertical_margin=none;is_enabled=false;}")
          dcl-fp))
      (write-line (strcat "}")
        dcl-fp)))
  (if header-title? (progn (write-line (strcat ": row { ")
        dcl-fp)
      (if show-line-number? (write-line (strcat ":edit_box{value=\"\";width=2;fixed_width=true;horizontal_margin=none;vertical_margin=none;is_enabled=false;}")
          dcl-fp))
      (setq i% 0)
      (repeat columns (write-line (strcat ":edit_box{key=\""
            key "header"
            (itoa (setq i% (1+ i%)))
            "\";value=\"\";width="
            (itoa (nth (1- i%)
                tbl-widths))
            ";fixed_width=true;horizontal_margin=none;vertical_margin=none;is_enabled=false;}")
          dcl-fp))
      (write-line (strcat "}")
        dcl-fp)))
  (setq r% 0)
  (repeat rows (write-line (strcat ":row{")
      dcl-fp)
    (setq r% (1+ r%)
      c% 64)
    (if show-line-number? (write-line (strcat ":edit_box{key=\""
          key "rno"
          (itoa r%)
          "\";value=\"\";width=2;fixed_width=true;horizontal_margin=none;vertical_margin=none;is_enabled=false;}")
        dcl-fp))
    (repeat columns (write-line (strcat ":edit_box{key=\""
          key (chr (setq c% (1+ c%)))
          (itoa r%)
          "\";value=\"\";width="
          (itoa (nth (- c% 65)
              tbl-widths))
          ";fixed_width=true;horizontal_margin=none;vertical_margin=none;}")
        dcl-fp))
    (write-line (strcat "}")
      dcl-fp))
  (write-line (strcat "}")
    dcl-fp)
  (if show-scrollbar? (write-line (strcat ":slider{action=\"(cb-"
          key "scrollbar \\\""
          key "\\\")\";key=\""
        key "scrollbar\";layout=vertical;value="
        (itoa (1- (eval (read (strcat key "total-page")))))
        ";max_value="
        (itoa (1- (eval (read (strcat key "total-page")))))
        ";min_value=0;small_increment=1;}")
      dcl-fp))
  (write-line "}"
    dcl-fp))
```
</details>

---

### dcl:dialog

**è¯´æ˜**: åˆ›å»ºåä¸º name çš„å¯¹è¯æ¡†æ–‡ä»¶ã€‚å¤–éƒ¨å˜é‡: dcl-tmp å«è·¯å¾„çš„æ–‡ä»¶å. dcl-fp æ–‡ä»¶æŒ‡é’ˆã€‚

**ç”¨æ³•**:
```lisp
(dcl:dialog name)
```

**å‚æ•°**: 1 name  : æœªè¯†åˆ«å®šä¹‰;

**ç¤ºä¾‹**:
```lisp
(dcl:dialog "tips")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:dialog (name)
  "åˆ›å»ºåä¸º name çš„å¯¹è¯æ¡†æ–‡ä»¶ã€‚å¤–éƒ¨å˜é‡: dcl-tmp å«è·¯å¾„çš„æ–‡ä»¶å. dcl-fp æ–‡ä»¶æŒ‡é’ˆã€‚ "
  ""
  "(dcl:dialog \"tips\")"
  (setq dcl:accept-hook nil)
  (setq dcl-tmp
    (cond
      ((eq $platform 'microsoft)
       (vl-filename-mktemp name @::*tmp-path* ".dcl"))
      ((eq $platform 'linux)
       (strcat "/tmp/tmp-"name".dcl"))))
  (setq dcl-fp (open dcl-tmp "w"))
  (write-line (strcat name ":dialog {"
      "label = \""
      name "\";key=\"title\";")
    dcl-fp))
```
</details>

---

### dcl:dialog-end-ok-cancel

**è¯´æ˜**: å®Œæˆåˆ›å»º DCLæ–‡ä»¶ ï¼Œ å¹¶å…³é—­æ–‡ä»¶æŒ‡é’ˆã€‚

**ç”¨æ³•**:
```lisp
(dcl:dialog-end-ok-cancel )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:dialog-end-ok-cancel nil "å®Œæˆåˆ›å»º DCLæ–‡ä»¶ ï¼Œ å¹¶å…³é—­æ–‡ä»¶æŒ‡é’ˆã€‚"
  ""
  (write-line ":spacer{} ok_cancel;}"
    dcl-fp)
  (close dcl-fp))
```
</details>

---

### dcl:end-cluster

**è¯´æ˜**: å¼€å§‹ dcl å®¹å™¨ç±»æ§ä»¶ã€‚ä¸ dcl:begin-cluster æˆå¯¹ä½¿ç”¨ã€‚

**ç”¨æ³•**:
```lisp
(dcl:end-cluster )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:end-cluster nil "å¼€å§‹ dcl å®¹å™¨ç±»æ§ä»¶ã€‚ä¸ dcl:begin-cluster æˆå¯¹ä½¿ç”¨ã€‚"
  ""
  ""
  (write-line "}"
    dcl-fp))
```
</details>

---

### dcl:end-dialog

**è¯´æ˜**: å®Œæˆåˆ›å»º DCLæ–‡ä»¶ ï¼Œ å¹¶å…³é—­æ–‡ä»¶æŒ‡é’ˆã€‚å‚æ•° str-Yes-No å­—ç¬¦ä¸²ç”¨ - åˆ†éš”æˆä¸¤éƒ¨åˆ†ï¼Œå‰é¢ä¸ºaccept,åé¢ä¸º Cancel.å¦‚ æ˜¯-å¦ï¼Œæ„¿æ„-ä¸æ„¿æ„ã€‚

**ç”¨æ³•**:
```lisp
(dcl:end-dialog str-yes-no)
```

**å‚æ•°**: 1 str-yes-no  : å­—ç¬¦ä¸²;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:end-dialog (str-yes-no / para)
  "å®Œæˆåˆ›å»ºDCLæ–‡ä»¶å¹¶å…³é—­æ–‡ä»¶æŒ‡é’ˆã€‚
å‚æ•° str-Yes-No å­—ç¬¦ä¸²ç”¨ - åˆ†éš”æˆä¸¤éƒ¨åˆ†ï¼Œå‰é¢ä¸ºaccept,åé¢ä¸º Cancel.å¦‚ æ˜¯-å¦ï¼Œæ„¿æ„-ä¸æ„¿æ„ã€‚"
  ""
  (if (null str-yes-no)
      (setq str-yes-no "Yes-No"))
  (setq para (string:to-list str-yes-no "-"))
  (cond ((= (length para)
            0)
   (setq para (list "æ˜¯" "å¦")))
  ((= (length para)
            1)
   (setq para (list (car para)
        "å¦"))))
  (write-line (strcat ":spacer{} : column {: row { fixed_width = true; alignment = centered; : retirement_button { label =\""
          (car para)"\";key=\"accept\";is_default=true;} :spacer{ width = 2; }:retirement_button {label= \""
          (cadr para) "\"; key =\"cancel\"; is_cancel = true;}}}}")
        dcl-fp)
  (close dcl-fp))
```
</details>

---

### dcl:error

**è¯´æ˜**: dcl ç³»åˆ—å‡½æ•°çš„é”™è¯¯å¤„ç†ï¼Œå½“dcl è¿è¡Œå‡ºé”™åçš„ä¸€ç³»åˆ—æ‰«å°¾å·¥ä½œï¼Œé˜²æ­¢å¯¹è¯æ¡†æ— æ³•å…³é—­è€Œåªèƒ½å¼ºè¡Œç»“æŸä»»åŠ¡çš„æƒ…å†µã€‚

**ç”¨æ³•**:
```lisp
(dcl:error msg)
```

**å‚æ•°**: 1 msg  : æç¤ºä¿¡æ¯;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:error (msg)
  "dcl ç³»åˆ—å‡½æ•°çš„é”™è¯¯å¤„ç†ï¼Œå½“dcl è¿è¡Œå‡ºé”™åçš„ä¸€ç³»åˆ—æ‰«å°¾å·¥ä½œï¼Œé˜²æ­¢å¯¹è¯æ¡†æ— æ³•å…³é—­è€Œåªèƒ½å¼ºè¡Œç»“æŸä»»åŠ¡çš„æƒ…å†µã€‚"
  (term_dialog)
  (if dcl-id (unload_dialog dcl-id))
  (if (= (quote file)
      (type dcl-fp))
    (close dcl-fp))
  (if (and (= (quote str)
        (type dcl-tmp))
      (findfile dcl-tmp))
    (vl-file-delete dcl-tmp))
  (@:*error* msg))
```
</details>

---

### dcl:hr

**è¯´æ˜**: DCL æ°´å¹³çº¿,ç²—åº¦ size å€¼ æ¨èä¸º 0.08(ä¸€ä¸ªåƒç´ ),0.17(ä¸¤ä¸ªåƒç´ ).

**ç”¨æ³•**:
```lisp
(dcl:hr size)
```

**å‚æ•°**: 1 size  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: dclæ ¼å¼å­—ç¬¦ä¸²

**ç¤ºä¾‹**:
```lisp
(dcl:hr 0.08)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:hr (size / color)
  "DCL æ°´å¹³çº¿,ç²—åº¦ size å€¼ æ¨èä¸º 0.08(ä¸€ä¸ªåƒç´ ),0.17(ä¸¤ä¸ªåƒç´ )."
  "dclæ ¼å¼å­—ç¬¦ä¸²"
  "(dcl:hr 0.08)"
  (or (setq color theme:bg-color)
    (setq color 152))
  (write-line (strcat ":image{ height="
      (rtos size 2 2)
      "; color="
      (itoa color)
      "; fixed_height=true;vertical_margin=none;}")
    dcl-fp))
```
</details>

---

### dcl:image-button

**è¯´æ˜**: dcl å›¾åƒæŒ‰é’®ã€‚

**ç”¨æ³•**:
```lisp
(dcl:image-button key width height style)
```

**å‚æ•°**: 1 key  : é”®ï¼Œå…³é”®å­—;2 width  : æœªè¯†åˆ«å®šä¹‰;3 height  : æœªè¯†åˆ«å®šä¹‰;4 style  : æœªè¯†åˆ«å®šä¹‰;

**ç¤ºä¾‹**:
```lisp
(dcl:image-button "btn1" 30 60)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:image-button (key width height style)
  "dcl å›¾åƒæŒ‰é’®ã€‚"
  ""
  "(dcl:image-button \"btn1\"
    30 60)"
  (set (read (strcat "cb-"
        key))
    (eval (read (strcat "(lambda()(alert (strcat \"éœ€è¦å®šä¹‰å›è°ƒå‡½æ•° (cb-"
                  key ")\")))"))))
  (write-line (strcat ":image_button{key=\""
      key "\";width="
      (rtos width 2)
      ";height="
      (rtos height 2)
      ";color=152;"
      "action=\"(cb-"
        key ")\";"
      (dcl:lst2dcl style)
      "}")
    dcl-fp))
```
</details>

---

### dcl:img

**è¯´æ˜**: dcl å›¾åƒæ§ä»¶ã€‚

**ç”¨æ³•**:
```lisp
(dcl:img key width height)
```

**å‚æ•°**: 1 key  : é”®ï¼Œå…³é”®å­—;2 width  : æœªè¯†åˆ«å®šä¹‰;3 height  : æœªè¯†åˆ«å®šä¹‰;

**ç¤ºä¾‹**:
```lisp
(dcl:img "img1 10 5)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:img (key width height)
  "dcl å›¾åƒæ§ä»¶ã€‚"
  ""
  "(dcl:img \"img1 10 5)"
  (write-line (strcat ":image{key=\""
      key "\";width="
      (rtos width 2)
      ";height="
      (rtos height 2)
      ";color=152;}")
    dcl-fp))
```
</details>

---

### dcl:input

**è¯´æ˜**: dcl è¾“å…¥æ¡†ã€‚

**ç”¨æ³•**:
```lisp
(dcl:input key label default style)
```

**å‚æ•°**: 1 key  : é”®ï¼Œå…³é”®å­—;2 label  : æ ‡ç­¾;3 default  : æœªè¯†åˆ«å®šä¹‰;4 style  : æœªè¯†åˆ«å®šä¹‰;

**ç¤ºä¾‹**:
```lisp
(dcl:input "in1" "label" "3" "")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:input (key label default style)
  "dcl è¾“å…¥æ¡†ã€‚"
  ""
  "(dcl:input \"in1\"
    \"label\"
    \"3\"
    \"\")"
  (write-line (strcat ": edit_box{key=\""
      key "\";"
      "label=\""
      label "\";"
      "value=\""
      default "\";"
      (dcl:lst2dcl style)
      "}")
    dcl-fp))
```
</details>

---

### dcl:lst2dcl

**è¯´æ˜**: å°† lst æ ¼å¼çš„DCL æè¿°è¡¨è¾¾å¼è½¬ä¸º DCL æ ¼å¼. lst æ ¼å¼å½“ä¸ºç‚¹å¯¹æ—¶ï¼Œè¡¨ç¤ºä¸ºå±æ€§å€¼å¯¹ï¼Œå½“ä¸ºåˆ—è¡¨æ—¶ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä¸º Tile åã€‚

**ç”¨æ³•**:
```lisp
(dcl:lst2dcl lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: String

**ç¤ºä¾‹**:
```lisp
(dcl:lst2dcl '(button (key . btn)(label . BTN)(width . 20)(height . 3)) ;; => :button {key="btn";label="BTN";width=20;height=3;}
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:lst2dcl (lst)
  "å°† lst æ ¼å¼çš„DCL æè¿°è¡¨è¾¾å¼è½¬ä¸º DCL æ ¼å¼. lst æ ¼å¼è¯´æ˜ï¼šå½“ä¸ºç‚¹å¯¹æ—¶ï¼Œè¡¨ç¤ºä¸ºå±æ€§å€¼å¯¹ï¼Œå½“ä¸ºåˆ—è¡¨æ—¶ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä¸º Tile åã€‚"
  "String"
  "(dcl:lst2dcl '(button (key . btn)(label . BTN)(width . 20)(height . 3))
    ;; => :button {key=\"btn\";label=\"BTN\";width=20;height=3;}"
    (defun handle-value (sym)
      (cond ((p:intp sym)
          (itoa sym))
        ((numberp sym)
          (rtos sym 2 3))
        ((p:stringp sym)
          (strcat "\""
            sym "\""))
        ((member sym (quote (true false)))
          (vl-symbol-name sym))
        (t (strcat "\""
            (vl-symbol-name sym)
            "\""))))
    (if (p:stringp lst)
      lst (cond ((null lst)
          "")
        ((p:dotpairp lst)
          (strcat (vl-symbol-name (car lst))
            "="
            (handle-value (cdr lst))
            ";"))
        ((listp lst)
          (cond ((atom (car lst))
              (strcat ":"
                (vl-string-trim ":"
                  (vl-symbol-name (car lst)))
                "{"
                (dcl:lst2dcl (cdr lst))
                "}"))
            (t (string:from-lst (mapcar (quote dcl:lst2dcl)
                  lst)
                "")))))))
```
</details>

---

### dcl:mtext

**è¯´æ˜**: å¸¦æ¡æ ¼çš„å¤šè¡Œæ–‡æœ¬ã€‚å¯¹èµ‹ä¼ ä¸‹çš„ä¸€æ®µå­—ç¬¦ä¸²è‡ªè¡Œæ¢è¡Œå¤„ç†ã€‚

**ç”¨æ³•**:
```lisp
(dcl:mtext key rows width)
```

**å‚æ•°**: 1 key  : é”®ï¼Œå…³é”®å­—;2 rows  : æœªè¯†åˆ«å®šä¹‰;3 width  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:mtext (key rows width / color)
  "å¸¦æ¡æ ¼çš„å¤šè¡Œæ–‡æœ¬ã€‚å¯¹èµ‹ä¼ ä¸‹çš„ä¸€æ®µå­—ç¬¦ä¸²è‡ªè¡Œæ¢è¡Œå¤„ç†ã€‚"
  (or (setq color theme:bg-color)
    (setq color 152))
  (setq i% 0)
  (write-line (strcat ":column{"
      ":image{ height=0.17; color="
      (itoa color)
      "; fixed_height=true;vertical_margin=none;}"
      ":image{ height=0.08; color="
      (itoa color)
      "; fixed_height=true;}")
    dcl-fp)
  (repeat rows (write-line (strcat ":text{key=\""
        key (itoa (1+ i%))
        "\";value=\"\";width="
        (itoa width)
        ";height=1.3;}"
        ":image{ height=0.08; color="
        (itoa color)
        "; fixed_height=true;}")
      dcl-fp)
    (setq i% (1+ i%)))
  (write-line (strcat ":image{ height=0.17; color="
      (itoa color)
      "; fixed_height=true;vertical_margin=none;}}:spacer{}")
    dcl-fp))
```
</details>

---

### dcl:new

**è¯´æ˜**: è½½å…¥DCLï¼Œå¹¶åˆ›å»ºå¯¹è¯æ¡†åä¸º name çš„å¯¹è±¡ã€‚

**ç”¨æ³•**:
```lisp
(dcl:new name)
```

**å‚æ•°**: 1 name  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:new (name)
  "è½½å…¥DCLï¼Œå¹¶åˆ›å»ºå¯¹è¯æ¡†åä¸º name çš„å¯¹è±¡ã€‚"
  ""
  (setq dcl-id (load_dialog dcl-tmp))
  (if (not (new_dialog name dcl-id))
    (progn (princ "åˆ›å»ºå¯¹è¯æ¡†å¤±è´¥ï¼Œå¯èƒ½æ˜¯å¤ªå¤§äº†")
      (exit)))
  (action_tile "accept"
    "(dcl:accept)"))
```
</details>

---

### dcl:paging

**è¯´æ˜**: DCL åˆ†é¡µæ¨¡å—ï¼Œkeyä¸º prev, next, curr_total. å‚æ•° h-or-v : t ä¸º æ°´å¹³ï¼Œnil ä¸ºç«–å‘.Modeléƒ¨å¤–éƒ¨å˜é‡è¯´æ˜: curr-page:å½“å‰é¡µå·, total-page :æ€»é¡µæ•°ã€‚Controléƒ¨å›è°ƒå‡½æ•°å®šä¹‰: (cb-flush-page) é¡µé¢æ›´æ–°ã€‚Initéƒ¨: (paging-init)åˆå§‹åŒ–æŒ‰é’®ä½¿èƒ½

**ç”¨æ³•**:
```lisp
(dcl:paging h-or-v)
```

**å‚æ•°**: 1 h-or-v  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: dclæ ¼å¼å­—ç¬¦ä¸²ã€‚

**ç¤ºä¾‹**:
```lisp
(dcl:paging t)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:paging (h-or-v / *error*)
  "DCL åˆ†é¡µæ¨¡å—ï¼Œkeyä¸º prev, next, curr_total. \nå‚æ•° h-or-v : t ä¸º æ°´å¹³ï¼Œnil ä¸ºç«–å‘.\nModeléƒ¨å¤–éƒ¨å˜é‡è¯´æ˜: curr-page:å½“å‰é¡µå·, total-page :æ€»é¡µæ•°ã€‚\nControléƒ¨å›è°ƒå‡½æ•°å®šä¹‰: (cb-flush-page)
  é¡µé¢æ›´æ–°ã€‚\nInitéƒ¨: (paging-init)åˆå§‹åŒ–æŒ‰é’®ä½¿èƒ½"
  "dclæ ¼å¼å­—ç¬¦ä¸²ã€‚"
  "(dcl:paging t)"
  (defun *error* (msg)
    (if (/= (quote file)
        (type dcl-fp))
      (alert "è¯·å…ˆè¿è¡Œ dcl:dialog ."))
    (@:*error* msg))
  (defun cb-flush-page nil "ä¸€èˆ¬å‡½æ•°ï¼Œéœ€æ ¹æ®åŠŸèƒ½è¦æ±‚é‡æ–°å®šä¹‰."
    (alert "è¯·å®šä¹‰å›è°ƒå‡½æ•° (cb-flush-page)"))
  (defun paging-init nil (if (= 0 curr-page)
      (mode_tile "prev"
        1)
      (mode_tile "prev"
        0))
    (if (= (1- total-page)
        curr-page)
      (mode_tile "next"
        1)
      (mode_tile "next"
        0))
    (set_tile "curr_total"
      (strcat (itoa (1+ curr-page))
        "/"
        (itoa total-page))))
  (defun cb-page-up nil (setq curr-page (1- curr-page))
    (if (< curr-page 0)
      (setq curr-page 0))
    (if (= 0 curr-page)
      (mode_tile "prev"
        1)
      (mode_tile "prev"
        0))
    (if (= (1- total-page)
        curr-page)
      (mode_tile "next"
        1)
      (mode_tile "next"
        0))
    (set_tile "curr_total"
      (strcat (itoa (1+ curr-page))
        "/"
        (itoa total-page)))
    (cb-flush-page))
  (defun cb-page-down nil (setq curr-page (1+ curr-page))
    (if (> curr-page total-page)
      (setq curr-page total-page))
    (if (= 0 curr-page)
      (mode_tile "prev"
        1)
      (mode_tile "prev"
        0))
    (if (= (1- total-page)
        curr-page)
      (mode_tile "next"
        1)
      (mode_tile "next"
        0))
    (set_tile "curr_total"
      (strcat (itoa (1+ curr-page))
        "/"
        (itoa total-page)))
    (cb-flush-page))
  (write-line (strcat (if h-or-v ":row"
        ":column")
      "{alignment=centered;children_alignment=centered;"
      ":button{action=\"(cb-page-up)\";label=\"(<)Prev\";mnemonic=\"<\";key=\"prev\";is_enabled=false;alignment=centered;}"
      "spacer_0;"
      ":text_part{key=\"curr_total\"; value=\"\";alignment=centered;width=10;}"
      ":button{action=\"(cb-page-down)\";label=\"Next(>)\";mnemonic=\">\";key=\"next\";is_enabled=false;alignment=centered;}}")
    dcl-fp))
```
</details>

---

### dcl:password

**è¯´æ˜**: dcl è¾“å…¥æ¡†ã€‚

**ç”¨æ³•**:
```lisp
(dcl:password key label default style)
```

**å‚æ•°**: 1 key  : é”®ï¼Œå…³é”®å­—;2 label  : æ ‡ç­¾;3 default  : æœªè¯†åˆ«å®šä¹‰;4 style  : æœªè¯†åˆ«å®šä¹‰;

**ç¤ºä¾‹**:
```lisp
(dcl:password "pw1" "label" "abc" "")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:password (key label default style)
  "dcl è¾“å…¥æ¡†ã€‚"
  ""
  "(dcl:password \"pw1\"
    \"label\"
    \"abc\"
    \"\")"
  (write-line (strcat ": edit_box{key=\""
      key "\";"
      "label=\""
      label "\";"
      "value=\""
      default "\";password_char=\"*\";"
      (dcl:lst2dcl style)
      "}")
    dcl-fp))
```
</details>

---

### dcl:progressbar

**è¯´æ˜**: dcl è¿›åº¦æ¡ã€‚

**ç”¨æ³•**:
```lisp
(dcl:progressbar key style show-txt?)
```

**å‚æ•°**: 1 key  : é”®ï¼Œå…³é”®å­—;2 style  : æœªè¯†åˆ«å®šä¹‰;3 show-txt?  : æœªè¯†åˆ«å®šä¹‰;

**ç¤ºä¾‹**:
```lisp
(dcl:progress-bar "pbar1" "" t)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:progressbar (key style show-txt? / color)
  "dcl è¿›åº¦æ¡ã€‚"
  ""
  "(dcl:progress-bar \"pbar1\"
    \"\"
    t)"
  (or (setq color theme:bg-color)
    (setq color 152))
  (write-line (strcat (if show-txt? ":row{"
        "")
      ":image{key=\""
      key "\";height=0.3;color=253;fixed_height=true;vertical_margin=none;"
      style "}"
      (if show-txt? (strcat ":text{key=\""
          key "txt\";width=4;fixed_width=true;}}")
        ""))
    dcl-fp))
```
</details>

---

### dcl:scrollbar

**ç”¨æ³•**:
```lisp
(dcl:scrollbar key style h-or-v)
```

**å‚æ•°**: 1 key  : é”®ï¼Œå…³é”®å­—;2 style  : æœªè¯†åˆ«å®šä¹‰;3 h-or-v  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:scrollbar (key style h-or-v)
  (set (read (strcat "cb-"
        key "scrollbar"))
    (lambda (key)
      "æ»šåŠ¨æ¡äº‹ä»¶çš„å›è°ƒå‡½æ•°"
      (alert (strcat "è¯·å®šä¹‰å›è°ƒå‡½æ•° (cb-"
            key "scrollbar)"))))
  (if (eval (read (strcat key "total-page")))
    (write-line (strcat ":slider{action=\"(cb-"
          key "scrollbar \\\""
          key "\\\")\";key=\""
        key "\";layout="
        (if h-or-v "horizontal"
          "vertical")
        ";value="
        (itoa (1- (eval (read (strcat key "total-page")))))
        ";max_value="
        (itoa (1- (eval (read (strcat key "total-page")))))
        ";min_value=0;small_increment=1;}")
      dcl-fp)
    (alert (strcat "è¯·åœ¨Modeléƒ¨å®šä¹‰ "
        key "total-page å˜é‡ã€‚"))))
```
</details>

---

### dcl:set-mtext

**è¯´æ˜**: ç»™ mtext æ§ä»¶èµ‹å€¼ï¼Œè‡ªåŠ¨æ¢è¡Œã€‚å½“ value çš„é•¿åº¦å¤§äº mtext å¯ä»¥å®¹çº³çš„é•¿åº¦æ—¶ï¼Œç»“å°¾åŠ  ... å·ã€‚

**ç”¨æ³•**:
```lisp
(dcl:set-mtext key value)
```

**å‚æ•°**: 1 key  : é”®ï¼Œå…³é”®å­—;2 value  : å€¼;

**ç¤ºä¾‹**:
```lisp
(dcl:set-mtext "mt" "ç»™ mtext æ§ä»¶èµ‹å€¼ï¼Œè‡ªåŠ¨æ¢è¡Œã€‚å½“ value çš„é•¿åº¦å¤§äº mtext å¯ä»¥å®¹çº³çš„é•¿åº¦æ—¶ï¼Œç»“å°¾åŠ  ... å·ã€‚")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:set-mtext (key value / i% rows width)
  "ç»™ mtext æ§ä»¶èµ‹å€¼ï¼Œè‡ªåŠ¨æ¢è¡Œã€‚å½“ value çš„é•¿åº¦å¤§äº mtext å¯ä»¥å®¹çº³çš„é•¿åº¦æ—¶ï¼Œç»“å°¾åŠ  ... å·ã€‚"
  ""
  "(dcl:set-mtext \"mt\"
    \"ç»™ mtext æ§ä»¶èµ‹å€¼ï¼Œè‡ªåŠ¨æ¢è¡Œã€‚å½“ value çš„é•¿åº¦å¤§äº mtext å¯ä»¥å®¹çº³çš„é•¿åº¦æ—¶ï¼Œç»“å°¾åŠ  ... å·ã€‚\")"
  (setq i% 0)
  (while (get_tile (strcat key (itoa (setq i% (1+ i%))))))
  (setq rows (1- i%))
  (setq width (atoi (get_attr (strcat key "1")
        "width")))
  (setq i% 0)
  (setq lst-value% nil)
  (foreach c% (string:s2l-ansi value)
    (cond ((> i% rows)
        nil)
      ((= 10 c%)
        (set_tile (strcat key (itoa (setq i% (1+ i%))))
          (string:l2s-ansi (reverse lst-value%)))
        (setq lst-value% nil))
      ((> (string:bytelength (string:l2s-ansi (reverse (cdr lst-value%))))
          (- width 6))
        (set_tile (strcat key (itoa (setq i% (1+ i%))))
          (string:l2s-ansi (reverse lst-value%)))
        (setq lst-value% (cons c% nil)))
      (t (setq lst-value% (cons c% lst-value%)))))
  (if (and (> (length lst-value%)
        0)
      (<= i% rows))
    (set_tile (strcat key (itoa (setq i% (1+ i%))))
      (string:l2s-ansi (reverse lst-value%))))
  (while (get_tile (strcat key (itoa (setq i% (1+ i%)))))
    (set_tile (strcat key (itoa i%))
      "")))
```
</details>

---

### dcl:set-progressbar

**è¯´æ˜**: è®¾ç½® dcl è¿›åº¦æ¡çš„å€¼ã€‚

**ç”¨æ³•**:
```lisp
(dcl:set-progressbar key value)
```

**å‚æ•°**: 1 key  : é”®ï¼Œå…³é”®å­—;2 value  : å€¼;

**ç¤ºä¾‹**:
```lisp
(dcl:set-progressbar "pbar1" 0.5)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:set-progressbar (key value / w h color)
  "è®¾ç½® dcl è¿›åº¦æ¡çš„å€¼ã€‚"
  ""
  "(dcl:set-progressbar \"pbar1\"
    0.5)"
  (or (setq color theme:bg-color)
    (setq color 152))
  (if (> value 1)
    (setq value 1)
    (if (< value 0)
      (setq value 0)))
  (setq w (dimx_tile key)
    h (dimy_tile key))
  (start_image key)
  (fill_image 0 0 w h 253)
  (fill_image 0 0 (fix (* value w))
    h color)
  (end_image)
  (set_tile (strcat key "txt")
    (strcat (itoa (fix (* value 100)))
      "%")))
```
</details>

---

### dcl:show

**è¯´æ˜**: æ˜¾ç¤ºå¯¹è¯æ¡†

**ç”¨æ³•**:
```lisp
(dcl:show )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:show (/ ret)
  "æ˜¾ç¤ºå¯¹è¯æ¡†"
  ""
  (setq ret (start_dialog))
  (unload_dialog dcl-id)
  (vl-file-delete dcl-tmp)
  ret)
```
</details>

---

### dcl:text

**è¯´æ˜**: dcl è¾“å…¥æ¡†ã€‚

**ç”¨æ³•**:
```lisp
(dcl:text key label style)
```

**å‚æ•°**: 1 key  : é”®ï¼Œå…³é”®å­—;2 label  : æ ‡ç­¾;3 style  : æœªè¯†åˆ«å®šä¹‰;

**ç¤ºä¾‹**:
```lisp
(dcl:text "text1" "text string" "")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun dcl:text (key label style)
  "dcl è¾“å…¥æ¡†ã€‚"
  ""
  "(dcl:text \"text1\"
    \"text string\"
    \"\")"
  (write-line (strcat ": text{key=\""
      key "\";"
      "label=\""
      label "\";"
      (dcl:lst2dcl style)
      "}")
    dcl-fp))
```
</details>

---

## demo

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### demo:demo

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun demo:demo (lst pt)
  "è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºï¼Œæ²¡æœ‰å®é™…åŠŸèƒ½ï¼Œåªç”¨äºæµ‹è¯•"
  "String"
  "(demo:demo '(a b)
    '(0 0 0))"
  (alert "æµ‹è¯•ç”¨ä¾‹"))
```
</details>

---

## entity

**æ¨¡å—è¯´æ˜**: å›¾å…ƒåˆ›å»ºã€ä¿®æ”¹ã€æŸ¥è¯¢æ“ä½œ

### entity:activedimstyle

**è¯´æ˜**: æ¿€æ´»æŒ‡å®šçš„æ ‡æ³¨æ ·å¼ã€‚dimname:æ ‡æ³¨æ ·å¼å

**ç”¨æ³•**:
```lisp
(entity:activedimstyle dimname)
```

**å‚æ•°**: 1 dimname  : æœªè¯†åˆ«å®šä¹‰;

**ç¤ºä¾‹**:
```lisp
(activedimstyle "40")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:activedimstyle (dimname / acaddocument acadobject currdimstyle mspace)
  "æ¿€æ´»æŒ‡å®šçš„æ ‡æ³¨æ ·å¼ã€‚dimname:æ ‡æ³¨æ ·å¼å"
  ""
  "(activedimstyle \"40\")"
  (vl-load-com)
  (setq entname (tblobjname "DIMSTYLE"
      dimname))
  (setq acadobject (vlax-get-acad-object)
    acaddocument (vla-get-activedocument acadobject)
    mspace (vla-get-modelspace acaddocument))
  (setq currdimstyle (vlax-ename->vla-object entname))
  (vla-put-activedimstyle acaddocument currdimstyle)
  (princ))
```
</details>

---

### entity:activelayer

**è¯´æ˜**: è®¾ç½®æŒ‡å®šå±‚ä¸ºå½“å‰å±‚.  name:å›¾å±‚å

**ç”¨æ³•**:
```lisp
(entity:activelayer name)
```

**å‚æ•°**: 1 name  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: æˆåŠŸè¿”å›tï¼Œå¤±è´¥è¿”å›nil

**ç¤ºä¾‹**:
```lisp
(entity:ActiveLayer "layer1")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:activelayer (name / iloc out)
  "è®¾ç½®æŒ‡å®šå±‚ä¸ºå½“å‰å±‚.  name:å›¾å±‚å"
  "æˆåŠŸè¿”å›tï¼Œå¤±è´¥è¿”å›nil"
  "(entity:ActiveLayer \"layer1\")"
  (if (and (tblsearch "layer"
        name)
      (setq iloc (vl-position name (entity:layers))))
    (progn (vla-put-activelayer (std:active-document)
        (vla-item (std:layers)
          iloc))
      t)
    nil))
```
</details>

---

### entity:add-entitys-to-block

**è¯´æ˜**: æ·»åŠ é€‰æ‹©é›†åˆ°å—å®šä¹‰ã€‚

**ç”¨æ³•**:
```lisp
(entity:add-entitys-to-block block ss)
```

**å‚æ•°**: 1 block  : æœªè¯†åˆ«å®šä¹‰;2 ss  : é€‰æ‹©é›†;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:add-entitys-to-block (block ss / lst mat)
  "æ·»åŠ é€‰æ‹©é›†åˆ°å—å®šä¹‰ã€‚"
  (setq lst (pickset->vlalist ss)
    mat (entity:reference->definition block)
    mat (vlax-tmatrix (append (mapcar (quote append)
          (car mat)
          (mapcar (quote list)
            (cadr mat)))
        (quote ((0.0 0.0 0.0 1.0))))))
  (foreach obj lst (vla-transformby obj mat))
  (vla-copyobjects (std:active-document)
    (vla:objarray lst)
    (vla-item (vla-get-blocks (std:active-document))
      (vla-get-name block)))
  (foreach obj lst (vla-delete obj))
  (vla-regen (std:active-document)
    acallviewports))
```
</details>

---

### entity:addhatch

**è¯´æ˜**: åˆ›å»ºå¡«å……ã€‚outArray:å¤–è¾¹ç•Œå¯¹è±¡è¡¨ï¼ŒinArray:å†…è¾¹ç•Œå¯¹è±¡è¡¨ï¼Œname:å……å¡«åç§°

**ç”¨æ³•**:
```lisp
(entity:addhatch outarray inarray name)
```

**å‚æ•°**: 1 outarray  : æœªè¯†åˆ«å®šä¹‰;2 inarray  : æœªè¯†åˆ«å®šä¹‰;3 name  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: å¡«å……ä½“å¯¹è±¡

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:addhatch (outarray inarray name / hatchobj)
  "åˆ›å»ºå¡«å……ã€‚outArray:å¤–è¾¹ç•Œå¯¹è±¡è¡¨ï¼ŒinArray:å†…è¾¹ç•Œå¯¹è±¡è¡¨ï¼Œname:å……å¡«åç§°"
  "å¡«å……ä½“å¯¹è±¡"
  (setq hatchobj (vla-addhatch (std:model-space)
      achatchpatterntypepredefined name :vlax-true))
  (vla-appendouterloop hatchobj (vla:objarray (mapcar (quote vlax-ename->vla-object)
        outarray)))
  (if inarray (vla-appendinnerloop hatchobj (vla:objarray (mapcar (quote vlax-ename->vla-object)
          inarray))))
  (vla-put-patternscale hatchobj 40)
  hatchobj)
```
</details>

---

### entity:addtext

**è¯´æ˜**: ç”Ÿæˆä¸€ä¸ªTEXTå®ä½“,entity:make-textå‚æ•°ç®€åŒ–ç‰ˆ

**ç”¨æ³•**:
```lisp
(entity:addtext str pt zg ang dq)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 zg  : æœªè¯†åˆ«å®šä¹‰;4 ang  : è§’åº¦å€¼;5 dq  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: return:æ–‡å­—å›¾å…ƒå

**ç¤ºä¾‹**:
```lisp
example:(entity:addtext "æ–‡å­—" (getpoint) 3 0 11)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:addtext (str pt zg ang dq)
  "ç”Ÿæˆä¸€ä¸ªTEXTå®ä½“,entity:make-textå‚æ•°ç®€åŒ–ç‰ˆ"
  "return:æ–‡å­—å›¾å…ƒå"
  "example:(entity:addtext \"æ–‡å­—\"
    (getpoint)
    3 0 11)"
  (entity:make-text str pt zg ang 0.8 0 dq))
```
</details>

---

### entity:block

**è¯´æ˜**: å°†é€‰æ‹©é›†ã€å›¾å…ƒè¡¨ã€å¯¹è±¡è¡¨åˆ›å»ºä¸ºå—ã€‚

**ç”¨æ³•**:
```lisp
(entity:block ss name insertionpoint)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;2 name  : æœªè¯†åˆ«å®šä¹‰;3 insertionpoint  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:block (ss name insertionpoint / block)
  "å°†é€‰æ‹©é›†ã€å›¾å…ƒè¡¨ã€å¯¹è±¡è¡¨åˆ›å»ºä¸ºå—ã€‚"
  (cond ((p:ename-listp ss)
      (setq ss (vla:objarray (mapcar (quote vlax-ename->vla-object)
            ss))))
    ((p:vla-listp ss)
      (setq ss (vla:objarray ss)))
    ((p:picksetp ss)
      (setq ss (pickset:to-array ss))))
  (print (type ss))
  (setq block (vla-add (vla-get-blocks *doc*)
      (vlax-3d-point insertionpoint)
      name))
  (vla-copyobjects *doc* ss block)
  (if (vl-catch-all-error-p (setq return (vl-catch-all-apply (quote (lambda nil (foreach obj (vlax-safearray->list ss)
                (vla-delete obj)))))))
    (vl-catch-all-error-message return))
  block)
```
</details>

---

### entity:boundary

**è¯´æ˜**: åˆ›å»ºå›¾å…ƒæ‰€åœ¨çš„å›´åŒºçš„è¾¹ç•Œå¤šæ®µçº¿.

**ç”¨æ³•**:
```lisp
(entity:boundary ent)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: è¾¹ç•Œå›¾å…ƒæˆ–nil

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:boundary (ent / pt boundary vis)
  "åˆ›å»ºå›¾å…ƒæ‰€åœ¨çš„å›´åŒºçš„è¾¹ç•Œå¤šæ®µçº¿."
  "è¾¹ç•Œå›¾å…ƒæˆ–nil"
  (setq vis (vla-get-visible (e2o ent)))
  (setq pt (apply (quote point:mid)
      (entity:getbox ent 0)))
  (vla-put-visible (e2o ent)
    :vlax-false)
  (setq boundary (bpoly pt))
  (vla-put-visible (e2o ent)
    vis)
  boundary)
```
</details>

---

### entity:change-ltype

**è¯´æ˜**: æ”¹å˜å¯¹è±¡çº¿å‹å‚æ•°:obj:å¯¹è±¡strLtype:çº¿å‹

**ç”¨æ³•**:
```lisp
(entity:change-ltype obj strltype)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;2 strltype  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: æˆåŠŸè¿”å›Tï¼Œå¤±è´¥è¿”å›nil

**ç¤ºä¾‹**:
```lisp
(entity:change-Ltype cirobj "DASHED")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:change-ltype (obj strltype / entlist)
  "æ”¹å˜å¯¹è±¡çº¿å‹\nå‚æ•°:\nobj:å¯¹è±¡\nstrLtype:çº¿å‹"
  "æˆåŠŸè¿”å›Tï¼Œå¤±è´¥è¿”å›nil"
  "(entity:change-Ltype cirobj \"DASHED\")"
  (cond ((entity:ltype-exists strltype)
      (cond ((and (vlax-read-enabled-p obj)
            (vlax-write-enabled-p obj))
          (vla-put-linetype obj strltype)
          t)
        (t nil)))
    (t nil)))
```
</details>

---

### entity:change-textstyle

**è¯´æ˜**: æ›´æ”¹æŒ‡å®šå­—ä½“æ ·å¼çš„å­—ä½“å‚æ•°:TextStyleName:å­—ä½“æ ·å¼åç§°FontName:å­—ä½“åå­—BigFontName:å¤§å­—ä½“åå­—

**ç”¨æ³•**:
```lisp
(entity:change-textstyle textstylename fontname bigfontname)
```

**å‚æ•°**: 1 textstylename  : æœªè¯†åˆ«å®šä¹‰;2 fontname  : æœªè¯†åˆ«å®šä¹‰;3 bigfontname  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: æ— 

**ç¤ºä¾‹**:
```lisp
(entity:ChangeTextStyle "STANDARD" "SIMfang.TTF" "")(entity:Change-TextStyle "STANDARD" "simplex.shx" "dayuxp.shx")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:change-textstyle (textstylename fontname bigfontname / txtstyle)
  "æ›´æ”¹æŒ‡å®šå­—ä½“æ ·å¼çš„å­—ä½“\nå‚æ•°:\nTextStyleName:å­—ä½“æ ·å¼åç§°\nFontName:å­—ä½“åå­—\nBigFontName:å¤§å­—ä½“åå­—"
  "æ— "
  "(entity:ChangeTextStyle \"STANDARD\"
    \"SIMfang.TTF\"
    \"\")\n(entity:Change-TextStyle \"STANDARD\"
    \"simplex.shx\"
    \"dayuxp.shx\")"
  (setq txtstyle (vla-item (vla-get-textstyles (std:active-document))
      textstylename))
  (if (wcmatch (vl-filename-extension fontname)
      ".TTF,.ttf")
    (vla-put-fontfile txtstyle (strcat (getenv "Windir")
        "\\fonts\\"
        FONTNAME))
    (PROGN (vla-put-FontFile TXTSTYLE FONTNAME)
      (vla-put-BigFontFile TXTSTYLE BIGFONTNAME)))
  (vla-Regen (STD:ACTIVE-DOCUMENT)
    acAllViewports)
  (vlax-release-object TXTSTYLE)
  (PRINC))
```
</details>

---

### entity:check-error-codes

**è¯´æ˜**: æ¶ˆé™¤å­—ä½“ä¹±ç ï¼Œåˆ©ç”¨gbenor.shx gbcbig.shxå‚æ•°:doc:å½“å‰æ´»åŠ¨æ–‡æ¡£

**ç”¨æ³•**:
```lisp
(entity:check-error-codes doc)
```

**å‚æ•°**: 1 doc  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: æ— 

**ç¤ºä¾‹**:
```lisp
(entity:Check-Error-Codes *DOC*)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:check-error-codes (doc)
  "æ¶ˆé™¤å­—ä½“ä¹±ç ï¼Œåˆ©ç”¨gbenor.shx gbcbig.shx\nå‚æ•°:\ndoc:å½“å‰æ´»åŠ¨æ–‡æ¡£"
  "æ— "
  "(entity:Check-Error-Codes *DOC*)"
  (vlax-for txtstyle (vla-get-textstyles doc)
    (if (findfile (vla-get-fontfile txtstyle))
      nil (vla-put-fontfile txtstyle "tssdeng.shx"))
    (if (findfile (vla-get-bigfontfile txtstyle))
      nil (vla-put-bigfontfile txtstyle "tssdchn.shx")))
  (princ))
```
</details>

---

### entity:deldxf

**è¯´æ˜**: åˆ é™¤å›¾å…ƒçš„æŸä¸€ç»„ç ï¼Œç”¨äºæ“ä½œé¢œè‰²ç­‰ä¸æ˜¯å¿…æ®µçš„ç»„ç ã€‚å‚æ•°:ename:å›¾å…ƒï¼Œé€‰æ‹©é›†ï¼Œå›¾å…ƒåˆ—è¡¨code:ç»„ç æˆ–ç»„ç è¡¨

**ç”¨æ³•**:
```lisp
(entity:deldxf ename code)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 code  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: æ›´æ–°åçš„å›¾å…ƒï¼Œé€‰æ‹©é›†ï¼Œå›¾å…ƒåˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(entity:deldxf (car (entsel))    62 )
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:deldxf (ename code / ent)
  "åˆ é™¤å›¾å…ƒçš„æŸä¸€ç»„ç ï¼Œç”¨äºæ“ä½œé¢œè‰²ç­‰ä¸æ˜¯å¿…æ®µçš„ç»„ç ã€‚\nå‚æ•°:\nename:å›¾å…ƒï¼Œé€‰æ‹©é›†ï¼Œå›¾å…ƒåˆ—è¡¨\ncode:ç»„ç æˆ–ç»„ç è¡¨\n"
  "æ›´æ–°åçš„å›¾å…ƒï¼Œé€‰æ‹©é›†ï¼Œå›¾å…ƒåˆ—è¡¨"
  "(entity:deldxf (car (entsel))\n    62 )"
  (cond ((p:enamep ename)
      (if (null (wcmatch (entity:getdxf ename 0)
            "TCH_*"))
        (progn (setq ent (entget ename))
          (if (and (listp code))
            (mapcar (quote (lambda (x y)
                  (entity:deldxf ename x)))
              code val)
            (progn (if (entity:getdxf ename code)
                (entmod (vl-remove (assoc code ent)
                    ent)))
              (entupd ename))))
        (@:log "WARR"
          "this function CANNOT support proxy entity.")))
    ((p:picksetp ename)
      (foreach s1 (pickset:to-list ename)
        (entity:deldxf s1 code)))
    ((p:ename-listp ename)
      (foreach s1 ename (entity:deldxf s1 code))))
  ename)
```
</details>

---

### entity:dimaligned

**è¯´æ˜**: åˆ›å»ºå¯¹é½æ ‡æ³¨

**ç”¨æ³•**:
```lisp
(entity:dimaligned p1 p2 txtpt)
```

**å‚æ•°**: 1 p1  : æœªè¯†åˆ«å®šä¹‰;2 p2  : æœªè¯†åˆ«å®šä¹‰;3 txtpt  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:dimaligned (p1 p2 txtpt)
  "åˆ›å»ºå¯¹é½æ ‡æ³¨"
  (entmakex (list (quote (0 . "DIMENSION"))
      (quote (100 . "AcDbEntity"))
      (quote (100 . "AcDbDimension"))
      (cons 10 txtpt)
      (quote (70 . 33))
      (quote (1 . ""))
      (quote (100 . "AcDbAlignedDimension"))
      (cons 13 p1)
      (cons 14 p2))))
```
</details>

---

### entity:dimdiameter

**è¯´æ˜**: ç”Ÿæˆç›´å¾„æ ‡æ³¨

**ç”¨æ³•**:
```lisp
(entity:dimdiameter pt1 pt2 pt-txt)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 pt-txt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: return:æ ‡æ³¨å›¾å…ƒå

**ç¤ºä¾‹**:
```lisp
example:(entity:dimdiameter (getpoint) (getpoint)(getpoint))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:dimdiameter (pt1 pt2 pt-txt)
  "ç”Ÿæˆç›´å¾„æ ‡æ³¨"
  "return:æ ‡æ³¨å›¾å…ƒå"
  "example:(entity:dimdiameter (getpoint)
    (getpoint)(getpoint))"
  (entmakex (list (quote (0 . "DIMENSION"))
      (quote (100 . "AcDbEntity"))
      (quote (100 . "AcDbDimension"))
      (cons 10 pt1)
      (cons 11 pt-txt)
      (quote (70 . 163))
      (quote (100 . "AcDbDiametricDimension"))
      (cons 15 pt2))))
```
</details>

---

### entity:dimhorizontal

**è¯´æ˜**: ç”Ÿæˆæ°´å¹³æ ‡æ³¨

**ç”¨æ³•**:
```lisp
(entity:dimhorizontal pt1 pt2 pt-txt)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 pt-txt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: return:æ ‡æ³¨å›¾å…ƒå

**ç¤ºä¾‹**:
```lisp
example:(entity:dimhorizontal (getpoint) (getpoint) (getpoint))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:dimhorizontal (pt1 pt2 pt-txt)
  "ç”Ÿæˆæ°´å¹³æ ‡æ³¨"
  "return:æ ‡æ³¨å›¾å…ƒå"
  "example:(entity:dimhorizontal (getpoint)
    (getpoint)
    (getpoint))"
  (entmakex (list (quote (0 . "DIMENSION"))
      (quote (100 . "AcDbEntity"))
      (quote (100 . "AcDbDimension"))
      (cons 10 pt-txt)
      (quote (70 . 32))
      (quote (1 . ""))
      (quote (100 . "AcDbAlignedDimension"))
      (cons 13 pt1)
      (cons 14 pt2)
      (quote (100 . "AcDbRotatedDimension")))))
```
</details>

---

### entity:dimradius

**è¯´æ˜**: ç”ŸæˆåŠå¾„æ ‡æ³¨

**ç”¨æ³•**:
```lisp
(entity:dimradius pt-cen pt-r)
```

**å‚æ•°**: 1 pt-cen  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt-r  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: return:æ ‡æ³¨å›¾å…ƒå

**ç¤ºä¾‹**:
```lisp
example:(entity:dimradius (getpoint) (getpoint))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:dimradius (pt-cen pt-r)
  "ç”ŸæˆåŠå¾„æ ‡æ³¨"
  "return:æ ‡æ³¨å›¾å…ƒå"
  "example:(entity:dimradius (getpoint)
    (getpoint))"
  (entmakex (list (quote (0 . "DIMENSION"))
      (quote (100 . "AcDbEntity"))
      (quote (100 . "AcDbDimension"))
      (cons 10 pt-cen)
      (quote (70 . 36))
      (quote (100 . "AcDbRadialDimension"))
      (cons 15 pt-r))))
```
</details>

---

### entity:dimvertical

**è¯´æ˜**: åˆ›å»ºç«–å‘æ ‡æ³¨

**ç”¨æ³•**:
```lisp
(entity:dimvertical p1 p2 txtpt)
```

**å‚æ•°**: 1 p1  : æœªè¯†åˆ«å®šä¹‰;2 p2  : æœªè¯†åˆ«å®šä¹‰;3 txtpt  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:dimvertical (p1 p2 txtpt)
  "åˆ›å»ºç«–å‘æ ‡æ³¨"
  (entmakex (list (quote (0 . "DIMENSION"))
      (quote (100 . "AcDbEntity"))
      (quote (100 . "AcDbDimension"))
      (cons 10 txtpt)
      (quote (70 . 32))
      (quote (1 . ""))
      (quote (100 . "AcDbAlignedDimension"))
      (cons 13 p1)
      (cons 14 p2)
      (quote (50 . 1.5708))
      (quote (100 . "AcDbRotatedDimension")))))
```
</details>

---

### entity:fontstyle_set

**è¯´æ˜**: éªŒè¯å­—ä½“æ ·å¼æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºå­—ä½“æ ·å¼å‚æ•°ï¼šst_name : æ–‡å­—æ ·å¼åh : å­—é«˜

**ç”¨æ³•**:
```lisp
(entity:fontstyle_set st_name h)
```

**å‚æ•°**: 1 st_name  : æœªè¯†åˆ«å®šä¹‰;2 h  : æœªè¯†åˆ«å®šä¹‰;

**ç¤ºä¾‹**:
```lisp
(fontstyle_set "ä»¿å®‹_GB2312" 0)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:fontstyle_set (st_name h / sty)
  "éªŒè¯å­—ä½“æ ·å¼æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºå­—ä½“æ ·å¼\nå‚æ•°ï¼š\nst_name : æ–‡å­—æ ·å¼å\nh : å­—é«˜"
  ""
  "(fontstyle_set \"ä»¿å®‹_GB2312\"
    0)"
  (setq sty (tblobjname "style"
      st_name))
  (if (null sty)
    (progn (entmake (list (quote (0 . "STYLE"))
          (quote (100 . "AcDbSymbolTableRecord"))
          (quote (100 . "AcDbTextStyleTableRecord"))
          (cons 2 st_name)
          (quote (70 . 0))
          (cons 40 h)
          (cons 41 0.7)
          (quote (3 . ""))
          (quote (4 . "")))))))
```
</details>

---

### entity:get-color

**è¯´æ˜**: è·å–å›¾å…ƒçš„é¢œè‰²ï¼Œå½“é¢œè‰²éšå±‚æ—¶ï¼Œè¿”å›å›¾å±‚é¢œè‰²ã€‚

**ç”¨æ³•**:
```lisp
(entity:get-color ent)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:get-color (ent)
  "è·å–å›¾å…ƒçš„é¢œè‰²ï¼Œå½“é¢œè‰²éšå±‚æ—¶ï¼Œè¿”å›å›¾å±‚é¢œè‰²ã€‚"
  (if (entity:getdxf ent 62)
    (entity:getdxf ent 62)
    (cdr (assoc 62 (tblsearch "layer"
          (entity:getdxf ent 8))))))
```
</details>

---

### entity:get-layer

**è¯´æ˜**: è·å–å›¾å…ƒçš„å›¾å±‚å

**ç”¨æ³•**:
```lisp
(entity:get-layer ent)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: String

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:get-layer (ent)
  "è·å–å›¾å…ƒçš„å›¾å±‚å"
  "String"
  (entity:getdxf ent 8))
```
</details>

---

### entity:get-linetype

**è¯´æ˜**: è·å–å›¾å…ƒçš„çº¿å‹ï¼Œå½“çº¿å‹éšå±‚æ—¶ï¼Œè¿”å›å›¾å±‚çº¿å‹ã€‚

**ç”¨æ³•**:
```lisp
(entity:get-linetype ent)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: String

**ç¤ºä¾‹**:
```lisp
(entity:get-linetype (car(entsel)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:get-linetype (ent)
  "è·å–å›¾å…ƒçš„çº¿å‹ï¼Œå½“çº¿å‹éšå±‚æ—¶ï¼Œè¿”å›å›¾å±‚çº¿å‹ã€‚"
  "String"
  "(entity:get-linetype (car(entsel)))"
  (if (entity:getdxf ent 6)
    (entity:getdxf ent 6)
    (cdr (assoc 6 (tblsearch "layer"
          (entity:getdxf ent 8))))))
```
</details>

---

### entity:get-truecolor

**è¯´æ˜**: è·å–å›¾å…ƒ RGB çœŸå½©è‰²

**ç”¨æ³•**:
```lisp
(entity:get-truecolor ent)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: lst

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:get-truecolor (ent / obj-color)
  "è·å–å›¾å…ƒ RGB çœŸå½©è‰²"
  "lst"
  (if (= (quote ename)
      (type ent))
    (setq ent (e2o ent)))
  (if (p:vlap ent)
    (progn (setq obj-color (vla-get-truecolor ent))
      (list (vla-get-red obj-color)
        (vla-get-green obj-color)
        (vla-get-blue obj-color)))
    (quote (0 0 0))))
```
</details>

---

### entity:getbox

**è¯´æ˜**: å›¾å…ƒçš„æœ€å°åŒ…å›´ç›’

**ç”¨æ³•**:
```lisp
(entity:getbox ent offset)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;2 offset  : åç§»é‡;

**è¿”å›å€¼**: return:å¤–æ¡†ï¼ˆåç§»åï¼‰çš„å·¦ä¸‹ï¼Œå³ä¸Šè§’ç‚¹

**ç¤ºä¾‹**:
```lisp
example:(entity:getbox (car(entsel)) 0.1)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:getbox (ent offset / lst obj p1 p2 p3 p4)
  "å›¾å…ƒçš„æœ€å°åŒ…å›´ç›’"
  "return:å¤–æ¡†ï¼ˆåç§»åï¼‰çš„å·¦ä¸‹ï¼Œå³ä¸Šè§’ç‚¹"
  "example:(entity:getbox (car(entsel))
    0.1)"
  (if (= (quote pickset)
      (type ent))
    (pickset:getbox ent offset)
    (progn (setq obj (vlax-ename->vla-object ent))
      (vla-getboundingbox obj (quote p1)
        (quote p3))
      (setq p1 (vlax-safearray->list p1)
        p3 (vlax-safearray->list p3))
      (if (= "SPLINE"
          (cdr (assoc 0 (entget ent))))
        (progn (setq lst (mapcar (quote (lambda (a b)
                  (vlax-curve-getclosestpointtoprojection ent a b t)))
              (list p1 (list (car p1)
                  (cadr p3)
                  (caddr p1))
                p3 (list (car p3)
                  (cadr p1)
                  (caddr p1)))
              (quote ((1.0 0 0)
                  (0 -1.0 0)
                  (-1.0 0 0)
                  (0 1.0 0)))))
          (setq p1 (apply (quote mapcar)
              (cons (quote min)
                lst))
            p3 (apply (quote mapcar)
              (cons (quote max)
                lst)))))
      (if (or (not offset)
          (equal offset 0 0.0001))
        (list p1 p3)
        (list (list:- p1 (list offset offset 0))
          (list:+ p3 (list offset offset 0)))))))
```
</details>

---

### entity:getdxf

**è¯´æ˜**: è·å–å›¾å…ƒçš„ç»„ç å€¼å‚æ•°:ent:å›¾å…ƒåæˆ–vlaå¯¹è±¡åi:ç»„ç æˆ–ç»„ç è¡¨

**ç”¨æ³•**:
```lisp
(entity:getdxf ent i)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;2 i  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: ç»„ç å€¼æˆ–åˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(entity:getdxf (car (entsel)) 10)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:getdxf (ent i / getdxf result)
  "è·å–å›¾å…ƒçš„ç»„ç å€¼\nå‚æ•°:\nent:å›¾å…ƒåæˆ–vlaå¯¹è±¡å\ni:ç»„ç æˆ–ç»„ç è¡¨"
  "ç»„ç å€¼æˆ–åˆ—è¡¨"
  "(entity:getdxf (car (entsel))
    10)"
  (defun getdxf (ent i)
    (mapcar (quote cdr)
      (vl-remove-if-not (quote (lambda (x)
            (= (car x)
              i)))
        ent)))
  (cond ((p:vlap ent)
      (setq ent (entget (vlax-vla-object->ename ent)
          (quote ("*")))))
    ((p:enamep ent)
      (setq ent (entget ent (quote ("*"))))))
  (cond ((atom i)
      (setq result (getdxf ent i)))
    ((listp i)
      (setq result (apply (quote append)
          (mapcar (quote (lambda (x)
                (getdxf ent x)))
            i)))))
  (if (= 1 (length result))
    (car result)
    result))
```
</details>

---

### entity:gettable

**ç”¨æ³•**:
```lisp
(entity:gettable s)
```

**å‚æ•°**: 1 s  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:gettable (s / d r)
  (while (setq d (tblnext s (null d)))
    (setq r (cons (cdr (assoc 2 d))
        r)))
  (reverse r))
```
</details>

---

### entity:gettextbox

**è¯´æ˜**: è·å–å•è¡Œæ–‡æœ¬åŒ…å›´æ¡†

**ç”¨æ³•**:
```lisp
(entity:gettextbox ent-text offset)
```

**å‚æ•°**: 1 ent-text  : å•ä¸ªå›¾å…ƒ;2 offset  : åç§»é‡;

**è¿”å›å€¼**: return:æ–‡å­—å¤–æ¡†ï¼ˆåç§»åï¼‰çš„å››ä¸ªè§’ç‚¹ï¼ˆå·¦ä¸‹ï¼Œå³ä¸‹ï¼Œå³ä¸Šï¼Œå·¦ä¸Š

**ç¤ºä¾‹**:
```lisp
example:(entity:getTextBox (car(entsel)) 2)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:gettextbox (ent-text offset / pt1 pt2 pts)
  "è·å–å•è¡Œæ–‡æœ¬åŒ…å›´æ¡†"
  "return:æ–‡å­—å¤–æ¡†ï¼ˆåç§»åï¼‰çš„å››ä¸ªè§’ç‚¹ï¼ˆå·¦ä¸‹ï¼Œå³ä¸‹ï¼Œå³ä¸Šï¼Œå·¦ä¸Š"
  "example:(entity:getTextBox (car(entsel))
    2)"
  (setq pts (textbox (entget ent-text)))
  (if offset (entity:rec-2pt->4pt (list:- (car pts)
        (list offset offset 0))
      (list:+ (cadr pts)
        (list offset offset 0)))
    pts))
```
</details>

---

### entity:group

**è¯´æ˜**: å°†å®ä½“é›†ç¼–ç»„

**ç”¨æ³•**:
```lisp
(entity:group lst name)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 name  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:group (lst name / groupobj)
  "å°†å®ä½“é›†ç¼–ç»„"
  (setq groupobj (vla-add (vla-get-groups (vla-get-activedocument (vlax-get-acad-object)))
      name))
  (vla-appenditems groupobj (vla:list->array lst 9)))
```
</details>

---

### entity:layers

**è¯´æ˜**: è·å–å›¾å±‚åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(entity:layers )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:layers nil "è·å–å›¾å±‚åˆ—è¡¨"
  (entity:listcollection (std:layers)))
```
</details>

---

### entity:line

**è¯´æ˜**: åœ¨æ¨¡å‹ç©ºé—´ç”»ç›´çº¿

**ç”¨æ³•**:
```lisp
(entity:line start end)
```

**å‚æ•°**: 1 start  : æœªè¯†åˆ«å®šä¹‰;2 end  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:line (start end)
  "åœ¨æ¨¡å‹ç©ºé—´ç”»ç›´çº¿"
  (vla-addline (std:model-space)
    (vlax-3d-point start)
    (vlax-3d-point end)))
```
</details>

---

### entity:linetypes

**ç”¨æ³•**:
```lisp
(entity:linetypes )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:linetypes nil (entity:listcollection (std:linetypes)))
```
</details>

---

### entity:listcollection

**è¯´æ˜**: åˆ—é›†åˆ

**ç”¨æ³•**:
```lisp
(entity:listcollection collection)
```

**å‚æ•°**: 1 collection  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:listcollection (collection / out)
  "åˆ—é›†åˆ"
  (vlax-for each collection (setq out (cons (vla-get-name each)
        out)))
  (reverse out))
```
</details>

---

### entity:ltype-exists

**è¯´æ˜**: çº¿å‹æ˜¯å¦å­˜åœ¨?å‚æ•°:strLtype:çº¿å‹å

**ç”¨æ³•**:
```lisp
(entity:ltype-exists strltype)
```

**å‚æ•°**: 1 strltype  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: æˆåŠŸè¿”å›tï¼Œå¤±è´¥è¿”å›nil

**ç¤ºä¾‹**:
```lisp
(entity:Ltype-Exists "continuous")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:ltype-exists (strltype)
  "çº¿å‹æ˜¯å¦å­˜åœ¨?\nå‚æ•°:\nstrLtype:çº¿å‹å"
  "æˆåŠŸè¿”å›tï¼Œå¤±è´¥è¿”å›nil"
  "(entity:Ltype-Exists \"continuous\")"
  (and (member (strcase strltype)
      (mapcar (quote strcase)
        (entity:linetypes)))))
```
</details>

---

### entity:make-arc

**è¯´æ˜**: åˆ›å»ºåœ†å¼§

**ç”¨æ³•**:
```lisp
(entity:make-arc cen rad startpt endpt)
```

**å‚æ•°**: 1 cen  : æœªè¯†åˆ«å®šä¹‰;2 rad  : æœªè¯†åˆ«å®šä¹‰;3 startpt  : æœªè¯†åˆ«å®šä¹‰;4 endpt  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-arc (cen rad startpt endpt)
  "åˆ›å»ºåœ†å¼§"
  (entmakex (list (quote (0 . "ARC"))
      (quote (100 . "AcDbEntity"))
      (quote (100 . "AcDbCircle"))
      (quote (100 . "AcDbArc"))
      (cons 10 cen)
      (cons 40 rad)
      (cons 50 (if (listp startpt)
          (angle cen startpt)
          startpt))
      (cons 51 (if (p:listp endpt)
          (angle cen endpt)
          endpt)))))
```
</details>

---

### entity:make-arrow

**è¯´æ˜**: ç”Ÿæˆç®­å¤´,ä¸€ç«¯å®½ï¼Œä¸€ç«¯çª„çš„å¤šæ®µçº¿ã€‚å‚æ•°:   startpt:ç®­å¤´å°–åæ ‡   endpt:ç®­å¤´å°¾åæ ‡   width:ç®­å¤´å°¾å®½åº¦è¿”å›å€¼:  ç®­å¤´å›¾å…ƒå

**ç”¨æ³•**:
```lisp
(entity:make-arrow startpt endpt width)
```

**å‚æ•°**: 1 startpt  : æœªè¯†åˆ«å®šä¹‰;2 endpt  : å•ä¸ªå›¾å…ƒ;3 width  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-arrow (startpt endpt width)
  "ç”Ÿæˆç®­å¤´,ä¸€ç«¯å®½ï¼Œä¸€ç«¯çª„çš„å¤šæ®µçº¿ã€‚\nå‚æ•°:\n   startpt:ç®­å¤´å°–åæ ‡\n   endpt:ç®­å¤´å°¾åæ ‡\n   width:ç®­å¤´å°¾å®½åº¦\nè¿”å›å€¼:\n  ç®­å¤´å›¾å…ƒå\n"
  (entmakex (list (quote (0 . "LWPOLYLINE"))
      (quote (100 . "AcDbEntity"))
      (quote (100 . "AcDbPolyline"))
      (quote (90 . 2))
      (quote (70 . 0))
      (cons 10 startpt)
      (quote (40 . 0))
      (cons 41 width)
      (cons 10 endpt)
      (cons 40 width)
      (cons 41 width))))
```
</details>

---

### entity:make-circle

**è¯´æ˜**: åˆ›å»ºåœ†.å¦‚æœåœ†å¿ƒæ˜¯ç‚¹çš„åˆ—è¡¨æˆ–åŠå¾„æ˜¯æ•°å€¼çš„åˆ—è¡¨ï¼Œå¯ä»¥åŒæ—¶åˆ›å»ºå¤šä¸ªåœ†

**ç”¨æ³•**:
```lisp
(entity:make-circle pts-cen num-rad)
```

**å‚æ•°**: 1 pts-cen  : å¤šä¸ªåæ ‡ç‚¹åˆ—è¡¨;2 num-rad  : æ•°å€¼;

**è¿”å›å€¼**: Ename

**ç¤ºä¾‹**:
```lisp
(entity:make-circle (list (getpoint)(getpoint)) '(3 5))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-circle (pts-cen num-rad)
  "åˆ›å»ºåœ†.å¦‚æœåœ†å¿ƒæ˜¯ç‚¹çš„åˆ—è¡¨æˆ–åŠå¾„æ˜¯æ•°å€¼çš„åˆ—è¡¨ï¼Œå¯ä»¥åŒæ—¶åˆ›å»ºå¤šä¸ªåœ†"
  "Ename"
  "(entity:make-circle (list (getpoint)(getpoint))
    '(3 5))"
  (cond ((and (= (quote point)
          (type-of pts-cen))
        (numberp num-rad))
      (entmakex (list (quote (0 . "circle"))
          (quote (100 . "AcDbEntity"))
          (quote (100 . "AcDbCircle"))
          (cons 10 pts-cen)
          (cons 40 num-rad))))
    ((and (listp pts-cen)
        (apply (quote and)
          (mapcar (function (lambda (x)
                (= (quote point)
                  (type-of x))))
            pts-cen)))
      (mapcar (quote (lambda (pt)
            (entity:make-circle pt num-rad)))
        pts-cen))
    ((and (listp num-rad)
        (apply (quote and)
          (mapcar (quote numberp)
            num-rad)))
      (mapcar (quote (lambda (rad)
            (entity:make-circle pts-cen rad)))
        num-rad))
    (t (@:log "WARR"
        "å‚æ•°é”™è¯¯,æ— åˆ›å»ºåœ†")
      nil)))
```
</details>

---

### entity:make-dimstyle

**è¯´æ˜**: åˆ›å»ºæ ‡æ³¨æ ·å¼,name:æ ‡æ³¨æ ·å¼å

**ç”¨æ³•**:
```lisp
(entity:make-dimstyle name)
```

**å‚æ•°**: 1 name  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-dimstyle (name / my_dimasz my_dimaunit my_dimclrd my_dimclre my_dimclrt my_dimdli my_dimdsep my_dimexe my_dimexo my_dimlfac my_dimlwd my_dimlwe my_dimscale my_dimtad my_dimtih my_dimtix my_dimtofl my_dimtoh my_dimtxt my_dimzin)
  "åˆ›å»ºæ ‡æ³¨æ ·å¼,name:æ ‡æ³¨æ ·å¼å"
  (entmake (list (quote (0 . "STYLE"))
      (quote (100 . "AcDbSymbolTableRecord"))
      (quote (100 . "AcDbTextStyleTableRecord"))
      (quote (2 . "æ ‡æ³¨"))
      (quote (70 . 0))
      (quote (40 . 0))
      (quote (41 . 0.8))
      (quote (50 . 0.0))
      (quote (71 . 0))
      (quote (42 . 2.5))
      (quote (3 . "SimSun.ttf"))
      (quote (4 . ""))))
  (entmake (list (quote (0 . "BLOCK"))
      (quote (100 . "AcDbEntity"))
      (quote (67 . 0))
      (quote (8 . "0"))
      (quote (100 . "AcDbBlockBegin"))
      (quote (70 . 0))
      (quote (10 0.0 0.0 0.0))
      (quote (2 . "_Oblique"))
      (quote (1 . ""))))
  (entmake (list (quote (0 . "LINE"))
      (quote (100 . "AcDbEntity"))
      (quote (67 . 0))
      (quote (8 . "0"))
      (quote (62 . 0))
      (quote (6 . "ByBlock"))
      (quote (370 . -2))
      (quote (100 . "AcDbLine"))
      (quote (10 -0.5 -0.5 0.0))
      (quote (11 0.5 0.5 0.0))
      (quote (210 0.0 0.0 1.0))))
  (entmake (list (quote (0 . "ENDBLK"))))
  (entupd (tblobjname "Block"
      "_Oblique"))
  (setq my_dimscale 40)
  (setq my_dimasz 2.5)
  (setq my_dimexo 1)
  (setq my_dimdli 3.75)
  (setq my_dimexe 1.25)
  (setq my_dimtxt 2.5)
  (setq my_dimlfac 1)
  (setq my_dimtih 0)
  (setq my_dimtoh 0)
  (setq my_dimtad 1)
  (setq my_dimzin 8)
  (setq my_dimtofl 1)
  (setq my_dimclrd 256)
  (setq my_dimclre 256)
  (setq my_dimclrt 256)
  (setq my_dimaunit 1)
  (setq my_dimdsep 46)
  (setq my_dimlwd -1)
  (setq my_dimlwe -1)
  (setq my_dimtix 1)
  (entmake (list (quote (0 . "DIMSTYLE"))
      (quote (100 . "AcDbSymbolTableRecord"))
      (quote (100 . "AcDbDimStyleTableRecord"))
      (cons 2 name)
      (quote (70 . 0))
      (quote (141 . 2.5))
      (quote (143 . 0.0393701))
      (quote (147 . 0.625))
      (quote (171 . 3))
      (quote (271 . 1))
      (quote (272 . 1))
      (quote (274 . 3))
      (quote (283 . 0))
      (quote (284 . 8))
      (cons 40 my_dimscale)
      (cons 41 my_dimasz)
      (cons 42 my_dimexo)
      (cons 43 my_dimdli)
      (cons 44 my_dimexe)
      (cons 140 my_dimtxt)
      (cons 144 my_dimlfac)
      (cons 73 my_dimtih)
      (cons 74 my_dimtoh)
      (cons 77 my_dimtad)
      (cons 78 my_dimzin)
      (cons 172 my_dimtofl)
      (cons 174 my_dimtix)
      (cons 176 my_dimclrd)
      (cons 177 my_dimclre)
      (cons 178 my_dimclrt)
      (cons 275 my_dimaunit)
      (cons 278 my_dimdsep)
      (cons 371 my_dimlwd)
      (cons 372 my_dimlwe)
      (cons 340 (tblobjname "STYLE"
          "æ ‡æ³¨"))
      (cons 342 (cdr (assoc 330 (entget (tblobjname "BLOCK"
                "_Oblique")))))))
  (entupd (tblobjname "Dimstyle"
      name))
  (princ))
```
</details>

---

### entity:make-layer

**è¯´æ˜**: åˆ›å»ºå›¾å±‚å‚æ•°:strName:å›¾å±‚åintColor:å›¾å±‚é¢œè‰²strLtype:å›¾å±‚çº¿å‹booleCur:æ˜¯å¦ç½®ä¸ºå½“å‰å›¾å±‚

**ç”¨æ³•**:
```lisp
(entity:make-layer strname intcolor strltype boolecur)
```

**å‚æ•°**: 1 strname  : å­—ç¬¦ä¸²;2 intcolor  : æ•´æ•°;3 strltype  : å­—ç¬¦ä¸²;4 boolecur  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: æˆåŠŸè¿”å›å›¾å±‚åï¼Œå¤±è´¥è¿”å›nil

**ç¤ºä¾‹**:
```lisp
(entity:make-layer "Layer1" 3 "DASHED" T)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-layer (strname intcolor strltype boolecur / iloc obj out)
  "åˆ›å»ºå›¾å±‚\nå‚æ•°:\nstrName:å›¾å±‚å\nintColor:å›¾å±‚é¢œè‰²\nstrLtype:å›¾å±‚çº¿å‹\nbooleCur:æ˜¯å¦ç½®ä¸ºå½“å‰å›¾å±‚"
  "æˆåŠŸè¿”å›å›¾å±‚åï¼Œå¤±è´¥è¿”å›nil"
  "(entity:make-layer \"Layer1\"
    3 \"DASHED\"
    T)"
  (if (not (tblsearch "layer"
        strname))
    (progn (setq obj (vla-add (std:layers)
          strname))
      (setq iloc (vl-position strname (entity:layers)))
      (if (vlax-write-enabled-p obj)
        (progn (if intcolor (vla-put-color obj intcolor))
          (if strltype (entity:change-ltype obj strltype))))
      (if boolecur (vla-put-activelayer (std:active-document)
          (vla-item (std:layers)
            iloc)))
      strname)
    nil))
```
</details>

---

### entity:make-leader

**è¯´æ˜**: åˆ›å»ºæ— æ ‡è®°çš„ç®­å¤´æ ‡æ³¨

**ç”¨æ³•**:
```lisp
(entity:make-leader startpt endpt)
```

**å‚æ•°**: 1 startpt  : æœªè¯†åˆ«å®šä¹‰;2 endpt  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-leader (startpt endpt)
  "åˆ›å»ºæ— æ ‡è®°çš„ç®­å¤´æ ‡æ³¨"
  (entmake (list (quote (0 . "leader"))
      (quote (100 . "AcDbEntity"))
      (quote (100 . "AcDbLeader"))
      (quote (71 . 1))
      (quote (72 . 0))
      (quote (73 . 3))
      (quote (74 . 1))
      (quote (75 . 0))
      (quote (40 . 0.0))
      (quote (41 . 0.0))
      (quote (76 . 2))
      (cons 10 startpt)
      (cons 10 endpt)
      (quote (211 1.0 0.0 0.0))
      (quote (210 0.0 0.0 1.0))
      (quote (212 0.0 0.0 0.0))
      (quote (213 0.0 0.0 0.0)))))
```
</details>

---

### entity:make-line

**è¯´æ˜**: ä¸¤ç‚¹åˆ›å»ºç›´çº¿

**ç”¨æ³•**:
```lisp
(entity:make-line startpt endpt)
```

**å‚æ•°**: 1 startpt  : æœªè¯†åˆ«å®šä¹‰;2 endpt  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-line (startpt endpt)
  "ä¸¤ç‚¹åˆ›å»ºç›´çº¿"
  (entmakex (list (quote (0 . "LINE"))
      (quote (100 . "AcDbEntity"))
      (quote (100 . "AcDbLine"))
      (cons 10 startpt)
      (cons 11 endpt))))
```
</details>

---

### entity:make-lines

**è¯´æ˜**: æŒ‰å¤šä¸ªç‚¹åæ ‡åˆ›å»ºè¿ç»­ç›´çº¿

**ç”¨æ³•**:
```lisp
(entity:make-lines pts)
```

**å‚æ•°**: 1 pts  : å¤šä¸ªåæ ‡ç‚¹åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-lines (pts)
  "æŒ‰å¤šä¸ªç‚¹åæ ‡åˆ›å»ºè¿ç»­ç›´çº¿"
  (mapcar (quote entity:make-line)
    (list:rtrim pts 1)
    (cdr pts)))
```
</details>

---

### entity:make-lwpline-bold

**è¯´æ˜**: ç”Ÿæˆå›ºå®šå®½åº¦çš„äºŒç»´å¤šæ®µçº¿.LWPOLYLINEå‚æ•°:   plist:ç«¯ç‚¹åæ ‡ç‚¹è¡¨ï¼Œå¦‚ï¼š((x1 y1 z1)(x2 y2 z2)(x2 y2 z2))æˆ–((x1 y1)(x2 y2)(x2 y2))   convexity:å„ç‚¹ä¸ä¸‹ä¸€ç‚¹çš„å‡¸åº¦(ä¸ªæ•°åŒåæ ‡ç‚¹è¡¨)ï¼Œå¯ä¸ºnil   elevation:æ ‡é«˜   closed:æ˜¯å¦é—­åˆï¼Œ1:é—­åˆï¼Œ0ï¼šä¸é—­åˆ

**ç”¨æ³•**:
```lisp
(entity:make-lwpline-bold plist convexity elevation closed bold)
```

**å‚æ•°**: 1 plist  : æœªè¯†åˆ«å®šä¹‰;2 convexity  : æœªè¯†åˆ«å®šä¹‰;3 elevation  : æœªè¯†åˆ«å®šä¹‰;4 closed  : æœªè¯†åˆ«å®šä¹‰;5 bold  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: è¿”å›å€¼: ç”Ÿæˆçš„å¤šæ®µçº¿çš„å›¾å…ƒå

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-lwpline-bold (plist convexity elevation closed bold / lst-dxf i)
  "ç”Ÿæˆå›ºå®šå®½åº¦çš„äºŒç»´å¤šæ®µçº¿.LWPOLYLINE\nå‚æ•°:\n   plist:ç«¯ç‚¹åæ ‡ç‚¹è¡¨ï¼Œå¦‚ï¼š((x1 y1 z1)(x2 y2 z2)(x2 y2 z2))æˆ–((x1 y1)(x2 y2)(x2 y2))\n   convexity:å„ç‚¹ä¸ä¸‹ä¸€ç‚¹çš„å‡¸åº¦(ä¸ªæ•°åŒåæ ‡ç‚¹è¡¨)ï¼Œå¯ä¸ºnil\n   elevation:æ ‡é«˜\n   closed:æ˜¯å¦é—­åˆï¼Œ1:é—­åˆï¼Œ0ï¼šä¸é—­åˆ"
  "è¿”å›å€¼: ç”Ÿæˆçš„å¤šæ®µçº¿çš„å›¾å…ƒå"
  (setq lst-dxf (list (quote (0 . "LWPOLYLINE"))
      (quote (100 . "AcDbEntity"))
      (quote (62 . 1))
      (quote (370 . 30))
      (quote (100 . "AcDbPolyline"))
      (cons 90 (length plist))
      (if (= closed 1)
        (quote (70 . 1))
        (quote (70 . 0)))
      (cons 43 bold)
      (quote (38 . 0.0))
      (quote (39 . 0.0))))
  (setq i 0)
  (foreach x plist (setq lst-dxf (append lst-dxf (list (cons 10 x)
          (cons 40 bold)
          (cons 41 bold)
          (cons 42 (if (null convexity)
              0 (nth i convexity)))
          (cons 91 0))))
    (setq i (1+ i)))
  (entmake lst-dxf)
  (entlast))
```
</details>

---

### entity:make-lwpolyline

**è¯´æ˜**: ç”ŸæˆäºŒç»´å¤šæ®µçº¿.LWPOLYLINEå‚æ•°:  plist:ç«¯ç‚¹åæ ‡ç‚¹è¡¨ï¼Œå¦‚ï¼š((x1 y1 z1) (x2 y2 z2) (x2 y2 z2))æˆ–((x1 y1) (x2 y2) (x2 y2))  convexity:å„ç‚¹ä¸ä¸‹ä¸€ç‚¹çš„å‡¸åº¦(ä¸ªæ•°åŒåæ ‡ç‚¹è¡¨)ï¼Œå¯ä¸ºnil  linewidth : å®½åº¦,å½“ä¸ºæ•°å€¼æ—¶ï¼Œä¸ºå…¨å±€å®½åº¦ï¼Œå½“ä¸ºè¡¨æ—¶ï¼Œä¸ºå„æ®µå®½åº¦ã€‚  closed:æ˜¯å¦é—­åˆï¼Œ1:é—­åˆï¼Œ0ï¼šä¸é—­åˆ  elevation:æ ‡é«˜

**ç”¨æ³•**:
```lisp
(entity:make-lwpolyline plist convexity linewidth closed elevation)
```

**å‚æ•°**: 1 plist  : æœªè¯†åˆ«å®šä¹‰;2 convexity  : æœªè¯†åˆ«å®šä¹‰;3 linewidth  : æœªè¯†åˆ«å®šä¹‰;4 closed  : æœªè¯†åˆ«å®šä¹‰;5 elevation  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: è¿”å›å€¼: ç”Ÿæˆå¤šæ®µçº¿çš„å›¾å…ƒå

**ç¤ºä¾‹**:
```lisp
(entity:make-lwpolyline '((0 0) (2 2)) '(0.3 0) '((0.5 1.0)(0 0)) 0 nil)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-lwpolyline (plist convexity linewidth closed elevation / lst-dxf i)
  "ç”ŸæˆäºŒç»´å¤šæ®µçº¿.LWPOLYLINE\nå‚æ•°:\n  plist:ç«¯ç‚¹åæ ‡ç‚¹è¡¨ï¼Œå¦‚ï¼š((x1 y1 z1)
    (x2 y2 z2)
    (x2 y2 z2))æˆ–((x1 y1)
    (x2 y2)
    (x2 y2))\n  convexity:å„ç‚¹ä¸ä¸‹ä¸€ç‚¹çš„å‡¸åº¦(ä¸ªæ•°åŒåæ ‡ç‚¹è¡¨)ï¼Œå¯ä¸ºnil\n  linewidth : å®½åº¦,å½“ä¸ºæ•°å€¼æ—¶ï¼Œä¸ºå…¨å±€å®½åº¦ï¼Œå½“ä¸ºè¡¨æ—¶ï¼Œä¸ºå„æ®µå®½åº¦ã€‚\n  closed:æ˜¯å¦é—­åˆï¼Œ1:é—­åˆï¼Œ0ï¼šä¸é—­åˆ\n  elevation:æ ‡é«˜"
  "è¿”å›å€¼: ç”Ÿæˆå¤šæ®µçº¿çš„å›¾å…ƒå"
  "(entity:make-lwpolyline '((0 0)
      (2 2))
    '(0.3 0)
    '((0.5 1.0)(0 0))
    0 nil)"
  (setq lst-dxf (list (quote (0 . "LWPOLYLINE"))
      (quote (100 . "AcDbEntity"))
      (quote (62 . 1))
      (quote (370 . 30))
      (quote (100 . "AcDbPolyline"))
      (cons 90 (length plist))
      (if (= closed 1)
        (quote (70 . 1))
        (quote (70 . 0)))
      (if (numberp linewidth)
        (cons 43 linewidth))
      (quote (38 . 0.0))
      (quote (39 . 0.0))))
  (setq i 0)
  (foreach x plist (setq lst-dxf (append lst-dxf (list (cons 10 x)
          (if (listp linewidth)
            (cond ((numberp (nth i linewidth))
                (cons 40 (nth i linewidth)))
              ((and (listp (nth i linewidth))
                  (numberp (car (nth i linewidth))))
                (cons 40 (car (nth i linewidth))))
              (t (cons 40 0)))
            (cons 40 linewidth))
          (if (listp linewidth)
            (cond ((numberp (nth i linewidth))
                (cons 41 (nth i linewidth)))
              ((and (listp (nth i linewidth))
                  (numberp (cadr (nth i linewidth))))
                (cons 41 (cadr (nth i linewidth))))
              (t (cons 41 0)))
            (cons 41 linewidth))
          (cons 42 (if (null convexity)
              0 (nth i convexity)))
          (cons 91 0))))
    (setq i (1+ i)))
  (entmake (vl-remove nil lst-dxf))
  (entlast))
```
</details>

---

### entity:make-mtext

**è¯´æ˜**: åˆ›å»ºå¤šè¡Œæ–‡æœ¬

**ç”¨æ³•**:
```lisp
(entity:make-mtext str pt fontsize w h)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 fontsize  : æœªè¯†åˆ«å®šä¹‰;4 w  : æœªè¯†åˆ«å®šä¹‰;5 h  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: ent

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-mtext (str pt fontsize w h / ent-mtext)
  "åˆ›å»ºå¤šè¡Œæ–‡æœ¬"
  "ent"
  (setq ent-mtext (entmakex (list (quote (0 . "MTEXT"))
        (quote (100 . "AcDbEntity"))
        (quote (67 . 0))
        (quote (100 . "AcDbMText"))
        (cons 10 pt)
        (cons 40 fontsize)
        (cons 41 w)
        (quote (46 . 0.0))
        (quote (71 . 1))
        (quote (72 . 5))
        (cons 1 "pre  mtext")
        (cons 7 (getvar "textstyle"))
        (quote (210 0.0 0.0 1.0))
        (quote (11 1.0 0.0 0.0))
        (cons 42 w)
        (cons 43 h)
        (quote (50 . 0.0))
        (quote (73 . 1))
        (quote (44 . 1.0)))))
  (vla-put-textstring (e2o ent-mtext)
    str)
  ent-mtext)
```
</details>

---

### entity:make-multileader

**è¯´æ˜**: åˆ›å»ºä¸€ä¸ªå¤šé‡å¼•çº¿ï¼Œ

**ç”¨æ³•**:
```lisp
(entity:make-multileader pts str)
```

**å‚æ•°**: 1 pts  : å¤šä¸ªåæ ‡ç‚¹åˆ—è¡¨;2 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: ename

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-multileader (pts str / mleader)
  "åˆ›å»ºä¸€ä¸ªå¤šé‡å¼•çº¿ï¼Œ"
  "ename"
  (setq pts (mapcar (quote point:2d->3d)
      pts))
  (setq points (vlax-make-safearray vlax-vbdouble (cons 0 (1- (* 3 (length pts))))))
  (vlax-safearray-fill points (apply (quote append)
      pts))
  (setq i 0)
  (setq mleader (vla-addmleader *ms* points i))
  (vla-put-textstring mleader str)
  (o2e mleader))
```
</details>

---

### entity:make-pline

**è¯´æ˜**: ç”ŸæˆäºŒç»´å¤šæ®µçº¿.POLYLINEå‚æ•°:  plist:ç«¯ç‚¹åæ ‡ç‚¹è¡¨ï¼Œå¦‚ï¼š((x1 y1 z1) (x2 y2 z2) (x2 y2 z2))æˆ–((x1 y1) (x2 y2) (x2 y2))  convexity:å„ç‚¹ä¸ä¸‹ä¸€ç‚¹çš„å‡¸åº¦(ä¸ªæ•°åŒåæ ‡ç‚¹è¡¨)ï¼Œå¯ä¸ºnil  elevation:æ ‡é«˜  closed:æ˜¯å¦é—­åˆï¼Œ1:é—­åˆï¼Œ0ï¼šä¸é—­åˆ

**ç”¨æ³•**:
```lisp
(entity:make-pline plist convexity elevation closed)
```

**å‚æ•°**: 1 plist  : æœªè¯†åˆ«å®šä¹‰;2 convexity  : æœªè¯†åˆ«å®šä¹‰;3 elevation  : æœªè¯†åˆ«å®šä¹‰;4 closed  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: è¿”å›å€¼:  ç”Ÿæˆå¤šæ®µçº¿çš„å›¾å…ƒå

**ç¤ºä¾‹**:
```lisp
ç¤ºä¾‹:  (entity:make-pline '((0 0 0) (5000 0 0) (5000 5000 0) (0 5000 0)) '(-1.0 -0.5 0 -0.3) 100 1)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-pline (plist convexity elevation closed)
  "ç”ŸæˆäºŒç»´å¤šæ®µçº¿.POLYLINE\nå‚æ•°:\n  plist:ç«¯ç‚¹åæ ‡ç‚¹è¡¨ï¼Œå¦‚ï¼š((x1 y1 z1)
    (x2 y2 z2)
    (x2 y2 z2))æˆ–((x1 y1)
    (x2 y2)
    (x2 y2))\n  convexity:å„ç‚¹ä¸ä¸‹ä¸€ç‚¹çš„å‡¸åº¦(ä¸ªæ•°åŒåæ ‡ç‚¹è¡¨)ï¼Œå¯ä¸ºnil\n  elevation:æ ‡é«˜\n  closed:æ˜¯å¦é—­åˆï¼Œ1:é—­åˆï¼Œ0ï¼šä¸é—­åˆ"
  "è¿”å›å€¼:  ç”Ÿæˆå¤šæ®µçº¿çš„å›¾å…ƒå"
  "ç¤ºä¾‹:  (entity:make-pline '((0 0 0)
      (5000 0 0)
      (5000 5000 0)
      (0 5000 0))
    '(-1.0 -0.5 0 -0.3)
    100 1)"
  (if (= closed 1)
    (entmake (list (quote (0 . "POLYLINE"))
        (quote (100 . "AcDbEntity"))
        (quote (67 . 0))
        (quote (410 . "Model"))
        (quote (8 . "0"))
        (quote (100 . "AcDb3dPolyline"))
        (quote (66 . 1))
        (quote (10 0.0 0.0 0.0))
        (quote (70 . 16))
        (quote (40 . 0.0))
        (quote (41 . 0.0))
        (quote (210 0.0 0.0 1.0))
        (quote (71 . 0))
        (quote (72 . 0))
        (quote (73 . 0))
        (quote (74 . 0))
        (quote (75 . 0))))
    (entmake (list (quote (0 . "POLYLINE"))
        (quote (66 . 1)))))
  (if convexity (mapcar (quote (lambda (x y)
          (entmake (list (cons 0 "VERTEX")
              (cons 10 x)
              (cons 42 y)))))
      plist convexity)
    (mapcar (quote (lambda (x)
          (entmake (list (cons 0 "VERTEX")
              (cons 10 x)))))
      plist))
  (entmake (quote ((0 . "SEQEND"))))
  (entlast))
```
</details>

---

### entity:make-point

**è¯´æ˜**: æ ¹æ®å‚æ•°åæ ‡ç»˜åˆ¶ä¸€ä¸ªç‚¹

**ç”¨æ³•**:
```lisp
(entity:make-point pt)
```

**å‚æ•°**: 1 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: ename or nil

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-point (pt)
  "æ ¹æ®å‚æ•°åæ ‡ç»˜åˆ¶ä¸€ä¸ªç‚¹"
  "ename or nil"
  (entmakex (list (quote (0 . "POINT"))
      (quote (100 . "AcDbEntity"))
      (quote (67 . 0))
      (quote (100 . "AcDbPoint"))
      (cons 10 pt)
      (quote (210 0.0 0.0 1.0))
      (quote (50 . 0.0)))))
```
</details>

---

### entity:make-polyline

**è¯´æ˜**: ç”Ÿæˆä¸‰ç»´å¤šæ®µçº¿.POLYLINEå‚æ•°:  pts:ç«¯ç‚¹åæ ‡ç‚¹è¡¨ï¼Œå¦‚ï¼š((x1 y1 z1) (x2 y2 z2) (x2 y2 z2))  closed:æ˜¯å¦é—­åˆï¼Œ1:é—­åˆï¼Œ0ï¼šä¸é—­åˆ

**ç”¨æ³•**:
```lisp
(entity:make-polyline pts closed)
```

**å‚æ•°**: 1 pts  : å¤šä¸ªåæ ‡ç‚¹åˆ—è¡¨;2 closed  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: ç”Ÿæˆå¤šæ®µçº¿çš„å›¾å…ƒå

**ç¤ºä¾‹**:
```lisp
(entity:make-pline '((0 0 0) (5000 0 0) (5000 5000 0) (0 5000 0)) 1)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-polyline (pts closed / ent)
  "ç”Ÿæˆä¸‰ç»´å¤šæ®µçº¿.POLYLINE\nå‚æ•°:\n  pts:ç«¯ç‚¹åæ ‡ç‚¹è¡¨ï¼Œå¦‚ï¼š((x1 y1 z1)
    (x2 y2 z2)
    (x2 y2 z2))\n  closed:æ˜¯å¦é—­åˆï¼Œ1:é—­åˆï¼Œ0ï¼šä¸é—­åˆ"
  "ç”Ÿæˆå¤šæ®µçº¿çš„å›¾å…ƒå"
  "(entity:make-pline '((0 0 0)
      (5000 0 0)
      (5000 5000 0)
      (0 5000 0))
    1)"
  (if (= closed 1)
    (entmake (list (quote (0 . "POLYLINE"))
        (quote (66 . 1))
        (quote (10 0.0 0.0 0.0))
        (quote (70 . 9))))
    (entmake (list (quote (0 . "POLYLINE"))
        (quote (66 . 1))
        (quote (70 . 8)))))
  (if pts (mapcar (quote (lambda (x)
          (entmake (list (cons 0 "VERTEX")
              (cons 10 x)
              (cons 70 32)))))
      pts))
  (entmake (quote ((0 . "SEQEND"))))
  (entlast))
```
</details>

---

### entity:make-polyline-ax

**è¯´æ˜**: æ ¹æ®ç‚¹è¡¨ç”Ÿæˆpolylineï¼Œä¸‰ç»´å¤šæ®µçº¿ã€‚å‚æ•°:closed? T or nil.ActiveX æ–¹æ³•ã€‚

**ç”¨æ³•**:
```lisp
(entity:make-polyline-ax pts-3d closed?)
```

**å‚æ•°**: 1 pts-3d  : å¤šä¸ªåæ ‡ç‚¹åˆ—è¡¨;2 closed?  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: ä¸‰ç»´POLYLINEå›¾å…ƒ

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-polyline-ax (pts-3d closed? / acadobj doc modelspace pntlst2 points polyobj)
  "æ ¹æ®ç‚¹è¡¨ç”Ÿæˆpolylineï¼Œä¸‰ç»´å¤šæ®µçº¿ã€‚å‚æ•°:closed? T or nil.ActiveX æ–¹æ³•ã€‚"
  "ä¸‰ç»´POLYLINEå›¾å…ƒ"
  (setq pntlst2 (quote nil))
  (if pts-3d (progn (foreach e pts-3d (setq pntlst2 (append pntlst2 e)))
      (setq acadobj (vlax-get-acad-object))
      (setq doc (vla-get-activedocument acadobj))
      (setq points (vlax-make-safearray vlax-vbdouble (cons 0 (- (length pntlst2)
              1))))
      (vlax-safearray-fill points pntlst2)
      (setq modelspace (vla-get-modelspace doc))
      (setq polyobj (vla-add3dpoly modelspace points))
      (if (= closed? t)
        (vla-put-closed (vlax-ename->vla-object (entlast))
          :vlax-true))))
  (entlast))
```
</details>

---

### entity:make-rectangle

**è¯´æ˜**: åˆ›å»ºçŸ©å½¢æ¡†(æ°´å¹³ï¼Œç«–ç›´æ–¹å‘)

**ç”¨æ³•**:
```lisp
(entity:make-rectangle pt1 pt2)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-rectangle (pt1 pt2)
  "åˆ›å»ºçŸ©å½¢æ¡†(æ°´å¹³ï¼Œç«–ç›´æ–¹å‘)"
  (entmake (list (quote (0 . "LWPOLYLINE"))
      (quote (100 . "AcDbEntity"))
      (quote (100 . "AcDbPolyline"))
      (quote (90 . 4))
      (quote (70 . 1))
      (if (caddr pt1)
        (cons 38 (caddr pt1))
        (cons 38 0))
      (cons 10 (list (car pt1)
          (cadr pt1)))
      (cons 10 (list (car pt2)
          (cadr pt1)))
      (cons 10 (list (car pt2)
          (cadr pt2)))
      (cons 10 (list (car pt1)
          (cadr pt2)))
      (cons 210 (quote (0 0 1)))))
  (entlast))
```
</details>

---

### entity:make-tag

**è¯´æ˜**: ç”Ÿæˆä¸€ä¸ªæ ‡ç­¾

**ç”¨æ³•**:
```lisp
(entity:make-tag pt name)
```

**å‚æ•°**: 1 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 name  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-tag (pt name)
  "ç”Ÿæˆä¸€ä¸ªæ ‡ç­¾"
  (entity:make-circle pt 10)
  (entity:maketext (vl-symbol-name name)
    pt 250 0 0.8 0 13))
```
</details>

---

### entity:make-text

**è¯´æ˜**: ç”Ÿæˆä¸€ä¸ªTEXTå®ä½“,å•è¡Œæ–‡æœ¬,å‚æ•°fontsize: å­—é«˜ang: è§’åº¦kgb: å®½é«˜æ¯”qx: å€¾æ–œè§’dqys: å¯¹é½æ–¹å¼ï¼ŒL å·¦ M ä¸­ R å³ï¼ŒT ä¸Š M ä¸­ B ä¸‹ã€‚

**ç”¨æ³•**:
```lisp
(entity:make-text str pt1 fontsize ang kgb qx dqys)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 fontsize  : æœªè¯†åˆ«å®šä¹‰;4 ang  : è§’åº¦å€¼;5 kgb  : æœªè¯†åˆ«å®šä¹‰;6 qx  : æœªè¯†åˆ«å®šä¹‰;7 dqys  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: return:æ–‡å­—å›¾å…ƒå

**ç¤ºä¾‹**:
```lisp
example:(entity:make-text "æ–‡å­—" (getpoint) 3 0 0.8 0 "LB")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-text (str pt1 fontsize ang kgb qx dqys / y1 y2)
  "ç”Ÿæˆä¸€ä¸ªTEXTå®ä½“,å•è¡Œæ–‡æœ¬,\nå‚æ•°è¯´æ˜ï¼š\nfontsize: å­—é«˜\nang: è§’åº¦\nkgb: å®½é«˜æ¯”\nqx: å€¾æ–œè§’\ndqys: å¯¹é½æ–¹å¼ï¼ŒL å·¦ M ä¸­ R å³ï¼ŒT ä¸Š M ä¸­ B ä¸‹ã€‚\n"
  "return:æ–‡å­—å›¾å…ƒå"
  "example:(entity:make-text \"æ–‡å­—\"
    (getpoint)
    3 0 0.8 0 \"LB\")"
  (if (= (quote str)
      (type dqys))
    (setq dqys (strcase dqys)))
  (cond ((or (= dqys 0)
        (= dqys "M"))
      (setq y1 (cons 72 4)
        y2 (cons 73 0)))
    ((or (= dqys 11)
        (= dqys "LT"))
      (setq y1 (cons 72 0)
        y2 (cons 73 3)))
    ((or (= dqys 12)
        (= dqys "LM"))
      (setq y1 (cons 72 0)
        y2 (cons 73 2)))
    ((or (= dqys 13)
        (= dqys "LB"))
      (setq y1 (cons 72 0)
        y2 (cons 73 1)))
    ((or (= dqys 21)
        (= dqys "MT"))
      (setq y1 (cons 72 1)
        y2 (cons 73 3)))
    ((or (= dqys 22)
        (= dqys "MM"))
      (setq y1 (cons 72 1)
        y2 (cons 73 2)))
    ((or (= dqys 23)
        (= dqys "MB"))
      (setq y1 (cons 72 1)
        y2 (cons 73 1)))
    ((or (= dqys 31)
        (= dqys "RT"))
      (setq y1 (cons 72 2)
        y2 (cons 73 3)))
    ((or (= dqys 32)
        (= dqys "RM"))
      (setq y1 (cons 72 2)
        y2 (cons 73 2)))
    ((or (= dqys 33)
        (= dqys "RB"))
      (setq y1 (cons 72 2)
        y2 (cons 73 1)))
    (t (setq y1 (cons 72 0)
        y2 (cons 73 3))))
  (entmakex (list (quote (0 . "TEXT"))
      (cons 10 pt1)
      (cons 1 str)
      (cons 40 fontsize)
      (cons 50 ang)
      (cons 41 kgb)
      (cons 51 qx)
      (quote (71 . 0))
      y1 y2 (cons 11 pt1))))
```
</details>

---

### entity:make-textstyle

**è¯´æ˜**: åˆ›å»ºæ–‡å­—æ ·å¼ã€‚

**ç”¨æ³•**:
```lisp
(entity:make-textstyle name)
```

**å‚æ•°**: 1 name  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-textstyle (name / obj)
  "åˆ›å»ºæ–‡å­—æ ·å¼ã€‚"
  (setq obj (vla-add (vla-get-textstyles (vla-get-activedocument (vlax-get-acad-object)))
      name))
  (vla-setfont obj "å®‹ä½“"
    :vlax-false :vlax-false 1 0)
  (vla-put-width obj 0.7)
  (princ))
```
</details>

---

### entity:make-xline

**è¯´æ˜**: ä¸¤ç‚¹æ„é€ çº¿ã€‚pt-base åŸºç‚¹ï¼Œunit-vector ç©ºé—´å•ä½çŸ¢é‡ï¼Œå½“ä¸ºä¸€ä¸ªæ•°å€¼æ—¶ï¼Œè¡¨ç¤ºä¸ºå¼§åº¦ã€‚

**ç”¨æ³•**:
```lisp
(entity:make-xline pt-base unit-vector)
```

**å‚æ•°**: 1 pt-base  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 unit-vector  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:make-xline (pt-base unit-vector)
  "ä¸¤ç‚¹æ„é€ çº¿ã€‚pt-base åŸºç‚¹ï¼Œunit-vector ç©ºé—´å•ä½çŸ¢é‡ï¼Œå½“ä¸ºä¸€ä¸ªæ•°å€¼æ—¶ï¼Œè¡¨ç¤ºä¸ºå¼§åº¦ã€‚"
  ""
  ""
  (if (numberp unit-vector)
    (setq unit-vector (list (cos unit-vector)
        (sin unit-vector)
        0)))
  (entmakex (list (quote (0 . "XLINE"))
      (quote (100 . "AcDbEntity"))
      (quote (100 . "AcDbXline"))
      (cons 10 pt-base)
      (cons 11 unit-vector))))
```
</details>

---

### entity:offset

**è¯´æ˜**: åç§»å¯¹è±¡

**ç”¨æ³•**:
```lisp
(entity:offset obj dis)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;2 dis  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:offset (obj dis / offsetobj)
  "åç§»å¯¹è±¡"
  (if (p:enamep obj)
    (setq obj (vlax-ename->vla-object obj)))
  (setq offsetobj (vla-offset obj dis)))
```
</details>

---

### entity:onlockedlayer

**è¯´æ˜**: è§£é”å›¾å…ƒæ‰€åœ¨çš„å›¾å±‚

**ç”¨æ³•**:
```lisp
(entity:onlockedlayer ename)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:onlockedlayer (ename / entlst)
  "è§£é”å›¾å…ƒæ‰€åœ¨çš„å›¾å±‚"
  (setq entlst (tblsearch "LAYER"
      (cdr (assoc 8 (entget ename)))))
  (= 4 (logand 4 (cdr (assoc 70 entlst)))))
```
</details>

---

### entity:putdxf

**è¯´æ˜**: æ›´æ–°å›¾å…ƒçš„ç»„ç å€¼å‚æ•°:ename:å›¾å…ƒï¼Œé€‰æ‹©é›†ï¼Œå›¾å…ƒåˆ—è¡¨code:ç»„ç æˆ–ç»„ç è¡¨val:å€¼æˆ–è€…å€¼è¡¨

**ç”¨æ³•**:
```lisp
(entity:putdxf ename code val)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 code  : æœªè¯†åˆ«å®šä¹‰;3 val  : å€¼;

**è¿”å›å€¼**: æ›´æ–°åçš„å›¾å…ƒï¼Œé€‰æ‹©é›†ï¼Œå›¾å…ƒåˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(entity:putdxf (car (entsel))    10 '(0 0 0))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:putdxf (ename code val / ent)
  "æ›´æ–°å›¾å…ƒçš„ç»„ç å€¼\nå‚æ•°:\nename:å›¾å…ƒï¼Œé€‰æ‹©é›†ï¼Œå›¾å…ƒåˆ—è¡¨\ncode:ç»„ç æˆ–ç»„ç è¡¨\nval:å€¼æˆ–è€…å€¼è¡¨"
  "æ›´æ–°åçš„å›¾å…ƒï¼Œé€‰æ‹©é›†ï¼Œå›¾å…ƒåˆ—è¡¨"
  "(entity:putdxf (car (entsel))\n    10 '(0 0 0))"
  (cond ((p:enamep ename)
      (if (null (wcmatch (entity:getdxf ename 0)
            "TCH_*"))
        (progn (setq ent (entget ename))
          (if (and (listp code)
              (listp val))
            (mapcar (quote (lambda (x y)
                  (entity:putdxf ename x y)))
              code val)
            (if (null (entity:getdxf ename code))
              (entmod (append ent (list (cons code val))))
              (entmod (subst (cons code val)
                  (assoc code ent)
                  ent))))
          (entupd ename))
        (@:log "WARR"
          "this function CANNOT support proxy entity.")))
    ((p:picksetp ename)
      (foreach s1 (pickset:to-list ename)
        (entity:putdxf s1 code val)))
    ((p:ename-listp ename)
      (foreach s1 ename (entity:putdxf s1 code val))))
  ename)
```
</details>

---

### entity:readme

**è¯´æ˜**: å›¾å…ƒæ“ä½œç›¸å…³å‡½æ•°ã€‚

**ç”¨æ³•**:
```lisp
(entity:readme )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:readme nil "å›¾å…ƒæ“ä½œç›¸å…³å‡½æ•°ã€‚"
  (princ "å›¾å…ƒæ“ä½œç›¸å…³å‡½æ•°ã€‚ä½¿ç”¨ (require 'entity:*)
    åŠ è½½è¿™äº›å‡½æ•°")
  (princ))
```
</details>

---

### entity:reference->definition

**è¯´æ˜**: è®¡ç®—å—å‚ç…§ä¸å—å®šä¹‰çš„å˜æ¢çŸ©é˜µ

**ç”¨æ³•**:
```lisp
(entity:reference->definition ent)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: è¿” å› å€¼:3x3çŸ©é˜µå’Œå‘é‡ç»„æˆçš„è¡¨

**ç¤ºä¾‹**:
```lisp
ç¤º    ä¾‹:(entity:Reference->Definition e)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:reference->definition (ent / a n)
  "è®¡ç®—å—å‚ç…§ä¸å—å®šä¹‰çš„å˜æ¢çŸ©é˜µ"
  "è¿” å› å€¼:3x3çŸ©é˜µå’Œå‘é‡ç»„æˆçš„è¡¨"
  "ç¤º    ä¾‹:(entity:Reference->Definition e)"
  (setq a (vla-get-rotation e)
    n (vla:getvalue (vla-get-normal e)))
  ((lambda (m)
      (list m (mapcar (quote -)
          (vla:-getvalue (vla-get-origin (vla-item (vla-get-blocks *doc*)
                (vla-get-name e))))
          (matrix:mxv m (trans (vla:-getvalue (vla-get-insertionpoint e))
              n 0)))))
    (matrix:mxm (list (list (/ 1.0 (vla-get-xscalefactor e))
          0.0 0.0)
        (list 0.0 (/ 1.0 (vla-get-yscalefactor e))
          0.0)
        (list 0.0 0.0 (/ 1.0 (vla-get-zscalefactor e))))
      (matrix:mxm (list (list (cos a)
            (sin (- a))
            0.0)
          (list (sin a)
            (cos a)
            0.0)
          (list 0.0 0.0 1.0))
        (mapcar (quote (lambda (e)
              (trans e n 0 t)))
          (quote ((1.0 0.0 0.0)
              (0.0 1.0 0.0)
              (0.0 0.0 1.0))))))))
```
</details>

---

### entity:set-visible

**è¯´æ˜**: è®¾ç½®å›¾å…ƒçš„å¯è§æ€§

**ç”¨æ³•**:
```lisp
(entity:set-visible ent bool)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;2 bool  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:set-visible (ent bool)
  "è®¾ç½®å›¾å…ƒçš„å¯è§æ€§"
  ""
  (if bool (vla-put-visible (e2o ent)
      :vlax-true)
    (vla-put-visible (e2o ent)
      :vlax-false)))
```
</details>

---

### entity:spline

**ç”¨æ³•**:
```lisp
(entity:spline pts)
```

**å‚æ•°**: 1 pts  : å¤šä¸ªåæ ‡ç‚¹åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:spline (pts)
  (command "_SPLINE")
  (mapcar (quote command)
    pts)
  (command ""
    ""
    "")
  (entlast))
```
</details>

---

### entity:textstyles

**è¯´æ˜**: æ–‡å­—æ ·å¼é›†åˆ

**ç”¨æ³•**:
```lisp
(entity:textstyles )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:textstyles nil "æ–‡å­—æ ·å¼é›†åˆ"
  (entity:listcollection (std:textstyles)))
```
</details>

---

### entity:to-obj

**è¯´æ˜**: å›¾å…ƒç±»å‹è½¬ä¸ºActiveXå¯¹è±¡ã€‚ç®€åŒ–å‡½æ•° e2o

**ç”¨æ³•**:
```lisp
(entity:to-obj en0)
```

**å‚æ•°**: 1 en0  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun entity:to-obj (en0)
  "å›¾å…ƒç±»å‹è½¬ä¸ºActiveXå¯¹è±¡ã€‚ç®€åŒ–å‡½æ•° e2o"
  (vlax-ename->vla-object en0))
```
</details>

---

## env

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### env:set-bg-color

**è¯´æ˜**: è®¾ç½®ç»˜å›¾åŒºèƒŒæ™¯è‰²

**ç”¨æ³•**:
```lisp
(env:set-bg-color col)
```

**å‚æ•°**: 1 col  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: æ— 

**ç¤ºä¾‹**:
```lisp
(env:set-bg-color 55)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun env:set-bg-color (col / display)
    "è®¾ç½®ç»˜å›¾åŒºèƒŒæ™¯è‰²"
    "æ— "
    "(env:set-bg-color 55)"
    (setq display (vla-get-display (vla-get-preferences (vla-get-application (vlax-get-acad-object)))))
    (vla-put-graphicswinlayoutbackgrndcolor display (vlax-make-variant (+ col (* col 256)
                (* col 65536))
            vlax-vblong))
    (princ))
```
</details>

---

### env:set-cross-color

**ç”¨æ³•**:
```lisp
(env:set-cross-color )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun env:set-cross-color (/ col display)
    (vla-put-modelcrosshaircolor display (vlax-make-variant (+ col (* col 256)
                (* col 65536))
            vlax-vblong)))
```
</details>

---

## example

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### example:cmd-reactor

**è¯´æ˜**: å‘½ä»¤ååº”å™¨ç¤ºä¾‹ï¼šå½“æ‰§è¡ŒLINE PLINE ARCæ—¶ï¼Œä¸´æ—¶è°ƒæ•´å¯¹è±¡æ•æ‰åŠŸèƒ½ï¼Œå®Œæˆåæ¢å¤åŸè®¾ç½®

**ç”¨æ³•**:
```lisp
(example:cmd-reactor )
```

**å‚æ•°**: æ²¡æœ‰

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:cmd-reactor nil "å‘½ä»¤ååº”å™¨ç¤ºä¾‹ï¼šå½“æ‰§è¡ŒLINE PLINE ARCæ—¶ï¼Œä¸´æ—¶è°ƒæ•´å¯¹è±¡æ•æ‰åŠŸèƒ½ï¼Œå®Œæˆåæ¢å¤åŸè®¾ç½®"
  ""
  ""
  ";;åè½¬æœ€è¿‘ç‚¹æ•æ‰å‘½ä»¤ï¼Œå¯åŠ  ' è¿›è¡Œé€æ˜æ‰§è¡Œ"
  (defun c:switchnea nil (setvar "osmode"
      (boole 6 (getvar "osmode")
        512))
    (if (= 0 (logand (getvar "osmode")
          512))
      (prompt "
        å…³é—­æœ€è¿‘ç‚¹æ•æ‰")
      (prompt "
        å¼€å¯æœ€è¿‘ç‚¹æ•æ‰"))
    (princ))
  ";;å½“æ‰§è¡Œå‘½ä»¤ line pline arc æ—¶ï¼Œä¿å­˜å½“å‰osmodeå˜é‡"
  (defun react-start-cmd (param1 param2)
    (if (member (car param2)
        (quote ("LINE"
            "PLINE"
            "ARC")))
      (push-var "OSMODE"))
    (princ))
  ";; å½“ç»“æŸå‘½ä»¤ line pline arc æ—¶ï¼Œæ¢å¤å½“å‰osmodeå˜é‡"
  (defun react-end-cmd (param1 param2)
    (if (member (car param2)
        (quote ("LINE"
            "PLINE"
            "ARC")))
      (pop-var))
    (princ))
  ";; å®šä¹‰å‘½ä»¤ååº”å™¨"
  (defun @::enable-tempvar-reactor nil (if (null at-tempvar-cmd-start)
      (setq at-tempvar-cmd-start (vlr-command-reactor nil (quote ((:vlr-commandwillstart . react-start-cmd)))))
      (vlr-add at-tempvar-cmd-start))
    (if (null at-tempvar-cmd-ended)
      (setq at-tempvar-cmd-ended (vlr-command-reactor nil (quote ((:vlr-commandended . react-end-cmd)
              (:vlr-commandcancelled . react-end-cmd)
              (:vlr-commandfailed . react-end-cmd)))))
      (vlr-add at-tempvar-cmd-ended)))
  (defun @::disable-tempvar-reactor nil (foreach x (list at-tempvar-cmd-start at-tempvar-cmd-ended)
      (if x (vlr-remove x))))
  (@::enable-tempvar-reactor))
```
</details>

---

### example:dbx

**è¯´æ˜**: ç”¨DBXæ–¹å¼åˆ é™¤dwgæ–‡ä»¶ä¸­çš„å›¾æ¡†ç­¾åå’Œæ‰‹å†™ç­¾åå—

**ç”¨æ³•**:
```lisp
(example:dbx )
```

**å‚æ•°**: æ²¡æœ‰ä¸€ä¸ª

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:dbx nil "ç”¨DBXæ–¹å¼åˆ é™¤dwgæ–‡ä»¶ä¸­çš„å›¾æ¡†ç­¾åå’Œæ‰‹å†™ç­¾åå—"
  ""
  ""
  "ä¿®æ”¹ä»¥ä¸‹é…ç½®ä¿¡æ¯==================================="
  (setq framename "å›¾æ¡†å—å")
  (setq signs (quote ("ç­¾å1"
        "ç­¾å2")))
  "
  =================================================="
  (defun dbx-clean-att (dwg-file / blk-obj blk3)
    "æ‰“å¼€å¤–éƒ¨dwgçš„DBXå¯¹è±¡. å‡å®šæ–‡ä»¶ä¸º D:/abc.dwg"
    (setq dwg-file (findfile dwg-file))
    (dbx:open dwg-file)
    "å–dbxä¸­çš„æ¨¡å‹ç©ºé—´ä¸­çš„å®ä½“"
    (setq dbx-ms (vla-get-modelspace *dbx*))
    "å–dbxå—é›†ä¸­çš„ç¬¬4ä¸ªå—å®šä¹‰å¯¹è±¡ï¼ˆå‰å‡ ä¸ªæ˜¯model-space paper-spaceä¹‹ç±»çš„ï¼‰"
    (setq n 0)
    (repeat (vla-get-count dbx-ms)
      (setq obj% (vla-item dbx-ms n))
      (print (vla-get-objectname obj%))
      (cond ((and (= (vla-get-objectname obj%)
              "AcDbBlockReference")
            (= (vla-get-hasattributes obj%)
              :vlax-true)
            (= (vla-get-effectivename obj%)
              framename))
          (block:set-attributes obj% (quote (("è®¾è®¡"
                  . "")
                ("æ ¡å¯¹"
                  . "")))))
        ((and (= (vla-get-objectname obj%)
              "AcDbBlockReference")
            (member (vla-get-effectivename obj%)
              signs))
          (vla-delete obj%)))
      (setq n (1+ n)))
    (setq tmp-file (strcat dwg-file ".b.dwg"))
    (vla-saveas *dbx* tmp-file)
    (dbx:release)
    (if (and (findfile tmp-file)
        (> (vl-file-size tmp-file)
          0))
      (progn (vl-file-delete dwg-file)
        (vl-file-rename tmp-file dwg-file))))
  (dbx-clean-att "D:/xxx.dwg"))
```
</details>

---

### example:dcl-cell

**è¯´æ˜**: MVCNIS æ–¹æ³•: 6 æ­¥è¿›è¡ŒåŠ¨æ€ DCL å¼€å‘ã€‚è¡¨æ ¼ç¤ºä¾‹ã€‚Model-View-Control-New-Init-Show.

**ç”¨æ³•**:
```lisp
(example:dcl-cell )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:dcl-cell (/ curr-page total-page dcl-fp dcl-tmp)
  "MVCNIS æ–¹æ³•: 6 æ­¥è¿›è¡ŒåŠ¨æ€ DCL å¼€å‘ã€‚è¡¨æ ¼ç¤ºä¾‹ã€‚Model-View-Control-New-Init-Show."
  ""
  ""
  (require (quote dcl:*))
  (setq lst-cell (quote (("é‡Œç¨‹L"
          "é«˜ç¨‹H"
          "åŠå¾„R")
        (0.0 218.0 0.0)
        (315.589 226.02 1000)
        (815.589 261.02 1000)
        (988.596 255.83 1000)
        (1407.44 260.01 1000)
        (1578.32 265.14 1000)
        (1768.39 264.57 1000)
        (2068.39 240.57 1000)
        (2168.39 237.57 1000)
        (2439.11 215.91 1000)
        (2527.98 213.9 10.0)
        (315.589 226.02 1000)
        (815.589 261.02 1000)
        (988.596 255.83 1000)
        (1407.44 260.01 1000)
        (1578.32 265.14 1000)
        (1768.39 264.57 1000)
        (2068.39 240.57 1000)
        (2168.39 237.57 1000)
        (2439.11 215.91 1000)
        (2527.98 213.9 10.0)
        (315.589 226.02 1000)
        (815.589 261.02 1000)
        (988.596 255.83 1000)
        (1407.44 260.01 1000)
        (1578.32 265.14 1000)
        (1768.39 264.57 1000)
        (2068.39 240.57 1000)
        (2168.39 237.57 1000)
        (2439.11 215.91 1000)
        (2527.98 213.9 10.0)
        (315.589 226.02 1000)
        (815.589 261.02 1000)
        (988.596 255.83 1000)
        (1407.44 260.01 1000)
        (1578.32 265.14 1000)
        (1768.39 264.57 1000)
        (2068.39 240.57 1000)
        (2168.39 237.57 1000)
        (2439.11 215.91 1000)
        (2527.98 213.9 10.0))))
  "1. Model å»ºç«‹æ•°æ®æ¨¡å‹ã€‚"
  (setq accept-hook nil)
  (setq lst-cellraw lst-cell)
  (setq cell1tmp-data lst-cell)
  (setq cell1curr-page 0)
  "2. View å»ºç«‹æ˜¾ç¤ºè§†å›¾ã€‚"
  (dcl:dialog "example")
  (dcl:cell "cell1"
    9 (length (car cell1tmp-data))
    t t t t)
  (dcl:dialog-end-ok-cancel)
  "3. Control åˆ›å»ºæ§åˆ¶æµç¨‹"
  (dcl:new "example")
  "5. Init åˆå§‹åŒ–å¯¹è¯æ¡†"
  (set_tile "title"
    "Example æ ‡é¢˜")
  (dcl:show-celldata "cell1")
  "6. Show"
  (dcl:show))
```
</details>

---

### example:dcl-dialog

**è¯´æ˜**: MVCNIS æ³•ç¤ºä¾‹2: 6 æ­¥è¿›è¡ŒåŠ¨æ€ DCL å¼€å‘ã€‚

**ç”¨æ³•**:
```lisp
(example:dcl-dialog )
```

**å‚æ•°**: æ²¡æœ‰

**ç¤ºä¾‹**:
```lisp
(example:dcl-dialog)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:dcl-dialog (/ *error* curr-page total-page dcl-fp dcl-tmp)
  "MVCNIS æ³•ç¤ºä¾‹2: 6 æ­¥è¿›è¡ŒåŠ¨æ€ DCL å¼€å‘ã€‚"
  ""
  "(example:dcl-dialog)"
  (require (quote dcl:*))
  "1. Model å»ºç«‹æ•°æ®æ¨¡å‹ã€‚"
  (setq curr-page 0)
  (setq total-page 1)
  "2. View å»ºç«‹æ˜¾ç¤ºè§†å›¾ã€‚"
  (dcl:dialog "example")
  (progn (dcl:hr 0.08)
    (write-line ":text{key=\"num\";}"
      dcl-fp)
    (dcl:hr 0.08)
    (dcl:cell "cell"
      8 8 nil t nil nil)
    (dcl:hr 0.08)
    (dcl:paging t))
  (dcl:dialog-end-ok-cancel)
  "3. Control åˆ›å»ºæ§åˆ¶æµç¨‹"
  (defun cb-flush-page nil (set_tile "num"
      (strcat "\n         å½“å‰é¡µé¢: "
        (itoa (1+ curr-page)))))
  "4. New ä¸€ä¸ªæ–°å¯¹è¯æ¡†å¯¹è±¡ã€‚"
  (dcl:new "example")
  "5. Init åˆå§‹åŒ–å¯¹è¯æ¡†"
  (set_tile "title"
    "Example æ ‡é¢˜")
  (paging-init)
  (cb-flush-page)
  "6. Show dialog æ˜¾ç¤ºå¹¶è¿›è¡Œäº¤äº’"
  (dcl:show)
  (princ))
```
</details>

---

### example:dcl-modify-title

**è¯´æ˜**: dclæ”¹æ ‡é¢˜ç¤ºä¾‹

**ç”¨æ³•**:
```lisp
(example:dcl-modify-title )
```

**å‚æ•°**: None

**ç¤ºä¾‹**:
```lisp
(require 'example:dcl-modify-title)(example:dcl-modify-title)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:dcl-modify-title (/ *error* make-dcl dcl-tmp dcl-id)
  "dclæ”¹æ ‡é¢˜ç¤ºä¾‹"
  ""
  "(require 'example:dcl-modify-title)(example:dcl-modify-title)"
  (defun *error* (msg)
    (@:*error* msg))
  (defun make-dcl (/ lst_str str file f)
    (setq lst_str (quote (""
          "test:dialog {"
          "
             value=\"åˆå§‹æ ‡é¢˜\";"
          "
             key = \"test\"
          ;"
          "
             :edit_box {"
          "
                 key = \"title\"
          ;"
          "
                 label = \"æ ‡é¢˜:\"
          ;"
          "
             }"
          "
             :button {"
          "
                 key = \"modify\"
          ;"
          "
                 label = \"æ›´æ”¹\"
          ;"
          "
             }"
          "
             ok_cancel;"
          "}")))
    (setq file (vl-filename-mktemp "temp.dcl"))
    (setq f (open file "w"))
    (foreach str lst_str (princ "\n"
        f)
      (princ str f))
    (close f)
    file)
  (setq dcl-tmp (make-dcl))
  (setq dcl-id (load_dialog dcl-tmp))
  (if (not (new_dialog "test"
        dcl-id ""))
    (exit))
  (action_tile "modify"
    "(set_tile \"test\"
      (get_tile \"title\"))")
  (start_dialog)
  (unload_dialog dcl-id)
  (vl-file-delete dcl-tmp)
  (princ))
```
</details>

---

### example:dcl-mtext

**è¯´æ˜**: MVCNIS æ³•: 6 æ­¥è¿›è¡ŒåŠ¨æ€ DCL å¼€å‘ä¹‹å¤šè¡Œæ–‡æœ¬

**ç”¨æ³•**:
```lisp
(example:dcl-mtext )
```

**å‚æ•°**: None

**ç¤ºä¾‹**:
```lisp
(example:dcl-mtext)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:dcl-mtext (/ dcl-fp dcl-tmp)
  "MVCNIS æ³•: 6 æ­¥è¿›è¡ŒåŠ¨æ€ DCL å¼€å‘ä¹‹å¤šè¡Œæ–‡æœ¬"
  ""
  "(example:dcl-mtext)"
  (require (quote dcl:*))
  "1. Model å»ºç«‹æ•°æ®æ¨¡å‹ã€‚"
  "2. View å»ºç«‹æ˜¾ç¤ºè§†å›¾ã€‚"
  (dcl:dialog "example")
  (progn (dcl:mtext "mt"
      3 50)
    (dcl:begin-cluster "row"
      "")
    (progn (dcl:button "btn1"
        "æŒ‰é’®1"
        "")
      (dcl:button "btn2"
        "æŒ‰é’®2"
        "")
      (dcl:end-cluster)))
  (dcl:dialog-end-ok-cancel)
  "3. Control åˆ›å»ºæ§åˆ¶æµç¨‹"
  (defun cb-btn1 nil (dcl:set-mtext "mt"
      "æŒ‰ä¸‹äº†æŒ‰é’®1æŒ‰ä¸‹äº†æŒ‰é’®1æŒ‰ä¸‹äº†æŒ‰é’®1æŒ‰ä¸‹äº†æŒ‰é’®1æŒ‰ä¸‹äº†æŒ‰é’®1æŒ‰ä¸‹äº†æŒ‰é’®1æŒ‰ä¸‹äº†æŒ‰é’®1æŒ‰ä¸‹äº†æŒ‰é’®1"))
  (defun cb-btn2 nil (dcl:set-mtext "mt"
      "æŒ‰ä¸‹äº†æŒ‰é’®2æŒ‰ä¸‹äº†æŒ‰é’®2æŒ‰ä¸‹äº†æŒ‰é’®2æŒ‰ä¸‹äº†æŒ‰é’®2æŒ‰ä¸‹äº†æŒ‰é’®2æŒ‰ä¸‹äº†æŒ‰é’®2æŒ‰ä¸‹äº†æŒ‰é’®2æŒ‰ä¸‹äº†æŒ‰é’®2"))
  "4. New ä¸€ä¸ªæ–°å¯¹è¯æ¡†å¯¹è±¡ã€‚"
  (dcl:new "example")
  "5. Init åˆå§‹åŒ–å¯¹è¯æ¡†"
  (set_tile "title"
    "dcl-å¤šè¡Œæ–‡æœ¬ç¤ºä¾‹")
  (dcl:set-mtext "mt"
    "åˆå§‹åŒ–å¤šè¡Œæ–‡æœ¬å†…å®¹ã€‚åˆå§‹åŒ–å¤šè¡Œæ–‡æœ¬å†…å®¹ã€‚åˆå§‹åŒ–å¤šè¡Œæ–‡æœ¬å†…å®¹ã€‚åˆå§‹åŒ–å¤šè¡Œæ–‡æœ¬å†…å®¹ã€‚åˆå§‹åŒ–å¤šè¡Œæ–‡æœ¬å†…å®¹ã€‚")
  "6. Show dialog æ˜¾ç¤ºå¹¶è¿›è¡Œäº¤äº’"
  (dcl:show)
  (princ))
```
</details>

---

### example:dcl-mtext2

**è¯´æ˜**: MVCNIS æ–¹æ³•: 6 æ­¥è¿›è¡ŒåŠ¨æ€ DCL å¼€å‘ã€‚Model-View-Control-New-Init-Show.

**ç”¨æ³•**:
```lisp
(example:dcl-mtext2 )
```

**å‚æ•°**: None

**ç¤ºä¾‹**:
```lisp
(example:dcl-dialog)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:dcl-mtext2 (/ curr-page total-page dcl-fp dcl-tmp)
  "MVCNIS æ–¹æ³•: 6 æ­¥è¿›è¡ŒåŠ¨æ€ DCL å¼€å‘ã€‚Model-View-Control-New-Init-Show."
  ""
  "(example:dcl-dialog)"
  (require (quote dcl:*))
  "1. Model å»ºç«‹æ•°æ®æ¨¡å‹ã€‚"
  (setq curr-page 0)
  (setq total-page 5)
  "2. View å»ºç«‹æ˜¾ç¤ºè§†å›¾ã€‚"
  (dcl:dialog "example")
  (progn (dcl:begin-cluster "column"
      "")
    (progn (dcl:img "img1"
        20 10)
      (dcl:mtext "mtext"
        5 90)
      (dcl:begin-cluster "row"
        "")
      (progn (dcl:button "btn1"
          "Button1"
          "")
        (dcl:button "btn2"
          "Button2"
          "")
        (dcl:end-cluster))
      (dcl:end-cluster)))
  (dcl:dialog-end-ok-cancel)
  "3. Control åˆ›å»ºæ§åˆ¶æµç¨‹"
  (defun cb-flush-page nil (set_tile "num"
      (strcat "\n         å½“å‰é¡µé¢: "
        (itoa (1+ curr-page)))))
  (defun cb-btn1 nil (dcl:set-mtext "mtext"
      "è¯´æ˜ï¼šå­—ç¬¦ä¸²è½¬å­—byte or word æ•´æ•°å€¼åˆ—è¡¨ã€‚nå½“å°äº128æ—¶ï¼Œå•å­—èŠ‚ï¼Œå½“ä¸¤ä¸ªè¿ç»­çš„å¤§äº128æ—¶ï¼ŒåŒå­—èŠ‚å€¼ã€‚ç”¨äºè½¬æ¢éè‹±æ–‡å­—ä¸²æ—¶é˜²æ­¢é‡ç ã€‚nå½“AutoCAD2021ä¸”lispsys=1æ—¶ï¼Œè¿”å› unicode ç ã€‚è¯´æ˜ï¼šè‡ªåŠ¨åˆ†æ®µï¼ŒæŒ‰æ•°å­—-å­—æ¯-æ±‰å­—è‡ªåŠ¨æ–­å¼€å­—ç¬¦ä¸²ä¸ºå­—ç¬¦ä¸²åˆ—è¡¨ã€‚ä¸æ”¯æŒç§‘å­¦è®¡æ•°æ³•çš„æ•°å­—ã€‚è¯´æ˜ï¼šå­—ç¬¦ä¸²è½¬å­—byte or word æ•´æ•°å€¼åˆ—è¡¨ã€‚nå½“å°äº128æ—¶ï¼Œå•å­—èŠ‚ï¼Œå½“ä¸¤ä¸ªè¿ç»­çš„å¤§äº128æ—¶ï¼ŒåŒå­—èŠ‚å€¼ã€‚ç”¨äºè½¬æ¢éè‹±æ–‡å­—ä¸²æ—¶é˜²æ­¢é‡ç ã€‚nå½“AutoCAD2021ä¸”lispsys=1æ—¶ï¼Œè¿”å› unicode ç ã€‚è¯´æ˜ï¼šè‡ªåŠ¨åˆ†æ®µï¼ŒæŒ‰æ•°å­—-å­—æ¯-æ±‰å­—è‡ªåŠ¨æ–­å¼€å­—ç¬¦ä¸²ä¸ºå­—ç¬¦ä¸²åˆ—è¡¨ã€‚ä¸æ”¯æŒç§‘å­¦è®¡æ•°æ³•çš„æ•°å­—ã€‚"))
  (defun cb-btn2 nil (dcl:set-mtext "mtext"
      "The button's label specifies text that appears inside the button. Buttons are appropriate for actions that are immediately visible to the user such as leaving the dialog box, or going into a subdialog box."))
  "4. New ä¸€ä¸ªæ–°å¯¹è¯æ¡†å¯¹è±¡ã€‚"
  (dcl:new "example")
  "5. Init åˆå§‹åŒ–å¯¹è¯æ¡†"
  (set_tile "title"
    "Example æ ‡é¢˜")
  (cb-flush-page)
  (dcl:set-mtext "mtext"
    "åŠ¨æ€å¤šè¡Œæ–‡æœ¬ã€‚")
  (dcl:show)
  (princ))
```
</details>

---

### example:dcl-multirb

**è¯´æ˜**: å¤šè¡Œå¤šåˆ—æ— çº¿æŒ‰é’®çš„é€‰å–

**ç”¨æ³•**:
```lisp
(example:dcl-multirb )
```

**å‚æ•°**: æ²¡æœ‰ä¸€ä¸ª

**è¿”å›å€¼**: é€‰ä¸­çš„æŒ‰é’®çš„key

**ç¤ºä¾‹**:
```lisp
(example:dcl-multirb)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:dcl-multirb (/ dcl-fp rbn group-rb rb-value)
  "å¤šè¡Œå¤šåˆ—æ— çº¿æŒ‰é’®çš„é€‰å–"
  "é€‰ä¸­çš„æŒ‰é’®çš„key"
  "(example:dcl-multirb)"
  (setq rbn 0)
  (setq group-rb "slt")
  (setq rb-value nil)
  (dcl:dialog "buttons")
  (dcl:begin-cluster "radio_row"
    "")
  (repeat 3 (progn (dcl:begin-cluster "column"
        "")
      (repeat 3 (write-line (strcat ":radio_button{key=\""
            group-rb (itoa (setq rbn (1+ rbn)))
            "\"; label=\""
            "Select"
            (itoa rbn)
            "\";action=\"(cb-rb $key)\";}")
          dcl-fp))
      (dcl:end-cluster)))
  (dcl:end-cluster)
  (dcl:end-dialog str-yes-no)
  (defun cb-rb (key / i)
    (print key)
    (setq i 0)
    (repeat rbn (if (/= key (strcat group-rb (itoa (setq i (1+ i)))))
        (set_tile (strcat group-rb (itoa i))
          "0")
        (set_tile (strcat group-rb (itoa i))
          "1")))
    (setq rb-value key))
  (dcl:new "buttons")
  (dcl:show)
  rb-value)
```
</details>

---

### example:dcl-progressbar

**è¯´æ˜**: MVCNIS æ³•: 6 æ­¥è¿›è¡ŒåŠ¨æ€ DCL å¼€å‘ä¹‹è¿›åº¦æ¡

**ç”¨æ³•**:
```lisp
(example:dcl-progressbar )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:dcl-progressbar (/ dcl-fp dcl-tmp valuebar)
  "MVCNIS æ³•: 6 æ­¥è¿›è¡ŒåŠ¨æ€ DCL å¼€å‘ä¹‹è¿›åº¦æ¡"
  ""
  ""
  (require (quote dcl:*))
  "1. Model å»ºç«‹æ•°æ®æ¨¡å‹ã€‚"
  (setq value-bar 0.3)
  "2. View å»ºç«‹æ˜¾ç¤ºè§†å›¾ã€‚"
  (dcl:dialog "example")
  (progn (dcl:progressbar "pbar1"
      "width=30;fixed_width=true;"
      t)
    (dcl:begin-cluster "row"
      "")
    (progn (dcl:button "btn1"
        "è¿›åº¦-"
        "")
      (dcl:button "btn2"
        "è¿›åº¦+"
        "")
      (dcl:end-cluster)))
  (dcl:dialog-end-ok-cancel)
  "3. Control åˆ›å»ºæ§åˆ¶æµç¨‹"
  (defun chg-bar (step)
    (setq value-bar (+ value-bar step))
    (if (> value-bar 1)
      (setq value-bar 1)
      (if (< value-bar 0)
        (setq value-bar 0)))
    value-bar)
  (defun cb-btn1 nil (dcl:set-progressbar "pbar1"
      (chg-bar -0.1)))
  (defun cb-btn2 nil (dcl:set-progressbar "pbar1"
      (chg-bar 0.1)))
  "4. New ä¸€ä¸ªæ–°å¯¹è¯æ¡†å¯¹è±¡ã€‚"
  (dcl:new "example")
  "5. Init åˆå§‹åŒ–å¯¹è¯æ¡†"
  (set_tile "title"
    "dcl-è¿›åº¦æ¡ç¤ºä¾‹")
  (dcl:set-progressbar "pbar1"
    value-bar)
  "6. Show dialog æ˜¾ç¤ºå¹¶è¿›è¡Œäº¤äº’"
  (dcl:show)
  (princ))
```
</details>

---

### example:dcl-progressbar2

**è¯´æ˜**: MVCNIS æ³•: 6 æ­¥è¿›è¡ŒåŠ¨æ€ DCL å¼€å‘ä¹‹è¿›åº¦æ¡

**ç”¨æ³•**:
```lisp
(example:dcl-progressbar2 )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:dcl-progressbar2 (/ dcl-fp dcl-tmp valuebar v1 v2 v3)
  "MVCNIS æ³•: 6 æ­¥è¿›è¡ŒåŠ¨æ€ DCL å¼€å‘ä¹‹è¿›åº¦æ¡"
  ""
  ""
  (require (quote dcl:*))
  "1. Model å»ºç«‹æ•°æ®æ¨¡å‹ã€‚"
  (setq value-bar 0.01 v1 0.01 v2 0.01 v3 0.01)
  "2. View å»ºç«‹æ˜¾ç¤ºè§†å›¾ã€‚"
  (dcl:dialog "example")
  (progn (dcl:progressbar "pbar0"
      "width=30;fixed_width=true;height=1;"
      t)
    (dcl:progressbar "pbar1"
      "width=30;fixed_width=true;"
      t)
    (dcl:progressbar "pbar2"
      "width=30;fixed_width=true;"
      t)
    (dcl:progressbar "pbar3"
      "width=30;fixed_width=true;"
      t)
    (dcl:mtext "mt"
      1 30)
    (dcl:begin-cluster "row"
      "")
    (progn (dcl:button "btn1"
        "æ¸…é›¶"
        "")
      (dcl:button "btn2"
        "è¿›åº¦+"
        "")
      (dcl:end-cluster)))
  (dcl:dialog-end-ok-cancel)
  "3. Control åˆ›å»ºæ§åˆ¶æµç¨‹"
  (defun chg-bar (step)
    (dcl:set-mtext "mt"
      "
      æ‰§è¡Œç¬¬ä¸€é˜¶æ®µï¼š")
    (while (and (< v1 1)
        (> v1 0))
      (setq v1 (+ v1 step))
      (if (> v1 1)
        (setq v1 1)
        (if (< v1 0)
          (setq v1 0)))
      (dcl:set-progressbar "pbar1"
        v1)
      (dcl:set-progressbar "pbar0"
        (/ (+ v1 v2 v3)
          3.0))
      (sleep 0.5))
    (dcl:set-mtext "mt"
      "
      æ‰§è¡Œç¬¬äºŒé˜¶æ®µ: ")
    (while (and (< v2 1)
        (> v2 0))
      (setq v2 (+ v2 (* 0.2 step)))
      (if (> v2 1)
        (setq v2 1)
        (if (< v2 0)
          (setq v2 0)))
      (dcl:set-progressbar "pbar2"
        v2)
      (dcl:set-progressbar "pbar0"
        (/ (+ v1 v2 v3)
          3.0))
      (sleep 0.2))
    (dcl:set-mtext "mt"
      "
      æ‰§è¡Œç¬¬ä¸‰é˜¶æ®µ: ")
    (while (and (< v3 1)
        (> v3 0))
      (setq v3 (+ v3 (* 0.3 step)))
      (if (> v3 1)
        (setq v3 1)
        (if (< v3 0)
          (setq v3 0)))
      (dcl:set-progressbar "pbar3"
        v3)
      (dcl:set-progressbar "pbar0"
        (/ (+ v1 v2 v3)
          3.0))
      (sleep 0.5))
    (dcl:set-mtext "mt"
      "
      æ‰§è¡Œå®Œæ¯•ï¼ï¼ "))
  (defun cb-btn1 nil (setq v1 0.001 v2 0.001 v3 0.001)
    (dcl:set-mtext "mt"
      "
      å‡†å¤‡ä¸­ ... ")
    (mapcar (quote dcl:set-progressbar)
      (quote ("pbar0"
          "pbar1"
          "pbar2"
          "pbar3"))
      (quote (0.001 0.001 0.001 0.001))))
  (defun cb-btn2 nil (chg-bar 0.1))
  "4. New ä¸€ä¸ªæ–°å¯¹è¯æ¡†å¯¹è±¡ã€‚"
  (dcl:new "example")
  "5. Init åˆå§‹åŒ–å¯¹è¯æ¡†"
  (set_tile "title"
    "dcl-è¿›åº¦æ¡ç¤ºä¾‹")
  (cb-btn1)
  "6. Show dialog æ˜¾ç¤ºå¹¶è¿›è¡Œäº¤äº’"
  (dcl:show)
  (princ))
```
</details>

---

### example:dcl-subdialog

**è¯´æ˜**: DCLå¤šçº§å¯¹è¯æ¡†ç¤ºä¾‹ä»£ç 

**ç”¨æ³•**:
```lisp
(example:dcl-subdialog )
```

**å‚æ•°**: æ²¡æœ‰ä¸€ä¸ª

**ç¤ºä¾‹**:
```lisp
(example:dcl-subdialog)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:dcl-subdialog (/ *error* curr-page total-page dcl-fp dcl-tmp cb-flush-page cb-img1 cb-img2 cb-img3)
  "DCLå¤šçº§å¯¹è¯æ¡†ç¤ºä¾‹ä»£ç "
  ""
  "(example:dcl-subdialog)"
  (require (quote dcl:*))
  (defun sub-dialog (m n / curr-page total-page dcl-fp dcl-tmp cb-flush-page page-init)
    "m n è¡¨ç¤ºå›¾åƒçš„ è¡Œ åˆ—ä¸ªæ•°"
    "1. Model å»ºç«‹æ•°æ®æ¨¡å‹ã€‚"
    (setq curr-page 0)
    (setq total-page 3)
    "2. View å»ºç«‹æ˜¾ç¤ºè§†å›¾ã€‚"
    (dcl:dialog "subimgs")
    (progn (dcl:hr 0.08)
      (write-line ":text{key=\"num\";}"
        dcl-fp)
      (dcl:hr 0.08)
      (setq i 0)
      (dcl:begin-cluster "column"
        "")
      (repeat m (dcl:begin-cluster "row"
          "")
        (repeat n (dcl:image-button (strcat "subimg"
              (itoa (setq i (1+ i))))
            20 10 nil))
        (dcl:end-cluster))
      (dcl:end-cluster)
      (dcl:hr 0.08)
      (dcl:paging t))
    (dcl:dialog-end-ok-cancel)
    "3. Control åˆ›å»ºæ§åˆ¶æµç¨‹"
    (defun cb-flush-page nil (set_tile "num"
        (strcat "å½“å‰é¡µé¢: "
          (itoa (1+ curr-page)))))
    "4. New ä¸€ä¸ªæ–°å¯¹è¯æ¡†å¯¹è±¡ã€‚"
    (dcl:new "subimgs")
    "5. Init åˆå§‹åŒ–å¯¹è¯æ¡†"
    (set_tile "title"
      "å­çª—å£")
    (paging-init)
    (cb-flush-page)
    "6. Show dialog æ˜¾ç¤ºå¹¶è¿›è¡Œäº¤äº’"
    (dcl:show)
    (princ))
  "1. Model å»ºç«‹æ•°æ®æ¨¡å‹ã€‚"
  (setq curr-page 0)
  (setq total-page 5)
  "2. View å»ºç«‹æ˜¾ç¤ºè§†å›¾ã€‚"
  (dcl:dialog "example")
  (progn (dcl:hr 0.08)
    (write-line ":text{key=\"num\";}"
      dcl-fp)
    (dcl:hr 0.08)
    (setq i 0)
    (dcl:begin-cluster "column"
      "")
    (repeat 4 (dcl:begin-cluster "row"
        "")
      (repeat 3 (dcl:image-button (strcat "img"
            (itoa (setq i (1+ i))))
          30 10 nil))
      (dcl:end-cluster))
    (dcl:end-cluster)
    (dcl:hr 0.08)
    (dcl:paging t))
  (dcl:dialog-end-ok-cancel)
  "3. Control åˆ›å»ºæ§åˆ¶æµç¨‹"
  (defun cb-flush-page nil (set_tile "num"
      (strcat "å½“å‰é¡µé¢: "
        (itoa (1+ curr-page)))))
  (defun cb-img1 nil (sub-dialog 2 2))
  (defun cb-img2 nil (sub-dialog 3 3))
  (defun cb-img3 nil (sub-dialog 3 1))
  "4. New ä¸€ä¸ªæ–°å¯¹è¯æ¡†å¯¹è±¡ã€‚"
  (dcl:new "example")
  "5. Init åˆå§‹åŒ–å¯¹è¯æ¡†"
  (set_tile "title"
    "ä¸»çª—å£")
  (paging-init)
  (cb-flush-page)
  "6. Show dialog æ˜¾ç¤ºå¹¶è¿›è¡Œäº¤äº’"
  (dcl:show)
  (princ))
```
</details>

---

### example:dcl1

**è¯´æ˜**: MVCNIS æ³•: 6 æ­¥è¿›è¡ŒåŠ¨æ€ DCL å¼€å‘ã€‚

**ç”¨æ³•**:
```lisp
(example:dcl1 )
```

**å‚æ•°**: None

**ç¤ºä¾‹**:
```lisp
(example:dcl-dialog)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:dcl1 (/ *error* dcl-fp dcl-tmp)
  "MVCNIS æ³•: 6 æ­¥è¿›è¡ŒåŠ¨æ€ DCL å¼€å‘ã€‚"
  ""
  "(example:dcl-dialog)"
  (require (quote dcl:*))
  "1. Model å»ºç«‹æ•°æ®æ¨¡å‹ã€‚"
  "2. View å»ºç«‹æ˜¾ç¤ºè§†å›¾ã€‚"
  (dcl:dialog "example")
  (progn (dcl:hr 0.08)
    (dcl:button "btn1"
      "æŒ‰é’®1"
      "")
    (dcl:hr 0.08)
    (dcl:button "btn2"
      "æŒ‰é’®2"
      "")
    (dcl:hr 0.08))
  (dcl:dialog-end-ok-cancel)
  "3. Control åˆ›å»ºæ§åˆ¶æµç¨‹"
  (defun cb-btn1 nil (alert "æŒ‰ä¸‹äº†æŒ‰é’®1"))
  (defun cb-btn2 nil (alert "æŒ‰ä¸‹äº†æŒ‰é’®2"))
  "4. New ä¸€ä¸ªæ–°å¯¹è¯æ¡†å¯¹è±¡ã€‚"
  (dcl:new "example")
  "5. Init åˆå§‹åŒ–å¯¹è¯æ¡†"
  (set_tile "title"
    "dclç¤ºä¾‹1")
  "6. Show dialog æ˜¾ç¤ºå¹¶è¿›è¡Œäº¤äº’"
  (dcl:show)
  (princ))
```
</details>

---

### example:error-exit

**è¯´æ˜**: å‡½æ•°é”™è¯¯å¤„ç†æ–¹æ¡ˆç¤ºä¾‹ *error* å®šä¹‰ç§æœ‰å‡½æ•°ï¼Œéš”ç»å…¬å…±åŸŸ *error* ï¼Œä½¿ä¹‹ä¸ç”¨é‡å®šä¹‰ã€‚å‚æ•° para .ä¸º t æ—¶æ‰§è¡Œæ­£å¸¸æµç¨‹ï¼Œä¸º nil æ—¶ï¼Œæ‰§è¡Œé”™è¯¯å¤„ç†æµç¨‹ã€‚

**ç”¨æ³•**:
```lisp
(example:error-exit para)
```

**å‚æ•°**: 1 para  : æœªè¯†åˆ«å®šä¹‰;

**ç¤ºä¾‹**:
```lisp
(example:error-exit nil)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:error-exit (para / *error*)
  "å‡½æ•°é”™è¯¯å¤„ç†æ–¹æ¡ˆç¤ºä¾‹ *error* å®šä¹‰ç§æœ‰å‡½æ•°ï¼Œéš”ç»å…¬å…±åŸŸ *error* ï¼Œä½¿ä¹‹ä¸ç”¨é‡å®šä¹‰ã€‚\nå‚æ•° para .ä¸º t æ—¶æ‰§è¡Œæ­£å¸¸æµç¨‹ï¼Œä¸º nil æ—¶ï¼Œæ‰§è¡Œé”™è¯¯å¤„ç†æµç¨‹ã€‚"
  ""
  "(example:error-exit nil)"
  (defun *error* (msg)
    "å½“å¼‚å¸¸é€€å‡ºæ—¶ï¼Œæ­£å¸¸æµç¨‹æ²¡æœ‰å…³é—­æ–‡ä»¶æŒ‡é’ˆï¼Œåœ¨è¿™é‡Œå…³é—­"
    (if (= (quote file)
        (type fp))
      (progn (princ "å…³é—­å‡ºé”™æ—¶çš„æ–‡ä»¶å¥æœ¬æŸ„ã€‚\n")
        (close fp)))
    (princ "å½“å¼‚å¸¸é€€å‡ºæ—¶ï¼Œè®¾ç½®çš„å˜é‡æ²¡æœ‰æ¢å¤ï¼Œåœ¨è¿™é‡Œæ¢å¤")
    (pop-var)
    (princ "æ˜¾ç¤ºæ¢å¤çš„å˜é‡å€¼ï¼š")
    (princ (getvar "osmode"))
    (princ "\n")
    "ä»¥ä¸Šä¸ºä½ ä¸“ç”¨çš„å¤„ç†è¿‡ç¨‹"
    "ä¸‹é¢æ˜¯ atlisp å¸¸ç”¨é”™è¯¯å¤„ç†è¿‡ç¨‹"
    (@:*error* msg)
    (princ))
  "è®¾ç½®å½“å‰è¿è¡Œçš„å‡½æ•°åï¼Œå½“å‡ºé”™æ—¶ç»™å‡ºä¿¡æ¯ã€‚"
  (setq *funname* (quote example:error-exit))
  (princ "æ˜¾ç¤ºå˜é‡åŸå€¼ï¼š")
  (princ (getvar "osmode"))
  (princ "\n")
  (push-var)
  "ä¿®æ”¹å˜é‡"
  (setvar "osmode"
    0)
  (princ "æ˜¾ç¤ºä¿®æ”¹åçš„å˜é‡å€¼ï¼š")
  (princ (getvar "osmode"))
  (princ "\n")
  (setq fp (open (findfile "acad.pgp")
      "r"))
  (read-line fp)
  (if (null para)
    (progn "è¿™æ˜¯ä¸€ä¸ªæœªå®šä¹‰çš„å‡½æ•°ã€‚åœ¨è¿™é‡Œå¼‚å¸¸é€€å‡º."
      (mmma)))
  (princ "æ­£å¸¸çš„æµç¨‹,å…³é—­æ–‡ä»¶å¥æŸ„ï¼Œæ¢å¤å˜é‡ã€‚")
  (close fp)
  (pop-var)
  (princ "æ˜¾ç¤ºæ¢å¤çš„å˜é‡å€¼ï¼š")
  (princ (getvar "osmode"))
  (princ "\n")
  (princ))
```
</details>

---

### example:grread

**è¯´æ˜**: grread ç¼–ç¨‹ç¤ºä¾‹ï¼Œå½“æŒ‰ä¸‹é”®ç›˜æ—¶ï¼Œå¼¹çª—æç¤ºæŒ‰çš„ä»€ä¹ˆé”®ï¼Œå¦åˆ™æ˜¾ç¤ºå…‰æ ‡çš„åæ ‡

**ç”¨æ³•**:
```lisp
(example:grread )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:grread (/ flag r)
  "grread ç¼–ç¨‹ç¤ºä¾‹ï¼Œå½“æŒ‰ä¸‹é”®ç›˜æ—¶ï¼Œå¼¹çª—æç¤ºæŒ‰çš„ä»€ä¹ˆé”®ï¼Œå¦åˆ™æ˜¾ç¤ºå…‰æ ‡çš„åæ ‡"
  (setq r 100.0)
  (setq flag t)
  (while flag (setq gr (grread t 16))
    "å¤„ç†è¾“å…¥"
    (cond ((= 2 (car gr))
        "æŒ‰ä¸‹äº†é”®ç›˜æŒ‰é”®"
        (cond ((= "x"
              (chr (cadr gr)))
            (alert (strcat "æŒ‰ä¸‹äº†"
                (chr (cadr gr))))
            "è®¾ç½®æ¡ä»¶é€€å‡ºå¾ªç¯"
            (setq flag nil))
          ((= "S"
              (strcase (chr (cadr gr))))
            "ä»¥ä¸‹è¿›è¡Œ æŒ‰äº† Sçš„åå¤„ç†ç¨‹åº"
            (setq r (cdr (assoc "åŠå¾„"
                  (ui:input "è®¾ç½®"
                    (list (list "åŠå¾„"
                        r)))))))
          ((= "C"
              (strcase (chr (cadr gr))))
            "ä»¥ä¸‹è¿›è¡Œ æŒ‰äº† C çš„åå¤„ç†ç¨‹åº-ç”»åœ†"
            (entity:make-circle (cadr (grread t 0))
              r))
          (t (alert (vl-prin1-to-string gr)))))
      ((= 3 (car gr))
        "æŒ‰ä¸‹é¼ æ ‡å·¦é”®"
        (alert "click left"))
      ((or (= 25 (car gr))
          (= 11 (car gr)))
        "æŒ‰ä¸‹é¼ æ ‡å³é”®"
        (alert "click right"))
      ((= 5 (car gr))
        "ç§»åŠ¨é¼ æ ‡"
        (princ "å½“å‰å…‰æ ‡çš„åæ ‡: ")
        (princ gr))
      (t "å…¶å®ƒæƒ…å†µ"
        (princ gr)))
    (princ "\nè¾“å…¥[ é€€å‡ºx | è®¾ç½®s | ç”»åœ†c ]"))
  (princ))
```
</details>

---

### example:multi-platform

**è¯´æ˜**: å¤šå¹³å°å¼€å‘ç¤ºä¾‹ï¼Œå¦‚æœä½ å¸Œæœ›ä½ çš„ä»£ç èƒ½åœ¨å¤šç§CADå¹³å°ï¼ˆå¦‚autocad,æµ©è¾°CAD,ä¸­æœ›CADç­‰ï¼‰ä¸Šè¿è¡Œã€‚å› ä¸ºå…¼å®¹æ€§é—®é¢˜ï¼Œéœ€è¦å¤„ç†ä¸€äº›ç‰¹æ®Šçš„ä»£ç æ®µã€‚ä»¥é€‚åº”ä¸åŒçš„å¹³å°

**ç”¨æ³•**:
```lisp
(example:multi-platform )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:multi-platform (/ *error*)
  "å¤šå¹³å°å¼€å‘ç¤ºä¾‹ï¼Œå¦‚æœä½ å¸Œæœ›ä½ çš„ä»£ç èƒ½åœ¨å¤šç§CADå¹³å°ï¼ˆå¦‚autocad,æµ©è¾°CAD,ä¸­æœ›CADç­‰ï¼‰ä¸Šè¿è¡Œã€‚å› ä¸ºå…¼å®¹æ€§é—®é¢˜ï¼Œéœ€è¦å¤„ç†ä¸€äº›ç‰¹æ®Šçš„ä»£ç æ®µã€‚ä»¥é€‚åº”ä¸åŒçš„å¹³å°"
  ""
  ""
  "atlisp æä¾›ç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œä»£ç å¦‚ä¸‹ã€‚"
  (cond (is-gcad "è¿™é‡Œç¼–å†™æµ©è¾°CADçš„å¤„ç†è¿‡ç¨‹"
      (alert "è¿™æ˜¯æµ©è¾°CAD")
      (cond ((= "R21.2"
            (getvar "gcadver"))
          "æµ©è¾°ä¸åŒç‰ˆæœ¬çš„åŒºåˆ«å¤„ç†"
          (alert "è¿™æ˜¯æµ©è¾°CAD-v1"))
        ((= "R20.1"
            (getvar "gcadver"))
          "æµ©è¾°ä¸åŒç‰ˆæœ¬çš„åŒºåˆ«å¤„ç†"
          (alert "è¿™æ˜¯æµ©è¾°CAD-v2"))))
    (is-zwcad "è¿™é‡Œç¼–å†™ä¸­æœ›CADçš„å¤„ç†è¿‡ç¨‹"
      (alert "è¿™æ˜¯ä¸­æœ›CAD"))
    (t "AutoCAD çš„å¤„ç†è¿‡ç¨‹"
      (alert "è¿™æ˜¯AutoCAD"))))
```
</details>

---

### example:prev-var

**è¯´æ˜**: ä¸Šæ¬¡è¾“å…¥çš„å€¼ä½œä¸ºé»˜è®¤å€¼çš„ç¤ºä¾‹

**ç”¨æ³•**:
```lisp
(example:prev-var )
```

**å‚æ•°**: æ²¡æœ‰

**ç¤ºä¾‹**:
```lisp
(example:prev-var)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:prev-var (/ k)
  "ä¸Šæ¬¡è¾“å…¥çš„å€¼ä½œä¸ºé»˜è®¤å€¼çš„ç¤ºä¾‹"
  ""
  "(example:prev-var)"
  (if (not (and prev-var (p:stringp prev-var)))
    (setq prev-var "D"))
  (initget "A W V D S B")
  (if (setq k (getkword (strcat "ä½ç½®[A åœ¨æ–‡å­—å·¦è¾¹,W åœ¨æ³¨è§£å·¦è¾¹,V åœ¨æ”¹æ¨¡æ–‡å­—å·¦è¾¹,D åœ¨æ–‡å­—å³è¾¹,S æ‰‹åŠ¨æ·»åŠ ,B åœ¨æ¨¡å…·BOMåºå·å·¦è¾¹]<"
          (if (and prev-var (p:stringp prev-var))
            prev-var "D")
          ">:")))
    (setq prev-var k))
  prev-var)
```
</details>

---

### example:sort

**è¯´æ˜**: æ’åºç¤ºä¾‹.ç”¨äºæ¼”ç¤º vl-sort è‡ªå®šä¹‰æ’åºå‡½æ•°çš„ä»£ç ã€‚n1 n2 è¡¨ç¤º åˆ—è¡¨å†…ä»»æ„ä¸¤ä¸ªæ•°ï¼Œlambda å¯¹è¿™ä¸¤ä¸ªæ•°è¿›è¡Œæ¯”è¾ƒã€‚æ ¹æ®æ¯”è¾ƒç»“æœè¿›è¡Œæ’åºã€‚

**ç”¨æ³•**:
```lisp
(example:sort )
```

**å‚æ•°**: None

**è¿”å›å€¼**: å¶æ•°ä»å¤§åˆ°å°ï¼Œå¥‡æ•°ä»å°åˆ°å¤§,å¶æ•°åœ¨å‰

**ç¤ºä¾‹**:
```lisp
(example:sort) => (8 6 4 2 0 1 3 5 7 9)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun example:sort nil "æ’åºç¤ºä¾‹.ç”¨äºæ¼”ç¤º vl-sort è‡ªå®šä¹‰æ’åºå‡½æ•°çš„ä»£ç ã€‚n1 n2 è¡¨ç¤º åˆ—è¡¨å†…ä»»æ„ä¸¤ä¸ªæ•°ï¼Œlambda å¯¹è¿™ä¸¤ä¸ªæ•°è¿›è¡Œæ¯”è¾ƒã€‚æ ¹æ®æ¯”è¾ƒç»“æœè¿›è¡Œæ’åºã€‚"
  "å¶æ•°ä»å¤§åˆ°å°ï¼Œå¥‡æ•°ä»å°åˆ°å¤§,å¶æ•°åœ¨å‰"
  "(example:sort)
  => (8 6 4 2 0 1 3 5 7 9)"
  (vl-sort (list 1 2 4 5 6 7 8 9 0 3)
    (function (lambda (n1 n2)
        (if (= 0 (rem n1 2))
          (progn "å‰è€…ä¸ºå¶æ—¶"
            (if (= 0 (rem n2 2))
              (progn "å¦‚æœåè€…ä¹Ÿä¸ºå¶ï¼Œæ¯”å¤§å°"
                (> n1 n2))
              (progn "å¦‚æœåè€…ä¸ä¸ºå¶ï¼Œä¿æŒ"
                t)))
          (progn "å‰è€…ä¸ºå¥‡çš„æƒ…å†µ"
            (if (/= 0 (rem n2 2))
              (progn "å¦‚æœåè€…ä¹Ÿä¸ºå¥‡ï¼Œ å°æ•°åœ¨å‰"
                (< n1 n2))
              (progn "åè€…ä¸ä¸ºå¥‡ï¼Œæ¢ä½"
                nil))))))))
```
</details>

---

## excel

**æ¨¡å—è¯´æ˜**: Excelæ–‡ä»¶è¯»å†™ã€æ•°æ®å¤„ç†

### excel:aci->eci

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:aci->eci (color / tmp)
  "å°†cadé¢œè‰²ç´¢å¼•è½¬æ¢ä¸ºexcelé¢œè‰²ç´¢å¼•\nå‚æ•°:Color:cadé¢œè‰²ç´¢å¼•"
  "excelé¢œè‰²ç´¢å¼•"
  "(excel:ACI->ECI 2)"
  (if (setq tmp (vl-remove-if-not (quote (lambda (x)
            (= (cadr x)
              color)))
        *xls-color*))
    (caar tmp)
    0))
```
</details>

---

### excel:aci->truecolor

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:aci->truecolor (aci)
  "å°†cadé¢œè‰²ç´¢å¼•è½¬æ¢ä¸ºçœŸå½©è‰²å€¼\nå‚æ•°:aci:cadé¢œè‰²ç´¢å¼•"
  "çœŸå½©è‰²å€¼"
  "(excel:ACI->Truecolor)"
  (excel:eci->truecolor (excel:aci->eci aci)))
```
</details>

---

### excel:add-sheet

**è¯´æ˜**: æ·»åŠ ä¸ªå·¥ä½œè¡¨å‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡å‚æ•°:Name:å·¥ä½œè¡¨å

**ç”¨æ³•**:
```lisp
(excel:add-sheet xlapp name)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;2 name  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: æˆåŠŸè¿”å›t

**ç¤ºä¾‹**:
```lisp
(excel:add-sheet exobj "123")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:add-sheet (xlapp name / rtn)
  "æ·»åŠ ä¸ªå·¥ä½œè¡¨\nå‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡\nå‚æ•°:Name:å·¥ä½œè¡¨å"
  "æˆåŠŸè¿”å›t"
  "(excel:add-sheet exobj \"123\")"
  (if (member name (excel:sheets xlapp))
    (setq rtn nil)
    (progn (vlax-put-property (vlax-invoke (vlax-get-property xlapp "sheets")
          "Add")
        "name"
        name)
      (setq rtn (equal (excel:get-activesheet xlapp)
          name))))
  rtn)
```
</details>

---

### excel:delete-sheet

**è¯´æ˜**: è¯´æ˜:åˆ é™¤å·¥ä½œè¡¨å‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡å‚æ•°:Name:å·¥ä½œè¡¨å

**ç”¨æ³•**:
```lisp
(excel:delete-sheet xlapp name)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;2 name  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: æˆåŠŸè¿”å›t

**ç¤ºä¾‹**:
```lisp
(excel:deleteSheet exobj "123")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:delete-sheet (xlapp name / old rtn sh)
  "è¯´æ˜:åˆ é™¤å·¥ä½œè¡¨\nå‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡\nå‚æ•°:Name:å·¥ä½œè¡¨å"
  "æˆåŠŸè¿”å›t"
  "(excel:deleteSheet exobj \"123\")"
  (setq rtn (excel:sheets xlapp)
    old (vlax-get-property xlapp "DisplayAlerts"))
  (vlax-put-property xlapp "DisplayAlerts"
    0)
  (vlax-for sh (vlax-get-property xlapp "sheets")
    (if (= (vlax-get-property sh "Name")
        name)
      (vlax-invoke-method sh "Delete")))
  (vlax-put-property xlapp "DisplayAlerts"
    old)
  (not (equal rtn (excel:sheets xlapp))))
```
</details>

---

### excel:eci->aci

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:eci->aci (color / tmp)
  "å°†excelé¢œè‰²ç´¢å¼•è½¬æ¢ä¸ºcadé¢œè‰²ç´¢å¼•\nå‚æ•°:Color:excelé¢œè‰²ç´¢å¼•"
  "cadé¢œè‰²ç´¢å¼•"
  "(Excel:ECI->ACI 6)"
  (cond ((setq tmp (assoc color *xls-color*))
      (cadr tmp))
    (t 256)))
```
</details>

---

### excel:eci->truecolor

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:eci->truecolor (color / tmp)
  "å°†excelé¢œè‰²ç´¢å¼•è½¬æ¢ä¸ºçœŸå½©è‰²å€¼\nå‚æ•°:Color:excelé¢œè‰²ç´¢å¼•"
  "çœŸå½©è‰²å€¼"
  "(excel:ECI->Truecolor 6)"
  (cond ((setq tmp (assoc color *xls-color*))
      (caddr tmp))
    (t 16711935)))
```
</details>

---

### excel:get-activesheet

**è¯´æ˜**: è·å–å½“å‰å·¥ä½œè¡¨çš„åå­—å‚æ•°:XLApp:æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡

**ç”¨æ³•**:
```lisp
(excel:get-activesheet xlapp)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: åå­—å­—ç¬¦ä¸²

**ç¤ºä¾‹**:
```lisp
(excel:getActiveSheet exobj)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:get-activesheet (xlapp)
  "è·å–å½“å‰å·¥ä½œè¡¨çš„åå­—\nå‚æ•°:XLApp:æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡"
  "åå­—å­—ç¬¦ä¸²"
  "(excel:getActiveSheet exobj)"
  (vlax-get-property (vlax-get-property (vlax-get-property xlapp (quote activeworkbook))
      (quote activesheet))
    (quote name)))
```
</details>

---

### excel:get-backcolor

**è¯´æ˜**: è·å–å……å¡«è‰²å‚æ•°:xlapp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡å‚æ•°:index:åŒºåŸŸç´¢å¼•ï¼ŒA1å¼•ç”¨æ ¼å¼æˆ–è€…è¡Œåˆ—è¡¨

**ç”¨æ³•**:
```lisp
(excel:get-backcolor xlapp index)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;2 index  : ç´¢å¼•å€¼;

**è¿”å›å€¼**: é¢œè‰²ç´¢å¼•å­—ç¬¦ä¸² 0-56 å·

**ç¤ºä¾‹**:
```lisp
(excel:get-Backcolor exobj "A1")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:get-backcolor (xlapp index)
  "è·å–å……å¡«è‰²\nå‚æ•°:xlapp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡\nå‚æ•°:index:åŒºåŸŸç´¢å¼•ï¼ŒA1å¼•ç”¨æ ¼å¼æˆ–è€…è¡Œåˆ—è¡¨"
  "é¢œè‰²ç´¢å¼•å­—ç¬¦ä¸² 0-56 å·"
  "(excel:get-Backcolor exobj \"A1\")"
  (excel:utils-getvalue (vlax-get-property (vlax-get-property (excel:get-range xlapp index)
        (quote interior))
      (quote colorindex))))
```
</details>

---

### excel:get-mergeindex

**è¯´æ˜**: è·å–åˆå¹¶å•å…ƒæ ¼çš„ç´¢å¼•å‚æ•°:xlapp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡å‚æ•°:index:åŒºåŸŸç´¢å¼•ï¼ŒA1å¼•ç”¨æ ¼å¼æˆ–è€…è¡Œåˆ—è¡¨

**ç”¨æ³•**:
```lisp
(excel:get-mergeindex xlapp index)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;2 index  : ç´¢å¼•å€¼;

**è¿”å›å€¼**: A1æ ¼å¼çš„ç´¢å¼•

**ç¤ºä¾‹**:
```lisp
(Excel:get-MergeIndex)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:get-mergeindex (xlapp index / rtn)
  "è·å–åˆå¹¶å•å…ƒæ ¼çš„ç´¢å¼•\nå‚æ•°:xlapp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡\nå‚æ•°:index:åŒºåŸŸç´¢å¼•ï¼ŒA1å¼•ç”¨æ ¼å¼æˆ–è€…è¡Œåˆ—è¡¨"
  "A1æ ¼å¼çš„ç´¢å¼•"
  "(Excel:get-MergeIndex)"
  (if (excel:range-mergep xlapp index)
    (progn (vlax-invoke-method (excel:get-range xlapp index)
        (quote select))
      (setq rtn (excel:get-selection xlapp))))
  rtn)
```
</details>

---

### excel:get-property

**è¯´æ˜**: æ£€ç´¢ VLA å¯¹è±¡çš„ç‰¹æ€§å‚æ•°:obj:vlaå¯¹è±¡å‚æ•°:prop:ç¬¦å·æˆ–å­—ç¬¦ä¸²ï¼Œæ ‡è¯†è¦æ£€ç´¢çš„ç‰¹æ€§ï¼Œå­—ç¬¦ä¸²çš„æ—¶å€™å¯ä»¥ç›´æ¥è°ƒç”¨å¤šçº§ç‰¹æ€§ï¼š"Rows.Count"

**ç”¨æ³•**:
```lisp
(excel:get-property obj prop)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;2 prop  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: ç‰¹æ€§çš„å€¼

**ç¤ºä¾‹**:
```lisp
(excel:get-property range "MergeArea.Rows.Count")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:get-property (obj prop / rtn)
  "æ£€ç´¢ VLA å¯¹è±¡çš„ç‰¹æ€§\nå‚æ•°:obj:vlaå¯¹è±¡\nå‚æ•°:prop:ç¬¦å·æˆ–å­—ç¬¦ä¸²ï¼Œæ ‡è¯†è¦æ£€ç´¢çš„ç‰¹æ€§ï¼Œå­—ç¬¦ä¸²çš„æ—¶å€™å¯ä»¥ç›´æ¥è°ƒç”¨å¤šçº§ç‰¹æ€§ï¼š\"Rows.Count\""
  "ç‰¹æ€§çš„å€¼"
  "(excel:get-property range \"MergeArea.Rows.Count\")"
  (cond ((= (type prop)
        (quote sym))
      (setq rtn (vlax-get-property obj prop)))
    ((= (type prop)
        (quote str))
      (if (null (vl-string-search "."
            prop))
        (setq rtn (vlax-get-property obj prop))
        (foreach item (bf-str->lst prop ".")
          (if (null rtn)
            (setq rtn (vlax-get-property obj item))
            (setq rtn (vlax-get-property rtn item)))))))
  rtn)
```
</details>

---

### excel:get-range

**è¯´æ˜**: è¯´æ˜:æ ¹æ®ç´¢å¼•è·å–rangeå¯¹è±¡å‚æ•°:xlapp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡å‚æ•°:index:åŒºåŸŸç´¢å¼•ï¼ŒA1å¼•ç”¨æ ¼å¼æˆ–è€…è¡Œåˆ—è¡¨

**ç”¨æ³•**:
```lisp
(excel:get-range xlapp index)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;2 index  : ç´¢å¼•å€¼;

**è¿”å›å€¼**: rangeå¯¹è±¡

**ç¤ºä¾‹**:
```lisp
(excel:get-Range exobj "A1")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:get-range (xlapp index)
  "è¯´æ˜:æ ¹æ®ç´¢å¼•è·å–rangeå¯¹è±¡\nå‚æ•°:xlapp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡\nå‚æ•°:index:åŒºåŸŸç´¢å¼•ï¼ŒA1å¼•ç”¨æ ¼å¼æˆ–è€…è¡Œåˆ—è¡¨"
  "rangeå¯¹è±¡"
  "(excel:get-Range exobj \"A1\")"
  (vlax-get-property (vlax-get-property (vlax-get-property xlapp (quote activeworkbook))
      (quote activesheet))
    (quote range)
    (excel:utils-index-cells->range index)))
```
</details>

---

### excel:get-rangeindex

**è¯´æ˜**: è·å–rangeçš„ç´¢å¼•å‚æ•°:range:rangeå¯¹è±¡

**ç”¨æ³•**:
```lisp
(excel:get-rangeindex range)
```

**å‚æ•°**: 1 range  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: A1æ ¼å¼çš„ç´¢å¼•

**ç¤ºä¾‹**:
```lisp
(excel:get-RangeIndex xlrange)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:get-rangeindex (range / str col row dx dy)
  "è·å–rangeçš„ç´¢å¼•\nå‚æ•°:range:rangeå¯¹è±¡"
  "A1æ ¼å¼çš„ç´¢å¼•"
  "(excel:get-RangeIndex xlrange)"
  (if (equal (excel:get-property range "mergecells")
      :vlax-true)
    (setq str "MergeArea.")
    (setq str ""))
  (setq dx (excel:get-property range (strcat str "Rows.Count"))
    dy (excel:get-property range (strcat str "Columns.Count"))
    row (excel:get-property range (strcat str "Row"))
    col (excel:get-property range (strcat str "Column")))
  (excel:utils-index-cells->range (list row col (1- (+ row dx))
      (1- (+ col dy)))))
```
</details>

---

### excel:get-rangevalue

**è¯´æ˜**: è·å–å•å…ƒæ ¼æˆ–åŒºåŸŸçš„å€¼å‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡å‚æ•°:index:ä½ç½®ä¿¡æ¯ï¼Œå¦‚"A1"æˆ–è€…'(1 1), "A1:B2"æˆ–è€…'(1 1 2 2)

**ç”¨æ³•**:
```lisp
(excel:get-rangevalue xlapp index)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;2 index  : ç´¢å¼•å€¼;

**è¿”å›å€¼**: å€¼çš„åˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(excel:get-RangeValue exobj "A1:B2")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:get-rangevalue (xlapp index)
  "è·å–å•å…ƒæ ¼æˆ–åŒºåŸŸçš„å€¼\nå‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡\nå‚æ•°:index:ä½ç½®ä¿¡æ¯ï¼Œå¦‚\"A1\"æˆ–è€…'(1 1), \"A1:B2\"æˆ–è€…'(1 1 2 2)"
  "å€¼çš„åˆ—è¡¨"
  "(excel:get-RangeValue exobj \"A1:B2\")"
  (excel:utils-getvalue (vlax-get-property (excel:get-range xlapp index)
      (quote value2))))
```
</details>

---

### excel:get-selection

**è¯´æ˜**: è·å–é€‰æ‹©åŒºåŸŸçš„ç´¢å¼•å‚æ•°:xlapp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡

**ç”¨æ³•**:
```lisp
(excel:get-selection xlapp)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: A1æ ¼å¼çš„ç´¢å¼•

**ç¤ºä¾‹**:
```lisp
(excel:get-Selection exobj)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:get-selection (xlapp)
  "è·å–é€‰æ‹©åŒºåŸŸçš„ç´¢å¼•\nå‚æ•°:xlapp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡"
  "A1æ ¼å¼çš„ç´¢å¼•"
  "(excel:get-Selection exobj)"
  (excel:get-rangeindex (vlax-get-property xlapp (quote selection))))
```
</details>

---

### excel:get-usedrange

**è¯´æ˜**: è·å–å·²ä½¿ç”¨çš„rangeåŒºåŸŸå‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡å‚æ•°:Name:å·¥ä½œè¡¨å

**ç”¨æ³•**:
```lisp
(excel:get-usedrange xlapp name)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;2 name  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: æˆåŠŸè¿”å›rangeå¯¹è±¡

**ç¤ºä¾‹**:
```lisp
(excel:get-UsedRange exobj "345")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:get-usedrange (xlapp name / rtn sh)
  "è·å–å·²ä½¿ç”¨çš„rangeåŒºåŸŸ\nå‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡\nå‚æ•°:Name:å·¥ä½œè¡¨å"
  "æˆåŠŸè¿”å›rangeå¯¹è±¡"
  "(excel:get-UsedRange exobj \"345\")"
  (if (null name)
    (setq name (excel:get-activesheet xlapp)))
  (vlax-for sh (vlax-get-property xlapp "sheets")
    (if (= (vlax-get-property sh "Name")
        name)
      (setq rtn (vlax-get-property sh "UsedRange"))))
  rtn)
```
</details>

---

### excel:merge-range

**è¯´æ˜**: åˆå¹¶å•å…ƒæ ¼å‚æ•°:xlapp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡å‚æ•°:index:åŒºåŸŸç´¢å¼•ï¼ŒA1å¼•ç”¨æ ¼å¼æˆ–è€…è¡Œåˆ—è¡¨

**ç”¨æ³•**:
```lisp
(excel:merge-range xlapp index)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;2 index  : ç´¢å¼•å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:merge-range (xlapp index / range)
  "åˆå¹¶å•å…ƒæ ¼\nå‚æ•°:xlapp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡\nå‚æ•°:index:åŒºåŸŸç´¢å¼•ï¼ŒA1å¼•ç”¨æ ¼å¼æˆ–è€…è¡Œåˆ—è¡¨"
  (vlax-invoke-method (excel:get-range xlapp (excel:utils-index-cells->range index))
    (quote merge))
  (excel:get-range xlapp index))
```
</details>

---

### excel:new

**è¯´æ˜**: æ–°å»ºExcelå·¥ä½œç°¿å‚æ•°:ishide:æ˜¯å¦å¯è§ï¼Œtä¸ºå¯è§ï¼Œnilä¸ºä¸å¯è§

**ç”¨æ³•**:
```lisp
(excel:new ishide)
```

**å‚æ•°**: 1 ishide  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: ä¸€ä¸ªè¡¨ç¤ºExcelå·¥ä½œç°¿çš„vlaå¯¹è±¡

**ç¤ºä¾‹**:
```lisp
(excel:New t)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:new (ishide / rtn)
  "æ–°å»ºExcelå·¥ä½œç°¿\nå‚æ•°:ishide:æ˜¯å¦å¯è§ï¼Œtä¸ºå¯è§ï¼Œnilä¸ºä¸å¯è§"
  "ä¸€ä¸ªè¡¨ç¤ºExcelå·¥ä½œç°¿çš„vlaå¯¹è±¡"
  "(excel:New t)"
  (if (setq rtn (vlax-get-or-create-object "Excel.Application"))
    (progn (vlax-invoke (vlax-get-property rtn (quote workbooks))
        (quote add))
      (if ishide (vla-put-visible rtn 1)
        (vla-put-visible rtn 0))))
  rtn)
```
</details>

---

### excel:open

**è¯´æ˜**: æ‰“å¼€ä¸€ä¸ªexcelæ–‡ä»¶å‚æ•°:Filename:æ–‡ä»¶è·¯å¾„å‚æ•°:ishide:æ˜¯å¦å¯è§ï¼Œtä¸ºå¯è§ï¼Œnilä¸ºä¸å¯è§

**ç”¨æ³•**:
```lisp
(excel:open filename ishide)
```

**å‚æ•°**: 1 filename  : æ–‡ä»¶å;2 ishide  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: ä¸€ä¸ªè¡¨ç¤ºæ‰“å¼€çš„excelæ–‡ä»¶çš„vlaå¯¹è±¡

**ç¤ºä¾‹**:
```lisp
(excel:open "C:\Users\mimi\Desktop\1.xlsx" t)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:open (filename ishide / activesheet excelapp rtn sheets worksheet)
  "æ‰“å¼€ä¸€ä¸ªexcelæ–‡ä»¶\nå‚æ•°:Filename:æ–‡ä»¶è·¯å¾„\nå‚æ•°:ishide:æ˜¯å¦å¯è§ï¼Œtä¸ºå¯è§ï¼Œnilä¸ºä¸å¯è§"
  "ä¸€ä¸ªè¡¨ç¤ºæ‰“å¼€çš„excelæ–‡ä»¶çš„vlaå¯¹è±¡"
  "(excel:open \"C:\\Users\\mimi\\Desktop\\1.xlsx\"
    t)"
  (if (and (findfile filename)
      (setq rtn (vlax-get-or-create-object "Excel.Application")))
    (progn (vlax-invoke (vlax-get-property rtn (quote workbooks))
        (quote open)
        filename)
      (if ishide (vla-put-visible rtn 1)
        (vla-put-visible rtn 0))))
  rtn)
```
</details>

---

### excel:quit

**è¯´æ˜**: é€€å‡ºexcelå‚æ•°:ExlObj:æ‰“å¼€çš„excelå¯¹è±¡å‚æ•°:SaveYN:æ˜¯å¦ä¿å­˜ï¼Œtä¸ºä¿å­˜ï¼Œnilä¸ºä¸ä¿å­˜

**ç”¨æ³•**:
```lisp
(excel:quit exlobj saveyn)
```

**å‚æ•°**: 1 exlobj  : æœªæ˜ç¡®å®šä¹‰;2 saveyn  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:quit (exlobj saveyn)
  "é€€å‡ºexcel\nå‚æ•°:ExlObj:æ‰“å¼€çš„excelå¯¹è±¡\nå‚æ•°:SaveYN:æ˜¯å¦ä¿å­˜ï¼Œtä¸ºä¿å­˜ï¼Œnilä¸ºä¸ä¿å­˜"
  (if saveyn (vlax-invoke (vlax-get-property exlobj "ActiveWorkbook")
      (quote close))
    (vlax-invoke (vlax-get-property exlobj "ActiveWorkbook")
      (quote close)
      :vlax-false))
  (vlax-invoke exlobj (quote quit))
  (vlax-release-object exlobj)
  (setq exlobj nil)
  (gc))
```
</details>

---

### excel:quit-all

**è¯´æ˜**: é€€å‡ºæ‰€æœ‰æ‰“å¼€çš„excelæ–‡ä»¶å‚æ•°:SaveYN:æ˜¯å¦ä¿å­˜

**ç”¨æ³•**:
```lisp
(excel:quit-all saveyn)
```

**å‚æ•°**: 1 saveyn  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:quit-all (saveyn / exlobj)
  "é€€å‡ºæ‰€æœ‰æ‰“å¼€çš„excelæ–‡ä»¶\nå‚æ•°:SaveYN:æ˜¯å¦ä¿å­˜"
  (while (setq exlobj (vlax-get-object "Excel.Application"))
    (excel:quit exlobj saveyn)))
```
</details>

---

### excel:range-mergep

**è¯´æ˜**: åˆ¤æ–­æ˜¯å¦æ˜¯åˆå¹¶å•å…ƒæ ¼å‚æ•°:xlapp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡å‚æ•°:index:åŒºåŸŸç´¢å¼•ï¼ŒA1å¼•ç”¨æ ¼å¼æˆ–è€…è¡Œåˆ—è¡¨

**ç”¨æ³•**:
```lisp
(excel:range-mergep xlapp index)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;2 index  : ç´¢å¼•å€¼;

**è¿”å›å€¼**: æ˜¯ï¼Œè¿”å›tï¼Œå¦ï¼Œè¿”å›nil

**ç¤ºä¾‹**:
```lisp
(excel:Range-Mergep exobj "A1")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:range-mergep (xlapp index)
  "åˆ¤æ–­æ˜¯å¦æ˜¯åˆå¹¶å•å…ƒæ ¼\nå‚æ•°:xlapp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡\nå‚æ•°:index:åŒºåŸŸç´¢å¼•ï¼ŒA1å¼•ç”¨æ ¼å¼æˆ–è€…è¡Œåˆ—è¡¨"
  "æ˜¯ï¼Œè¿”å›tï¼Œå¦ï¼Œè¿”å›nil"
  "(excel:Range-Mergep exobj \"A1\")"
  (equal (vlax-variant-value (vlax-get-property (excel:get-range xlapp (excel:utils-index-cells->range index))
        (quote mergecells)))
    :vlax-true))
```
</details>

---

### excel:rename-sheet

**è¯´æ˜**: è¯´æ˜:é‡å‘½åå·¥ä½œè¡¨å‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡å‚æ•°:Old:å·¥ä½œè¡¨åŸåå‚æ•°:New:å·¥ä½œè¡¨æ–°å

**ç”¨æ³•**:
```lisp
(excel:rename-sheet xlapp old new)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;2 old  : æœªæ˜ç¡®å®šä¹‰;3 new  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: æˆåŠŸè¿”å›t

**ç¤ºä¾‹**:
```lisp
(excel:rename-Sheet  exobj "123" "345")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:rename-sheet (xlapp old new / rtn sh)
  "è¯´æ˜:é‡å‘½åå·¥ä½œè¡¨\nå‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡\nå‚æ•°:Old:å·¥ä½œè¡¨åŸå\nå‚æ•°:New:å·¥ä½œè¡¨æ–°å"
  "æˆåŠŸè¿”å›t"
  "(excel:rename-Sheet  exobj \"123\"
    \"345\")"
  (if (null old)
    (setq old (excel:get-activesheet xlapp)))
  (if (member new (excel:sheets xlapp))
    (setq rtn nil)
    (progn (vlax-for sh (vlax-get-property xlapp "sheets")
        (if (= (vlax-get-property sh (quote name))
            old)
          (vlax-put-property sh (quote name)
            new)))
      (setq rtn (equal new (excel:get-activesheet xlapp)))))
  rtn)
```
</details>

---

### excel:save

**è¯´æ˜**: ä¿å­˜å½“å‰å·¥ä½œç°¿å‚æ•°:xlsApp:å½“å‰å·¥ä½œç°¿å¯¹è±¡

**ç”¨æ³•**:
```lisp
(excel:save xlsapp)
```

**å‚æ•°**: 1 xlsapp  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: æ­£ç¡®ä¿å­˜åº”è¯¥è¿”å›tï¼Œé”™è¯¯è¿”å›nil

**ç¤ºä¾‹**:
```lisp
(excel:save xlsobj)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:save (xlsapp)
  "ä¿å­˜å½“å‰å·¥ä½œç°¿\nå‚æ•°:xlsApp:å½“å‰å·¥ä½œç°¿å¯¹è±¡"
  "æ­£ç¡®ä¿å­˜åº”è¯¥è¿”å›tï¼Œé”™è¯¯è¿”å›nil"
  "(excel:save xlsobj)"
  (equal (vlax-invoke-method (vlax-get-property xlsapp "ActiveWorkbook")
      "Save")
    :vlax-true))
```
</details>

---

### excel:saveas

**è¯´æ˜**: å¦å­˜ä¸ºexcelæ–‡ä»¶å‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡å‚æ•°:Filename:å¦å­˜ä¸ºçš„æ–‡ä»¶è·¯å¾„

**ç”¨æ³•**:
```lisp
(excel:saveas xlapp filename)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;2 filename  : æ–‡ä»¶å;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:saveas (xlapp filename)
  "å¦å­˜ä¸ºexcelæ–‡ä»¶\nå‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡\nå‚æ•°:Filename:å¦å­˜ä¸ºçš„æ–‡ä»¶è·¯å¾„"
  (vlax-invoke (vlax-get-property xlapp "ActiveWorkbook")
    "SaveAs"
    filename))
```
</details>

---

### excel:set-activesheet

**è¯´æ˜**: è®¾ç½®æ´»åŠ¨å·¥ä½œè¡¨å‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡å‚æ•°:Name:å·¥ä½œè¡¨å

**ç”¨æ³•**:
```lisp
(excel:set-activesheet xlapp name)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;2 name  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: æˆåŠŸè¿”å›t

**ç¤ºä¾‹**:
```lisp
(excel:set-ActiveSheet exobj "123")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:set-activesheet (xlapp name / sh)
  "è®¾ç½®æ´»åŠ¨å·¥ä½œè¡¨\nå‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡\nå‚æ•°:Name:å·¥ä½œè¡¨å"
  "æˆåŠŸè¿”å›t"
  "(excel:set-ActiveSheet exobj \"123\")"
  (if (member name (excel:sheets xlapp))
    (vlax-for sh (vlax-get-property xlapp "sheets")
      (if (= (vlax-get-property sh "Name")
          name)
        (vlax-invoke-method sh "Activate"))))
  (equal (excel:get-activesheet xlapp)
    name))
```
</details>

---

### excel:set-backcolor

**è¯´æ˜**: è®¾ç½®å……å¡«è‰²å‚æ•°:xlapp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡å‚æ•°:index:åŒºåŸŸç´¢å¼•ï¼ŒA1å¼•ç”¨æ ¼å¼æˆ–è€…è¡Œåˆ—è¡¨å‚æ•°:colorindex:é¢œè‰²ç´¢å¼•0-56å·

**ç”¨æ³•**:
```lisp
(excel:set-backcolor xlapp index colorindex)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;2 index  : ç´¢å¼•å€¼;3 colorindex  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:set-backcolor (xlapp index colorindex)
  "è®¾ç½®å……å¡«è‰²\nå‚æ•°:xlapp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡\nå‚æ•°:index:åŒºåŸŸç´¢å¼•ï¼ŒA1å¼•ç”¨æ ¼å¼æˆ–è€…è¡Œåˆ—è¡¨\nå‚æ•°:colorindex:é¢œè‰²ç´¢å¼•0-56å·"
  (vlax-put-property (vlax-get-property (excel:get-range xlapp index)
      (quote interior))
    (quote colorindex)
    colorindex))
```
</details>

---

### excel:set-rangevalue

**è¯´æ˜**: è®¾ç½®å•å…ƒæ ¼æˆ–åŒºåŸŸçš„å€¼å‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡å‚æ•°:index:ä½ç½®ä¿¡æ¯ï¼Œå¦‚"A1"æˆ–è€…'(1 1), "A1:B2"æˆ–è€…'(1 1 2 2)å‚æ•°:value:è¦è®¾ç½®çš„å€¼åˆ—è¡¨æˆ–è€…å­—ç¬¦ä¸²/æ•°å­—ç­‰

**ç”¨æ³•**:
```lisp
(excel:set-rangevalue xlapp index value)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;2 index  : ç´¢å¼•å€¼;3 value  : å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:set-rangevalue (xlapp index value / range)
  "è®¾ç½®å•å…ƒæ ¼æˆ–åŒºåŸŸçš„å€¼\nå‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡\nå‚æ•°:index:ä½ç½®ä¿¡æ¯ï¼Œå¦‚\"A1\"æˆ–è€…'(1 1), \"A1:B2\"æˆ–è€…'(1 1 2 2)\nå‚æ•°:value:è¦è®¾ç½®çš„å€¼åˆ—è¡¨æˆ–è€…å­—ç¬¦ä¸²/æ•°å­—ç­‰"
  (setq range (excel:get-range xlapp index))
  (if (= (quote list)
      (type value))
    (progn (vlax-for it range (vlax-put-property it (quote value2)
          (car value))
        (setq value (cdr value))))
    (progn (vlax-for it range (vlax-put-property it (quote value2)
          value)))))
```
</details>

---

### excel:sheets

**è¯´æ˜**: è·å–å·¥ä½œè¡¨åˆ—è¡¨å‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡

**ç”¨æ³•**:
```lisp
(excel:sheets xlapp)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: å·¥ä½œè¡¨ååˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(excel:sheets exobj)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:sheets (xlapp / rtn sh)
  "è·å–å·¥ä½œè¡¨åˆ—è¡¨\nå‚æ•°:XLApp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡"
  "å·¥ä½œè¡¨ååˆ—è¡¨"
  "(excel:sheets exobj)"
  (vlax-for sh (vlax-get-property xlapp "sheets")
    (setq rtn (cons (vlax-get-property sh "Name")
        rtn)))
  (reverse rtn))
```
</details>

---

### excel:unmerge-range

**è¯´æ˜**: åˆ†è§£åˆå¹¶å•å…ƒæ ¼å‚æ•°:xlapp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡å‚æ•°:index:åŒºåŸŸç´¢å¼•ï¼ŒA1å¼•ç”¨æ ¼å¼æˆ–è€…è¡Œåˆ—è¡¨

**ç”¨æ³•**:
```lisp
(excel:unmerge-range xlapp index)
```

**å‚æ•°**: 1 xlapp  : æœªæ˜ç¡®å®šä¹‰;2 index  : ç´¢å¼•å€¼;

**è¿”å›å€¼**: åˆ†è§£åçš„rangeå¯¹è±¡

**ç¤ºä¾‹**:
```lisp
(excel:UnmergeRange exobj "A1")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:unmerge-range (xlapp index / rtn)
  "åˆ†è§£åˆå¹¶å•å…ƒæ ¼\nå‚æ•°:xlapp:å·²æ‰“å¼€çš„excelæ–‡ä»¶å¯¹è±¡\nå‚æ•°:index:åŒºåŸŸç´¢å¼•ï¼ŒA1å¼•ç”¨æ ¼å¼æˆ–è€…è¡Œåˆ—è¡¨"
  "åˆ†è§£åçš„rangeå¯¹è±¡"
  "(excel:UnmergeRange exobj \"A1\")"
  (setq index (excel:utils-index-cells->range index))
  (if (excel:range-mergep xlapp index)
    (progn (vlax-invoke-method (excel:get-range xlapp index)
        (quote unmerge))
      (setq rtn (excel:get-range xlapp index))))
  rtn)
```
</details>

---

### excel:utils-getvalue

**è¯´æ˜**: è¯´æ˜:å·¥å…·å‡½æ•°ï¼Œè·å–å˜ä½“çš„å€¼å‚æ•°:var:å˜ä½“

**ç”¨æ³•**:
```lisp
(excel:utils-getvalue var)
```

**å‚æ•°**: 1 var  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: å€¼åˆ—è¡¨ï¼Œå…¶ä¸­æ•°å­—å…¨éƒ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²

**ç¤ºä¾‹**:
```lisp
(excel:Utils-GetValue obj)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:utils-getvalue (var)
  "è¯´æ˜:å·¥å…·å‡½æ•°ï¼Œè·å–å˜ä½“çš„å€¼\nå‚æ•°:var:å˜ä½“"
  "å€¼åˆ—è¡¨ï¼Œå…¶ä¸­æ•°å­—å…¨éƒ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²"
  "(excel:Utils-GetValue obj)"
  (cond ((= (quote list)
        (type var))
      (mapcar (quote excel:utils-getvalue)
        var))
    ((= (quote variant)
        (type var))
      (excel:utils-getvalue (vlax-variant-value (if (member (vlax-variant-type var)
              (quote (5 4 3 2)))
            (setq var (vlax-variant-change-type var vlax-vbstring))
            var))))
    ((= (quote safearray)
        (type var))
      (mapcar (quote excel:utils-getvalue)
        (vlax-safearray->list var)))
    (t var)))
```
</details>

---

### excel:utils-index-cells->range

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:utils-index-cells->range (lst / num->col)
  "è¯´æ˜:å·¥å…·å‡½æ•°ï¼Œå°†è¡Œå·ã€åˆ—æ ‡è¡¨è½¬æ¢æˆA1æ ¼å¼çš„å¼•ç”¨\nå‚æ•°:lst:è¡Œå·ã€åˆ—æ ‡è¡¨ï¼Œåˆ—æœ€å¤šæ”¯æŒåˆ°ZZåˆ—"
  "A1æ ¼å¼çš„å¼•ç”¨"
  "(Excel:Utils-index-cells->range '(1 2 3 4))"
  (defun num->col (n)
    (if (< n 27)
      (chr (+ 64 n))
      (strcat (num->col (/ (1- n)
            26))
        (num->col (1+ (rem (1- n)
              26))))))
  (if (= (quote list)
      (type lst))
    (cond ((= 2 (length lst))
        (strcat (num->col (cadr lst))
          (itoa (car lst))))
      ((= 4 (length lst))
        (strcat (num->col (cadr lst))
          (itoa (car lst))
          ":"
          (num->col (last lst))
          (itoa (caddr lst))))
      (t "A1"))
    lst))
```
</details>

---

### excel:utils-index-offset

**è¯´æ˜**: æ ¹æ®è¡Œåˆ—åç§»é‡è®¡ç®—å•å…ƒæ ¼ç´¢å¼•å‚æ•°:BaseCellId:åŸºç¡€å•å…ƒæ ¼ç´¢å¼•ï¼Œå¯ä»¥ä¸ºA1å¼•ç”¨æ ¼å¼æˆ–è€…è¡Œåˆ—æ•°å­—åˆ—è¡¨å‚æ•°:rowOffset:è¡Œåç§»é‡å‚æ•°:columnOffset:åˆ—åç§»é‡

**ç”¨æ³•**:
```lisp
(excel:utils-index-offset basecellid rowoffset columnoffset)
```

**å‚æ•°**: 1 basecellid  : æœªæ˜ç¡®å®šä¹‰;2 rowoffset  : æœªæ˜ç¡®å®šä¹‰;3 columnoffset  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: A1æ ¼å¼çš„å•å…ƒæ ¼ç´¢å¼•

**ç¤ºä¾‹**:
```lisp
(excel:Utils-index-offset "A1" 2 3)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:utils-index-offset (basecellid rowoffset columnoffset)
  "æ ¹æ®è¡Œåˆ—åç§»é‡è®¡ç®—å•å…ƒæ ¼ç´¢å¼•\nå‚æ•°:BaseCellId:åŸºç¡€å•å…ƒæ ¼ç´¢å¼•ï¼Œå¯ä»¥ä¸ºA1å¼•ç”¨æ ¼å¼æˆ–è€…è¡Œåˆ—æ•°å­—åˆ—è¡¨\nå‚æ•°:rowOffset:è¡Œåç§»é‡\nå‚æ•°:columnOffset:åˆ—åç§»é‡"
  "A1æ ¼å¼çš„å•å…ƒæ ¼ç´¢å¼•"
  "(excel:Utils-index-offset \"A1\"
    2 3)"
  (if (= (quote str)
      (type basecellid))
    (setq basecellid (excel:utils-index-range->cells basecellid)))
  (excel:utils-index-cells->range (mapcar (quote +)
      basecellid (list rowoffset columnoffset))))
```
</details>

---

### excel:utils-index-range->cells

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun excel:utils-index-range->cells (var / index str->list)
  "å·¥å…·å‡½æ•°ï¼Œå°†A1æ ¼å¼çš„å¼•ç”¨è½¬æ¢æˆè¡Œå·ã€åˆ—æ ‡è¡¨\nå‚æ•°:var:A1æ ¼å¼çš„å­—ç¬¦ä¸²"
  "è¡Œå·ã€åˆ—æ ‡è¡¨"
  "(excel:Utils-index-range->cells \"DD23:EE44\")"
  (defun str->list (str)
    (list (read (vl-list->string (vl-remove-if-not (quote (lambda (x)
                (<= 48 x 57)))
            (vl-string->list str))))
      ((lambda (f)
          (f (reverse (vl-remove-if (quote (lambda (x)
                    (<= 48 x 57)))
                (vl-string->list str)))))
        (lambda (l)
          (if l (+ (* 26 (f (cdr l)))
              (- (car l)
                64))
            0)))))
  (if (setq index (vl-string-position 58 var))
    (append (str->list (substr var 1 index))
      (str->list (substr var (+ 2 index))))
    (str->list var)))
```
</details>

---

## ext

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### ext:anchor-hiddenfun

**è¯´æ˜**: æ˜¾åŒ–AutoCAD éšè—çš„å‡½æ•°, fun éšè—å‡½æ•°åï¼›prefix æ˜¾åŒ–å‡½æ•°çš„å‰ç¼€.

**ç”¨æ³•**:
```lisp
(ext:anchor-hiddenfun fun prefix)
```

**å‚æ•°**: 1 fun  : æœªè¯†åˆ«å®šä¹‰;2 prefix  : æœªè¯†åˆ«å®šä¹‰;

**ç¤ºä¾‹**:
```lisp
(ext:anchor-hiddenfun 'beep 'at-)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ext:anchor-hiddenfun (fun prefix / dat file fo len fun1)
  "æ˜¾åŒ–AutoCAD éšè—çš„å‡½æ•°, fun éšè—å‡½æ•°åï¼›prefix æ˜¾åŒ–å‡½æ•°çš„å‰ç¼€."
  ""
  "(ext:anchor-hiddenfun 'beep 'at-)"
  (if (= (type fun)
      (quote sym))
    (setq fun (strcase (vl-symbol-name fun)
        t)))
  (cond ((null prefix)
      (setq prefix ""))
    ((= (type prefix)
        (quote sym))
      (setq prefix (strcase (vl-symbol-name prefix)
          t)))
    ((/= (quote str)
        (type prefix))
      (setq prefix ""))
    (t (setq prefix "")))
  (setq fun1 (strcat prefix fun))
  (setq len (+ (strlen fun)
      (strlen fun1)
      28))
  (setq file (strcat @:*prefix* ".cache\\"
      FUN ".fas"))
  (SETQ DAT (APPEND (QUOTE (13 266 32))
      (VL-STRING->LIST "fas4-file ; do not change it!")
      (QUOTE (13 266 49 13 266 49 32 36 32 36))
      (QUOTE (13 266))
      (VL-STRING->LIST (ITOA LEN))
      (QUOTE (32 52 32 36 20 1 1 1 256 219))
      (VL-STRING->LIST FUN1)
      (QUOTE (256 256 214))
      (VL-STRING->LIST FUN)
      (QUOTE (256 256 1 67 256 256 2 256 266 266 131 1 256 160 134 256 256 1 22 36 59))
      (VL-STRING->LIST "@lisp")))
  (IF (SETQ FO (OPEN FILE "w"))
    (PROGN (FOREACH X DAT (WRITE-CHAR X FO))
      (CLOSE FO)
      (LOAD FILE)
      (EVAL (READ FUN)))
    (PRINC (STRCAT "manifest faile."))))
```
</details>

---

### ext:interior

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ext:interior (fun / out lst-int ifun)
  "æ˜¾åŒ–å†…éƒ¨ç¬¦å·æˆ–å‡½æ•°ã€‚"
  "subr"
  "(ext:interior 'beep)"
  (cond 
   ((listp fun)
    (foreach x fun (ext:interior x)))
   ((atom fun)
    (if (= (type fun) 'sym)(setq fun (strcase (vl-symbol-name fun) t)))
    (if (= 'subr (type (eval (read fun))))
  (eval(read fun))
      (progn
  (setq out (strcat @:*prefix* ".cache" (chr 92) "interior-"
        (filename:replace-special fun)
        ".fas"))
  (if (findfile out)
      (load out)
    (progn
      (setq lst-int
      (append  (vl-string->list "\r\n FAS4-FILE ; Do not change it!\r\n")
         '(49 13 49 32 36 7 36 13 )
         (vl-string->list (itoa (+ 26 (* 2 (strlen fun)))))
         (list 32 50 32 36 20 1 1 1 0 86)
         (vl-string->list fun)
         (list 0 0 91 )
         (vl-string->list (vl-string-subst "-" "." fun))
         (list 0 0 1 67 0 0 2 0 10 3 0 0 11 6 1 0 22 36)
         (vl-string->list "\n;@lisp https://atlisp.cn")
         ))
      (file:list-to-stream out lst-int)
      (load out))))))))
```
</details>

---

### ext:interior-fun

**è¯´æ˜**: è°ƒç”¨å†…éƒ¨å‡½æ•°ã€‚

**ç”¨æ³•**:
```lisp
(ext:interior-fun fun)
```

**å‚æ•°**: 1 fun  : å‡½æ•°å;

**è¿”å›å€¼**: Subr

**ç¤ºä¾‹**:
```lisp
((ext:interior-fun 'beep) 523 200)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ext:interior-fun (fun / out lst-int ifun)
  "è°ƒç”¨å†…éƒ¨å‡½æ•°ã€‚"
  "subr"
  "((ext:interior-fun 'beep) 523 200)"
  (if (= (type fun) 'sym)(setq fun (strcase (vl-symbol-name fun) t)))
  (if (= 'subr (type (eval (read fun))))
      (eval(read fun))
    (progn
      (setq out (strcat @:*prefix* ".cache" (chr 92) "interior-"
      (filename:replace-special fun)
      ".fas"))
      (if (findfile out)
    (load out)
  (progn
    (setq lst-int
    (append  (vl-string->list "\r\n FAS4-FILE ; Do not change it!\r\n")
       '(49 13 49 32 36 7 36 13 )
       (vl-string->list (itoa (+ 26 (* 2 (strlen fun)))))
       (list 32 50 32 36 20 1 1 1 0 86)
       (vl-string->list fun)
       (list 0 0 91 )
       (vl-string->list (vl-string-subst "-" "." fun))
       (list 0 0 1 67 0 0 2 0 10 3 0 0 11 6 1 0 22 36)
       (vl-string->list "\n;@lisp https://atlisp.cn")
       ))
    (file:list-to-stream out lst-int)
    (load out))))))
```
</details>

---

### ext:probe-fun

**è¯´æ˜**: æ¢æµ‹å‡½æ•°çš„å‚æ•°ä¸ªæ•°(æœ€å°)åŠå‚æ•°ç±»å‹ã€‚

**ç”¨æ³•**:
```lisp
(ext:probe-fun fun)
```

**å‚æ•°**: 1 fun  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: expr or nil

**ç¤ºä¾‹**:
```lisp
(ext:probe-fun 'boole)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ext:probe-fun (fun / args iter iter-depth)
  "æ¢æµ‹å‡½æ•°çš„å‚æ•°ä¸ªæ•°(æœ€å°)åŠå‚æ•°ç±»å‹ã€‚"
  "expr or nil"
  "(ext:probe-fun 'boole)"
  (setq args (quote nil))
  (setq iter-depth 0)
  (setq str "string"
    intnum (fix 5)
    num 3.14 ent (entity:make-circle (quote (0 0 0))
      100)
    vlaobj (e2o ent)
    ss (ssadd ent)
    pt (quote (1 1 0)))
  (defun get-type (x)
    (cond ((listp x)
        (cond ((equal x (quote (1 1 0)))
            (quote point))
          (t (quote lst))))
      (t (type x))))
  (defun iter nil (setq iter-depth (1+ iter-depth))
    (if (and (vl-catch-all-error-p (setq errobj (vl-catch-all-apply fun (reverse args))))
        (setq errmsg (vl-catch-all-error-message errobj)))
      (if (< iter-depth 100)
        (cond ((wcmatch errmsg "*å‚æ•°å¤ªå°‘*")
            (setq args (cons (read (strcat "arg"
                    (itoa (length args))))
                args))
            (iter))
          ((wcmatch errmsg "å‚æ•°ç±»å‹é”™è¯¯*")
            (@:log "INFO"
              errmsg)
            (setq typeerr (string:to-list errmsg "
                "))
            (@:log "INFO"
              (vl-prin1-to-string typeerr))
            (cond ((wcmatch (cadr typeerr)
                  "stringp*")
                (setq args (subst str (read (last typeerr))
                    args)))
              ((wcmatch (cadr typeerr)
                  "listp*")
                (setq args (subst (quote (l i s t))
                    (read (last typeerr))
                    args)))
              ((wcmatch (cadr typeerr)
                  "numberp*")
                (setq args (subst num (read (last typeerr))
                    args)))
              ((wcmatch (cadr typeerr)
                  "fixnump*")
                (setq args (subst intnum (read (last typeerr))
                    args)))
              ((wcmatch (cadr typeerr)
                  "lselsetp*")
                (setq args (subst ss (read (last typeerr))
                    args)))
              ((wcmatch (cadr typeerr)
                  "lentity*")
                (setq args (subst ent (read (last typeerr))
                    args)))
              ((wcmatch (cadr typeerr)
                  "VLA-OBJECT*")
                (setq args (subst vlaobj (read (last typeerr))
                    args)))
              ((wcmatch (cadr typeerr)
                  "äºŒç»´/ä¸‰ç»´ç‚¹*")
                (setq args (subst pt (read (last typeerr))
                    args))))
            (iter))
          ((wcmatch errmsg "no function definition*")
            (setq args (subst (quote princ)
                (read (caddr typeerr))
                args))
            (iter))
          (t (princ errmsg)
            (princ "
               near completed \n")
            (cons fun (mapcar (quote get-type)
                (reverse args))))))
      (progn (princ "probe completed!\n")
        (cons fun (mapcar (quote get-type)
            (reverse args))))))
  (iter))
```
</details>

---

## file

**æ¨¡å—è¯´æ˜**: æ–‡ä»¶æ“ä½œã€è¯»å†™å¤„ç†

### file:list-to-stream

**ç”¨æ³•**:
```lisp
(file:list-to-stream out_file intlist)
```

**å‚æ•°**: 1 out_file  : æœªæ˜ç¡®å®šä¹‰;  2 intlist  : æ•´æ•°;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun file:list-to-stream (out_file intlist / adodb)
    (setq intlist (vlax-make-variant (vlax-safearray-fill (vlax-make-safearray 17 (cons 0 (1- (length intlist))))
                intlist)
            8209))
    (setq adodb (vlax-get-or-create-object "adodb.stream"))
    (vlax-put-property adodb (quote type)
        1)
    (vlax-invoke adodb (quote open))
    (vlax-put adodb (quote position)
        0)
    (vlax-invoke-method adodb (quote write)
        intlist)
    (vlax-invoke adodb (quote savetofile)
        out_file 2)
    (and adodb (vlax-invoke adodb (quote close)))
    (and adodb (vlax-release-object adodb))
    (princ))
```
</details>

---

### file:merge

**è¯´æ˜**: åˆå¹¶å¤šä¸ªæ–‡ä»¶å†…å®¹åˆ° dist æ–‡ä»¶ä¸­ã€‚

**ç”¨æ³•**:
```lisp
(file:merge dist lst-files)
```

**å‚æ•°**: 1 dist  : æœªè¯†åˆ«å®šä¹‰;2 lst-files  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun file:merge (dist lst-files / fp-out fp-in ln)
  "åˆå¹¶å¤šä¸ªæ–‡ä»¶å†…å®¹åˆ° dist æ–‡ä»¶ä¸­ã€‚"
  (if (and (getvar "lispsys")
      (> (getvar "lispssy")
        0))
    (setq fp-out (open dist "w"
        "utf8"))
    (setq fp-out (open dist "w")))
  (foreach file% lst-files (if (findfile file%)
      (progn (setq fp-in (open file% "r"))
        (while (setq ln (read-line fp-in))
          (write-line ln fp-out))
        (close fp-in))))
  (close fp-out))
```
</details>

---

### file:parse-ini

**è¯´æ˜**: è§£æ ini æ–‡ä»¶ã€‚

**ç”¨æ³•**:
```lisp
(file:parse-ini filename)
```

**å‚æ•°**: 1 filename  : æ–‡ä»¶å;

**è¿”å›å€¼**: list

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun file:parse-ini (filename / fp result *error*)
  "è§£æ ini æ–‡ä»¶ã€‚"
  "list"
  (defun *error* (msg)
    (if (= (quote file)
        (type fp))
      (close fp))
    (@:*error* msg))
  (setq fp (open filename "r"))
  (setq result (quote nil))
  (setq sub (quote nil))
  (while (setq str-line (read-line fp))
    (setq str-line (car (string:parse-by-lst (vl-string-trim "
            "
            str-line)
          (quote (";"
              "#")))))
    (cond ((= 91 (ascii str-line))
        (if sub (setq result (cons (reverse sub)
              result)))
        (setq sub (cons str-line nil)))
      ((setq a&v (string:to-list str-line "="))
        (setq sub (cons (cons (car a&v)
              (cadr a&v))
            sub)))
      (t (prompt (strcat "parse error "
            str-line)))))
  (if sub (setq result (cons (reverse sub)
        result)))
  (close fp)
  (reverse result))
```
</details>

---

### file:read-stream

**è¯´æ˜**: è¯»å…¥æŒ‡å®šç¼–ç çš„æ–‡ä»¶å†…å®¹

**ç”¨æ³•**:
```lisp
(file:read-stream filename encoding)
```

**å‚æ•°**: 1 filename  : æ–‡ä»¶å;2 encoding  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: String

**ç¤ºä¾‹**:
```lisp
(file:read-stream "d:\hzfile.txt" "utf-8")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun file:read-stream (filename encoding / str stream *error*)
  "è¯»å…¥æŒ‡å®šç¼–ç çš„æ–‡ä»¶å†…å®¹"
  "String"
  "(file:read-stream \"d:\\hzfile.txt\"
    \"utf-8\")"
  (defun *error* (msg)
    (if (= (quote file)
        (type stream))
      (close stream))
    (princ msg)
    (princ))
  (if (>= (atof (getvar "acadver"))
      24)
    (progn (setq stream (open filename "r"))
      (setq str "")
      (while (setq str-line (read-line stream))
        (setq str (strcat str "\n"
            str-line)))
      (close stream))
    (progn (setq stream (vlax-create-object "ADODB.Stream"))
      (vlax-put-property stream (quote type)
        2)
      (vlax-put-property stream (quote charset)
        encoding)
      (vlax-invoke stream (quote open))
      (vlax-invoke-method stream (quote loadfromfile)
        filename)
      (setq str (vlax-invoke-method stream (quote readtext)
          -1))
      (vlax-invoke-method stream (quote close))
      (vlax-release-object stream)))
  str)
```
</details>

---

### file:remove-lines

**è¯´æ˜**: åˆ é™¤æ–‡ä»¶ file ä¸­ æŸå‡ è¡Œçš„å†…å®¹ï¼Œæˆ–å†…å®¹ä¸º lines çš„è¡Œ

**ç”¨æ³•**:
```lisp
(file:remove-lines file lines)
```

**å‚æ•°**: 1 file  : æ–‡ä»¶å;2 lines  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun file:remove-lines (file lines / tmpfp)
  "åˆ é™¤æ–‡ä»¶ file ä¸­ æŸå‡ è¡Œçš„å†…å®¹ï¼Œæˆ–å†…å®¹ä¸º lines çš„è¡Œ"
  (if (atom lines)
    (setq lines (list lines)))
  (if (findfile file)
    (progn (setq fp (open file "r"))
      (setq tmpfp (open (setq tmpfile (vl-filename-mktemp))
          "w"))
      (setq n 0)
      (while (setq content (read-line fp))
        (setq n (1+ n))
        (if (not (or (member n lines)
              (member content lines)))
          (write-line content tmpfp)))
      (close fp)
      (close tmpfp)
      (vl-file-delete file)
      (vl-file-rename tmpfile file))
    (princ "Not found file"))
  (princ))
```
</details>

---

### file:subst-all

**è¯´æ˜**: æ›¿æ¢æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²ã€‚

**ç”¨æ³•**:
```lisp
(file:subst-all newstr oldstr lspfile new-suffix)
```

**å‚æ•°**: 1 newstr  : æœªæ˜ç¡®å®šä¹‰;  2 oldstr  : æœªæ˜ç¡®å®šä¹‰;  3 lspfile  : æœªæ˜ç¡®å®šä¹‰;  4 new-suffix  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun file:subst-all (newstr oldstr lspfile new-suffix / newfile vf zf text)
    "æ›¿æ¢æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²ã€‚"
    (setq newfile (strcat (vl-filename-directory lspfile)
            "\\"
            (vl-filename-base lspfile)
            new-suffix (vl-filename-extension lspfile)))
    (if (findfile newfile)
        (vl-file-delete (findfile newfile)))
    (setq vf (open lspfile "r"))
    (setq zf (open newfile "w"))
    (while (setq text (read-line vf))
        (write-line (string:subst-all newstr oldstr text)
            zf))
    (close vf)
    (close zf))
```
</details>

---

## filename

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### filename:replace-special

**è¯´æ˜**: æ›¿æ¢æ–‡ä»¶åä¸­çš„ç‰¹æ®Šå­—ç¬¦

**ç”¨æ³•**:
```lisp
(filename:replace-special str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: String

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun filename:replace-special (str)
  "æ›¿æ¢æ–‡ä»¶åä¸­çš„ç‰¹æ®Šå­—ç¬¦,æœ¬å‡½æ•°åªé€‚ç”¨äºå•ä¸ªæ–‡ä»¶ï¼Œä¸é€‚ç”¨äºå¸¦ç›®å½•çš„æ–‡ä»¶åå­—ç¬¦ä¸²ã€‚"
  "String"
  "(filename:replace-special \":s->l.lsp\")"
  (foreach x '(("+" . "*")
         ("ï¼" . "/")
         ("ï¼š" . ":")
         ("ï¼›" . ";")
         ("ï½œ" . "|")
         ("ã€" . "\\")
         ("-to-" . "->")
         ("gt-" . ">")
         ("-" . "\"")
         )
     (setq str (@:string-subst
          (car x)(cdr x)
          str))))
```
</details>

---

### filename:special-symbol

**è¯´æ˜**: æ›¿æ¢æ–‡ä»¶åä¸­çš„ç‰¹æ®Šå­—ç¬¦

**ç”¨æ³•**:
```lisp
(filename:special-symbol str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: String

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun filename:special-symbol (str)
  "æ›¿æ¢æ–‡ä»¶åä¸­çš„ç‰¹æ®Šå­—ç¬¦,æœ¬å‡½æ•°åªé€‚ç”¨äºå•ä¸ªæ–‡ä»¶ï¼Œä¸é€‚ç”¨äºå¸¦ç›®å½•çš„æ–‡ä»¶åå­—ç¬¦ä¸²ã€‚"
  "String"
  "(filename:replace-special \":s->l.lsp\")"
  (foreach x '(("ï¼" . "/")
    ("ï¼š" . ":")
    ("ï¼›" . ";")
    ("ï½œ" . "|")
    ("ã€" . "\\")
    ("-to-" . "->")
    ("gt-" . ">")
    ("-" . "\"")
    )
     (setq str (@:string-subst
          (car x)(cdr x)
          str))))
```
</details>

---

## fun

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### fun:test

**è¯´æ˜**: å‡½æ•°æµ‹è¯•ï¼Œfun:å‡½æ•°åï¼Œusecases:æµ‹è¯•ç”¨ä¾‹ï¼Œæµ‹è¯•ç”¨ä¾‹ä¸ºå‚æ•°å’Œè¿”å›å€¼ç»„æˆçš„ç‚¹å¯¹è¡¨ã€‚

**ç”¨æ³•**:
```lisp
(fun:test fun usecases)
```

**å‚æ•°**: 1 fun  : æœªè¯†åˆ«å®šä¹‰;2 usecases  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: lst,å¯¹åº”æµ‹è¯•ç”¨ä¾‹çš„æµ‹è¯•ç»“æœï¼Œtä¸ºé€šè¿‡ï¼Œnilä¸ºå¤±è´¥

**ç¤ºä¾‹**:
```lisp
(fun:test point:mid '((((0 0)(2 2)) . (1 1))(((3 3)(5 5)) . (4 4))))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun fun:test (fun usecases)
  "å‡½æ•°æµ‹è¯•ï¼Œfun:å‡½æ•°åï¼Œusecases:æµ‹è¯•ç”¨ä¾‹ï¼Œæµ‹è¯•ç”¨ä¾‹ä¸ºå‚æ•°å’Œè¿”å›å€¼ç»„æˆçš„ç‚¹å¯¹è¡¨ã€‚"
  "lst,å¯¹åº”æµ‹è¯•ç”¨ä¾‹çš„æµ‹è¯•ç»“æœï¼Œtä¸ºé€šè¿‡ï¼Œnilä¸ºå¤±è´¥"
  "(fun:test point:mid '((((0 0)(2 2))
        . (1 1))(((3 3)(5 5))
        . (4 4))))"
  (mapcar (quote (lambda (x)
        (list:equal (apply (function fun)
            (car x))
          (cdr x)
          1.0e-06)))
    usecases))
```
</details>

---

## g

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### g:dot-product

**è¯´æ˜**: æ±‚ä¸¤ä¸ªå‘é‡çš„ç‚¹ç§¯ã€å†…ç§¯ã€æ ‡é‡ç§¯ã€æ•°é‡ç§¯

**ç”¨æ³•**:
```lisp
(g:dot-product v1 v2)
```

**å‚æ•°**: 1 v1  : æœªè¯†åˆ«å®šä¹‰;2 v2  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: number

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun g:dot-product (v1 v2)
  "æ±‚ä¸¤ä¸ªå‘é‡çš„ç‚¹ç§¯ã€å†…ç§¯ã€æ ‡é‡ç§¯ã€æ•°é‡ç§¯"
  "number"
  (apply (quote +)
    (mapcar (quote *)
      v1 v2)))
```
</details>

---

### g:foot-point

**è¯´æ˜**: æ±‚ç‚¹åˆ°ç›´çº¿çš„å‚è¶³çš„åæ ‡ï¼Œline ä¸ºä¸¤ç‚¹åæ ‡ç»„æˆçš„åˆ—è¡¨ï¼Œpt ä¸ºä¸€ç‚¹åæ ‡

**ç”¨æ³•**:
```lisp
(g:foot-point line pt)
```

**å‚æ•°**: 1 line  : æœªè¯†åˆ«å®šä¹‰;2 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: åæ ‡

**ç¤ºä¾‹**:
```lisp
(g:foot-point (list (getpoint)(getpoint)) (getpoint))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun g:foot-point (line pt / dis dot-product foot projection v-p v-w)
  "æ±‚ç‚¹åˆ°ç›´çº¿çš„å‚è¶³çš„åæ ‡ï¼Œline ä¸ºä¸¤ç‚¹åæ ‡ç»„æˆçš„åˆ—è¡¨ï¼Œpt ä¸ºä¸€ç‚¹åæ ‡"
  "åæ ‡"
  "(g:foot-point (list (getpoint)(getpoint))
    (getpoint))"
  (setq v-w (mapcar (quote -)
      (cadr line)
      (car line)))
  (setq v-p (mapcar (quote -)
      pt (car line)))
  (setq dot-product (g:dot-product v-w v-p))
  (setq dis (apply (quote distance)
      line))
  (setq projection (/ dot-product (expt dis 2)))
  (setq foot-point (list (+ (caar line)
        (* (car v-w)
          projection))
      (+ (cadar line)
        (* (cadr v-w)
          projection))
      (+ (caddr (car line))
        (* (caddr v-w)
          projection)))))
```
</details>

---

## geometry

**æ¨¡å—è¯´æ˜**: å‡ ä½•è®¡ç®—ã€åæ ‡å˜æ¢

### geometry:angle

**è¯´æ˜**: ç›´çº¿(çº¿æ®µ)ä¸åæ ‡è½´xyzçš„å¤¹è§’åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(geometry:angle segment)
```

**å‚æ•°**: 1 segment  : çº¿æ®µï¼Œä¸¤ç‚¹ç»„æˆçš„è¡¨ï¼Œå¯ä»¥è¡¨ç¤ºæœ‰å‘å›¾æˆ–æ— å‘å›¾çš„ä¸€ä¸ªè¾¹ã€‚;

**è¿”å›å€¼**: ä¸¤ç‚¹ç›´çº¿ä¸x y z è½´çš„å¤¹è§’(å¼§åº¦)

**ç¤ºä¾‹**:
```lisp
(geometry:angel '((0 0 0)(1 1 1)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun geometry:angle (segment / pt1 pt2 dist-o)
  "ç›´çº¿(çº¿æ®µ)ä¸åæ ‡è½´xyzçš„å¤¹è§’åˆ—è¡¨"
  "ä¸¤ç‚¹ç›´çº¿ä¸x y z è½´çš„å¤¹è§’(å¼§åº¦)"
  "(geometry:angel '((0 0 0)(1 1 1)))"
  (setq pt1 (car segment)
    pt2 (cadr segment))
  (setq dist-o (sqrt (+ (* (- (car pt2)
            (car pt1))
          (- (car pt2)
            (car pt1)))
        (* (- (cadr pt2)
            (cadr pt1))
          (- (cadr pt2)
            (cadr pt1)))
        (* (- (caddr pt2)
            (caddr pt1))
          (- (caddr pt2)
            (caddr pt1))))))
  (list (/ (- (car pt2)
        (car pt1))
      dist-o)
    (/ (- (cadr pt2)
        (cadr pt1))
      dist-o)
    (/ (- (caddr pt2)
        (caddr pt1))
      dist-o)))
```
</details>

---

### geometry:box-intersectp

**è¯´æ˜**: æµ‹è¯•ä¸¤ä¸ªç›’å­æ˜¯å¦äº¤å‰

**ç”¨æ³•**:
```lisp
(geometry:box-intersectp box1 box2)
```

**å‚æ•°**: 1 box1  : æœªæ˜ç¡®å®šä¹‰;2 box2  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: T äº¤å‰ï¼Œnil ä¸äº¤å‰

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun geometry:box-intersectp (box1 box2)
  "æµ‹è¯•ä¸¤ä¸ªç›’å­æ˜¯å¦äº¤å‰"
  "T äº¤å‰ï¼Œnil ä¸äº¤å‰"
  (not (or (< (caadr box1)
        (caar box2))
      (< (cadadr box1)
        (cadar box2))
      (> (caar box1)
        (caadr box2))
      (> (cadar box1)
        (cadadr box2)))))
```
</details>

---

### geometry:convexhull-by-graham-scan

**è¯´æ˜**: graham-scanç®—æ³•è®¡ç®—ç‚¹é›†å‡¸åŒ…å‚æ•°: pts:ç‚¹è¡¨

**ç”¨æ³•**:
```lisp
(geometry:convexhull-by-graham-scan pts)
```

**å‚æ•°**: 1 pts  : å¤šä¸ªåæ ‡ç‚¹åˆ—è¡¨;

**è¿”å›å€¼**: å‡¸åŒ…ç‚¹è¡¨

**ç¤ºä¾‹**:
```lisp
(geometry:convexhull-by-graham-scan '(pt1 pt2 pt3 ...))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun geometry:convexhull-by-graham-scan (pts / d i p0)
  "graham-scanç®—æ³•è®¡ç®—ç‚¹é›†å‡¸åŒ…\nå‚æ•°: pts:ç‚¹è¡¨"
  "å‡¸åŒ…ç‚¹è¡¨"
  "(geometry:convexhull-by-graham-scan '(pt1 pt2 pt3 ...))"
  (setq pts (vl-sort pts (quote (lambda (p1 p2)
          (cond ((< (cadr p1)
                (cadr p2)))
            ((equal (cadr p1)
                (cadr p2)
                1.0e-08)
              (< (car p1)
                (car p2))))))))
  (setq p0 (car pts))
  (setq pts (vl-sort (cdr pts)
      (function (lambda (p1 p2 / m n)
          (cond ((< (setq m (angle p1 p0))
                (setq n (angle p2 p0))))
            ((equal m n 1.0e-08)
              (< (distance p1 p0)
                (distance p2 p0))))))))
  (setq pt-hull (list (cadr pts)
      (car pts)
      p0))
  (foreach curpt (cddr pts)
    (setq pt-hull (cons curpt pt-hull))
    (while (and (caddr pt-hull)
        (> 0 (geometry:turn-right-p (caddr pt-hull)
            (cadr pt-hull)
            curpt)))
      (setq pt-hull (cons curpt (cddr pt-hull)))))
  pt-hull)
```
</details>

---

### geometry:convexhull-by-jarvis

**è¯´æ˜**: æœ€å°å‡¸åŒ…ç®—æ³•: jarvis æ­¥è¿›æ³•ï¼Œpackage wrapping or gift wrapping

**ç”¨æ³•**:
```lisp
(geometry:convexhull-by-jarvis pts)
```

**å‚æ•°**: 1 pts  : å¤šä¸ªåæ ‡ç‚¹åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun geometry:convexhull-by-jarvis (pts / pfirst p0 p1 pmax1 pmax2 pp)
  "æœ€å°å‡¸åŒ…ç®—æ³•: jarvis æ­¥è¿›æ³•ï¼Œpackage wrapping or gift wrapping"
  (cond ((= (length pts)
        0)
      nil)
    ((or nil (= (length pts)
          1)
        (= (length pts)
          2))
      (progn (alert "ä½ è¾“å…¥çš„ç‚¹ä¸ºä¸¤ç‚¹æˆ–ä¸€ç‚¹!")
        pts))
    (t (progn (defun det2 (p1 p2)
          (- (* (car p1)
              (cadr p2))
            (* (car p2)
              (cadr p1))))
        (defun det (p1 p2 p3)
          (+ (det2 p1 p2)
            (det2 p2 p3)
            (det2 p3 p1)))
        (defun sign (x)
          (cond ((> x 0)
              -1.0)
            ((< x 0)
              1.0)
            (t 0)))
        (defun ang (p1 p2 p3 / x)
          (setq x (abs (- (angle p1 p3)
                (angle p1 p2))))
          (if (equal p3 p1 1.0e-08)
            (- pi)
            (if (< (abs (sin x))
                1.0e-08)
              (if (equal (- (distance p2 p3)
                    (+ (distance p1 p2)
                      (distance p1 p3)))
                  0 1.0e-08)
                pi 0)
              (if (> x pi)
                (* (- (* 2 pi)
                    x)
                  (sign (det p2 p1 p3)))
                (* x (sign (det p2 p1 p3)))))))
        (defun maxium (pts)
          (car (vl-sort pts (quote (lambda (e1 e2)
                  (if (equal (car e1)
                      (car e2)
                      1.0e-08)
                    (> (cadr e1)
                      (cadr e2))
                    (> (car e1)
                      (car e2))))))))
        (setq p0 (maxium pts))
        (setq p1 p0 pfirst p0 p0 (list (car p0)
            (+ 1.0 (cadr p0))
            (caddr p0)))
        (setq pmax1 p1)
        (setq p1 (mapcar (quote (lambda (x)
                (list (ang p1 p0 x)
                  (distance p1 x)
                  x)))
            pts))
        (setq pmax2 (caddr (maxium p1)))
        (setq pp (cons pmax2 (list pmax1)))
        (while (not (equal pfirst pmax2 1.0e-08))
          (setq p1 (mapcar (quote (lambda (x)
                  (list (ang pmax2 pmax1 x)
                    (distance pmax2 x)
                    x)))
              (mapcar (quote caddr)
                p1)))
          (setq pmax1 pmax2)
          (setq pmax2 (caddr (maxium p1)))
          (setq pp (cons pmax2 pp)))
        (reverse (cdr pp))))))
```
</details>

---

### geometry:dist-pt-line

**è¯´æ˜**: æ±‚ç‚¹åˆ°çº¿æ®µçš„è·ç¦»

**ç”¨æ³•**:
```lisp
(geometry:dist-pt-line pt segment)
```

**å‚æ•°**: 1 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 segment  : çº¿æ®µï¼Œä¸¤ç‚¹ç»„æˆçš„è¡¨ï¼Œå¯ä»¥è¡¨ç¤ºæœ‰å‘å›¾æˆ–æ— å‘å›¾çš„ä¸€ä¸ªè¾¹ã€‚;

**è¿”å›å€¼**: number

**ç¤ºä¾‹**:
```lisp
(geometry:dist-pt-line '(0 0 0) '((1 0 0)(0 1 0)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun geometry:dist-pt-line (pt segment / an)
  "æ±‚ç‚¹åˆ°çº¿æ®µçš„è·ç¦»"
  "number"
  "(geometry:dist-pt-line '(0 0 0)
    '((1 0 0)(0 1 0)))"
  (setq an (angle (car segment)
      (cadr segment)))
  (if (setq inter1 (inters (car segment)
        (cadr segment)
        pt (polar pt (+ an (* 0.5 pi))
          1000)
        nil))
    (if (geometry:on-segment inter1 segment)
      (distance pt inter1)
      (min (distance pt (car segment))
        (distance pt (cadr segment))))))
```
</details>

---

### geometry:merge-box

**è¯´æ˜**: åˆå¹¶ä¸¤ä¸ªåŒ…å›´ç›’ï¼Œä¸ç®¡ä¸¤ä¸ªç›’å­æ˜¯å¦æœ‰é‡å ã€‚

**ç”¨æ³•**:
```lisp
(geometry:merge-box box1 box2)
```

**å‚æ•°**: 1 box1  : æœªæ˜ç¡®å®šä¹‰;2 box2  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: æ€»åŒ…å›´ç›’

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun geometry:merge-box (box1 box2 / ax1 ax2 ay1 ay2 bx1 bx2 by1 by2)
  "åˆå¹¶ä¸¤ä¸ªåŒ…å›´ç›’ï¼Œä¸ç®¡ä¸¤ä¸ªç›’å­æ˜¯å¦æœ‰é‡å ã€‚"
  "æ€»åŒ…å›´ç›’"
  (list (list (min (caar box1)
        (caar box2))
      (min (cadar box1)
        (cadar box2)))
    (list (max (caadr box1)
        (caadr box2))
      (max (cadadr box1)
        (cadadr box2)))))
```
</details>

---

### geometry:on-segment

**è¯´æ˜**: åˆ¤æ–­ä¸€ä¸ªä¸çº¿æ®µå…±çº¿çš„ç‚¹æ˜¯å¦åœ¨çº¿æ®µä¸Šã€‚

**ç”¨æ³•**:
```lisp
(geometry:on-segment pt segment)
```

**å‚æ•°**: 1 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 segment  : çº¿æ®µï¼Œä¸¤ç‚¹ç»„æˆçš„è¡¨ï¼Œå¯ä»¥è¡¨ç¤ºæœ‰å‘å›¾æˆ–æ— å‘å›¾çš„ä¸€ä¸ªè¾¹ã€‚;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun geometry:on-segment (pt segment)
  "åˆ¤æ–­ä¸€ä¸ªä¸çº¿æ®µå…±çº¿çš„ç‚¹æ˜¯å¦åœ¨çº¿æ®µä¸Šã€‚"
  (and (>= (car pt)
      (apply (quote min)
        (mapcar (quote car)
          segment)))
    (<= (car pt)
      (apply (quote max)
        (mapcar (quote car)
          segment)))
    (>= (cadr pt)
      (apply (quote min)
        (mapcar (quote cadr)
          segment)))
    (<= (cadr pt)
      (apply (quote max)
        (mapcar (quote cadr)
          segment)))))
```
</details>

---

### geometry:point-3d->2d

**ç”¨æ³•**:
```lisp
(geometry:point-3d->2d pt)
```

**å‚æ•°**: 1 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun geometry:point-3d->2d (pt)
  (cons (car pt)
    (cadr pt)))
```
</details>

---

### geometry:segment-by-line

**ç”¨æ³•**:
```lisp
(geometry:segment-by-line line)
```

**å‚æ•°**: 1 line  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun geometry:segment-by-line (line)
  (list (entity:getdxf line 10)
    (entity:getdxf line 11)))
```
</details>

---

### geometry:segment-mid

**è¯´æ˜**: æ±‚çº¿æ®µçš„ä¸­ç‚¹åæ ‡

**ç”¨æ³•**:
```lisp
(geometry:segment-mid segment)
```

**å‚æ•°**: 1 segment  : çº¿æ®µï¼Œä¸¤ç‚¹ç»„æˆçš„è¡¨ï¼Œå¯ä»¥è¡¨ç¤ºæœ‰å‘å›¾æˆ–æ— å‘å›¾çš„ä¸€ä¸ªè¾¹ã€‚;

**è¿”å›å€¼**: ä¸‰ç»´åæ ‡å€¼

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun geometry:segment-mid (segment)
  "æ±‚çº¿æ®µçš„ä¸­ç‚¹åæ ‡"
  "ä¸‰ç»´åæ ‡å€¼"
  (list (* 0.5 (+ (car (car segment))
        (car (cadr segment))))
    (* 0.5 (+ (cadr (car segment))
        (cadr (cadr segment))))
    (if (caddr (car segment))
      (* 0.5 (+ (caddr (car segment))
          (caddr (cadr segment))))
      0)))
```
</details>

---

### geometry:turn-left-p

**è¯´æ˜**: åˆ¤æ–­ä¸‰ç‚¹çš„è½¬è§’æ–¹å‘ã€‚

**ç”¨æ³•**:
```lisp
(geometry:turn-left-p pt1 pt2 pt3)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 pt3  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: é¡ºæ—¶é’ˆæ–¹å‘çš„å¤¹è§’ä¸ºæ­£å€¼ï¼Œåä¹‹ä¸ºè´Ÿ, 0ä¸ºç›´çº¿ã€‚

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun geometry:turn-left-p (pt1 pt2 pt3 / det2 det x)
  "åˆ¤æ–­ä¸‰ç‚¹çš„è½¬è§’æ–¹å‘ã€‚"
  "é¡ºæ—¶é’ˆæ–¹å‘çš„å¤¹è§’ä¸ºæ­£å€¼ï¼Œåä¹‹ä¸ºè´Ÿ, 0ä¸ºç›´çº¿ã€‚"
  (defun det2 (p1 p2)
    "çŸ¢é‡å‰ç§¯"
    (- (* (car p1)
        (cadr p2))
      (* (car p2)
        (cadr p1))))
  (defun det (p1 p2 p3)
    "å®šä¹‰ä¸‰ç‚¹çš„è¡Œåˆ—å¼,å³ä¸‰ç‚¹ä¹‹å€é¢ç§¯"
    (+ (det2 p1 p2)
      (det2 p2 p3)
      (det2 p3 p1)))
  (setq x (abs (- (angle pt1 pt3)
        (angle pt1 pt2))))
  (if (equal pt3 pt1 1.0e-08)
    (- pi)
    (if (< (abs (sin x))
        1.0e-08)
      (if (equal (- (distance pt2 pt3)
            (+ (distance pt1 pt2)
              (distance pt1 pt3)))
          0 1.0e-08)
        pi 0)
      (if (> x pi)
        (* (- (* 2 pi)
            x)
          (m:sign (det pt2 pt1 pt3)))
        (* x (m:sign (det pt2 pt1 pt3)))))))
```
</details>

---

### geometry:turn-right-p

**è¯´æ˜**: åˆ¤æ–­ä¸‰ç‚¹çš„è½¬è§’æ–¹å‘ã€‚

**ç”¨æ³•**:
```lisp
(geometry:turn-right-p pt1 pt2 pt3)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 pt3  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: é¡ºæ—¶é’ˆæ–¹å‘çš„å¤¹è§’ä¸ºæ­£å€¼ï¼Œåä¹‹ä¸ºè´Ÿ, 0ä¸ºç›´çº¿ã€‚

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun geometry:turn-right-p (pt1 pt2 pt3 / det2 det x)
  "åˆ¤æ–­ä¸‰ç‚¹çš„è½¬è§’æ–¹å‘ã€‚"
  "é¡ºæ—¶é’ˆæ–¹å‘çš„å¤¹è§’ä¸ºæ­£å€¼ï¼Œåä¹‹ä¸ºè´Ÿ, 0ä¸ºç›´çº¿ã€‚"
  (defun det2 (p1 p2)
    "çŸ¢é‡å‰ç§¯"
    (- (* (car p1)
        (cadr p2))
      (* (car p2)
        (cadr p1))))
  (defun det (p1 p2 p3)
    "å®šä¹‰ä¸‰ç‚¹çš„è¡Œåˆ—å¼,å³ä¸‰ç‚¹ä¹‹å€é¢ç§¯"
    (+ (det2 p1 p2)
      (det2 p2 p3)
      (det2 p3 p1)))
  (setq x (abs (- (angle pt1 pt3)
        (angle pt1 pt2))))
  (if (equal pt3 pt1 1.0e-08)
    (- pi)
    (if (< (abs (sin x))
        1.0e-08)
      (if (equal (- (distance pt2 pt3)
            (+ (distance pt1 pt2)
              (distance pt1 pt3)))
          0 1.0e-08)
        pi 0)
      (if (> x pi)
        (* (- (* 2 pi)
            x)
          (m:sign (det pt2 pt1 pt3)))
        (* x (m:sign (det pt2 pt1 pt3)))))))
```
</details>

---

### geometry:ucs

**ç”¨æ³•**:
```lisp
(geometry:ucs base angle1)
```

**å‚æ•°**: 1 base  : æœªæ˜ç¡®å®šä¹‰;2 angle1  : è§’åº¦å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun geometry:ucs (base angle1)
  (command ".ucs"
    base (polar base angle1 10000)
    (polar base (+ (* 0.25 pi)
        angle1)
      25000)))
```
</details>

---

### geometry:ucs-angle

**ç”¨æ³•**:
```lisp
(geometry:ucs-angle )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun geometry:ucs-angle nil (if (equal 0 (car (getvar "ucsxdir"))
      1.0e-08)
    (if (equal 1 (cadr (getvar "ucsxdir"))
        1.0e-08)
      (* 0.5 pi)
      (* 1.5 pi))
    (if (>= (cadr (getvar "ucsxdir"))
        0)
      (atan (/ (cadr (getvar "ucsxdir"))
          (car (getvar "ucsxdir"))))
      (+ pi (atan (/ (cadr (getvar "ucsxdir"))
            (car (getvar "ucsxdir"))))))))
```
</details>

---

### geometry:wcs2ucs

**ç”¨æ³•**:
```lisp
(geometry:wcs2ucs pt)
```

**å‚æ•°**: 1 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun geometry:wcs2ucs (pt)
  (m:coord-chg pt (getvar "ucsorg")
    (getvar "ucsxdir")))
```
</details>

---

## group

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### group:get-by-name

**è¯´æ˜**: è·å–ç¼–ç»„åä¸º name çš„ç¼–ç»„å¯¹è±¡ã€‚

**ç”¨æ³•**:
```lisp
(group:get-by-name name)
```

**å‚æ•°**: 1 name  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun group:get-by-name (name)
    "è·å–ç¼–ç»„åä¸º name çš„ç¼–ç»„å¯¹è±¡ã€‚"
    (vla-item *grps* name))
```
</details>

---

### group:groups-to-objlist

**è¯´æ˜**: å°†ç¼–ç»„é›†è½¬ä¸ºç¼–ç»„å¯¹è±¡åˆ—è¡¨.

**ç”¨æ³•**:
```lisp
(group:groups-to-objlist )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun group:groups-to-objlist (/ i obj-g)
    "å°†ç¼–ç»„é›†è½¬ä¸ºç¼–ç»„å¯¹è±¡åˆ—è¡¨."
    (setq i 0)
    (setq obj-g (quote nil))
    (while (< i (vla-get-count *grps*))
        (setq obj-g (cons (vla-item *grps* i)
                obj-g))
        (setq i (1+ i)))
    obj-g)
```
</details>

---

### group:list

**è¯´æ˜**: åˆ—å‡ºå›¾ä¸­çš„ç¼–ç»„å

**ç”¨æ³•**:
```lisp
(group:list )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun group:list (/ i names)
    "åˆ—å‡ºå›¾ä¸­çš„ç¼–ç»„å"
    (setq i 0)
    (setq names (quote nil))
    (while (< i (vla-get-count *grps*))
        (setq names (cons (vla-get-name (vla-item *grps* i))
                names))
        (setq i (1+ i)))
    names)
```
</details>

---

### group:make

**è¯´æ˜**: å®ä½“é›†ç¼–ç»„lst å›¾å…ƒåˆ—è¡¨ï¼Œname ç¼–ç»„å,(åŒ¿åç»„é¦–å­—ä¸º*).

**ç”¨æ³•**:
```lisp
(group:make lst name)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 name  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun group:make (lst name / groupobj)
  "å®ä½“é›†ç¼–ç»„\nlst å›¾å…ƒåˆ—è¡¨ï¼Œname ç¼–ç»„å,(åŒ¿åç»„é¦–å­—ä¸º*)."
  (setq groupobj (vla-add (vla-get-groups (vla-get-activedocument (vlax-get-acad-object)))
      name))
  (setq lst (mapcar (quote (lambda (x)
          (cond ((p:enamep x)
              (e2o x))
            (t x))))
      lst))
  (vla-appenditems groupobj (vla:list->array lst 9)))
```
</details>

---

### group:to-entlist

**è¯´æ˜**: ç¼–ç»„è½¬å›¾å…ƒåˆ—è¡¨, obj-g ä¸ºç¼–ç»„å¯¹è±¡ã€‚

**ç”¨æ³•**:
```lisp
(group:to-entlist obj-g)
```

**å‚æ•°**: 1 obj-g  : activeX å¯¹è±¡;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun group:to-entlist (obj-g / i objlst)
    "ç¼–ç»„è½¬å›¾å…ƒåˆ—è¡¨, obj-g ä¸ºç¼–ç»„å¯¹è±¡ã€‚"
    (mapcar (quote vlax-vla-object->ename)
        (group:to-objlist obj-g)))
```
</details>

---

### group:to-objlist

**è¯´æ˜**: ç¼–ç»„è½¬å›¾å…ƒå¯¹è±¡åˆ—è¡¨, obj-g ä¸ºç¼–ç»„å¯¹è±¡ã€‚

**ç”¨æ³•**:
```lisp
(group:to-objlist obj-g)
```

**å‚æ•°**: 1 obj-g  : activeX å¯¹è±¡;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun group:to-objlist (obj-g / i objlst)
    "ç¼–ç»„è½¬å›¾å…ƒå¯¹è±¡åˆ—è¡¨, obj-g ä¸ºç¼–ç»„å¯¹è±¡ã€‚"
    (setq i 0)
    (setq objlst (quote nil))
    (while (< i (vla-get-count obj-g))
        (setq objlst (cons (vla-item obj-g i)
                objlst))
        (setq i (1+ i)))
    objlst)
```
</details>

---

## hdinfo

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### hdinfo:get-cpuid

**è¯´æ˜**: è·å–CPU ID,ä¸ä¸€å®šæœ‰ç”¨ã€‚

**ç”¨æ³•**:
```lisp
(hdinfo:get-cpuid )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun hdinfo:get-cpuid (/ vlist vobj lcom lexecquery item)
  "è·å–CPU ID,ä¸ä¸€å®šæœ‰ç”¨ã€‚"
  (vl-load-com)
  (setq vlist (quote nil))
  (if (setq vobj (vlax-create-object "wbemscripting.swbemlocator"))
    (progn (setq lcom (vlax-invoke vobj (quote connectserver)
          "."
          "\\root\\cimv2"
          ""
          ""
          ""
          ""
          128 nil))
      (setq lexecquery (vlax-invoke lcom (quote execquery)
          "Select * from Win32_Processor"))
      (vlax-for item lexecquery (setq vlist (vlax-get item (quote processorid))))
      (vlax-release-object lexecquery)
      (vlax-release-object lcom)
      (vlax-release-object vobj)))
  vlist)
```
</details>

---

### hdinfo:get-hd-serial

**è¯´æ˜**: è·å–ç¡¬ç›˜åºåˆ—å·,ä¸ä¸€å®šæœ‰ç”¨ã€‚

**ç”¨æ³•**:
```lisp
(hdinfo:get-hd-serial )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun hdinfo:get-hd-serial (/ lccon lox objw ret serx sn)
  "è·å–ç¡¬ç›˜åºåˆ—å·,ä¸ä¸€å®šæœ‰ç”¨ã€‚"
  (setq serx (quote nil))
  (if (setq objw (vlax-create-object "wbemscripting.swbemlocator"))
    (progn (setq lccon (vlax-invoke objw (quote connectserver)
          "."
          "\\root\\cimv2"
          ""
          ""
          ""
          ""
          128 nil))
      (setq lox (vlax-invoke lccon (quote execquery)
          "select serialnumber,tag from win32_physicalmedia"))
      (vlax-for item lox (setq serx (cons (list (vlax-get item (quote tag))
              (vlax-get item (quote serialnumber)))
            serx)))
      (vlax-release-object lox)
      (vlax-release-object lccon)
      (vlax-release-object objw)))
  serx)
```
</details>

---

### hdinfo:get-mac

**è¯´æ˜**: è·å–macåœ°å€ï¼Œä¸ä¸€å®šæœ‰ç”¨ã€‚

**ç”¨æ³•**:
```lisp
(hdinfo:get-mac )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun hdinfo:get-mac (/ i mac s str svr wmi)
  "è·å–macåœ°å€ï¼Œä¸ä¸€å®šæœ‰ç”¨ã€‚"
  (vl-load-com)
  (setq wmi (vlax-create-object "WbemScripting.SWbemLocator"))
  (setq svr (vlax-invoke wmi (quote connectserver)))
  (setq str "Select * from Win32_NetworkAdapterConfiguration Where IPEnabled=TRUE")
  (setq mac (vlax-invoke svr (quote execquery)
      str))
  (vlax-for i mac (setq s (cons (vlax-get i (quote macaddress))
        s)))
  (vlax-release-object mac)
  (vlax-release-object svr)
  (vlax-release-object wmi)
  (car s))
```
</details>

---

## ini

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### ini:get

**è¯´æ˜**: å– ini çš„æŸé¡¹çš„å€¼ã€‚lst-ini iniæ–‡ä»¶çš„è§£æç»“æœè¡¨, node èŠ‚ ï¼Œattr å±æ€§é¡¹

**ç”¨æ³•**:
```lisp
(ini:get lst-ini node attr)
```

**å‚æ•°**: 1 lst-ini  : åˆ—è¡¨;2 node  : æœªè¯†åˆ«å®šä¹‰;3 attr  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: String

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ini:get (lst-ini node attr)
  "å– ini çš„æŸé¡¹çš„å€¼ã€‚lst-ini iniæ–‡ä»¶çš„è§£æç»“æœè¡¨, node èŠ‚ ï¼Œattr å±æ€§é¡¹"
  "String"
  (setq node (strcat "["
      (vl-string-trim "[] "
        node)
      "]"))
  (cdr (assoc attr (cdr (assoc node lst-ini)))))
```
</details>

---

### ini:parse

**è¯´æ˜**: è§£æ ini æ–‡ä»¶ã€‚

**ç”¨æ³•**:
```lisp
(ini:parse filename)
```

**å‚æ•°**: 1 filename  : æ–‡ä»¶å;

**è¿”å›å€¼**: list

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ini:parse (filename / fp result *error*)
  "è§£æ ini æ–‡ä»¶ã€‚"
  "list"
  (defun *error* (msg)
    (if (= (quote file)
        (type fp))
      (close fp))
    (@:*error* msg))
  (setq fp (open filename "r"))
  (setq result (quote nil))
  (setq sub (quote nil))
  (while (setq str-line (read-line fp))
    (setq str-line (car (string:parse-by-lst (vl-string-trim "
            "
            str-line)
          (quote (";"
              "#")))))
    (cond ((= 91 (ascii str-line))
        (if sub (setq result (cons (reverse sub)
              result)))
        (setq sub (cons (strcat "["
              (vl-string-trim "[] "
                str-line)
              "]")
            nil)))
      ((setq a&v (string:to-list str-line "="))
        (setq sub (cons (cons (car a&v)
              (cadr a&v))
            sub)))
      (t (prompt (strcat "parse error "
            str-line)))))
  (if sub (setq result (cons (reverse sub)
        result)))
  (close fp)
  (reverse result))
```
</details>

---

### ini:read

**è¯´æ˜**: è§£æ ini æ–‡ä»¶ã€‚

**ç”¨æ³•**:
```lisp
(ini:read filename)
```

**å‚æ•°**: 1 filename  : æ–‡ä»¶å;

**è¿”å›å€¼**: list

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ini:read (filename / fp result *error*)
  "è§£æ ini æ–‡ä»¶ã€‚"
  "list"
  (defun *error* (msg)
    (if (= (quote file)
        (type fp))
      (close fp))
    (@:*error* msg))
  (setq fp (open filename "r"))
  (setq result (quote nil))
  (setq sub (quote nil))
  (while (setq str-line (read-line fp))
    (setq str-line (car (string:parse-by-lst (vl-string-trim "
            "
            str-line)
          (quote (";"
              "#")))))
    (cond ((= 91 (ascii str-line))
        (if sub (setq result (cons (reverse sub)
              result)))
        (setq sub (cons (strcat "["
              (vl-string-trim "[] "
                str-line)
              "]")
            nil)))
      ((setq a&v (string:to-list str-line "="))
        (setq sub (cons (cons (car a&v)
              (cadr a&v))
            sub)))
      (t (prompt (strcat "parse error "
            str-line)))))
  (if sub (setq result (cons (reverse sub)
        result)))
  (close fp)
  (reverse result))
```
</details>

---

### ini:save

**è¯´æ˜**: ä¿å­˜ lst-ini è¡¨ åˆ° ini æ–‡ä»¶ã€‚

**ç”¨æ³•**:
```lisp
(ini:save lst-ini filename)
```

**å‚æ•°**: 1 lst-ini  : åˆ—è¡¨;2 filename  : æ–‡ä»¶å;

**è¿”å›å€¼**: T or nil

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ini:save (lst-ini filename / *error* fp)
  "ä¿å­˜ lst-ini è¡¨ åˆ° ini æ–‡ä»¶ã€‚"
  "T or nil"
  (defun *error* (msg)
    (if (= (quote file)
        (type fp))
      (close fp))
    (@:*error* msg))
  (setq fp (open filename "w"))
  (if (= (quote file)
      (type fp))
    (progn (foreach sub lst-ini (foreach item sub (cond ((and (p:stringp item)
                (/= ""
                  item))
              (write-line (strcat "["
                  (vl-string-trim "[] "
                    item)
                  "]")
                fp))
            ((and (listp item)
                (p:stringp (car item))
                (/= ""
                  (car item)))
              (write-line (strcat (vl-string-trim "
                    "
                    (car item))
                  "="
                  (if (p:stringp (cdr item))
                    (cdr item)
                    (vl-prin1-to-string (cdr item))))
                fp)))))
      (close fp)
      t)))
```
</details>

---

### ini:set

**è¯´æ˜**: è®¾ç½® ini çš„æŸé¡¹çš„å€¼ã€‚lst-ini iniæ–‡ä»¶çš„è§£æç»“æœè¡¨, node èŠ‚ ï¼Œattr å±æ€§é¡¹, value å€¼ã€‚

**ç”¨æ³•**:
```lisp
(ini:set lst-ini node attr value)
```

**å‚æ•°**: 1 lst-ini  : åˆ—è¡¨;2 node  : æœªè¯†åˆ«å®šä¹‰;3 attr  : æœªè¯†åˆ«å®šä¹‰;4 value  : å€¼;

**è¿”å›å€¼**: lst-ini

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ini:set (lst-ini node attr value / sub)
  "è®¾ç½® ini çš„æŸé¡¹çš„å€¼ã€‚lst-ini iniæ–‡ä»¶çš„è§£æç»“æœè¡¨, node èŠ‚ ï¼Œattr å±æ€§é¡¹, value å€¼ã€‚"
  "lst-ini"
  (setq node (strcat "["
      (vl-string-trim "[] "
        node)
      "]"))
  (setq sub (cdr (assoc node lst-ini)))
  (setq sub (subst (cons attr value)
      (assoc attr sub)
      sub))
  (setq lst-ini (subst (cons node sub)
      (assoc node lst-ini)
      lst-ini)))
```
</details>

---

## json

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### json:decode-json-from-string

**è¯´æ˜**: å°†jsonå­—ç¬¦ä¸²è§£ç æˆlist

**ç”¨æ³•**:
```lisp
(json:decode-json-from-string str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: list

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun json:decode-json-from-string (str)
  "å°†jsonå­—ç¬¦ä¸²è§£ç æˆlist"
  "list"
  (read (@::post (strcat (@::uri)
        "/api/decode-json")
      str)))
```
</details>

---

### json:encode-from-alist

**è¯´æ˜**: å°†å…³è”åˆ—è¡¨è½¬åŒ–ä¸ºjsonä¸²,æµ‹è¯•ç‰ˆ

**ç”¨æ³•**:
```lisp
(json:encode-from-alist lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: list

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun json:encode-from-alist (lst / lst2array)
  "å°†å…³è”åˆ—è¡¨è½¬åŒ–ä¸ºjsonä¸²,æµ‹è¯•ç‰ˆ"
  "list"
  (defun lst2array (lst)
    (strcat "["
      (string:from-list (mapcar (quote @:to-string)
          lst)
        ",")
      "]"))
  (cond ((and (listp lst)
        (not (null lst)))
      (cond ((null (vl-list-length lst))
          (strcat "{\""
            (@:to-string (car lst))
            "\"
            : \""
            (@:to-string (cdr lst))
            "\"}"))
        ((and (apply (quote and)
              (mapcar (quote listp)
                lst))
            (apply (quote and)
              (mapcar (quote (lambda (x)
                    (and (= 1 (length x))
                      (atom (car x)))))
                lst)))
          (lst2array (mapcar (quote car)
              lst)))
        ((= 1 (length lst))
          (if (listp (car lst))
            (json:encode-from-alist (car lst))
            (@:to-string (car lst))))
        ((and (>= (length lst)
              2)
            (apply (quote and)
              (mapcar (quote atom)
                lst)))
          (strcat "{\""
            (@:to-string (car lst))
            "\"
            :"
            (lst2array (cdr lst))
            "}"))
        (t (strcat "{"
            (string:from-list (mapcar (quote json:encode-from-alist)
                lst)
              ",")
            "}"))))
    ((atom lst)
      (strcat "
        "
        (@:to-string lst)
        "
        "))))
```
</details>

---

### json:encode-json-alist

**è¯´æ˜**: å°†å±æ€§è¡¨ï¼ˆç‚¹å¯¹è¡¨ç»„æˆçš„åˆ—è¡¨ï¼‰ç¼–ç ä¸ºjsonå­—ç¬¦ä¸²

**ç”¨æ³•**:
```lisp
(json:encode-json-alist alist)
```

**å‚æ•°**: 1 alist  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: String

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun json:encode-json-alist (alist)
  "å°†å±æ€§è¡¨ï¼ˆç‚¹å¯¹è¡¨ç»„æˆçš„åˆ—è¡¨ï¼‰ç¼–ç ä¸ºjsonå­—ç¬¦ä¸²"
  "String"
  (@::post (strcat (@::uri)
      "/api/encode-json")
    (vl-prin1-to-string alist)))
```
</details>

---

### json:parse

**è¯´æ˜**: Json å­—ç¬¦ä¸²è½¬åŒ–ä¸º lisp åˆ—è¡¨ã€‚

**ç”¨æ³•**:
```lisp
(json:parse str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: list

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun json:parse (str)
  "Json å­—ç¬¦ä¸²è½¬åŒ–ä¸º lisp åˆ—è¡¨ã€‚"
  "list"
  (setq lst-str (vl-string->list str))
  (setq flag-escape nil)
  (setq flag-quote nil)
  (setq flag-keylevel 0)
  (setq flag-arraylevel 0)
  (setq atom-str-lst (quote nil))
  (while lst-str (setq curr-char (car lst-str))
    (cond ((= (ascii "\\")
          CURR-CHAR)
        (SETQ FLAG-ESCAPE (NOT FLAG-ESCAPE))
        (SETQ ATOM-STR-LST (CONS CURR-CHAR ATOM-STR-LST)))
      ((AND (= (ASCII "\"")
            CURR-CHAR)
          (NULL FLAG-ESCAPE))
        (SETQ FLAG-ESCAPE nil)
        (SETQ FLAG-QUOTE (NOT FLAG-QUOTE))
        (SETQ ATOM-STR-LST (CONS CURR-CHAR ATOM-STR-LST)))
      (T (SETQ FLAG-ESCAPE nil)
        (IF FLAG-QUOTE (SETQ ATOM-STR-LST (CONS CURR-CHAR ATOM-STR-LST))
          (COND ((= (ASCII "{")
                CURR-CHAR)
              (SETQ FLAG-KEYLEVEL (1+ FLAG-KEYLEVEL))
              (SETQ ATOM-STR-LST (CONS (ASCII "(")
                    ATOM-STR-LST)))
              ((= (ASCII "[")
                  CURR-CHAR)
                (SETQ FLAG-ARRAYLEVEL (1+ FLAG-ARRAYLEVEL))
                (IF (= PRE-CHAR (ASCII ":"))
                  (SETQ ATOM-STR-LST (CONS (ASCII "(")
                        (CDDDR ATOM-STR-LST)))
                    (SETQ ATOM-STR-LST (CONS (ASCII "(")
                          ATOM-STR-LST))))
                  ((= (ASCII "}")
                      CURR-CHAR)
                    (SETQ FLAG-KEYLEVEL (1- FLAG-KEYLEVEL))
                    (SETQ ATOM-STR-LST (CONS (ASCII ")")
                      ATOM-STR-LST)))
                ((= (ASCII "]")
                    CURR-CHAR)
                  (SETQ FLAG-ARRAYLEVEL (1- FLAG-ARRAYLEVEL))
                  (SETQ ATOM-STR-LST (CONS (ASCII ")")
                    ATOM-STR-LST)))
              ((= (ASCII ":")
                  CURR-CHAR)
                (SETQ ATOM-STR-LST (CONS (ASCII "
                      ")
                    (CONS (ASCII ".")
                      (CONS (ASCII "
                          ")
                        ATOM-STR-LST)))))
              ((= (ASCII ",")
                  CURR-CHAR)
                (SETQ ATOM-STR-LST (CONS (ASCII "(")
                      (CONS (ASCII ")")
                      ATOM-STR-LST))))
              (T (SETQ ATOM-STR-LST (CONS CURR-CHAR ATOM-STR-LST)))))))
      (SETQ PRE-CHAR CURR-CHAR)
      (SETQ LST-STR (CDR LST-STR)))
    (READ (STRCAT "("
          (VL-LIST->STRING (REVERSE ATOM-STR-LST))
          ")")))
```
</details>

---

## layer

**æ¨¡å—è¯´æ˜**: å›¾å±‚ç®¡ç†ã€å±æ€§è®¾ç½®

### layer:activelayer

**è¯´æ˜**: è®¾ç½®æŒ‡å®šå±‚ä¸ºå½“å‰å±‚

**ç”¨æ³•**:
```lisp
(layer:activelayer name)
```

**å‚æ•°**: 1 name  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: æˆåŠŸè¿”å›tï¼Œå¤±è´¥è¿”å›nil

**ç¤ºä¾‹**:
```lisp
(entity:ActiveLayer "layer1")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:activelayer (name / iloc out)
    "è®¾ç½®æŒ‡å®šå±‚ä¸ºå½“å‰å±‚"
    "æˆåŠŸè¿”å›tï¼Œå¤±è´¥è¿”å›nil"
    "(entity:activelayer \"layer1\")"
    (if (and (tblsearch "layer"
                name)
            (setq iloc (vl-position name (layer:list))))
        (progn (vla-put-activelayer (std:active-document)
                (vla-item (std:layers)
                    iloc))
            t)
        nil))
```
</details>

---

### layer:allname

**è¯´æ˜**: è¿”å›æ‰€æœ‰å›¾å±‚çš„åç§°(å­—ç¬¦ä¸²è¡¨)

**ç”¨æ³•**:
```lisp
(layer:allname )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:allname (/ out)
    "è¿”å›æ‰€æœ‰å›¾å±‚çš„åç§°(å­—ç¬¦ä¸²è¡¨)"
    (vlax-for obj *lays* (setq out (cons (vlax-get-property obj (quote name))
                out)))
    (reverse out))
```
</details>

---

### layer:delete

**è¯´æ˜**: åˆ é™¤å›¾å±‚ã€‚å‚æ•°æ”¯æŒåç§°ï¼Œå›¾å…ƒï¼Œvla-objectä»¥åŠå®ƒä»¬çš„åˆ—è¡¨ã€‚åˆ é™¤å‰éœ€æ¸…ç©ºå›¾å±‚ä¸­çš„å›¾å…ƒã€‚

**ç”¨æ³•**:
```lisp
(layer:delete layers)
```

**å‚æ•°**: 1 layers  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: t or nil

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:delete (layers / each out)
  "åˆ é™¤å›¾å±‚ã€‚å‚æ•°æ”¯æŒåç§°ï¼Œå›¾å…ƒï¼Œvla-objectä»¥åŠå®ƒä»¬çš„åˆ—è¡¨ã€‚åˆ é™¤å‰éœ€æ¸…ç©ºå›¾å±‚ä¸­çš„å›¾å…ƒã€‚"
  "t or nil"
  (if (not (listp layers))
    (setq layers (list layers)))
  (setq layers (mapcar (quote (lambda (x)
          (cond ((p:stringp x)
              (e2o (tblobjname "layer"
                  x)))
            ((p:enamep x)
              (e2o x))
            ((p:vlap x)
              x))))
      layers))
  (if (null (ssget "x"
        (list (cons 8 (string:from-list (mapcar (quote (lambda (x)
                    (vla-get-name x)))
                layers)
              ",")))))
    (apply (quote and)
      (mapcar vla-delete layers))))
```
</details>

---

### layer:ent

**è¯´æ˜**: è·è·å–æŒ‡å®šå›¾å±‚çš„å›¾å…ƒå

**ç”¨æ³•**:
```lisp
(layer:ent name)
```

**å‚æ•°**: 1 name  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: å›¾å…ƒ

**ç¤ºä¾‹**:
```lisp
(layer:ent "0") --> <å›¾å…ƒå: -64cb388>
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:ent (name)
    "è·è·å–æŒ‡å®šå›¾å±‚çš„å›¾å…ƒå"
    "å›¾å…ƒ"
    "(layer:ent \"0\")
    --> <å›¾å…ƒå: -64cb388>"
    (tblobjname "layer"
        name))
```
</details>

---

### layer:freeze

**è¯´æ˜**: å›¾å±‚åˆ—è¡¨å†»ç»“å¼€å…³å‡½æ•°

**ç”¨æ³•**:
```lisp
(layer:freeze laylist bool-flag)
```

**å‚æ•°**: 1 laylist  : æœªæ˜ç¡®å®šä¹‰;  2 bool-flag  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:freeze (laylist bool-flag)
    "å›¾å±‚åˆ—è¡¨å†»ç»“å¼€å…³å‡½æ•°"
    (vlax-for each (std:layers)
        (if (member (vla-get-name each)
                (if (listp laylist)
                    laylist (list laylist)))
            (if (vlax-write-enabled-p each)
                (vla-put-freeze each (if bool-flag :vlax-true :vlax-false))))
        (vlax-release-object each)))
```
</details>

---

### layer:freezed-p

**è¯´æ˜**: å±‚æ˜¯å¦å†»ç»“ï¼Ÿ

**ç”¨æ³•**:
```lisp
(layer:freezed-p lname)
```

**å‚æ•°**: 1 lname  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:freezed-p (lname / each)
    "å±‚æ˜¯å¦å†»ç»“ï¼Ÿ"
    (list:exist (entity:freezelist)
        lname))
```
</details>

---

### layer:freezelist

**è¯´æ˜**: è¿”å›å†»ç»“å›¾å±‚åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(layer:freezelist )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:freezelist (/ each out)
    "è¿”å›å†»ç»“å›¾å±‚åˆ—è¡¨"
    (vlax-for each (std:layers)
        (if (= (vla-get-freeze each)
                :vlax-true)
            (setq out (cons (vla-get-name each)
                    out))))
    out)
```
</details>

---

### layer:info

**è¯´æ˜**: è¿”å›æ‰€æœ‰å›¾å±‚çš„ä¿¡æ¯

**ç”¨æ³•**:
```lisp
(layer:info )
```

**å‚æ•°**: None

**è¿”å›å€¼**: (("å±‚å" çŠ¶æ€ é¢œè‰² "çº¿å‹")â€¦â€¦);  çŠ¶æ€ï¼š1å†»ç»“å›¾å±‚ 2æ–°è§†å£å†»ç»“å›¾å±‚ 4é”å®šâ€¦(å…¶ä»–çœ‹å¸®åŠ©);  é¢œè‰²ï¼šè´Ÿå€¼ä¸ºéšè—å›¾å±‚;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:info (/ lst d e1 e2)
    "è¿”å›æ‰€æœ‰å›¾å±‚çš„ä¿¡æ¯"
    "((\"å±‚å\"
            çŠ¶æ€ é¢œè‰² \"çº¿å‹\")â€¦â€¦)\nçŠ¶æ€ï¼š1å†»ç»“å›¾å±‚ 2æ–°è§†å£å†»ç»“å›¾å±‚ 4é”å®šâ€¦(å…¶ä»–çœ‹å¸®åŠ©)\né¢œè‰²ï¼šè´Ÿå€¼ä¸ºéšè—å›¾å±‚\n"
    (while (setq d (tblnext "layer"
                (null d)))
        (setq lst (cons (mapcar (quote cdr)
                    (cdr d))
                lst)))
    (vl-sort lst (quote (lambda (e1 e2)
                (< (car e1)
                    (car e2))))))
```
</details>

---

### layer:layerofflist

**è¯´æ˜**: è¿”å›å…³é—­å›¾å±‚åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(layer:layerofflist )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:layerofflist (/ each out)
    "è¿”å›å…³é—­å›¾å±‚åˆ—è¡¨"
    (vlax-for each (std:layers)
        (if (= (vla-get-layeron each)
                :vlax-false)
            (setq out (cons (vla-get-name each)
                    out))))
    out)
```
</details>

---

### layer:layers

**è¯´æ˜**: è¿”å›å›¾å±‚åˆ—è¡¨ list

**ç”¨æ³•**:
```lisp
(layer:layers )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:layers (/ sll layer)
  "è¿”å›å›¾å±‚åˆ—è¡¨ list"
  (setq layer nil)
  (setq sll (tblnext "layer"
      t))
  (while (/= sll nil)
    (setq sll (cdr (assoc 2 sll)))
    (setq layer (cons sll layer))
    (setq sll (tblnext "layer"
        nil)))
  (reverse layer))
```
</details>

---

### layer:list

**è¯´æ˜**: è¿”å›å›¾å±‚åˆ—è¡¨ list

**ç”¨æ³•**:
```lisp
(layer:list )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:list (/ sll layer)
    "è¿”å›å›¾å±‚åˆ—è¡¨ list"
    (setq layer nil)
    (setq sll (tblnext "layer"
            t))
    (while (/= sll nil)
        (setq sll (cdr (assoc 2 sll)))
        (setq layer (cons sll layer))
        (setq sll (tblnext "layer"
                nil)))
    (reverse layer))
```
</details>

---

### layer:lock

**è¯´æ˜**: å›¾å±‚é”å®šå¼€å…³å‡½æ•°

**ç”¨æ³•**:
```lisp
(layer:lock laylist bool-flag)
```

**å‚æ•°**: 1 laylist  : æœªæ˜ç¡®å®šä¹‰;  2 bool-flag  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:lock (laylist bool-flag)
    "å›¾å±‚é”å®šå¼€å…³å‡½æ•°"
    (vlax-for each (std:layers)
        (if (member (vla-get-name each)
                (if (listp laylist)
                    laylist (list laylist)))
            (if (vlax-write-enabled-p each)
                (vla-put-lock each (if bool-flag :vlax-true :vlax-false))))
        (vlax-release-object each)))
```
</details>

---

### layer:locked-p

**è¯´æ˜**: å±‚æ˜¯å¦é”å®šï¼Ÿ

**ç”¨æ³•**:
```lisp
(layer:locked-p lname)
```

**å‚æ•°**: 1 lname  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:locked-p (lname / each)
    "å±‚æ˜¯å¦é”å®šï¼Ÿ"
    (list:exist (entity:lockedlist)
        lname))
```
</details>

---

### layer:lockedlist

**è¯´æ˜**: è¿”å›é”å®šå›¾å±‚åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(layer:lockedlist )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:lockedlist (/ each out)
    "è¿”å›é”å®šå›¾å±‚åˆ—è¡¨"
    (vlax-for each (std:layers)
        (if (= (vla-get-lock each)
                :vlax-true)
            (setq out (cons (vla-get-name each)
                    out))))
    out)
```
</details>

---

### layer:make

**è¯´æ˜**: åˆ›å»ºä¸€ä¸ªå›¾å±‚å‚æ•°1:name:å›¾å±‚åç§°å‚æ•°2:colour:é¢œè‰²é»˜è®¤nil(7)å‚æ•°3:linetype:çº¿å‹é»˜è®¤nil(continuous)å‚æ•°4:n70:æ ‡å¿—ä½ï¼Œé»˜è®¤nil(0)  æ ‡å‡†æ ‡è®°ï¼ˆæŒ‰ä½ç¼–ç å€¼ï¼‰ï¼š  1 = å†»ç»“å›¾å±‚ï¼Œå¦åˆ™è§£å†»å›¾å±‚  2 = é»˜è®¤æƒ…å†µä¸‹åœ¨æ–°è§†å£ä¸­å†»ç»“å›¾å±‚  4 = é”å®šå›¾å±‚  16 = å¦‚æœè®¾ç½®äº†æ­¤ä½ï¼Œåˆ™è¡¨æ¡ç›®å¤–éƒ¨ä¾èµ–äºå¤–éƒ¨å‚ç…§  32 = å¦‚æœåŒæ—¶è®¾ç½®äº†æ­¤ä½å’Œä½ 16ï¼Œåˆ™è¡¨æ˜å·²æˆåŠŸèå…¥äº†å¤–éƒ¨ä¾èµ–çš„å¤–éƒ¨å‚ç…§  64 = å¦‚æœè®¾ç½®äº†æ­¤ä½ï¼Œåˆ™è¡¨æ˜åœ¨ä¸Šæ¬¡ç¼–è¾‘å›¾å½¢æ—¶ï¼Œå›¾å½¢ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå›¾å…ƒå‚ç…§äº†è¡¨æ¡ç›®ã€‚  (æ­¤æ ‡å¿—é€‚ç”¨äº autocad å‘½ä»¤ã€‚å¤§å¤šæ•°è¯»å– dxf æ–‡ä»¶çš„ç¨‹åºéƒ½å¯ä»¥å¿½ç•¥å®ƒï¼Œå¹¶ä¸”æ— éœ€ç”±å†™å…¥ dxf æ–‡ä»¶çš„ç¨‹åºå¯¹å…¶è¿›è¡Œè®¾ç½®)

**ç”¨æ³•**:
```lisp
(layer:make name colour linetype flag)
```

**å‚æ•°**: 1 name  : æœªè¯†åˆ«å®šä¹‰;2 colour  : æœªè¯†åˆ«å®šä¹‰;3 linetype  : æœªè¯†åˆ«å®šä¹‰;4 flag  : æœªè¯†åˆ«å®šä¹‰;

**ç¤ºä¾‹**:
```lisp
(layer:make "ABC" nil nil nil)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:make (name colour linetype flag)
  "åˆ›å»ºä¸€ä¸ªå›¾å±‚\nå‚æ•°1:name:å›¾å±‚åç§°\nå‚æ•°2:colour:é¢œè‰²é»˜è®¤nil(7)\nå‚æ•°3:linetype:çº¿å‹é»˜è®¤nil(continuous)\nå‚æ•°4:n70:æ ‡å¿—ä½ï¼Œé»˜è®¤nil(0)\n  æ ‡å‡†æ ‡è®°ï¼ˆæŒ‰ä½ç¼–ç å€¼ï¼‰ï¼š\n  1 = å†»ç»“å›¾å±‚ï¼Œå¦åˆ™è§£å†»å›¾å±‚\n  2 = é»˜è®¤æƒ…å†µä¸‹åœ¨æ–°è§†å£ä¸­å†»ç»“å›¾å±‚\n  4 = é”å®šå›¾å±‚\n  16 = å¦‚æœè®¾ç½®äº†æ­¤ä½ï¼Œåˆ™è¡¨æ¡ç›®å¤–éƒ¨ä¾èµ–äºå¤–éƒ¨å‚ç…§\n  32 = å¦‚æœåŒæ—¶è®¾ç½®äº†æ­¤ä½å’Œä½ 16ï¼Œåˆ™è¡¨æ˜å·²æˆåŠŸèå…¥äº†å¤–éƒ¨ä¾èµ–çš„å¤–éƒ¨å‚ç…§\n  64 = å¦‚æœè®¾ç½®äº†æ­¤ä½ï¼Œåˆ™è¡¨æ˜åœ¨ä¸Šæ¬¡ç¼–è¾‘å›¾å½¢æ—¶ï¼Œå›¾å½¢ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå›¾å…ƒå‚ç…§äº†è¡¨æ¡ç›®ã€‚\n  (æ­¤æ ‡å¿—é€‚ç”¨äº autocad å‘½ä»¤ã€‚å¤§å¤šæ•°è¯»å– dxf æ–‡ä»¶çš„ç¨‹åºéƒ½å¯ä»¥å¿½ç•¥å®ƒï¼Œå¹¶ä¸”æ— éœ€ç”±å†™å…¥ dxf æ–‡ä»¶çš„ç¨‹åºå¯¹å…¶è¿›è¡Œè®¾ç½®)"
  ""
  "(layer:make \"ABC\"
    nil nil nil)"
  (or flag (setq flag 0))
  (or colour (setq colour 7))
  (or linetype (setq linetype "continuous"))
  (entmakex (list (cons 0 "layer")
      (cons 100 "AcDbSymbolTableRecord")
      (cons 100 "AcDbLayerTableRecord")
      (cons 2 name)
      (cons 70 flag)
      (cons 62 colour)
      (cons 6 linetype))))
```
</details>

---

### layer:obj-name

**è¯´æ˜**: è¿”å›æ‰€æœ‰å›¾å±‚å¯¹åº”çš„å¯¹è±¡å(å¤§å†™)

**ç”¨æ³•**:
```lisp
(layer:obj-name )
```

**å‚æ•°**: None

**è¿”å›å€¼**: ((å›¾å±‚å1 å¯¹è±¡å1) (å›¾å±‚å2 å¯¹è±¡å2)â€¦â€¦)

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:obj-name (/ ob)
    "è¿”å›æ‰€æœ‰å›¾å±‚å¯¹åº”çš„å¯¹è±¡å(å¤§å†™)"
    "((å›¾å±‚å1 å¯¹è±¡å1)
        (å›¾å±‚å2 å¯¹è±¡å2)â€¦â€¦)"
    (vlax-for each (vla-get-layers *doc*)
        (setq ob (cons (list (vla-get-name each)
                    each)
                ob)))
    ob)
```
</details>

---

### layer:off

**è¯´æ˜**: å…³é—­å›¾å±‚;  å‚æ•°ï¼šå›¾å±‚åç§°è¡¨

**ç”¨æ³•**:
```lisp
(layer:off laylist)
```

**å‚æ•°**: 1 laylist  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:off (laylist)
    "å…³é—­å›¾å±‚\nå‚æ•°ï¼šå›¾å±‚åç§°è¡¨"
    (setq laylist (mapcar (quote strcase)
            laylist))
    (vlax-for each *lays* (if (member (strcase (vla-get-name each))
                laylist)
            (if (vlax-write-enabled-p each)
                (vla-put-layeron each :vlax-false)))
        (vlax-release-object each)))
```
</details>

---

### layer:on

**è¯´æ˜**: å›¾å±‚åˆ—è¡¨å¼€å…³å‡½æ•°

**ç”¨æ³•**:
```lisp
(layer:on laylist bool-flag)
```

**å‚æ•°**: 1 laylist  : æœªæ˜ç¡®å®šä¹‰;  2 bool-flag  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:on (laylist bool-flag)
    "å›¾å±‚åˆ—è¡¨å¼€å…³å‡½æ•°"
    (vlax-for each (std:layers)
        (if (member (vla-get-name each)
                (if (listp laylist)
                    laylist (list laylist)))
            (if (vlax-write-enabled-p each)
                (vla-put-layeron each (if bool-flag :vlax-true :vlax-false))))
        (vlax-release-object each)))
```
</details>

---

### layer:plotable

**è¯´æ˜**: è®¾ç½®æŒ‡å®šå›¾å±‚(åˆ—è¡¨)ä¸æ‰“å°nå‚æ•°1ã€å›¾å±‚åˆ—è¡¨nå‚æ•°2ã€æ˜¯å¦æ‰“å°(tæ‰“å°/nilä¸æ‰“å°)

**ç”¨æ³•**:
```lisp
(layer:plotable laylist on-off)
```

**å‚æ•°**: 1 laylist  : æœªè¯†åˆ«å®šä¹‰;2 on-off  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:plotable (laylist on-off)
  "è®¾ç½®æŒ‡å®šå›¾å±‚(åˆ—è¡¨)ä¸æ‰“å°\nå‚æ•°1ã€å›¾å±‚åˆ—è¡¨\nå‚æ•°2ã€æ˜¯å¦æ‰“å°(tæ‰“å°/nilä¸æ‰“å°)"
  (if (atom laylist)
    (setq laylist (list laylist)))
  (vlax-for each (vla-get-layers *doc*)
    (if (member (strcase (vla-get-name each))
        (mapcar (quote strcase)
          laylist))
      (if (vlax-write-enabled-p each)
        (if on-off (vla-put-plottable each :vlax-true)
          (vla-put-plottable each :vlax-false))))
    (vlax-release-object each)))
```
</details>

---

### layer:plottable

**è¯´æ˜**: å›¾å±‚æ‰“å°å¼€å…³å‡½æ•°

**ç”¨æ³•**:
```lisp
(layer:plottable laylist bool-flag)
```

**å‚æ•°**: 1 laylist  : æœªæ˜ç¡®å®šä¹‰;  2 bool-flag  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:plottable (laylist bool-flag)
    "å›¾å±‚æ‰“å°å¼€å…³å‡½æ•°"
    (vlax-for each (std:layers)
        (if (member (vla-get-name each)
                (if (listp laylist)
                    laylist (list laylist)))
            (if (vlax-write-enabled-p each)
                (vla-put-plottable each (if bool-flag :vlax-true :vlax-false))))
        (vlax-release-object each)))
```
</details>

---

### layer:plottablelist

**è¯´æ˜**: è¿”å›å¯æ‰“å°å›¾å±‚åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(layer:plottablelist )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:plottablelist (/ each out)
    "è¿”å›å¯æ‰“å°å›¾å±‚åˆ—è¡¨"
    (vlax-for each (std:layers)
        (if (= (vla-get-plottable each)
                :vlax-true)
            (setq out (cons (vla-get-name each)
                    out))))
    out)
```
</details>

---

### layer:readme

**è¯´æ˜**: å›¾å±‚æ“ä½œç›¸å…³å‡½æ•°ã€‚

**ç”¨æ³•**:
```lisp
(layer:readme )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:readme nil "å›¾å±‚æ“ä½œç›¸å…³å‡½æ•°ã€‚"
  (princ "å›¾å±‚æ“ä½œç›¸å…³å‡½æ•°ã€‚ä½¿ç”¨ (require 'layer:*)
    åŠ è½½è¿™äº›å‡½æ•°")
  (princ))
```
</details>

---

### layer:set-color

**è¯´æ˜**: è®¾ç½®å›¾å±‚ lay é¢œè‰²å·ä¸º intï¼Œlay æ”¯æŒæ–‡å­—åŠ*å·é€šé…ç¬¦ï¼Œæˆ–å›¾å±‚å®ä½“ç±»å‹ï¼Œint ä¸º 0~255 ä¹‹é—´çš„æ•´æ•°

**ç”¨æ³•**:
```lisp
(layer:set-color lay int)
```

**å‚æ•°**: 1 lay  : æœªè¯†åˆ«å®šä¹‰;2 int  : æ•´æ•°;

**è¿”å›å€¼**: ename

**ç¤ºä¾‹**:
```lisp
(layer:set-color "jz-*" 3)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layer:set-color (lay int / lst)
  "è®¾ç½®å›¾å±‚ lay é¢œè‰²å·ä¸º intï¼Œlay æ”¯æŒæ–‡å­—åŠ*å·é€šé…ç¬¦ï¼Œæˆ–å›¾å±‚å®ä½“ç±»å‹ï¼Œint ä¸º 0~255 ä¹‹é—´çš„æ•´æ•°"
  "ename"
  "(layer:set-color \"jz-*\"
    3)"
  (cond ((p:stringp lay)
      (setq lst (vl-remove-if-not (quote (lambda (x)
              (wcmatch (strcase x)
                (strcase lay))))
          (layer:list)))
      (foreach layername lst (setq %ent (entget (layer:ent layername)))
        (entmod (subst (cons 62 int)
            (assoc 62 %ent)
            %ent))))
    ((p:enamep lay)
      (setq %ent (entget lay))
      (entmod (subst (cons 62 int)
          (assoc 62 %ent)
          %ent)))))
```
</details>

---

## layout

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### layout:list

**è¯´æ˜**: æŒ‰ç…§å½“å‰å±å¹•æ˜¾ç¤ºçš„é¡ºåºè¿”å›æ‰€æœ‰å¸ƒå±€åç§°

**ç”¨æ³•**:
```lisp
(layout:list )
```

**å‚æ•°**: None

**è¿”å›å€¼**: å¸ƒå±€ååˆ—è¡¨

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layout:list (/ a lst)
    "æŒ‰ç…§å½“å‰å±å¹•æ˜¾ç¤ºçš„é¡ºåºè¿”å›æ‰€æœ‰å¸ƒå±€åç§°"
    "å¸ƒå±€ååˆ—è¡¨"
    (vlax-for a *layouts* (setq lst (cons (list (vla-get-taborder a)
                    (vla-get-name a))
                lst)))
    (cdr (mapcar (quote cadr)
            (vl-sort lst (quote (lambda (x y)
                        (< (car x)
                            (car y))))))))
```
</details>

---

### layout:make-viewport

**è¯´æ˜**: ä»æ¨¡å‹ç©ºé—´ç”Ÿæˆå¸ƒå±€

**ç”¨æ³•**:
```lisp
(layout:make-viewport layout pt-center width height twistang pt-model)
```

**å‚æ•°**: 1 layout  : æœªè¯†åˆ«å®šä¹‰;2 pt-center  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 width  : æœªè¯†åˆ«å®šä¹‰;4 height  : æœªè¯†åˆ«å®šä¹‰;5 twistang  : æœªè¯†åˆ«å®šä¹‰;6 pt-model  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: ename

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layout:make-viewport (layout pt-center width height twistang pt-model / obj-pv)
  "ä»æ¨¡å‹ç©ºé—´ç”Ÿæˆå¸ƒå±€"
  "ename"
  (if (null (member layout (layout:list)))
    (progn (vla-add *layouts* layout)
      (if (/= layout (getvar "ctab"))
        (setvar "ctab"
          layout))
      (pickset:erase (ssget "x"
          (list (cons 410 layout)))))
    (if (/= layout (getvar "ctab"))
      (setvar "ctab"
        layout)))
  (if (null twistang)
    (setq twistang 0.0)
    (if (not (zerop twistang))
      (setq pt-model (m:coordinate-rotate pt-model twistang))))
  (if (/= layout (getvar "ctab"))
    (setvar "ctab"
      layout))
  (setvar "cmdecho"
    0)
  (@::cmd "mview"
    "NE"
    (polar (polar pt-model pi (* 0.5 width))
      (* 1.5 pi)
      (* 0.5 height))
    (polar (polar pt-model 0 (* 0.5 width))
      (* 0.5 pi)
      (* 0.5 height))
    ""
    pt-center)
  (setvar "cmdecho"
    1)
  (setq obj-pv (e2o (entlast)))
  (vla-put-width obj-pv width)
  (vla-put-height obj-pv height)
  (vla-put-customscale obj-pv 1.0)
  (vla-put-twistangle obj-pv twistang)
  (o2e obj-pv))
```
</details>

---

### layout:readme

**è¯´æ˜**: å¸ƒå±€æ“ä½œç›¸å…³å‡½æ•°ã€‚

**ç”¨æ³•**:
```lisp
(layout:readme )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layout:readme nil "å¸ƒå±€æ“ä½œç›¸å…³å‡½æ•°ã€‚"
  (princ "å¸ƒå±€æ“ä½œç›¸å…³å‡½æ•°ã€‚ä½¿ç”¨ (require 'layout:*)
    åŠ è½½è¿™äº›å‡½æ•°")
  (princ))
```
</details>

---

### layout:rename

**è¯´æ˜**: é‡å‘½åå¸ƒå±€åç§°

**ç”¨æ³•**:
```lisp
(layout:rename str-oldname str-newname)
```

**å‚æ•°**: 1 str-oldname  : å­—ç¬¦ä¸²;2 str-newname  : å­—ç¬¦ä¸²;

**ç¤ºä¾‹**:
```lisp
(layout:rename "å¸ƒå±€1" "æˆ‘çš„å¸ƒå±€")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layout:rename (str-oldname str-newname / lst-name)
  "é‡å‘½åå¸ƒå±€åç§°"
  ""
  "(layout:rename \"å¸ƒå±€1\"
    \"æˆ‘çš„å¸ƒå±€\")"
  (setq lst-name (mapcar (quote vla-get-name)
      (layout:vla-list)))
  (if (and (member str-oldname lst-name)
      (null (member str-newname lst-name)))
    (vla-put-name (nth (vl-position str-oldname lst-name)
        (layout:vla-list))
      str-newname)))
```
</details>

---

### layout:set-position

**è¯´æ˜**: æ ¹æ®æŒ‡å®šå¸ƒå±€åç§°ä¿®æ”¹å¸ƒå±€çš„ä½ç½®

**ç”¨æ³•**:
```lisp
(layout:set-position name n)
```

**å‚æ•°**: 1 name  : æœªæ˜ç¡®å®šä¹‰;  2 n  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layout:set-position (name n)
    "æ ¹æ®æŒ‡å®šå¸ƒå±€åç§°ä¿®æ”¹å¸ƒå±€çš„ä½ç½®"
    (setq vpnm1 (vla-item *layouts* name))
    (vla-put-taborder vpnm1 n))
```
</details>

---

### layout:sort

**è¯´æ˜**: è‡ªåŠ¨æŒ‰å¸ƒå±€åæ’åºå¸ƒå±€

**ç”¨æ³•**:
```lisp
(layout:sort )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layout:sort (/ i layname layname-s)
    "è‡ªåŠ¨æŒ‰å¸ƒå±€åæ’åºå¸ƒå±€"
    (setq layname (layout:list)
        layname-s (string:sort-by-numer layname)
        i 0)
    (foreach n layname-s (setq i (1+ i))
        (layout:set-position n i)))
```
</details>

---

### layout:vla-list

**è¯´æ˜**: æŒ‰ç…§å½“å‰å±å¹•æ˜¾ç¤ºçš„é¡ºåºè¿”å›æ‰€æœ‰å¸ƒå±€å¯¹è±¡

**ç”¨æ³•**:
```lisp
(layout:vla-list )
```

**å‚æ•°**: None

**è¿”å›å€¼**: å¸ƒå±€å¯¹è±¡åˆ—è¡¨

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun layout:vla-list (/ a lst)
    "æŒ‰ç…§å½“å‰å±å¹•æ˜¾ç¤ºçš„é¡ºåºè¿”å›æ‰€æœ‰å¸ƒå±€å¯¹è±¡"
    "å¸ƒå±€å¯¹è±¡åˆ—è¡¨"
    (vlax-for a *layouts* (setq lst (cons (list (vla-get-taborder a)
                    a)
                lst)))
    (cdr (mapcar (quote cadr)
            (vl-sort lst (quote (lambda (x y)
                        (< (car x)
                            (car y))))))))
```
</details>

---

## line

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### line:get-lwpoints

**è¯´æ˜**: ç”Ÿæˆå¤šæ®µçº¿çš„ç‚¹åº

**ç”¨æ³•**:
```lisp
(line:get-lwpoints en0)
```

**å‚æ•°**: 1 en0  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun line:get-lwpoints (en0 / ddlist dd1 tmplist)
    "ç”Ÿæˆå¤šæ®µçº¿çš„ç‚¹åº"
    (setq ddlist nil)
    (setq tmplist (entget en0))
    (repeat (cdr (assoc 90 (entget en0)))
        (setq dd1 (cdr (assoc 10 tmplist)))
        (setq tmplist (member (assoc 10 tmplist)
                tmplist))
        (setq tmplist (cdr tmplist))
        (setq ddlist (append ddlist (list dd1)))))
```
</details>

---

### line:length

**è¯´æ˜**: æ±‚çº¿æ®µå®ä½“é•¿åº¦

**ç”¨æ³•**:
```lisp
(line:length ent-line)
```

**å‚æ•°**: 1 ent-line  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun line:length (ent-line)
    "æ±‚çº¿æ®µå®ä½“é•¿åº¦"
    (apply (quote distance)
        (entity:getdxf ent-line (quote (10 11)))))
```
</details>

---

### line:mid

**è¯´æ˜**: æ±‚çº¿æ®µå®ä½“ä¸­ç‚¹åæ ‡

**ç”¨æ³•**:
```lisp
(line:mid ent-line)
```

**å‚æ•°**: 1 ent-line  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun line:mid (ent-line)
    "æ±‚çº¿æ®µå®ä½“ä¸­ç‚¹åæ ‡"
    (polar (entity:getdxf ent-line 10)
        (apply (quote angle)
            (entity:getdxf ent-line (quote (10 11))))
        (* 0.5 (line:length ent-line))))
```
</details>

---

## list

**æ¨¡å—è¯´æ˜**: åˆ—è¡¨æ“ä½œã€æ’åºã€å»é‡ã€æŸ¥æ‰¾

### list:+

**è¯´æ˜**: ä¸¤ä¸ªåˆ—è¡¨å„é¡¹ç›¸åŠ ä¹‹å’Œç»„æˆçš„åˆ—è¡¨ï¼Œåˆ—è¡¨é•¿åº¦ä»¥å‚æ•°ä¸­åˆ—è¡¨é•¿åº¦å°çš„ä¸ºå‡†.å‚æ•°:lst1,lst2:æ•°å­—åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(list:+ lst1 lst2)
```

**å‚æ•°**: 1 lst1  : åˆ—è¡¨;2 lst2  : åˆ—è¡¨;

**è¿”å›å€¼**: åˆ—è¡¨å„é¡¹ç›¸åŠ åçš„åˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(list:+ '(1 2) '(3 4))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:+ (lst1 lst2)
  "ä¸¤ä¸ªåˆ—è¡¨å„é¡¹ç›¸åŠ ä¹‹å’Œç»„æˆçš„åˆ—è¡¨ï¼Œåˆ—è¡¨é•¿åº¦ä»¥å‚æ•°ä¸­åˆ—è¡¨é•¿åº¦å°çš„ä¸ºå‡†.\nå‚æ•°:lst1,lst2:æ•°å­—åˆ—è¡¨"
  "åˆ—è¡¨å„é¡¹ç›¸åŠ åçš„åˆ—è¡¨"
  "(list:+ '(1 2)
    '(3 4))"
  (mapcar (quote +)
    lst1 lst2))
```
</details>

---

### list:-

**è¯´æ˜**: ä¸¤ä¸ªåˆ—è¡¨å„é¡¹å·®ç»„æˆçš„åˆ—è¡¨ï¼Œåˆ—è¡¨é•¿åº¦ä»¥å‚æ•°ä¸­åˆ—è¡¨é•¿åº¦å°çš„ä¸ºå‡†

**ç”¨æ³•**:
```lisp
(list:- lst1 lst2)
```

**å‚æ•°**: 1 lst1  : åˆ—è¡¨;  2 lst2  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:- (lst1 lst2)
    "ä¸¤ä¸ªåˆ—è¡¨å„é¡¹å·®ç»„æˆçš„åˆ—è¡¨ï¼Œåˆ—è¡¨é•¿åº¦ä»¥å‚æ•°ä¸­åˆ—è¡¨é•¿åº¦å°çš„ä¸ºå‡†"
    (mapcar (quote -)
        lst1 lst2))
```
</details>

---

### list:add

**è¯´æ˜**: ä¸¤ä¸ªåˆ—è¡¨å„é¡¹ç›¸åŠ ä¹‹å’Œç»„æˆçš„åˆ—è¡¨ï¼Œåˆ—è¡¨é•¿åº¦ä»¥å‚æ•°ä¸­åˆ—è¡¨é•¿åº¦å°çš„ä¸ºå‡†.å‚æ•°:lst1,lst2:æ•°å­—åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(list:add lst1 lst2)
```

**å‚æ•°**: 1 lst1  : åˆ—è¡¨;2 lst2  : åˆ—è¡¨;

**è¿”å›å€¼**: åˆ—è¡¨å„é¡¹ç›¸åŠ åçš„åˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(list:+ '(1 2) '(3 4))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:add (lst1 lst2)
  "ä¸¤ä¸ªåˆ—è¡¨å„é¡¹ç›¸åŠ ä¹‹å’Œç»„æˆçš„åˆ—è¡¨ï¼Œåˆ—è¡¨é•¿åº¦ä»¥å‚æ•°ä¸­åˆ—è¡¨é•¿åº¦å°çš„ä¸ºå‡†.\nå‚æ•°:lst1,lst2:æ•°å­—åˆ—è¡¨"
  "åˆ—è¡¨å„é¡¹ç›¸åŠ åçš„åˆ—è¡¨"
  "(list:+ '(1 2)
    '(3 4))"
  (mapcar (quote +)
    lst1 lst2))
```
</details>

---

### list:assoclist-additem

**è¯´æ˜**: æ·»åŠ å…³è”è¡¨çš„å…ƒç´ ,æ— æ›¿æ¢

**ç”¨æ³•**:
```lisp
(list:assoclist-additem lst value)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 value  : å€¼;

**è¿”å›å€¼**: å…³è”è¡¨ï¼Œæ— ç›¸åŒçš„key

**ç¤ºä¾‹**:
```lisp
(list:AssocList-AddItem '((1 11) (2 22) (3 33) (4 44)) '(2 33))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:assoclist-additem (lst value)
    "æ·»åŠ å…³è”è¡¨çš„å…ƒç´ ,æ— æ›¿æ¢"
    "å…³è”è¡¨ï¼Œæ— ç›¸åŒçš„key"
    "(list:assoclist-additem '((1 11)
            (2 22)
            (3 33)
            (4 44))
        '(2 33))"
    (if (assoc (car value)
            lst)
        lst (cons value lst)))
```
</details>

---

### list:assoclist-appenditem

**è¯´æ˜**: æ·»åŠ å…³è”è¡¨çš„å…ƒç´ ,æ›¿æ¢. åŒ assoc

**ç”¨æ³•**:
```lisp
(list:assoclist-appenditem lst value)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 value  : å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:assoclist-appenditem (lst value)
    "æ·»åŠ å…³è”è¡¨çš„å…ƒç´ ,æ›¿æ¢. åŒ assoc"
    (if (assoc (car value)
            lst)
        (setq lst (list:assoclist-remove lst (car value))))
    (cons value lst))
```
</details>

---

### list:assoclist-appendlist

**ç”¨æ³•**:
```lisp
(list:assoclist-appendlist lst value)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 value  : å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:assoclist-appendlist (lst value)
    (if (listp value)
        (foreach item value (setq lst (list:assoclist-appenditem lst item)))))
```
</details>

---

### list:assoclist-index

**è¯´æ˜**: æ ¹æ®keyæŸ¥æ‰¾å…³è”è¡¨çš„ç´¢å¼•

**ç”¨æ³•**:
```lisp
(list:assoclist-index lst key)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 key  : é”®ï¼Œå…³é”®å­—;

**è¿”å›å€¼**: ç´¢å¼•ï¼Œä»0å¼€å§‹

**ç¤ºä¾‹**:
```lisp
(list:AssocList-Index '((1 11) (2 22) (3 33) (4 44)) 3) ==> 2
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:assoclist-index (lst key)
    "æ ¹æ®keyæŸ¥æ‰¾å…³è”è¡¨çš„ç´¢å¼•"
    "ç´¢å¼•ï¼Œä»0å¼€å§‹"
    "(list:assoclist-index '((1 11)
            (2 22)
            (3 33)
            (4 44))
        3)
    ==> 2"
    (vl-position key (mapcar (quote car)
            lst)))
```
</details>

---

### list:assoclist-key

**è¯´æ˜**: è¿”å›å…³è”è¡¨ä¸­keyå¯¹åº”çš„value,ç­‰ä»·äº(cdr (assoc key value))

**ç”¨æ³•**:
```lisp
(list:assoclist-key lst key)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 key  : é”®ï¼Œå…³é”®å­—;

**è¿”å›å€¼**: keyå¯¹åº”çš„value

**ç¤ºä¾‹**:
```lisp
(list:AssocList-Key lst key)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:assoclist-key (lst key)
    "è¿”å›å…³è”è¡¨ä¸­keyå¯¹åº”çš„value,ç­‰ä»·äº(cdr (assoc key value))"
    "keyå¯¹åº”çš„value"
    "(list:assoclist-key lst key)"
    (cdr (assoc key lst)))
```
</details>

---

### list:assoclist-keys

**è¯´æ˜**: è¿”å›å…³è”è¡¨çš„keyå€¼è¡¨

**ç”¨æ³•**:
```lisp
(list:assoclist-keys lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:assoclist-keys (lst)
    "è¿”å›å…³è”è¡¨çš„keyå€¼è¡¨"
    (mapcar (quote car)
        lst))
```
</details>

---

### list:assoclist-remove

**è¯´æ˜**: åˆ é™¤è¡¨ä¸­å…³è”è¡¨åŒ¹é…åˆ°keyçš„çš„å­è¡¨

**ç”¨æ³•**:
```lisp
(list:assoclist-remove lst key)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 key  : é”®ï¼Œå…³é”®å­—;

**è¿”å›å€¼**: åˆ é™¤å…ƒç´ åçš„è¡¨

**ç¤ºä¾‹**:
```lisp
(list:AssocList-Remove '((1 11) (2 22) (3 33) (4 44)) 2) ==>((1 11) (3 33) (4 44))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:assoclist-remove (lst key)
    "åˆ é™¤è¡¨ä¸­å…³è”è¡¨åŒ¹é…åˆ°keyçš„çš„å­è¡¨"
    "åˆ é™¤å…ƒç´ åçš„è¡¨"
    "(list:assoclist-remove '((1 11)
            (2 22)
            (3 33)
            (4 44))
        2)
    ==>((1 11)
        (3 33)
        (4 44))"
    (vl-remove-if (quote (lambda (x)
                (equal (car x)
                    key)))
        lst))
```
</details>

---

### list:assoclist-values

**è¯´æ˜**: è¿”å›å…³è”è¡¨çš„valueå€¼è¡¨

**ç”¨æ³•**:
```lisp
(list:assoclist-values lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:assoclist-values (lst)
    "è¿”å›å…³è”è¡¨çš„valueå€¼è¡¨"
    (mapcar (quote cdr)
        lst))
```
</details>

---

### list:change-index

**è¯´æ˜**: äº¤æ¢åˆ—è¡¨çš„må’Œné¡¹ï¼Œç´¢å¼•ä»0å¼€å§‹

**ç”¨æ³•**:
```lisp
(list:change-index lst m n)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 m  : æœªæ˜ç¡®å®šä¹‰;  3 n  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:change-index (lst m n / t1 t2)
    "äº¤æ¢åˆ—è¡¨çš„må’Œné¡¹ï¼Œç´¢å¼•ä»0å¼€å§‹"
    (setq t1 (nth m lst)
        t2 (nth n lst))
    (list:replace-index (list:replace-index lst m t2)
        n t1))
```
</details>

---

### list:delnotsame

**è¯´æ˜**: æŸ¥æ‰¾è¡¨ä¸­ä¸é‡å¤å…ƒç´ ã€‚

**ç”¨æ³•**:
```lisp
(list:delnotsame lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:delnotsame (lst)
    "æŸ¥æ‰¾è¡¨ä¸­ä¸é‡å¤å…ƒç´ ã€‚"
    (m:intersect lst (list:same lst)))
```
</details>

---

### list:delsame

**è¯´æ˜**: åˆ é™¤è¡¨ä¸­ç›¸åŒé¡¹ç›®ï¼Œä¿ç•™ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼ˆæ”¯æŒå®¹å·®ï¼‰

**ç”¨æ³•**:
```lisp
(list:delsame lst fuzz)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 fuzz  : å®¹å·®;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:delsame (lst fuzz)
  "åˆ é™¤è¡¨ä¸­ç›¸åŒé¡¹ç›®ï¼Œä¿ç•™ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼ˆæ”¯æŒå®¹å·®ï¼‰"
  (if lst (cons (car lst)
      (list:delsame (vl-remove-if (quote (lambda (x)
              (list:equal (car lst)
                x fuzz)))
          (cdr lst))
        fuzz))))
```
</details>

---

### list:delsame-all

**è¯´æ˜**: åˆ é™¤è¡¨ä¸­æ‰€æœ‰é‡å¤çš„å…ƒç´ 

**ç”¨æ³•**:
```lisp
(list:delsame-all lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:delsame-all (lst / l2)
    "åˆ é™¤è¡¨ä¸­æ‰€æœ‰é‡å¤çš„å…ƒç´ "
    (foreach i (list:same lst)
        (setq lst (vl-remove i lst))))
```
</details>

---

### list:difference

**è¯´æ˜**: æ±‚å·®é›†.

**ç”¨æ³•**:
```lisp
(list:difference lst1 lst2)
```

**å‚æ•°**: 1 lst1  : åˆ—è¡¨;2 lst2  : åˆ—è¡¨;

**è¿”å›å€¼**: list

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:difference (lst1 lst2 / res)
  "æ±‚å·®é›†."
  "list"
  (foreach a lst1 (if (not (member a lst2))
      (setq res (cons a res))))
  res)
```
</details>

---

### list:dot->list

**è¯´æ˜**: ç‚¹è¡¨è½¬æ™®é€šè¡¨

**ç”¨æ³•**:
```lisp
(list:dot->list lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: æ™®é€šè¡¨

**ç¤ºä¾‹**:
```lisp
(list:dot->list '(1 2 3 . 4))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(DEFUN LIST:DOT->LIST (LST)
"dot list to common list"
"common list"
    "(list:dot->list '(1 2 3 . 4))"
    (IF (LISTP LST)
        LST (COND ((AND LST (LISTP LST))
                (CONS (CAR LST)
                    (LIST:DOT->LIST (CDR LST))))
            ((AND LST (NOT (LISTP LST)))
                (CONS LST (LIST:DOT->LIST nil)))
            (T nil))))
```
</details>

---

### list:equal

**è¯´æ˜**: æ¯”è¾ƒå«æœ‰æµ®ç‚¹æ•°çš„åŸå­æˆ–è¡¨

**ç”¨æ³•**:
```lisp
(list:equal lst1 lst2 fuzz)
```

**å‚æ•°**: 1 lst1  : åˆ—è¡¨;2 lst2  : åˆ—è¡¨;3 fuzz  : å®¹å·®;

**è¿”å›å€¼**: t or nil

**ç¤ºä¾‹**:
```lisp
(list:equal 5.3 5.3 0.01)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:equal (lst1 lst2 fuzz)
  "æ¯”è¾ƒå«æœ‰æµ®ç‚¹æ•°çš„åŸå­æˆ–è¡¨"
  "t or nil"
  "(list:equal 5.3 5.3 0.01)"
  (cond ((and (numberp lst1)
        (numberp lst2))
      (equal lst1 lst2 fuzz))
    ((and (listp lst1)
        (listp lst2)
        (> (length lst1)
          0)
        (= (length lst1)
          (length lst2)))
      (apply (quote and)
        (mapcar (quote (lambda (a b)
              (list:equal a b fuzz)))
          lst1 lst2)))
    (t (equal lst1 lst2))))
```
</details>

---

### list:exist

**è¯´æ˜**: åˆ¤æ–­itemæ˜¯å¦åœ¨åˆ—è¡¨å†…

**ç”¨æ³•**:
```lisp
(list:exist lst item)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 item  : é¡¹æˆ–é¡¹å€¼;

**è¿”å›å€¼**: å­˜åœ¨tï¼Œåä¹‹nil

**ç¤ºä¾‹**:
```lisp
(list:exist '(1 2 3 4) 3)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:exist (lst item)
    "åˆ¤æ–­itemæ˜¯å¦åœ¨åˆ—è¡¨å†…"
    "å­˜åœ¨tï¼Œåä¹‹nil"
    "(list:exist '(1 2 3 4)
        3)"
    (apply (quote or)
        (cons (vl-position item lst)
            (mapcar (quote (lambda (x)
                        (list:exist x item)))
                (vl-remove-if (quote atom)
                    lst)))))
```
</details>

---

### list:fill

**è¯´æ˜**: å¯¹äºå…ƒç´ ä¸ªæ•°å°äº n çš„ lst, ç”¨element è¡¥è¶³

**ç”¨æ³•**:
```lisp
(list:fill lst n element)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 n  : æ•´æ•°;3 element  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: list

**ç¤ºä¾‹**:
```lisp
(list:fill '(a b) 4 'c) => '(a b c c)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:fill (lst n element)
  "å¯¹äºå…ƒç´ ä¸ªæ•°å°äº n çš„ lst, ç”¨element è¡¥è¶³"
  "list"
  "(list:fill '(a b)
    4 'c)
  => '(a b c c)"
  (if (and (numberp n)
      (listp lst)
      (< (length lst)
        n))
    (repeat (- (fix n)
        (length lst))
      (setq lst (append lst (list element)))))
  lst)
```
</details>

---

### list:flatten

**è¯´æ˜**: å°†å¤šç»´åˆ—è¡¨å±•å¹³ä¸ºä¸€ç»´ã€‚å•å‘ç®”ã€‚

**ç”¨æ³•**:
```lisp
(list:flatten lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: list

**ç¤ºä¾‹**:
```lisp
(list:flatten '(a (b c) (d (e))))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:flatten (lst / lst1)
  "å°†å¤šç»´åˆ—è¡¨å±•å¹³ä¸ºä¸€ç»´ã€‚å•å‘ç®”ã€‚"
  "list"
  "(list:flatten '(a (b c)
      (d (e))))"
  (foreach x lst (cond ((atom x)
        (setq lst1 (append lst1 (list x))))
      ((listp x)
        (setq lst1 (append lst1 (list:flatten x)))))))
```
</details>

---

### list:get-front-nth

**è¯´æ˜**: è¿”å›å‰ n ä¸ªå…ƒç´ 

**ç”¨æ³•**:
```lisp
(list:get-front-nth n lst)
```

**å‚æ•°**: 1 n  : æœªæ˜ç¡®å®šä¹‰;  2 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:get-front-nth (n lst)
    "è¿”å›å‰ n ä¸ªå…ƒç´ "
    (if (= n 0)
        nil (cons (car lst)
            (list:get-front-nth (1- n)
                (cdr lst)))))
```
</details>

---

### list:get-ubound

**è¯´æ˜**: å¾—åˆ°è¡¨çš„å„ç»´æ•°é•¿åº¦ï¼Œæœ€å¤šæ”¯æŒåˆ°ä¸‰ç»´

**ç”¨æ³•**:
```lisp
(list:get-ubound lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:get-ubound (lst)
    "å¾—åˆ°è¡¨çš„å„ç»´æ•°é•¿åº¦ï¼Œæœ€å¤šæ”¯æŒåˆ°ä¸‰ç»´"
    (if (atom lst)
        (quote (0 0 0))
        (list (vl-list-length lst)
            (apply (quote max)
                (mapcar (quote vl-list-length)
                    lst))
            (apply (quote max)
                (mapcar (quote vl-list-length)
                    (apply (quote append)
                        lst))))))
```
</details>

---

### list:group-by

**è¯´æ˜**: å¯¹å·²æ’åºçš„åˆ—è¡¨lstè¿›è¡Œåˆ†ç»„ã€‚funä¸ºåˆ†ç»„ä¾æ®

**ç”¨æ³•**:
```lisp
(list:group-by lst fun)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 fun  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: lst

**ç¤ºä¾‹**:
```lisp
(list:group-by '(a a a b b c) '(lambda(x y)(= x y))) => ((a a a)(b b)(c))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:group-by (lst fun / res g)
  "å¯¹å·²æ’åºçš„åˆ—è¡¨lstè¿›è¡Œåˆ†ç»„ã€‚funä¸ºåˆ†ç»„ä¾æ®"
  "lst"
  "(list:group-by '(a a a b b c)
    '(lambda(x y)(= x y)))
  => ((a a a)(b b)(c))"
  (setq res nil)
  (setq g (cons (car lst)
      nil))
  (while (setq lst (cdr lst))
    (setq a% (car lst))
    (if ((eval fun)
        (car g)
        a%)
      (setq g (cons a% g))
      (progn (setq res (cons (reverse g)
            res))
        (setq g (cons a% nil)))))
  (if g (setq res (cons (reverse g)
        res)))
  (reverse res))
```
</details>

---

### list:indot->list

**è¯´æ˜**: å†…åµŒç‚¹è¡¨çš„è¡¨è½¬æ™®é€šè¡¨

**ç”¨æ³•**:
```lisp
(list:indot->list lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:indot->list (lst / tmplist)
    "å†…åµŒç‚¹è¡¨çš„è¡¨è½¬æ™®é€šè¡¨"
    (setq tmplist lst)
    (foreach i tmplist (if (dotpairp i)
            (setq lst (subst (list:dot->list i)
                    i lst))))
    lst)
```
</details>

---

### list:insert

**è¯´æ˜**: åœ¨åˆ—è¡¨lst çš„ç¬¬ index é¡¹å‰æ’å…¥é¡¹ itemã€‚

**ç”¨æ³•**:
```lisp
(list:insert lst index item)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 index  : ç´¢å¼•å€¼;  3 item  : é¡¹æˆ–é¡¹å€¼;

**è¿”å›å€¼**: æ’å…¥é¡¹åçš„åˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(list:insert '(0 1 2 3) 1 5)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:insert (lst index item)
    "åœ¨åˆ—è¡¨lst çš„ç¬¬ index é¡¹å‰æ’å…¥é¡¹ itemã€‚"
    "æ’å…¥é¡¹åçš„åˆ—è¡¨"
    "(list:insert '(0 1 2 3)
        1 5)"
    (if (zerop index)
        (cons item lst)
        (cons (car lst)
            (list:insert (cdr lst)
                (1- index)
                item))))
```
</details>

---

### list:insert-nth

**è¯´æ˜**: æ’å…¥å…ƒç´ vaåˆ°lstè¡¨çš„ç¬¬nä½

**ç”¨æ³•**:
```lisp
(list:insert-nth value n lst)
```

**å‚æ•°**: 1 value  : å€¼;  2 n  : æœªæ˜ç¡®å®šä¹‰;  3 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:insert-nth (value n lst)
    "æ’å…¥å…ƒç´ vaåˆ°lstè¡¨çš„ç¬¬nä½"
    (if (= n 0)
        (cons value lst)
        (cons (car lst)
            (list:insert-nth value (1- n)
                (cdr lst)))))
```
</details>

---

### list:intersect

**è¯´æ˜**: æ±‚ä¸¤ä¸ªåˆ—è¡¨é›†åˆçš„äº¤é›†

**ç”¨æ³•**:
```lisp
(list:intersect lst1 lst2)
```

**å‚æ•°**: 1 lst1  : åˆ—è¡¨;2 lst2  : åˆ—è¡¨;

**è¿”å›å€¼**: List

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:intersect (lst1 lst2 / res)
  "æ±‚ä¸¤ä¸ªåˆ—è¡¨é›†åˆçš„äº¤é›†"
  "List"
  (if (null *fuzz*)
    (setq *fuzz* 0.0001))
  (foreach a lst2 (if (list:member a lst1 *fuzz*)
      (setq res (cons a res))))
  res)
```
</details>

---

### list:intersection

**è¯´æ˜**: æ±‚ä¸¤ä¸ªåˆ—è¡¨çš„äº¤é›†

**ç”¨æ³•**:
```lisp
(list:intersection lst1 lst2)
```

**å‚æ•°**: 1 lst1  : åˆ—è¡¨;2 lst2  : åˆ—è¡¨;

**è¿”å›å€¼**: List

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:intersection (lst1 lst2 / res)
  "æ±‚ä¸¤ä¸ªåˆ—è¡¨çš„äº¤é›†"
  "List"
  (foreach a lst2 (if (member a lst1)
      (setq res (cons a res))))
  res)
```
</details>

---

### list:item-num

**è¯´æ˜**: è¡¨ä¸­å…ƒç´ åŠæ•°é‡

**ç”¨æ³•**:
```lisp
(list:item-num lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:item-num (lst / l2 tmp tmp1)
    "è¡¨ä¸­å…ƒç´ åŠæ•°é‡"
    (while (setq l2 (cons (list (setq tmp1 (car lst))
                    (- (length lst)
                        (length (setq tmp (vl-remove tmp1 lst)))))
                l2)
            lst tmp))
    (reverse l2))
```
</details>

---

### list:ltrim

**è¯´æ˜**: åˆ é™¤è¡¨å¤´å‰mé¡¹

**ç”¨æ³•**:
```lisp
(list:ltrim lst m)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 m  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:ltrim (lst m)
    "åˆ é™¤è¡¨å¤´å‰mé¡¹"
    (cond ((or (zerop m)
                (minusp m)
                (>= m (length lst)))
            lst)
        (t (repeat m (setq lst (cdr lst))))))
```
</details>

---

### list:make-same

**è¯´æ˜**: ç”Ÿæˆnumä¸ªç›¸åŒå…ƒç´  element çš„åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(list:make-same element num)
```

**å‚æ•°**: 1 element  : æœªè¯†åˆ«å®šä¹‰;2 num  : æ•°å€¼;

**è¿”å›å€¼**: list

**ç¤ºä¾‹**:
```lisp
(list:make-same 'a 5)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:make-same (element num / lst)
  "ç”Ÿæˆnumä¸ªç›¸åŒå…ƒç´  element çš„åˆ—è¡¨"
  "list"
  "(list:make-same 'a 5)"
  (repeat (fix num)
    (setq lst (cons element lst))))
```
</details>

---

### list:member

**è¯´æ˜**: æ”¯æŒæµ®ç‚¹æ•°çš„member

**ç”¨æ³•**:
```lisp
(list:member ele lst fuzz)
```

**å‚æ•°**: 1 ele  : æœªè¯†åˆ«å®šä¹‰;2 lst  : åˆ—è¡¨;3 fuzz  : å®¹å·®;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:member (ele lst fuzz)
  "æ”¯æŒæµ®ç‚¹æ•°çš„member"
  (if lst (cond ((list:equal ele (car lst)
          fuzz)
        lst)
      (t (list:member ele (cdr lst)
          fuzz)))))
```
</details>

---

### list:move

**è¯´æ˜**: åˆ—è¡¨å¾ªç¯ç§»åŠ¨

**ç”¨æ³•**:
```lisp
(list:move lst n)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 n  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:move (lst n)
    "åˆ—è¡¨å¾ªç¯ç§»åŠ¨"
    (repeat (abs n)
        (if (minusp n)
            (setq lst (append (list (last lst))
                    (list:rtrim lst 1)))
            (setq lst (append (cdr lst)
                    (list (car lst)))))))
```
</details>

---

### list:positions

**è¯´æ˜**: è·å–å…ƒç´  item åœ¨ è¡¨ lst ä¸­çš„æ‰€æœ‰ä½ç½®ã€‚

**ç”¨æ³•**:
```lisp
(list:positions item lst)
```

**å‚æ•°**: 1 item  : é¡¹æˆ–é¡¹å€¼;2 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: list

**ç¤ºä¾‹**:
```lisp
(list:postions 'a '(a b a)) => (0 2)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:positions (item lst / res)
  "è·å–å…ƒç´  item åœ¨ è¡¨ lst ä¸­çš„æ‰€æœ‰ä½ç½®ã€‚"
  "list"
  "(list:postions 'a '(a b a))
  => (0 2)"
  (setq l (length lst))
  (while (setq lst (member item lst))
    (setq res (cons (- l (length lst))
        res))
    (setq lst (cdr lst)))
  (reverse res))
```
</details>

---

### list:range

**è¯´æ˜**: ç”Ÿæˆç­‰å·®æ•°åˆ—è¡¨ï¼Œç±»ä¼¼pythonçš„range()å‡½æ•°.å‚æ•°ï¼šstart:èµ·å§‹å€¼      end:ç»“æŸå€¼      step:ç­‰å·®å€¼

**ç”¨æ³•**:
```lisp
(list:range start end step)
```

**å‚æ•°**: 1 start  : æœªè¯†åˆ«å®šä¹‰;2 end  : å•ä¸ªå›¾å…ƒ;3 step  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: ç­‰å·®æ•°åˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(list:range 1 4 1);; => (1 2 3 4)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:range (start end step)
  "ç”Ÿæˆç­‰å·®æ•°åˆ—è¡¨ï¼Œç±»ä¼¼pythonçš„range()å‡½æ•°.\nå‚æ•°ï¼šstart:èµ·å§‹å€¼\n      end:ç»“æŸå€¼\n      step:ç­‰å·®å€¼"
  "ç­‰å·®æ•°åˆ—è¡¨"
  "(list:range 1 4 1);; => (1 2 3 4)"
  (if (> start end)
    (quote nil)
    (cons start (list:range (+ start step)
        end step))))
```
</details>

---

### list:remove-duplicate-keys

**è¯´æ˜**: åˆ é™¤ç‚¹å¯¹è¡¨ä¸­é‡å¤çš„keyï¼Œå³å­è¡¨ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ å”¯ä¸€ã€‚

**ç”¨æ³•**:
```lisp
(list:remove-duplicate-keys lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:remove-duplicate-keys (lst)
  "åˆ é™¤ç‚¹å¯¹è¡¨ä¸­é‡å¤çš„keyï¼Œå³å­è¡¨ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ å”¯ä¸€ã€‚"
  (if lst (cons (car lst)
      (list:remove-duplicate-keys (vl-remove-if (quote (lambda (x)
              (eq (caar lst)
                (car x))))
          lst)))))
```
</details>

---

### list:remove-duplicates

**è¯´æ˜**: åˆ é™¤åˆ—è¡¨ä¸­é‡å¤çš„åŸå­ã€‚

**ç”¨æ³•**:
```lisp
(list:remove-duplicates lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:remove-duplicates (lst)
    "åˆ é™¤åˆ—è¡¨ä¸­é‡å¤çš„åŸå­ã€‚"
    (if lst (cons (car lst)
            (list:remove-duplicates (vl-remove (car lst)
                    lst)))))
```
</details>

---

### list:remove-front-nth

**è¯´æ˜**: åˆ é™¤åˆ—è¡¨ä¸­è¡¨çš„å‰nä¸ªå…ƒç´ 

**ç”¨æ³•**:
```lisp
(list:remove-front-nth n lst)
```

**å‚æ•°**: 1 n  : æœªæ˜ç¡®å®šä¹‰;  2 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:remove-front-nth (n lst)
    "åˆ é™¤åˆ—è¡¨ä¸­è¡¨çš„å‰nä¸ªå…ƒç´ "
    (if (= n 0)
        lst (list:remove-front-nth (1- n)
            (cdr lst))))
```
</details>

---

### list:remove-index

**è¯´æ˜**: æŒ‰ç´¢å¼•åˆ é™¤åˆ—è¡¨çš„é¡¹,leemac

**ç”¨æ³•**:
```lisp
(list:remove-index lst index)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 index  : ç´¢å¼•å€¼;

**è¿”å›å€¼**: åˆ é™¤ç´¢å¼•é¡¹ä¹‹åçš„åˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(list:RemoveIndex '(0 1 2 3) 1)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:remove-index (lst index / i)
    "æŒ‰ç´¢å¼•åˆ é™¤åˆ—è¡¨çš„é¡¹,leemac"
    "åˆ é™¤ç´¢å¼•é¡¹ä¹‹åçš„åˆ—è¡¨"
    "(list:removeindex '(0 1 2 3)
        1)"
    (setq i -1)
    (vl-remove-if (quote (lambda (x)
                (= (setq i (1+ i))
                    index)))
        lst))
```
</details>

---

### list:remove-nth

**è¯´æ˜**: åˆ é™¤lstè¡¨çš„ç¬¬nä¸ªå…ƒç´ 

**ç”¨æ³•**:
```lisp
(list:remove-nth n lst)
```

**å‚æ•°**: 1 n  : æœªæ˜ç¡®å®šä¹‰;  2 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:remove-nth (n lst)
    "åˆ é™¤lstè¡¨çš„ç¬¬nä¸ªå…ƒç´ "
    (if (= n 0)
        (cdr lst)
        (cons (car lst)
            (list:remove-nth (1- n)
                (cdr lst)))))
```
</details>

---

### list:remove-once

**è¯´æ˜**: åˆ é™¤è¡¨ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„å…ƒç´ 

**ç”¨æ³•**:
```lisp
(list:remove-once lst item)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 item  : é¡¹æˆ–é¡¹å€¼;

**è¿”å›å€¼**: åˆ é™¤å…ƒç´ åçš„è¡¨

**ç¤ºä¾‹**:
```lisp
(list:remove-once '(1 2 3 4 3)        3)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:remove-once (lst item / f)
  "åˆ é™¤è¡¨ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„å…ƒç´ "
  "åˆ é™¤å…ƒç´ åçš„è¡¨"
  "(list:remove-once '(1 2 3 4 3)\n        3)"
  (setq f equal)
  (vl-remove-if (quote (lambda (a)
        (if (f a item)
          (setq f (lambda (a b)
              nil)))))
    lst))
```
</details>

---

### list:replace-index

**è¯´æ˜**: æŒ‰ç´¢å¼•æ›¿æ¢åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(list:replace-index oldlst index item)
```

**å‚æ•°**: 1 oldlst  : æœªæ˜ç¡®å®šä¹‰;  2 index  : ç´¢å¼•å€¼;  3 item  : é¡¹æˆ–é¡¹å€¼;

**è¿”å›å€¼**: æ›¿æ¢åçš„åˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(list:reeplace-index '(0 1 2 3) 1 5)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:replace-index (oldlst index item)
    "æŒ‰ç´¢å¼•æ›¿æ¢åˆ—è¡¨"
    "æ›¿æ¢åçš„åˆ—è¡¨"
    "(list:reeplace-index '(0 1 2 3)
        1 5)"
    (if (zerop index)
        (append (list item)
            (cdr oldlst))
        (cons (car oldlst)
            (list:replace-index (cdr oldlst)
                (1- index)
                item))))
```
</details>

---

### list:replace[m,n]

**è¯´æ˜**: æŒ‰ç´¢å¼•æ›¿æ¢åˆ—è¡¨ç¬¬må­è¡¨çš„ç¬¬né¡¹

**ç”¨æ³•**:
```lisp
(list:replace[m,n] oldlst m n item)
```

**å‚æ•°**: 1 oldlst  : æœªæ˜ç¡®å®šä¹‰;  2 m  : æœªæ˜ç¡®å®šä¹‰;  3 n  : æœªæ˜ç¡®å®šä¹‰;  4 item  : é¡¹æˆ–é¡¹å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:replace[m,n] (oldlst m n item)
    "æŒ‰ç´¢å¼•æ›¿æ¢åˆ—è¡¨ç¬¬må­è¡¨çš„ç¬¬né¡¹"
    (list:replace-index oldlst m (list:replace-index (nth m oldlst)
            n item)))
```
</details>

---

### list:rm-m2n

**è¯´æ˜**: åˆ é™¤åˆ—è¡¨çš„ç¬¬mè‡³né¡¹ï¼Œç´¢å¼•å€¼ä»0è®¡ç®—

**ç”¨æ³•**:
```lisp
(list:rm-m2n lst m n)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 m  : æœªæ˜ç¡®å®šä¹‰;  3 n  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:rm-m2n (lst m n / len i)
    "åˆ é™¤åˆ—è¡¨çš„ç¬¬mè‡³né¡¹ï¼Œç´¢å¼•å€¼ä»0è®¡ç®—"
    (cond ((< m 0)
            (setq m 0))
        ((> n (setq len (length lst)))
            (setq n len)))
    (setq i -1)
    (vl-remove-if (quote (lambda (x)
                (and (<= m (setq i (1+ i)))
                    (<= i n))))
        lst))
```
</details>

---

### list:rtrim

**è¯´æ˜**: åˆ é™¤è¡¨å°¾mé¡¹

**ç”¨æ³•**:
```lisp
(list:rtrim lst m)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 m  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:rtrim (lst m)
    "åˆ é™¤è¡¨å°¾mé¡¹"
    (reverse (list:ltrim (reverse lst)
            m)))
```
</details>

---

### list:same

**è¯´æ˜**: æŸ¥æ‰¾è¡¨ä¸­é‡å¤å…ƒç´ 

**ç”¨æ³•**:
```lisp
(list:same lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:same (lst)
    "æŸ¥æ‰¾è¡¨ä¸­é‡å¤å…ƒç´ "
    (if lst (if (member (car lst)
                (cdr lst))
            (cons (car lst)
                (list:same (vl-remove (car lst)
                        (cdr lst))))
            (list:same (vl-remove (car lst)
                    (cdr lst))))))
```
</details>

---

### list:same-num

**è¯´æ˜**: è¡¨ä¸­ç›¸åŒå…ƒç´ åŠæ•°é‡

**ç”¨æ³•**:
```lisp
(list:same-num lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:same-num (lst / l2 tmp)
    "è¡¨ä¸­ç›¸åŒå…ƒç´ åŠæ•°é‡"
    (while (setq tmp (vl-remove (car lst)
                lst)
            l2 (if (member (car lst)
                    (cdr lst))
                (cons (list (car lst)
                        (- (length lst)
                            (length tmp)))
                    l2)
                l2)
            lst tmp))
    (reverse l2))
```
</details>

---

### list:search-index

**è¯´æ˜**: ä»¥ç´¢å¼•æŸ¥æ‰¾è¡¨ä¸­å…ƒç´ ;  å‚æ•°ï¼š;    lst:åˆ—è¡¨;    index:ç´¢å¼•æˆ–è€…ç´¢å¼•è¡¨

**ç”¨æ³•**:
```lisp
(list:search-index lst index)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 index  : ç´¢å¼•å€¼;

**è¿”å›å€¼**: æŸ¥æ‰¾åˆ°çš„å…ƒç´ ç»„æˆçš„è¡¨

**ç¤ºä¾‹**:
```lisp
(list:Search-Index '(1 2 3 4) 3)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:search-index (lst index)
    "ä»¥ç´¢å¼•æŸ¥æ‰¾è¡¨ä¸­å…ƒç´ \nå‚æ•°ï¼š\n  lst:åˆ—è¡¨\n  index:ç´¢å¼•æˆ–è€…ç´¢å¼•è¡¨"
    "æŸ¥æ‰¾åˆ°çš„å…ƒç´ ç»„æˆçš„è¡¨"
    "(list:search-index '(1 2 3 4)
        3)"
    (mapcar (quote (lambda (x)
                (nth x lst)))
        (if (atom index)
            (list index)
            index)))
```
</details>

---

### list:search-item

**è¯´æ˜**: æŸ¥æ‰¾è¡¨ä¸­å…ƒç´ çš„ç´¢å¼•ï¼Œç´¢å¼•ä»0å¼€å§‹

**ç”¨æ³•**:
```lisp
(list:search-item lst item)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 item  : é¡¹æˆ–é¡¹å€¼;

**è¿”å›å€¼**: ç´¢å¼•å€¼è¡¨

**ç¤ºä¾‹**:
```lisp
(list:search-item '(1 2 3 4) 3)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:search-item (lst item / i result)
    "æŸ¥æ‰¾è¡¨ä¸­å…ƒç´ çš„ç´¢å¼•ï¼Œç´¢å¼•ä»0å¼€å§‹"
    "ç´¢å¼•å€¼è¡¨"
    "(list:search-item '(1 2 3 4)
        3)"
    (setq i 0)
    (foreach x lst (if (= x item)
            (setq result (cons i result)))
        (setq i (1+ i)))
    (reverse result))
```
</details>

---

### list:set-nth

**è¯´æ˜**: æ›´æ–°lstè¡¨çš„ç¬¬nä¸ªå…ƒç´ ä¸ºvalue

**ç”¨æ³•**:
```lisp
(list:set-nth value n lst)
```

**å‚æ•°**: 1 value  : å€¼;  2 n  : æœªæ˜ç¡®å®šä¹‰;  3 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:set-nth (value n lst)
    "æ›´æ–°lstè¡¨çš„ç¬¬nä¸ªå…ƒç´ ä¸ºvalue"
    (if (= n 0)
        (cons value (cdr lst))
        (cons (car lst)
            (list:set-nth value (1- n)
                (cdr lst)))))
```
</details>

---

### list:sort

**è¯´æ˜**: æ— æŸæ’åºï¼Œvl-sort å¯èƒ½ä¼šåˆ é™¤ç›¸åŒçš„å…ƒç´ ï¼Œå¯¼è‡´ç»“æœåˆ—è¡¨å†…çš„ä¸ªæ•°å°äºåŸåˆ—è¡¨ã€‚list:sort ä¸ä¼šåˆ é™¤è¡¨å†…å…ƒç´ ã€‚fun:æ’åºä¾æ®

**ç”¨æ³•**:
```lisp
(list:sort lst fun)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 fun  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: lst

**ç¤ºä¾‹**:
```lisp
(list:sort '(1 2 3 1 2) '<)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:sort (lst fun / res)
  "æ— æŸæ’åºï¼Œvl-sort å¯èƒ½ä¼šåˆ é™¤ç›¸åŒçš„å…ƒç´ ï¼Œå¯¼è‡´ç»“æœåˆ—è¡¨å†…çš„ä¸ªæ•°å°äºåŸåˆ—è¡¨ã€‚list:sort ä¸ä¼šåˆ é™¤è¡¨å†…å…ƒç´ ã€‚fun:æ’åºä¾æ®"
  "lst"
  "(list:sort '(1 2 3 1 2)
    '<)"
  (setq res (cons (car lst)
      nil))
  (while (setq lst (cdr lst))
    (if ((eval fun)
        (car res)
        (car lst))
      (setq res (cons (car lst)
          res))
      (progn (setq tmp (cons (car res)
            nil))
        (while (and (> (length res)
              0)
            ((eval fun)
              (car lst)
              (car tmp)))
          (setq tmp (cons (car (setq res (cdr res)))
              tmp)))
        (setq res (append (reverse (cdr tmp))
            (list (car lst))
            res)))))
  (reverse res))
```
</details>

---

### list:split

**è¯´æ˜**: åˆ—è¡¨åˆ‡åˆ†,ä¸è¶³éƒ¨åˆ†çœç•¥ï¼Œæ­¤å‡½æ•°è¿”å›ç»“æœç›¸å¯¹list:split-2dã€list:split-3dä¸¤ä¸ªç‰¹æ®Šå‡½æ•°æ¯”è¾ƒåˆç†

**ç”¨æ³•**:
```lisp
(list:split lst x)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 x  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:split (lst x / lst2)
    "åˆ—è¡¨åˆ‡åˆ†,ä¸è¶³éƒ¨åˆ†çœç•¥ï¼Œæ­¤å‡½æ•°è¿”å›ç»“æœç›¸å¯¹list:split-2dã€list:split-3dä¸¤ä¸ªç‰¹æ®Šå‡½æ•°æ¯”è¾ƒåˆç†"
    (foreach n lst (if (and lst2 (/= x (length (car lst2))))
            (setq lst2 (cons (append (car lst2)
                        (list n))
                    (cdr lst2)))
            (setq lst2 (cons (list n)
                    lst2))))
    (reverse lst2))
```
</details>

---

### list:split-2d

**è¯´æ˜**: åˆ—è¡¨æŒ‰é¡ºåºåˆ‡åˆ†ä¸º2å…ƒç´ è¡¨ç»„æˆçš„è¡¨,ä¸è¶³éƒ¨åˆ†ç”¨nilè¡¨ç¤º

**ç”¨æ³•**:
```lisp
(list:split-2d lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:split-2d (lst)
    "åˆ—è¡¨æŒ‰é¡ºåºåˆ‡åˆ†ä¸º2å…ƒç´ è¡¨ç»„æˆçš„è¡¨,ä¸è¶³éƒ¨åˆ†ç”¨nilè¡¨ç¤º"
    (if lst (cons (list (car lst)
                (cadr lst))
            (list:split-2d (cddr lst)))))
```
</details>

---

### list:split-3d

**è¯´æ˜**: åˆ—è¡¨æŒ‰é¡ºåºåˆ‡åˆ†ä¸º3å…ƒç´ è¡¨ç»„æˆçš„è¡¨,ä¸è¶³éƒ¨åˆ†ç”¨nilè¡¨ç¤º

**ç”¨æ³•**:
```lisp
(list:split-3d lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: ((x x x )(x x x)...)

**ç¤ºä¾‹**:
```lisp
(list:split-3d '(1 2 3 4))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:split-3d (lst)
    "åˆ—è¡¨æŒ‰é¡ºåºåˆ‡åˆ†ä¸º3å…ƒç´ è¡¨ç»„æˆçš„è¡¨,ä¸è¶³éƒ¨åˆ†ç”¨nilè¡¨ç¤º"
    "((x x x )(x x x)...)"
    "(list:split-3d '(1 2 3 4))"
    (if lst (cons (list (car lst)
                (cadr lst)
                (caddr lst))
            (list:split-3d (cdddr lst)))))
```
</details>

---

### list:split-by

**è¯´æ˜**: æŒ‰ç»™å®šçš„æ¡ä»¶æ‹†åˆ†è¡¨

**ç”¨æ³•**:
```lisp
(list:split-by lst fun)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 fun  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: ç”±lstç»„æˆçš„lst

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:split-by (lst fun / res lst-sub)
  "æŒ‰ç»™å®šçš„æ¡ä»¶æ‹†åˆ†è¡¨"
  "ç”±lstç»„æˆçš„lst"
  ""
  (setq res nil)
  (setq lst-sub nil)
  (foreach sub% lst (if ((eval fun)
        sub%)
      (progn (setq res (cons (reverse lst-sub)
            res))
        (setq lst-sub (cons sub% nil)))
      (setq lst-sub (cons sub% lst-sub))))
  (if (car lst-sub)
    (setq res (cons (reverse lst-sub)
        res)))
  (reverse res))
```
</details>

---

### list:split-index

**è¯´æ˜**: æ ¹æ®ç´¢å¼•åˆ†å‰²åˆ—è¡¨ï¼Œç´¢å¼•ä»0å¼€å§‹

**ç”¨æ³•**:
```lisp
(list:split-index lst index)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 index  : ç´¢å¼•å€¼;

**è¿”å›å€¼**: ç´¢å¼•å‰åå…ƒç´ ç»„æˆçš„è¡¨ï¼Œå…¶ä¸­ç´¢å¼•æ‰€æŒ‡å‘çš„å…ƒç´ ä½äºç¬¬äºŒä¸ªå­è¡¨çš„è¡¨å¤´

**ç¤ºä¾‹**:
```lisp
(list:split-index '(1 2 3 4) 2)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:split-index (lst index / result tmp)
    "æ ¹æ®ç´¢å¼•åˆ†å‰²åˆ—è¡¨ï¼Œç´¢å¼•ä»0å¼€å§‹"
    "ç´¢å¼•å‰åå…ƒç´ ç»„æˆçš„è¡¨ï¼Œå…¶ä¸­ç´¢å¼•æ‰€æŒ‡å‘çš„å…ƒç´ ä½äºç¬¬äºŒä¸ªå­è¡¨çš„è¡¨å¤´"
    "(list:split-index '(1 2 3 4)
        2)"
    (setq tmp lst)
    (repeat index (setq result (cons (car tmp)
                result))
        (setq tmp (cdr tmp)))
    (list (reverse result)
        (list:ltrim lst index)))
```
</details>

---

### list:sublist

**è¯´æ˜**: è·å–å­åˆ—è¡¨,leemac

**ç”¨æ³•**:
```lisp
(list:sublist lst idx len)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 idx  : æœªæ˜ç¡®å®šä¹‰;  3 len  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: å­åˆ—è¡¨

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:sublist (lst idx len / rtn)
    "è·å–å­åˆ—è¡¨,leemac"
    "å­åˆ—è¡¨"
    (setq len (if len (min len (- (length lst)
                    idx))
            (- (length lst)
                idx))
        idx (+ idx len))
    (repeat len (setq rtn (cons (nth (setq idx (1- idx))
                    lst)
                rtn))))
```
</details>

---

### list:subsetp

**è¯´æ˜**: æ£€æŸ¥subæ˜¯å¦ä¸ºsupçš„å­é›†

**ç”¨æ³•**:
```lisp
(list:subsetp sub sup)
```

**å‚æ•°**: 1 sub  : æœªè¯†åˆ«å®šä¹‰;2 sup  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: t nil

**ç¤ºä¾‹**:
```lisp
(list:subsetp sub sup) æ£€æŸ¥subæ˜¯å¦ä¸ºsupçš„å­é›†
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:subsetp (sub sup)
  "æ£€æŸ¥subæ˜¯å¦ä¸ºsupçš„å­é›†"
  "t nil"
  "(list:subsetp sub sup)
  æ£€æŸ¥subæ˜¯å¦ä¸ºsupçš„å­é›†"
  (cond ((null sub)
      t)
    ((member (car sub)
        sup)
      (list:subsetp (cdr sub)
        sup))
    (t nil)))
```
</details>

---

### list:subst

**è¯´æ˜**: ç½®æ¢è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ 

**ç”¨æ³•**:
```lisp
(list:subst n a l)
```

**å‚æ•°**: 1 n  : æœªæ˜ç¡®å®šä¹‰;  2 a  : æœªæ˜ç¡®å®šä¹‰;  3 l  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:subst (n a l)
    "ç½®æ¢è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ "
    (cond ((numberp n)
            (if (zerop n)
                (append (list a)
                    (cdr l))
                (cons (car l)
                    (list:subst (1- n)
                        a (cdr l)))))
        ((listp n)
            (cond ((equal (length n)
                        1)
                    (if (zerop (car n))
                        (append (list a)
                            (cdr l))
                        (cons (car l)
                            (list:subst (1- (car n))
                                a (cdr l)))))
                ((> (length n)
                        1)
                    (if (zerop (car n))
                        (cons (list:subst (cdr n)
                                a (car l))
                            (cdr l))
                        (cons (car l)
                            (list:subst (append (list (1- (car n)))
                                    (cdr n))
                                a (cdr l)))))))))
```
</details>

---

### list:trim

**è¯´æ˜**: åˆ é™¤è¡¨å¤´å‰mé¡¹ï¼Œè¡¨å°¾å‰né¡¹

**ç”¨æ³•**:
```lisp
(list:trim lst m n)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;  2 m  : æœªæ˜ç¡®å®šä¹‰;  3 n  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:trim (lst m n)
    "åˆ é™¤è¡¨å¤´å‰mé¡¹ï¼Œè¡¨å°¾å‰né¡¹"
    (list:ltrim (list:rtrim lst n)
        m))
```
</details>

---

### list:union

**è¯´æ˜**: æ±‚ä¸¤ä¸ªé›†åˆçš„å¹¶é›†

**ç”¨æ³•**:
```lisp
(list:union lst1 lst2)
```

**å‚æ•°**: 1 lst1  : åˆ—è¡¨;2 lst2  : åˆ—è¡¨;

**è¿”å›å€¼**: list

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun list:union (lst1 lst2 / lst)
  "æ±‚ä¸¤ä¸ªé›†åˆçš„å¹¶é›†"
  "list"
  (if (null *fuzz*)
    (setq *fuzz* 0.001))
  (setq lst lst1)
  (foreach a lst2 (if (not (list:member a lst *fuzz*))
      (setq lst (cons a lst))))
  lst)
```
</details>

---

## m

**æ¨¡å—è¯´æ˜**: æ•°å­¦è¿ç®—ã€ä¸‰è§’å‡½æ•°

### m:acos

**è¯´æ˜**: è®¡ç®—åä½™å¼¦å€¼

**ç”¨æ³•**:
```lisp
(m:acos x)
```

**å‚æ•°**: 1 x  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:acos (x)
    "è®¡ç®—åä½™å¼¦å€¼"
    (if (<= -1.0 x 1.0)
        (atan (sqrt (- 1.0 (* x x)))
            x)))
```
</details>

---

### m:arcosh

**è¯´æ˜**: è®¡ç®—ååŒæ›²ä½™å¼¦å€¼

**ç”¨æ³•**:
```lisp
(m:arcosh x)
```

**å‚æ•°**: 1 x  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:arcosh (x)
    "è®¡ç®—ååŒæ›²ä½™å¼¦å€¼"
    (if (<= 1.0 x)
        (log (+ x (sqrt (1- (* x x)))))))
```
</details>

---

### m:arsinh

**è¯´æ˜**: è®¡ç®—ååŒæ›²æ­£å¼¦å€¼

**ç”¨æ³•**:
```lisp
(m:arsinh x)
```

**å‚æ•°**: 1 x  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:arsinh (x)
    "è®¡ç®—ååŒæ›²æ­£å¼¦å€¼"
    (log (+ x (sqrt (1+ (* x x))))))
```
</details>

---

### m:artanh

**è¯´æ˜**: è®¡ç®—ååŒæ›²æ­£åˆ‡å€¼

**ç”¨æ³•**:
```lisp
(m:artanh x)
```

**å‚æ•°**: 1 x  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:artanh (x)
    "è®¡ç®—ååŒæ›²æ­£åˆ‡å€¼"
    (if (< (abs x)
            1.0)
        (/ (log (/ (1+ x)
                    (- 1.0 x)))
            2.0)))
```
</details>

---

### m:asin

**è¯´æ˜**: è®¡ç®—åæ­£å¼¦å€¼

**ç”¨æ³•**:
```lisp
(m:asin x)
```

**å‚æ•°**: 1 x  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:asin (x)
    "è®¡ç®—åæ­£å¼¦å€¼"
    (if (<= -1.0 x 1.0)
        (atan x (sqrt (- 1.0 (* x x))))))
```
</details>

---

### m:azimuth

**è¯´æ˜**: è®¡ç®—æŸä¸ªè§’åº¦(ä»¥xè½´æ­£å‘ï¼Œé€†æ—¶é’ˆ)çš„æ–¹ä½è§’(ä»¥Yè½´æ­£å‘ï¼Œé¡ºæ—¶é’ˆ)

**ç”¨æ³•**:
```lisp
(m:azimuth ang)
```

**å‚æ•°**: 1 ang  : è§’åº¦å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:azimuth (ang)
    "è®¡ç®—æŸä¸ªè§’åº¦(ä»¥xè½´æ­£å‘ï¼Œé€†æ—¶é’ˆ)çš„æ–¹ä½è§’(ä»¥yè½´æ­£å‘ï¼Œé¡ºæ—¶é’ˆ)"
    (cond ((= ang 0)
            (setq ang (* 0.5 pi)))
        ((= ang (* 0.5 pi))
            (setq ang 0))
        ((= ang pi)
            (setq ang (* 1.5 pi)))
        ((= ang (* 1.5 pi))
            (setq ang pi))
        ((= ang (* 2 pi))
            (setq ang 0))
        ((and (< ang (* 0.5 pi))
                (> ang 0))
            (setq ang (- (* 0.5 pi)
                    ang)))
        (t (setq ang (- (* 2.5 pi)
                    ang)))))
```
</details>

---

### m:base->base

**è¯´æ˜**: è¿›åˆ¶è½¬æ¢

**ç”¨æ³•**:
```lisp
(m:base->base n b1 b2)
```

**å‚æ•°**: 1 n  : æœªæ˜ç¡®å®šä¹‰;  2 b1  : æœªæ˜ç¡®å®šä¹‰;  3 b2  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:base->base (n b1 b2)
    "è¿›åˆ¶è½¬æ¢"
    (m:dec->base (m:base->dec n b1)
        b2))
```
</details>

---

### m:base->dec

**è¯´æ˜**: è¿›åˆ¶è½¬æ¢

**ç”¨æ³•**:
```lisp
(m:base->dec n b)
```

**å‚æ•°**: 1 n  : æœªæ˜ç¡®å®šä¹‰;  2 b  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:base->dec (n b / l)
    "è¿›åˆ¶è½¬æ¢"
    (if (= 1 (setq l (strlen n)))
        (- (ascii n)
            (if (< (ascii n)
                    65)
                48 55))
        (+ (* b (m:base->dec (substr n 1 (1- l))
                    b))
            (m:base->dec (substr n l)
                b))))
```
</details>

---

### m:base2dec

**è¯´æ˜**: è¿›åˆ¶è½¬æ¢,strnum å­—ç¬¦ä¸²è¡¨ç¤ºçš„æ•°, int-b è¿›åˆ¶(2-36)

**ç”¨æ³•**:
```lisp
(m:base2dec strnum int-b)
```

**å‚æ•°**: 1 strnum  : å­—ç¬¦ä¸²;2 int-b  : æ•´æ•°;

**è¿”å›å€¼**: fixnum

**ç¤ºä¾‹**:
```lisp
(m:base2dec "B0A1" 16)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:base2dec (strnum int-b / l)
  "è¿›åˆ¶è½¬æ¢,strnum å­—ç¬¦ä¸²è¡¨ç¤ºçš„æ•°, int-b è¿›åˆ¶(2-36)"
  "fixnum"
  "(m:base2dec \"B0A1\"
    16)"
  (setq strnum (strcase strnum))
  (if (= 1 (setq l (strlen strnum)))
    (- (ascii strnum)
      (if (< (ascii strnum)
          65)
        48 55))
    (+ (* (float int-b)
        (m:base2dec (substr strnum 1 (1- l))
          (float int-b)))
      (m:base2dec (substr strnum l)
        (float int-b)))))
```
</details>

---

### m:cal

**è¯´æ˜**: æ ¹æ®ç»™å®šè¡¨è¾¾å¼è®¡ç®—ç»“æœ

**ç”¨æ³•**:
```lisp
(m:cal lst1 lst2 str)
```

**å‚æ•°**: 1 lst1  : åˆ—è¡¨;  2 lst2  : åˆ—è¡¨;  3 str  : å­—ç¬¦ä¸²;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:cal (lst1 lst2 str)
    "æ ¹æ®ç»™å®šè¡¨è¾¾å¼è®¡ç®—ç»“æœ"
    (if (not (list:exist (arx)
                "geomcal.arx"))
        (arxload "geomcal"
            "\nåŠ è½½geomcalå¤±è´¥ï¼"))
    (mapcar (quote set)
        lst1 lst2)
    (if (vl-every (quote (lambda (x)
                    (= (quote real)
                        (type x))))
            lst2)
        (cal (strcat "1.0*("
                    str ")"))
        (cal str)))
```
</details>

---

### m:calheight

**è¯´æ˜**: ç›®æ ‡ç‚¹çš„é«˜ç¨‹

**ç”¨æ³•**:
```lisp
(m:calheight pt1 pt2 podu)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;  2 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;  3 podu  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:calheight (pt1 pt2 podu)
    "ç›®æ ‡ç‚¹çš„é«˜ç¨‹"
    (subst (+ (caddr pt1)
            (* podu (distance (geometry:point-3d->2d pt1)
                    (geometry:point-3d->2d pt2))))
        (caddr pt2)
        pt2))
```
</details>

---

### m:coord-chg

**ç”¨æ³•**:
```lisp
(m:coord-chg pt-wcs o-ucs o-ang)
```

**å‚æ•°**: 1 pt-wcs  : å•ä¸ª2D/3Dåæ ‡ç‚¹;  2 o-ucs  : æœªæ˜ç¡®å®šä¹‰;  3 o-ang  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:coord-chg (pt-wcs o-ucs o-ang / pt1a x y z)
    (setq pt1a (mapcar (quote -)
            pt-wcs o-ucs))
    (setq x (car pt1a))
    (setq y (cadr pt1a))
    (list (+ (* x (car o-ang))
            (* y (cadr o-ang)))
        (- (* y (car o-ang))
            (* x (cadr o-ang)))
        0))
```
</details>

---

### m:coordinate

**è¯´æ˜**: åæ ‡å‘é‡å˜æ¢

**ç”¨æ³•**:
```lisp
(m:coordinate p-base point2d)
```

**å‚æ•°**: 1 p-base  : æœªæ˜ç¡®å®šä¹‰;  2 point2d  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:coordinate (p-base point2d / x y z)
    "åæ ‡å‘é‡å˜æ¢"
    (setq x (car point2d))
    (setq y (cadr point2d))
    (list (+ (car p-base)
            x)
        (+ (cadr p-base)
            y)
        (last p-base)))
```
</details>

---

### m:coordinate-rotate

**è¯´æ˜**: åæ ‡æ—‹è½¬

**ç”¨æ³•**:
```lisp
(m:coordinate-rotate point2d angle1)
```

**å‚æ•°**: 1 point2d  : æœªæ˜ç¡®å®šä¹‰;  2 angle1  : è§’åº¦å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:coordinate-rotate (point2d angle1 / x y)
    "åæ ‡æ—‹è½¬"
    (setq x (car point2d))
    (setq y (cadr point2d))
    (list (- (* x (cos angle1))
            (* y (sin angle1)))
        (+ (* x (sin angle1))
            (* y (cos angle1)))))
```
</details>

---

### m:coordinate-scale

**è¯´æ˜**: åæ ‡ç¼©æ”¾

**ç”¨æ³•**:
```lisp
(m:coordinate-scale point scale)
```

**å‚æ•°**: 1 point  : æœªæ˜ç¡®å®šä¹‰;  2 scale  : æ¯”ä¾‹å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:coordinate-scale (point scale)
    "åæ ‡ç¼©æ”¾"
    (mapcar (quote (lambda (a)
                (* scale a)))
        point))
```
</details>

---

### m:cosh

**è¯´æ˜**: è®¡ç®—åŒæ›²ä½™å¼¦å€¼

**ç”¨æ³•**:
```lisp
(m:cosh x)
```

**å‚æ•°**: 1 x  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:cosh (x)
    "è®¡ç®—åŒæ›²ä½™å¼¦å€¼"
    (/ (+ (exp x)
            (exp (- x)))
        2.0))
```
</details>

---

### m:dec->base

**è¯´æ˜**: è¿›åˆ¶è½¬æ¢

**ç”¨æ³•**:
```lisp
(m:dec->base n b)
```

**å‚æ•°**: 1 n  : æœªæ˜ç¡®å®šä¹‰;  2 b  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:dec->base (n b)
    "è¿›åˆ¶è½¬æ¢"
    (if (< n b)
        (chr (+ n (if (< n 10)
                    48 55)))
        (strcat (m:dec->base (/ n b)
                b)
            (m:dec->base (rem n b)
                b))))
```
</details>

---

### m:dec2base

**è¯´æ˜**: è¿›åˆ¶è½¬æ¢,fixnum æ•´æ•°å€¼, b è¿›åˆ¶

**ç”¨æ³•**:
```lisp
(m:dec2base fixnum b)
```

**å‚æ•°**: 1 fixnum  : æœªè¯†åˆ«å®šä¹‰;2 b  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: string

**ç¤ºä¾‹**:
```lisp
(m:dec2base 3323 16)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:dec2base (fixnum b)
  "è¿›åˆ¶è½¬æ¢,fixnum æ•´æ•°å€¼, b è¿›åˆ¶"
  "string"
  "(m:dec2base 3323 16)"
  (if (< fixnum b)
    (chr (+ fixnum (if (< fixnum 10)
          48 55)))
    (strcat (m:dec2base (/ fixnum b)
        b)
      (m:dec2base (rem fixnum b)
        b))))
```
</details>

---

### m:dec2hex

**è¯´æ˜**: å°†åè¿›åˆ¶æ•´æ•°è½¬æ¢ä¸º16è¿›åˆ¶ç¬¦å· 0XABçš„å½¢å¼

**ç”¨æ³•**:
```lisp
(m:dec2hex fixnum)
```

**å‚æ•°**: 1 fixnum  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: symbol

**ç¤ºä¾‹**:
```lisp
(m:dec2hex 45217) ;; => 0xB0A1
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:dec2hex (fixnum)
  "å°†åè¿›åˆ¶æ•´æ•°è½¬æ¢ä¸º16è¿›åˆ¶ç¬¦å· 0XABçš„å½¢å¼"
  "symbol"
  "(m:dec2hex 45217)
  ;; => 0xB0A1"
  (read (strcat "0x"
      (m:dec->base fixnum 16))))
```
</details>

---

### m:degress->radions

**è¯´æ˜**: è§’åº¦è½¬å¼§åº¦å‡½æ•°

**ç”¨æ³•**:
```lisp
(m:degress->radions degress)
```

**å‚æ•°**: 1 degress  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:degress->radions (degress)
    "è§’åº¦è½¬å¼§åº¦å‡½æ•°"
    (if (numberp degress)
        (* pi (/ degress 180.0))))
```
</details>

---

### m:difference

**è¯´æ˜**: åˆ—è¡¨å·®é›†

**ç”¨æ³•**:
```lisp
(m:difference lst1 lst2)
```

**å‚æ•°**: 1 lst1  : åˆ—è¡¨;  2 lst2  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:difference (lst1 lst2 / lst)
    "åˆ—è¡¨å·®é›†"
    (vl-remove-if (quote (lambda (x)
                (member x lst2)))
        lst1))
```
</details>

---

### m:dmm

**è¯´æ˜**: æ ¹æ®ç»™å®šå¼§åº¦è¿”å›åº¦åˆ†ç§’æ ¼å¼çš„è¡¨

**ç”¨æ³•**:
```lisp
(m:dmm ang)
```

**å‚æ•°**: 1 ang  : è§’åº¦å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:dmm (ang)
    "æ ¹æ®ç»™å®šå¼§åº¦è¿”å›åº¦åˆ†ç§’æ ¼å¼çš„è¡¨"
    (vl-remove-if (quote (lambda (x)
                (= ""
                    x)))
        (string:parse-by-lst (angtos ang 1 4)
            (quote ("d"
                    "'"
                    "\"")))))
```
</details>

---

### m:dms

**è¯´æ˜**: æ ¹æ®ç»™å®šåè¿›åˆ¶è§’åº¦è¿”å›åº¦åˆ†ç§’æ ¼å¼çš„è¡¨

**ç”¨æ³•**:
```lisp
(m:dms degress)
```

**å‚æ•°**: 1 degress  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:dms (degress / d x m s)
    "æ ¹æ®ç»™å®šåè¿›åˆ¶è§’åº¦è¿”å›åº¦åˆ†ç§’æ ¼å¼çš„è¡¨"
    (setq d (fix degress))
    (setq x (* (- degress d)
            60))
    (setq m (fix x))
    (setq s (* (- x m)
            60))
    (list d m s))
```
</details>

---

### m:evenp

**è¯´æ˜**: æµ‹è¯•ä¸€ä¸ªæ•´æ•°æ˜¯å¦ä¸ºå¶æ•°

**ç”¨æ³•**:
```lisp
(m:evenp n)
```

**å‚æ•°**: 1 n  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: T or nil

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:evenp (n)
  "æµ‹è¯•ä¸€ä¸ªæ•´æ•°æ˜¯å¦ä¸ºå¶æ•°"
  "T or nil"
  (= 0 (rem (fix n)
      2)))
```
</details>

---

### m:expmod

**ç”¨æ³•**:
```lisp
(m:expmod base exp1 m)
```

**å‚æ•°**: 1 base  : æœªè¯†åˆ«å®šä¹‰;2 exp1  : æœªè¯†åˆ«å®šä¹‰;3 m  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:expmod (base exp1 m)
  (setq base (float base))
  (setq exp1 (float exp1))
  (cond ((zerop exp1)
      1)
    ((m:evenp exp1)
      (rem (m:square (m:expmod base (/ (float exp1)
              2)
            m))
        m))
    (t (rem (* base (m:expmod base (- exp1 1)
            m))
        m))))
```
</details>

---

### m:factorial

**è¯´æ˜**: æ±‚n çš„é˜¶ä¹˜ã€‚æ–¯ç‰¹æ—å…¬å¼æ³•ã€‚;

**ç”¨æ³•**:
```lisp
(m:factorial n)
```

**å‚æ•°**: 1 n  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:factorial (n)
    "æ±‚n çš„é˜¶ä¹˜ã€‚æ–¯ç‰¹æ—å…¬å¼æ³•ã€‚\n"
    (* (sqrt (* 2 pi n))
        (expt (/ n (exp 1))
            n)))
```
</details>

---

### m:fast-expt

**ç”¨æ³•**:
```lisp
(m:fast-expt b n)
```

**å‚æ•°**: 1 b  : æœªè¯†åˆ«å®šä¹‰;2 n  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:fast-expt (b n)
  (cond ((zerop n)
      1)
    ((m:evenp n)
      (m:square (fast-expt b (/ n 2))))
    (t (* b (fast-expt b (1- n))))))
```
</details>

---

### m:fermat-test

**è¯´æ˜**: ç´ æ•°æµ‹è¯•

**ç”¨æ³•**:
```lisp
(m:fermat-test n)
```

**å‚æ•°**: 1 n  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: T or nil

**ç¤ºä¾‹**:
```lisp
(m:fermat-test 11)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:fermat-test (n / test-it)
  "ç´ æ•°æµ‹è¯•"
  "T or nil"
  "(m:fermat-test 11)"
  (defun test-it (a)
    (= (m:expmod a n n)
      a))
  (test-it (+ 1 (fix (m:random (- n 1))))))
```
</details>

---

### m:fix-angle

**è¯´æ˜**: ä½¿å¼§åº¦å€¼åœ¨ 0-2pi ä¹‹é—´ã€‚

**ç”¨æ³•**:
```lisp
(m:fix-angle angle0)
```

**å‚æ•°**: 1 angle0  : è§’åº¦å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:fix-angle (angle0)
  "ä½¿å¼§åº¦å€¼åœ¨ 0-2pi ä¹‹é—´ã€‚"
  (while (< angle0 0)
    (setq angle0 (+ pi pi angle0)))
  (while (>= angle0 (* pi 2))
    (setq angle0 (- angle0 (* pi 2))))
  angle0)
```
</details>

---

### m:gcd

**è¯´æ˜**: æ±‚æœ€å¤§å…¬çº¦æ•°

**ç”¨æ³•**:
```lisp
(m:gcd a b)
```

**å‚æ•°**: 1 a  : æœªè¯†åˆ«å®šä¹‰;2 b  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:gcd (a b)
  "æ±‚æœ€å¤§å…¬çº¦æ•°"
  (if (= b 0)
    a (gcd b (rem a b))))
```
</details>

---

### m:hex2dec

**è¯´æ˜**: 16è¿›åˆ¶è½¬æ¢ä¸º10è¿›åˆ¶æ•´æ•°,hex ä¸º 0x å¼€å¤´çš„ç¬¦å·æˆ–å­—ç¬¦ä¸²ã€‚

**ç”¨æ³•**:
```lisp
(m:hex2dec hex)
```

**å‚æ•°**: 1 hex  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: fixnum

**ç¤ºä¾‹**:
```lisp
(m:hex2dec '0xb0a1) ;;=> 45217
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:hex2dec (hex / l)
  "16è¿›åˆ¶è½¬æ¢ä¸º10è¿›åˆ¶æ•´æ•°,hex ä¸º 0x å¼€å¤´çš„ç¬¦å·æˆ–å­—ç¬¦ä¸²ã€‚"
  "fixnum"
  "(m:hex2dec '0xb0a1)
  ;;=> 45217"
  (if (= (quote sym)
      (type hex))
    (setq hex (vl-symbol-name hex)))
  (setq hex (vl-string-left-trim "0xX"
      hex))
  (setq hex (strcase hex))
  (m:base2dec hex 16))
```
</details>

---

### m:intersect

**è¯´æ˜**: åˆ—è¡¨äº¤é›†

**ç”¨æ³•**:
```lisp
(m:intersect lst1 lst2)
```

**å‚æ•°**: 1 lst1  : åˆ—è¡¨;  2 lst2  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:intersect (lst1 lst2)
    "åˆ—è¡¨äº¤é›†"
    (vl-remove-if-not (quote (lambda (x)
                (member x lst2)))
        lst1))
```
</details>

---

### m:length

**è¯´æ˜**: ä¸¤ç‚¹é•¿åº¦(è·ç¦»)ï¼Œç­‰åŒäºä¸¤ç‚¹å‘é‡çš„æ¨¡

**ç”¨æ³•**:
```lisp
(m:length start end)
```

**å‚æ•°**: 1 start  : æœªæ˜ç¡®å®šä¹‰;  2 end  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:length (start end)
    "ä¸¤ç‚¹é•¿åº¦(è·ç¦»)ï¼Œç­‰åŒäºä¸¤ç‚¹å‘é‡çš„æ¨¡"
    (vector:norm (mapcar (quote -)
            end start)))
```
</details>

---

### m:linear-interpolation

**è¯´æ˜**: çº¿æ€§æ’å€¼ y=y1+(y2-y1)*(x-x1)/(x2-x1)

**ç”¨æ³•**:
```lisp
(m:linear-interpolation x x1 x2 y1 y2)
```

**å‚æ•°**: 1 x  : æœªè¯†åˆ«å®šä¹‰;2 x1  : æœªè¯†åˆ«å®šä¹‰;3 x2  : æœªè¯†åˆ«å®šä¹‰;4 y1  : æœªè¯†åˆ«å®šä¹‰;5 y2  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: number

**ç¤ºä¾‹**:
```lisp
(m:liner-inerpolation 3.2 3 4 5 6)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:linear-interpolation (x x1 x2 y1 y2)
  "çº¿æ€§æ’å€¼ y=y1+(y2-y1)*(x-x1)/(x2-x1)"
  "number"
  "(m:liner-inerpolation 3.2 3 4 5 6)"
  (+ y1 (* (- y2 y1)
      (/ (float (- x x1))
        (float (- x2 x1))))))
```
</details>

---

### m:maxlist

**è¯´æ˜**: è¿”å›æ•°å€¼åˆ—è¡¨çš„ä¸­çš„æœ€å¤§å€¼

**ç”¨æ³•**:
```lisp
(m:maxlist lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:maxlist (lst)
    "è¿”å›æ•°å€¼åˆ—è¡¨çš„ä¸­çš„æœ€å¤§å€¼"
    (if (atom lst)
        lst (apply (quote max)
            lst)))
```
</details>

---

### m:mid

**è¯´æ˜**: è®¡ç®—ä¸­ç‚¹

**ç”¨æ³•**:
```lisp
(m:mid x y)
```

**å‚æ•°**: 1 x  : æœªæ˜ç¡®å®šä¹‰;  2 y  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:mid (x y / a b)
    "è®¡ç®—ä¸­ç‚¹"
    (mapcar (quote (lambda (a b)
                (* (+ a b)
                    0.5)))
        x y))
```
</details>

---

### m:minlist

**è¯´æ˜**: è¿”å›æ•°å€¼åˆ—è¡¨çš„ä¸­çš„æœ€å°å€¼

**ç”¨æ³•**:
```lisp
(m:minlist lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:minlist (lst)
    "è¿”å›æ•°å€¼åˆ—è¡¨çš„ä¸­çš„æœ€å°å€¼"
    (if (atom lst)
        lst (apply (quote min)
            lst)))
```
</details>

---

### m:mulmod

**è¯´æ˜**: å¿«é€Ÿç§¯æ±‚æ¨¡

**ç”¨æ³•**:
```lisp
(m:mulmod a b m)
```

**å‚æ•°**: 1 a  : æœªæ˜ç¡®å®šä¹‰;  2 b  : æœªæ˜ç¡®å®šä¹‰;  3 m  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:mulmod (a b m / ret)
    "å¿«é€Ÿç§¯æ±‚æ¨¡"
    (setq ret 0)
    (while (not (zerop b))
        (if (not (zerop (rem b 2)))
            (setq ret (rem (+ a ret)
                    m)))
        (setq b (fix (/ b 2))
            a (rem (* a 2.0)
                m)))
    (fix ret))
```
</details>

---

### m:power

**è¯´æ˜**: å¢å¼ºpowerå‡½æ•°ï¼Œç›®çš„ä¸ºæ‰©å±•exptå‡½æ•°,å‚æ•°éƒ½ä¸ºæ•°å­—æ—¶ï¼Œå­—ç¬¦ä¸²ï¼Œæ•°å­—ï¼Œåˆ—è¡¨ç±»å‹ï¼Œå…¶ä»–ç±»å‹è¿”å›nil,è¿”å›exptè®¡ç®—çš„ç»“æœï¼Œbaseä¸ºå­—ç¬¦ä¸²å’Œåˆ—è¡¨æ—¶ï¼Œè¿”å›è‡ªä¹˜çš„ç»“æœ

**ç”¨æ³•**:
```lisp
(m:power base pow)
```

**å‚æ•°**: 1 base  : æœªæ˜ç¡®å®šä¹‰;  2 pow  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:power (base pow / str1)
    "å¢å¼ºpowerå‡½æ•°ï¼Œç›®çš„ä¸ºæ‰©å±•exptå‡½æ•°,å‚æ•°éƒ½ä¸ºæ•°å­—æ—¶ï¼Œå­—ç¬¦ä¸²ï¼Œæ•°å­—ï¼Œåˆ—è¡¨ç±»å‹ï¼Œå…¶ä»–ç±»å‹è¿”å›nil,è¿”å›exptè®¡ç®—çš„ç»“æœï¼Œbaseä¸ºå­—ç¬¦ä¸²å’Œåˆ—è¡¨æ—¶ï¼Œè¿”å›è‡ªä¹˜çš„ç»“æœ"
    (cond ((stringp base)
            (progn (setq str1 "")
                (repeat pow (setq str1 (strcat str1 base)))))
        ((or (intp base)
                (realp base))
            (expt base pow))
        ((listp base)
            (progn (repeat pow (setq str1 (cons base str1)))))
        (t nil)))
```
</details>

---

### m:radions->degress

**è¯´æ˜**: å¼§åº¦è½¬è§’åº¦å‡½æ•°

**ç”¨æ³•**:
```lisp
(m:radions->degress radions)
```

**å‚æ•°**: 1 radions  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:radions->degress (radions)
    "å¼§åº¦è½¬è§’åº¦å‡½æ•°"
    (if (numberp radions)
        (* radions (/ 180.0 pi))))
```
</details>

---

### m:rand

**è¯´æ˜**: ç”Ÿæˆä¼ªéšæœºæ•°

**ç”¨æ³•**:
```lisp
(m:rand )
```

**å‚æ•°**: None

**è¿”å›å€¼**: 0~1ä¹‹é—´çš„å®æ•°

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:rand (/ a c m $xn)
  "ç”Ÿæˆä¼ªéšæœºæ•°"
  "0~1ä¹‹é—´çš„å®æ•°"
  (setq m 4.29497e+09 a 1.66453e+06 c 1.0139e+09 $xn (rem (+ c (* a (cond ($xn)
            ((getvar (quote date))))))
      m))
  (/ $xn m))
```
</details>

---

### m:rand-by-cputicks

**è¯´æ˜**: ä»¥æ—¥æœŸåŠCPUticksä¸ºå‚æ•°ç”Ÿæˆéšæœºæ•°

**ç”¨æ³•**:
```lisp
(m:rand-by-cputicks )
```

**å‚æ•°**: None

**è¿”å›å€¼**: 1~100ä¹‹é—´çš„æ•´æ•°

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:rand-by-cputicks (/ n3 n4)
  "ä»¥æ—¥æœŸåŠCPUticksä¸ºå‚æ•°ç”Ÿæˆéšæœºæ•°"
  "1~100ä¹‹é—´çš„æ•´æ•°"
  (setq n3 (rtos (rem (getvar "date")
        1)
      2 16))
  (setq n3 (substr n3 18 1)
    n3 (atoi n3))
  (setq n4 (rem (getvar "cputicks")
      100))
  (fix (rem (+ n3 n4)
      100)))
```
</details>

---

### m:random

**è¯´æ˜**: ç”Ÿæˆä¼ªéšæœºæ•°

**ç”¨æ³•**:
```lisp
(m:random n)
```

**å‚æ•°**: 1 n  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:random (n / a c m)
    "ç”Ÿæˆä¼ªéšæœºæ•°"
    (setq m 4.29497e+009 a 1.66453e+006 c 1.0139e+009 $xn (rem (+ c (* a (cond ($xn)
                        ((getvar (quote date))))))
            m))
    (* n (/ $xn m)))
```
</details>

---

### m:random-fix

**ç”¨æ³•**:
```lisp
(m:random-fix n m)
```

**å‚æ•°**: 1 n  : æœªæ˜ç¡®å®šä¹‰;  2 m  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:random-fix (n m)
    (fix (+ n (rem (getvar "cputicks")
                (- m n -1)))))
```
</details>

---

### m:randrange

**è¯´æ˜**: è®¡ç®—ç»™å®šèŒƒå›´å†…çš„éšæœºæ•°

**ç”¨æ³•**:
```lisp
(m:randrange a b)
```

**å‚æ•°**: 1 a  : æœªæ˜ç¡®å®šä¹‰;  2 b  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:randrange (a b)
    "è®¡ç®—ç»™å®šèŒƒå›´å†…çš„éšæœºæ•°"
    (+ (min a b)
        (fix (* (m:rand)
                (1+ (abs (- a b)))))))
```
</details>

---

### m:rtos

**è¯´æ˜**: ä¿ç•™å°æ•°ä½æ•°(å››èˆäº”å…¥)

**ç”¨æ³•**:
```lisp
(m:rtos real prec)
```

**å‚æ•°**: 1 real  : å®æ•°;  2 prec  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: å››èˆäº”å…¥åçš„å­—ç¬¦ä¸²

**ç¤ºä¾‹**:
```lisp
(m:rtos 1.8000 3)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:rtos (real prec / dimzin result)
    "ä¿ç•™å°æ•°ä½æ•°(å››èˆäº”å…¥)"
    "å››èˆäº”å…¥åçš„å­—ç¬¦ä¸²"
    "(m:rtos 1.8000 3)"
    (setq dimzin (getvar (quote dimzin)))
    (setvar (quote dimzin)
        0)
    (setq result (vl-catch-all-apply (quote rtos)
            (list real 2 prec)))
    (setvar (quote dimzin)
        dimzin)
    (if (not (vl-catch-all-error-p result))
        result))
```
</details>

---

### m:sign

**è¯´æ˜**: å®æ•°çš„ç¬¦å·(æ­£è´Ÿå·)

**ç”¨æ³•**:
```lisp
(m:sign x)
```

**å‚æ•°**: 1 x  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: t ä¸ºæ­£ï¼Œnil ä¸ºè´Ÿ

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:sign (x)
  "å®æ•°çš„ç¬¦å·(æ­£è´Ÿå·)"
  "t ä¸ºæ­£ï¼Œnil ä¸ºè´Ÿ"
  (cond ((> x 0)
      -1.0)
    ((< x 0)
      1.0)
    (t 0)))
```
</details>

---

### m:sinh

**è¯´æ˜**: è®¡ç®—åŒæ›²æ­£å¼¦å€¼

**ç”¨æ³•**:
```lisp
(m:sinh x)
```

**å‚æ•°**: 1 x  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:sinh (x)
    "è®¡ç®—åŒæ›²æ­£å¼¦å€¼"
    (/ (- (exp x)
            (exp (- x)))
        2.0))
```
</details>

---

### m:sort-by-curve

**è¯´æ˜**: å‡½æ•°è¯´æ˜:æ²¿æ›²çº¿æ’åº~%è¿” å› å€¼:æ’åºåçš„ç‚¹è¡¨

**ç”¨æ³•**:
```lisp
(m:sort-by-curve curve lst)
```

**å‚æ•°**: 1 curve  : æ›²çº¿;  2 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:sort-by-curve (curve lst)
    "å‡½æ•°è¯´æ˜:æ²¿æ›²çº¿æ’åº~%è¿” å› å€¼:æ’åºåçš„ç‚¹è¡¨"
    (vl-sort lst (function (lambda (p1 p2 / m n)
                (setq m (vlax-curve-getclosestpointto curve p1 t))
                (setq n (vlax-curve-getclosestpointto curve p2 t))
                (cond ((< (vlax-curve-getdistatpoint curve m)
                            (vlax-curve-getdistatpoint curve n)))
                    ((equal m n 1.0e-008)
                        (< (distance p1 m)
                            (distance p2 n))))))))
```
</details>

---

### m:square

**ç”¨æ³•**:
```lisp
(m:square x)
```

**å‚æ•°**: 1 x  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:square (x)
    (* x (float x)))
```
</details>

---

### m:symmetric-difference

**è¯´æ˜**: åˆ—è¡¨å¯¹ç§°å·®é›†

**ç”¨æ³•**:
```lisp
(m:symmetric-difference l1 l2)
```

**å‚æ•°**: 1 l1  : æœªæ˜ç¡®å®šä¹‰;  2 l2  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:symmetric-difference (l1 l2)
    "åˆ—è¡¨å¯¹ç§°å·®é›†"
    (append (vl-remove-if (quote (lambda (x)
                    (member x l2)))
            l1)
        (vl-remove-if (quote (lambda (x)
                    (member x l1)))
            l2)))
```
</details>

---

### m:tan

**è¯´æ˜**: è®¡ç®—æ­£åˆ‡å€¼

**ç”¨æ³•**:
```lisp
(m:tan num)
```

**å‚æ•°**: 1 num  : æ•°å€¼;

**è¿”å›å€¼**: å®æ•°

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:tan (num)
  "è®¡ç®—æ­£åˆ‡å€¼"
  "å®æ•°"
  (if (not (equal 0.0 (cos num)
        1.0e-10))
    (/ (sin num)
      (cos num))))
```
</details>

---

### m:tanh

**è¯´æ˜**: è®¡ç®—åŒæ›²æ­£åˆ‡å€¼

**ç”¨æ³•**:
```lisp
(m:tanh x)
```

**å‚æ•°**: 1 x  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:tanh (x)
    "è®¡ç®—åŒæ›²æ­£åˆ‡å€¼"
    (/ (m:sinh x)
        (m:cosh x)))
```
</details>

---

### m:transpt

**è¯´æ˜**: æ ¹æ®å·²çŸ¥ä¸–ç•Œåæ ‡å’Œç”¨æˆ·åæ ‡çš„åŸºå‡†ç‚¹ï¼Œè®¡ç®—ä¸–ç•Œåæ ‡å¯¹åº”çš„ç”¨æˆ·åæ ‡

**ç”¨æ³•**:
```lisp
(m:transpt base usrpt transpt ang)
```

**å‚æ•°**: 1 base  : æœªæ˜ç¡®å®šä¹‰;  2 usrpt  : æœªæ˜ç¡®å®šä¹‰;  3 transpt  : æœªæ˜ç¡®å®šä¹‰;  4 ang  : è§’åº¦å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:transpt (base usrpt transpt ang)
    "æ ¹æ®å·²çŸ¥ä¸–ç•Œåæ ‡å’Œç”¨æˆ·åæ ‡çš„åŸºå‡†ç‚¹ï¼Œè®¡ç®—ä¸–ç•Œåæ ‡å¯¹åº”çš„ç”¨æˆ·åæ ‡"
    (car (geometry:rotatebymatrix (geometry:translatebymatrix (list transpt)
                base usrpt)
            usrpt (- ang))))
```
</details>

---

### m:trim

**è¯´æ˜**: æ•°å€¼åç»­é›¶æ¸…é™¤

**ç”¨æ³•**:
```lisp
(m:trim realnum)
```

**å‚æ•°**: 1 realnum  : å®æ•°;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:trim (realnum / dimzin1 result)
    "æ•°å€¼åç»­é›¶æ¸…é™¤"
    (setq dimzin1 (getvar "dimzin"))
    (setvar "dimzin"
        8)
    (setq result (vl-catch-all-apply (quote rtos)
            (list realnum 2 8)))
    (setvar "dimzin"
        dimzin1)
    (if (not (vl-catch-all-error-p result))
        result))
```
</details>

---

### m:union

**è¯´æ˜**: æ±‚åˆ—è¡¨çš„å¹¶é›†

**ç”¨æ³•**:
```lisp
(m:union lst1 lst2)
```

**å‚æ•°**: 1 lst1  : åˆ—è¡¨;  2 lst2  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun m:union (lst1 lst2)
    "æ±‚åˆ—è¡¨çš„å¹¶é›†"
    (append lst1 (vl-remove-if (quote (lambda (x)
                    (member x lst1)))
            lst2)))
```
</details>

---

## matrix

**æ¨¡å—è¯´æ˜**: çŸ©é˜µè¿ç®—ã€å˜æ¢è®¡ç®—

### matrix:hadamard-product

**è¯´æ˜**: mxnçŸ©é˜µä¸mxn çŸ©é˜µçš„Hadamardç§¯è®°ä½œA*Bã€‚å…¶å…ƒç´ å®šä¹‰ä¸ºä¸¤ä¸ªçŸ©é˜µå¯¹åº”å…ƒç´ çš„ä¹˜ç§¯çš„mÃ—nçŸ©é˜µ

**ç”¨æ³•**:
```lisp
(matrix:hadamard-product m1 m2)
```

**å‚æ•°**: 1 m1  : æœªè¯†åˆ«å®šä¹‰;2 m2  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: matrix

**ç¤ºä¾‹**:
```lisp
(matrix:hadamard-product '((1 3 2)(1 0 0)(1 2 2)) '((0 0 2)(7 5 0)(2 1 1)));;=> ((0 0 4) (7 0 0) (2 2 2))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:hadamard-product (m1 m2)
  "mxnçŸ©é˜µä¸mxn çŸ©é˜µçš„Hadamardç§¯è®°ä½œA*Bã€‚å…¶å…ƒç´ å®šä¹‰ä¸ºä¸¤ä¸ªçŸ©é˜µå¯¹åº”å…ƒç´ çš„ä¹˜ç§¯çš„mÃ—nçŸ©é˜µ"
  "matrix"
  "(matrix:hadamard-product '((1 3 2)(1 0 0)(1 2 2))
    '((0 0 2)(7 5 0)(2 1 1)));;=> ((0 0 4)
    (7 0 0)
    (2 2 2))"
  (mapcar (quote (lambda (x y)
        (mapcar (quote *)
          x y)))
    m1 m2))
```
</details>

---

### matrix:kronecker-product

**è¯´æ˜**: å…‹ç½—å†…å…‹ç§¯ä¹Ÿç§°å¼ é‡ç§¯ã€ç›´ç§¯æ˜¯ä¸¤ä¸ªä»»æ„å¤§å°çš„çŸ©é˜µé—´çš„è¿ç®—ï¼Œç¬¦å·è®°ä½œ(x) ã€‚.ä»¥å¾·å›½æ•°å­¦å®¶åˆ©å¥¥æ³¢å¾·Â·å…‹ç½—å†…å…‹å‘½å

**ç”¨æ³•**:
```lisp
(matrix:kronecker-product m1 m2)
```

**å‚æ•°**: 1 m1  : æœªè¯†åˆ«å®šä¹‰;2 m2  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: matrix

**ç¤ºä¾‹**:
```lisp
(matrix:kronecker-product '((1 2)(3 1)(5 3)) '((0 3)(2 1))) => ((0 3 0 6) (2 1 4 2) (0 9 0 3) (6 3 2 1) (0 15 0 9) (10 5 6 3))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:kronecker-product (m1 m2)
  "å…‹ç½—å†…å…‹ç§¯ä¹Ÿç§°å¼ é‡ç§¯ã€ç›´ç§¯æ˜¯ä¸¤ä¸ªä»»æ„å¤§å°çš„çŸ©é˜µé—´çš„è¿ç®—ï¼Œç¬¦å·è®°ä½œ(x)
  ã€‚.ä»¥å¾·å›½æ•°å­¦å®¶åˆ©å¥¥æ³¢å¾·Â·å…‹ç½—å†…å…‹å‘½å"
  "matrix"
  "(matrix:kronecker-product '((1 2)(3 1)(5 3))
    '((0 3)(2 1)))
  => ((0 3 0 6)
    (2 1 4 2)
    (0 9 0 3)
    (6 3 2 1)
    (0 15 0 9)
    (10 5 6 3))"
  (apply (quote append)
    (mapcar (quote (lambda (a)
          (mapcar (quote (lambda (x)
                (apply (quote append)
                  x)))
            (matrix:trp a))))
      (mapcar (quote (lambda (m1%)
            (mapcar (quote (lambda (m1%%)
                  (mapcar (quote (lambda (m2%)
                        (mapcar (quote (lambda (m2%%)
                              (* m1%% m2%%)))
                          m2%)))
                    m2)))
              m1%)))
        m1))))
```
</details>

---

### matrix:mxm

**è¯´æ˜**: çŸ©é˜µç›¸ä¹˜

**ç”¨æ³•**:
```lisp
(matrix:mxm m q)
```

**å‚æ•°**: 1 m  : æœªè¯†åˆ«å®šä¹‰;2 q  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:mxm (m q)
  "çŸ©é˜µç›¸ä¹˜"
  (mapcar (function (lambda (r)
        (matrix:mxv (matrix:trp q)
          r)))
    m))
```
</details>

---

### matrix:mxp

**è¯´æ˜**: å¯¹ç‚¹çš„åæ ‡è¿›è¡ŒçŸ©é˜µå˜æ¢

**ç”¨æ³•**:
```lisp
(matrix:mxp m p)
```

**å‚æ•°**: 1 m  : æœªè¯†åˆ«å®šä¹‰;2 p  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: å˜æ¢åçš„3Dç‚¹åæ ‡

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:mxp (m p)
  "å¯¹ç‚¹çš„åæ ‡è¿›è¡ŒçŸ©é˜µå˜æ¢"
  "å˜æ¢åçš„3Dç‚¹åæ ‡"
  (if (= 2 (length p))
    (setq p (append p (list 0))))
  (reverse (cdr (reverse (matrix:mxv m (append p (list 1.0)))))))
```
</details>

---

### matrix:mxv

**è¯´æ˜**: å‘é‡çš„çŸ©é˜µå˜æ¢(å‘é‡ä¹˜çŸ©é˜µ)

**ç”¨æ³•**:
```lisp
(matrix:mxv m v)
```

**å‚æ•°**: 1 m  : æœªè¯†åˆ«å®šä¹‰;2 v  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:mxv (m v)
  "å‘é‡çš„çŸ©é˜µå˜æ¢(å‘é‡ä¹˜çŸ©é˜µ)"
  (mapcar (function (lambda (r)
        (apply (quote +)
          (mapcar (quote *)
            r v))))
    m))
```
</details>

---

### matrix:norm

**è¯´æ˜**: å‘é‡çš„æ¨¡(é•¿åº¦)

**ç”¨æ³•**:
```lisp
(matrix:norm v)
```

**å‚æ•°**: 1 v  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:norm (v)
  "å‘é‡çš„æ¨¡(é•¿åº¦)"
  (sqrt (apply (quote +)
      (mapcar (quote *)
        v v))))
```
</details>

---

### matrix:rotation

**è¯´æ˜**: æ„é€ ä¸‰ç»´æ—‹è½¬çŸ©é˜µï¼Œrx/ry/rzåˆ†åˆ«å¯¹åº”ä¸‰ä¸ªåæ ‡è½´çš„è½¬è§’

**ç”¨æ³•**:
```lisp
(matrix:rotation rx ry rz)
```

**å‚æ•°**: 1 rx  : æœªè¯†åˆ«å®šä¹‰;2 ry  : æœªè¯†åˆ«å®šä¹‰;3 rz  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:rotation (rx ry rz)
  "æ„é€ ä¸‰ç»´æ—‹è½¬çŸ©é˜µï¼Œrx/ry/rzåˆ†åˆ«å¯¹åº”ä¸‰ä¸ªåæ ‡è½´çš„è½¬è§’"
  (matrix:mxm (matrix:rotation-x rx)
    (matrix:mxm (matrix:rotation-y ry)
      (matrix:rotation-z rz))))
```
</details>

---

### matrix:rotation-x

**è¯´æ˜**: æ„é€ xè½´æ—‹è½¬çŸ©é˜µ

**ç”¨æ³•**:
```lisp
(matrix:rotation-x rx)
```

**å‚æ•°**: 1 rx  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:rotation-x (rx / cr sr)
  "æ„é€ xè½´æ—‹è½¬çŸ©é˜µ"
  (list (list 1 0 0 0)
    (list 0 (setq cr (cos rx))
      (setq sr (sin rx))
      0)
    (list 0 (- sr)
      cr 0)
    (list 0 0 0 1)))
```
</details>

---

### matrix:rotation-y

**è¯´æ˜**: æ„é€ yè½´æ—‹è½¬çŸ©é˜µ

**ç”¨æ³•**:
```lisp
(matrix:rotation-y ry)
```

**å‚æ•°**: 1 ry  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:rotation-y (ry / cr sr)
  "æ„é€ yè½´æ—‹è½¬çŸ©é˜µ"
  (list (list (setq cr (cos ry))
      0 (- (setq sr (sin rz)))
      0)
    (list 0 1 0 0)
    (list sr 0 cr 0)
    (list 0 0 0 1)))
```
</details>

---

### matrix:rotation-z

**è¯´æ˜**: æ„é€ zè½´æ—‹è½¬çŸ©é˜µ

**ç”¨æ³•**:
```lisp
(matrix:rotation-z rz)
```

**å‚æ•°**: 1 rz  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:rotation-z (rz / crz srz)
  "æ„é€ zè½´æ—‹è½¬çŸ©é˜µ"
  (list (list (setq crz (cos rz))
      (setq srz (sin rz))
      0 0)
    (list (- srz)
      crz 0 0)
    (list 0 0 1 0)
    (list 0 0 0 1)))
```
</details>

---

### matrix:scale

**è¯´æ˜**: æ„é€ 3è½´ç¼©æ”¾çŸ©é˜µï¼Œxyzåˆ†åˆ«ä»£è¡¨ä¸‰è½´çš„ç¼©æ”¾æ¯”ä¾‹

**ç”¨æ³•**:
```lisp
(matrix:scale x y z)
```

**å‚æ•°**: 1 x  : æœªè¯†åˆ«å®šä¹‰;2 y  : æœªè¯†åˆ«å®šä¹‰;3 z  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:scale (x y z)
  "æ„é€ 3è½´ç¼©æ”¾çŸ©é˜µï¼Œxyzåˆ†åˆ«ä»£è¡¨ä¸‰è½´çš„ç¼©æ”¾æ¯”ä¾‹"
  (list (list x 0 0 0)
    (list 0 y 0 0)
    (list 0 0 z 0)
    (list 0 0 0 1)))
```
</details>

---

### matrix:scale1

**è¯´æ˜**: æ„é€ 3è½´ç¼©æ”¾çŸ©é˜µï¼Œsä»£è¡¨ä¸‰è½´çš„ç»Ÿä¸€ç¼©æ”¾æ¯”ä¾‹

**ç”¨æ³•**:
```lisp
(matrix:scale1 s)
```

**å‚æ•°**: 1 s  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:scale1 (s)
  "æ„é€ 3è½´ç¼©æ”¾çŸ©é˜µï¼Œsä»£è¡¨ä¸‰è½´çš„ç»Ÿä¸€ç¼©æ”¾æ¯”ä¾‹"
  (list (list s 0 0 0)
    (list 0 s 0 0)
    (list 0 0 s 0)
    (list 0 0 0 1)))
```
</details>

---

### matrix:transform

**è¯´æ˜**: åæ ‡å˜æ¢å…¬å¼A'=TSRA

**ç”¨æ³•**:
```lisp
(matrix:transform translation scale rotation pt)
```

**å‚æ•°**: 1 translation  : æœªè¯†åˆ«å®šä¹‰;2 scale  : æ¯”ä¾‹å€¼;3 rotation  : æœªè¯†åˆ«å®šä¹‰;4 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:transform (translation scale rotation pt)
  "åæ ‡å˜æ¢å…¬å¼A'=TSRA"
  (matrix:mxp translation (matrix:mxp scale (matrix:mxp rotation pt))))
```
</details>

---

### matrix:transformation

**è¯´æ˜**: ä½¿ç”¨åæ ‡å˜æ¢å…¬å¼A'=TSRAè¿›è¡Œåæ ‡å˜æ¢

**ç”¨æ³•**:
```lisp
(matrix:transformation translation scale rotation pt)
```

**å‚æ•°**: 1 translation  : æœªè¯†åˆ«å®šä¹‰;2 scale  : æ¯”ä¾‹å€¼;3 rotation  : æœªè¯†åˆ«å®šä¹‰;4 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:transformation (translation scale rotation pt)
  "ä½¿ç”¨åæ ‡å˜æ¢å…¬å¼A'=TSRAè¿›è¡Œåæ ‡å˜æ¢"
  (matrix:mxp translation (matrix:mxp scale (matrix:mxp rotation pt))))
```
</details>

---

### matrix:translation

**è¯´æ˜**: æ„é€ å¹³ç§»è½¬æ¢çŸ©é˜µ

**ç”¨æ³•**:
```lisp
(matrix:translation x y z)
```

**å‚æ•°**: 1 x  : æœªè¯†åˆ«å®šä¹‰;2 y  : æœªè¯†åˆ«å®šä¹‰;3 z  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:translation (x y z)
  "æ„é€ å¹³ç§»è½¬æ¢çŸ©é˜µ"
  (list (list 1 0 0 x)
    (list 0 1 0 y)
    (list 0 0 1 z)
    (list 0 0 0 1)))
```
</details>

---

### matrix:trp

**è¯´æ˜**: çŸ©é˜µè½¬ç½®

**ç”¨æ³•**:
```lisp
(matrix:trp m)
```

**å‚æ•°**: 1 m  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: matrix

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:trp (m)
  "çŸ©é˜µè½¬ç½®"
  "matrix"
  (apply (quote mapcar)
    (cons (quote list)
      m)))
```
</details>

---

### matrix:unit

**è¯´æ˜**: å•ä½å‘é‡

**ç”¨æ³•**:
```lisp
(matrix:unit v)
```

**å‚æ•°**: 1 v  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:unit (v)
  "å•ä½å‘é‡"
  ((lambda (n)
      (if (equal 0.0 n 1.0e-14)
        nil (matrix:vxs v (/ 1.0 n))))
    (matrix:norm v)))
```
</details>

---

### matrix:v^v

**è¯´æ˜**: ä¸¤å‘é‡çš„å‰ç§¯

**ç”¨æ³•**:
```lisp
(matrix:v^v u v)
```

**å‚æ•°**: 1 u  : æœªè¯†åˆ«å®šä¹‰;2 v  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:v^v (u v)
  "ä¸¤å‘é‡çš„å‰ç§¯"
  (list (- (* (cadr u)
        (caddr v))
      (* (cadr v)
        (caddr u)))
    (- (* (car v)
        (caddr u))
      (* (car u)
        (caddr v)))
    (- (* (car u)
        (cadr v))
      (* (car v)
        (cadr u)))))
```
</details>

---

### matrix:vxs

**è¯´æ˜**: å‘é‡ä¹˜æ ‡é‡(ç³»æ•°)

**ç”¨æ³•**:
```lisp
(matrix:vxs v s)
```

**å‚æ•°**: 1 v  : æœªè¯†åˆ«å®šä¹‰;2 s  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:vxs (v s)
  "å‘é‡ä¹˜æ ‡é‡(ç³»æ•°)"
  (mapcar (quote (lambda (n)
        (* n s)))
    v))
```
</details>

---

### matrix:vxv

**è¯´æ˜**: å‘é‡çš„ç‚¹ç§¯

**ç”¨æ³•**:
```lisp
(matrix:vxv v1 v2)
```

**å‚æ•°**: 1 v1  : æœªè¯†åˆ«å®šä¹‰;2 v2  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun matrix:vxv (v1 v2)
  "å‘é‡çš„ç‚¹ç§¯"
  (apply (quote +)
    (mapcar (quote *)
      v1 v2)))
```
</details>

---

## music-die

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### music-die:list-to-var

**ç”¨æ³•**:
```lisp
(music-die:list-to-var lists)
```

**å‚æ•°**: 1 lists  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun music-die:list-to-var (lists / pntlst2)
  (vlax-safearray-fill (vlax-make-safearray vlax-vbdouble (cons 0 (1- (* 3 (length lists)))))
    (foreach e lists (setq pntlst2 (append pntlst2 e)))))
```
</details>

---

### music-die:multi-element

**è¯´æ˜**: ä½¿æŸä¸ªlispå…ƒç´ å‡ºç°ä»¥åˆ—è¡¨å½¢å¼å­˜å‚¨å¤šä»½ELEMENT å…ƒç´   num å­˜å‚¨ä»½æ•°ä½œè€…ï¼šMUSIC-DIE

**ç”¨æ³•**:
```lisp
(music-die:multi-element element num)
```

**å‚æ•°**: 1 element  : æœªæ˜ç¡®å®šä¹‰;2 num  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: ï¼ˆlist element elemen element element ...ï¼‰

**ç¤ºä¾‹**:
```lisp
(Multi-element 123 3) --> '(123 123 123)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun music-die:multi-element (element num / element-list)
  "\nä½¿æŸä¸ªlispå…ƒç´ å‡ºç°ä»¥åˆ—è¡¨å½¢å¼å­˜å‚¨å¤šä»½\nELEMENT å…ƒç´   num å­˜å‚¨ä»½æ•°\nä½œè€…ï¼šMUSIC-DIE\n"
  "\nè¿”å›å€¼ï¼šï¼ˆlist element elemen element element ...ï¼‰\n"
  "(Multi-element 123 3)
  --> '(123 123 123)"
  (repeat num (setq element-list (cons element element-list))))
```
</details>

---

### music-die:undo1

**è¯´æ˜**: å¯æ’¤å›ä¸€æ­¥æ“ä½œï¼Œå¹¶ä¸”ä¸ä¼šä½¿è§†å£ç§»åŠ¨

**ç”¨æ³•**:
```lisp
(music-die:undo1 )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun music-die:undo1 (/ ctr vsize)
  "å¯æ’¤å›ä¸€æ­¥æ“ä½œï¼Œå¹¶ä¸”ä¸ä¼šä½¿è§†å£ç§»åŠ¨"
  ""
  (setq ctr (trans (getvar "VIEWCTR")
      1 0))
  (setq vsize (getvar "VIEWSIZE"))
  (vl-cmdf "UNDO"
    1)
  (vla-zoomcenter *acad* (vlax-make-variant (music-die:list-to-var (list ctr)))
    vsize))
```
</details>

---

## orance

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### orance:show-all-objects

**è¯´æ˜**: æ˜¾ç¤ºæ‰€æœ‰éšè—å›¾å…ƒ(å±æ€§ä¸ºä¸å¯è§)

**ç”¨æ³•**:
```lisp
(orance:show-all-objects )
```

**å‚æ•°**: None

**è¿”å›å€¼**: æ— è¿”å›å€¼

**ç¤ºä¾‹**:
```lisp
ç¤ºä¾‹:(obj:Show-All-Objects)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun orance:show-all-objects nil "æ˜¾ç¤ºæ‰€æœ‰éšè—å›¾å…ƒ(å±æ€§ä¸ºä¸å¯è§)"
  "æ— è¿”å›å€¼"
  "ç¤ºä¾‹:(obj:Show-All-Objects)"
  (ssget "x"
    (quote ((60 . 1))))
  (progn (vlax-for obj (vla-get-activeselectionset (vla-get-activedocument (vlax-get-acad-object)))
      (vla-put-visible obj :vlax-true)))
  (princ))
```
</details>

---

## p

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### p:consp

**è¯´æ˜**: åˆ¤æ–­æ˜¯å¦ä¸ºæ„é€ è¡¨ï¼Œè¿™é‡Œ nil ä¸æ˜¯æ„é€ è¡¨

**ç”¨æ³•**:
```lisp
(p:consp lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: T or nil

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:consp (lst)
  "åˆ¤æ–­æ˜¯å¦ä¸ºæ„é€ è¡¨ï¼Œè¿™é‡Œ nil ä¸æ˜¯æ„é€ è¡¨"
  "T or nil"
  (vl-consp lst))
```
</details>

---

### p:curvep

**è¯´æ˜**: æ˜¯å¦æ˜¯æ›²çº¿

**ç”¨æ³•**:
```lisp
(p:curvep obj)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:curvep (obj)
  "æ˜¯å¦æ˜¯æ›²çº¿"
  (if (vlap obj)
    (and (member (vla-get-objectname obj)
        (quote ("AcDbPolyline"
            "AcDbSpline"
            "AcDb3dPolyline"
            "AcDb2dPolyline"
            "AcDbLine"
            "AcDbCircle"
            "AcDbArc"
            "AcDbEllipse"))))
    nil))
```
</details>

---

### p:dotpairp

**è¯´æ˜**: æ˜¯å¦ä¸ºç‚¹å¯¹è¡¨

**ç”¨æ³•**:
```lisp
(p:dotpairp lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:dotpairp (lst)
  "æ˜¯å¦ä¸ºç‚¹å¯¹è¡¨"
  (and (vl-consp lst)
    (not (vl-list-length lst))))
```
</details>

---

### p:ename-listp

**è¯´æ˜**: åˆ¤æ–­æ˜¯å¦ä¸ºå›¾å…ƒååˆ—è¡¨

**ç”¨æ³•**:
```lisp
(p:ename-listp lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:ename-listp (lst)
  "åˆ¤æ–­æ˜¯å¦ä¸ºå›¾å…ƒååˆ—è¡¨"
  (if (and lst (listp lst))
    (apply (quote and)
      (mapcar (quote p:enamep)
        lst))))
```
</details>

---

### p:enamep

**è¯´æ˜**: åˆ¤æ–­æ˜¯å¦å›¾å…ƒ

**ç”¨æ³•**:
```lisp
(p:enamep arg)
```

**å‚æ•°**: 1 arg  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:enamep (arg)
  "åˆ¤æ–­æ˜¯å¦å›¾å…ƒ"
  (equal (type arg)
    (quote ename)))
```
</details>

---

### p:functionp

**è¯´æ˜**: æµ‹è¯•ç¬¦å·æ˜¯ä¸æ˜¯å‡½æ•°,æ”¯æŒå†…éƒ¨å‡½æ•°ï¼Œç”¨æˆ·å‡½æ•°ï¼ŒEXRXæ‰©å±•å‡½æ•°å’Œdefun-qå®šä¹‰çš„å‡½æ•°

**ç”¨æ³•**:
```lisp
(p:functionp sym)
```

**å‚æ•°**: 1 sym  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: T or nil

**ç¤ºä¾‹**:
```lisp
(p:functionp boole)=> T
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:functionp (sym)
  "æµ‹è¯•ç¬¦å·æ˜¯ä¸æ˜¯å‡½æ•°,æ”¯æŒå†…éƒ¨å‡½æ•°ï¼Œç”¨æˆ·å‡½æ•°ï¼ŒEXRXæ‰©å±•å‡½æ•°å’Œdefun-qå®šä¹‰çš„å‡½æ•°"
  "T or nil"
  "(p:functionp boole)=> T"
  (or (member (type sym)
      (quote (subr usubr exrxsubr)))
    (and (not (null sym))
      (listp sym)
      (listp (car sym))
      (apply (quote and)
        (mapcar (quote vl-symbolp)
          (caar sym))))))
```
</details>

---

### p:intp

**è¯´æ˜**: åˆ¤æ–­æ˜¯å¦æ•´æ•°

**ç”¨æ³•**:
```lisp
(p:intp x)
```

**å‚æ•°**: 1 x  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:intp (x)
  "åˆ¤æ–­æ˜¯å¦æ•´æ•°"
  (equal (type x)
    (quote int)))
```
</details>

---

### p:listp

**è¯´æ˜**: åˆ¤æ–­æ˜¯å¦ä¸ºé“¾è¡¨ã€‚æ³¨æ„'(a b . c)ä¸æ˜¯é“¾è¡¨

**ç”¨æ³•**:
```lisp
(p:listp lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: T or nil

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:listp (lst)
  "åˆ¤æ–­æ˜¯å¦ä¸ºé“¾è¡¨ã€‚æ³¨æ„'(a b . c)ä¸æ˜¯é“¾è¡¨"
  "T or nil"
  (and (listp lst)
    (vl-list-length lst)))
```
</details>

---

### p:matrixp

**è¯´æ˜**: æµ‹è¯•ä¸€ç»„åˆ—è¡¨æ˜¯å¦ä¸ºçŸ©é˜µ

**ç”¨æ³•**:
```lisp
(p:matrixp mat)
```

**å‚æ•°**: 1 mat  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: T or nil

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:matrixp (mat)
  "æµ‹è¯•ä¸€ç»„åˆ—è¡¨æ˜¯å¦ä¸ºçŸ©é˜µ"
  "T or nil"
  (and (apply (quote and)
      (mapcar (quote listp)
        mat))
    (apply (quote =)
      (mapcar (quote length)
        mat))))
```
</details>

---

### p:phyunitp

**è¯´æ˜**: æµ‹è¯•å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç‰©ç†é‡å•ä½SI

**ç”¨æ³•**:
```lisp
(p:phyunitp str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: t or nil

**ç¤ºä¾‹**:
```lisp
(p:phyunitp "W/mU+00B2Â·K")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:phyunitp (str)
  "æµ‹è¯•å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç‰©ç†é‡å•ä½SI"
  "t or nil"
  "(p:phyunitp \"W/m\U+00B2Â·K\")"
  (or (member str @:*units*)
    (apply (quote and)
      (mapcar (quote (lambda (x)
            (member (chr x)
              @:*units*)))
        (string:s2l-ansi str)))))
```
</details>

---

### p:picksetp

**è¯´æ˜**: åˆ¤æ–­æ˜¯å¦éç©ºé€‰æ‹©é›†

**ç”¨æ³•**:
```lisp
(p:picksetp ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:picksetp (ss)
  "åˆ¤æ–­æ˜¯å¦éç©ºé€‰æ‹©é›†"
  (and (= (type ss)
      (quote pickset))
    (> (sslength ss)
      0)))
```
</details>

---

### p:readme

**è¯´æ˜**: è°“è¯å‡½æ•°åŠæµ‹è¯•å‡½æ•°ã€‚

**ç”¨æ³•**:
```lisp
(p:readme )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:readme nil "è°“è¯å‡½æ•°åŠæµ‹è¯•å‡½æ•°ã€‚"
  (princ "è°“è¯å‡½æ•°åŠæµ‹è¯•å‡½æ•°ã€‚ä½¿ç”¨ (require 'p:*)
    åŠ è½½è¿™äº›å‡½æ•°")
  (princ))
```
</details>

---

### p:realp

**è¯´æ˜**: åˆ¤æ–­æ˜¯å¦å®æ•°

**ç”¨æ³•**:
```lisp
(p:realp arg)
```

**å‚æ•°**: 1 arg  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:realp (arg)
  "åˆ¤æ–­æ˜¯å¦å®æ•°"
  (equal (type arg)
    (quote real)))
```
</details>

---

### p:safearrayp

**è¯´æ˜**: åˆ¤æ–­æ˜¯å¦ä¸ºå®‰å…¨æ•°ç»„

**ç”¨æ³•**:
```lisp
(p:safearrayp x)
```

**å‚æ•°**: 1 x  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:safearrayp (x)
  "åˆ¤æ–­æ˜¯å¦ä¸ºå®‰å…¨æ•°ç»„"
  (equal (type x)
    (quote safearray)))
```
</details>

---

### p:string-listp

**è¯´æ˜**: åˆ¤æ–­æ˜¯å¦ä¸ºå­—ç¬¦ä¸²åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(p:string-listp lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:string-listp (lst)
  "åˆ¤æ–­æ˜¯å¦ä¸ºå­—ç¬¦ä¸²åˆ—è¡¨"
  (if (and lst (listp lst))
    (apply (quote and)
      (mapcar (quote p:stringp)
        lst))))
```
</details>

---

### p:stringp

**è¯´æ˜**: åˆ¤æ–­æ˜¯å¦å­—ç¬¦ä¸²

**ç”¨æ³•**:
```lisp
(p:stringp arg)
```

**å‚æ•°**: 1 arg  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:stringp (arg)
  "åˆ¤æ–­æ˜¯å¦å­—ç¬¦ä¸²"
  (equal (type arg)
    (quote str)))
```
</details>

---

### p:variantp

**è¯´æ˜**: åˆ¤æ–­æ˜¯å¦å˜ä½“

**ç”¨æ³•**:
```lisp
(p:variantp arg)
```

**å‚æ•°**: 1 arg  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:variantp (arg)
  "åˆ¤æ–­æ˜¯å¦å˜ä½“"
  (equal (type arg)
    (quote variant)))
```
</details>

---

### p:vla-listp

**è¯´æ˜**: åˆ¤æ–­æ˜¯å¦ä¸ºvlaå¯¹è±¡åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(p:vla-listp lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:vla-listp (lst)
  "åˆ¤æ–­æ˜¯å¦ä¸ºvlaå¯¹è±¡åˆ—è¡¨"
  (if (and lst (listp lst))
    (apply (quote and)
      (mapcar (quote p:vlap)
        lst))))
```
</details>

---

### p:vlap

**è¯´æ˜**: åˆ¤æ–­æ˜¯å¦vlaå¯¹è±¡.

**ç”¨æ³•**:
```lisp
(p:vlap obj)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun p:vlap (obj)
  "åˆ¤æ–­æ˜¯å¦vlaå¯¹è±¡."
  (equal (type obj)
    (quote vla-object)))
```
</details>

---

## pickset

**æ¨¡å—è¯´æ˜**: é€‰æ‹©é›†å¤„ç†ã€è¿‡æ»¤ã€è½¬æ¢

### pickset:boxs

**è¯´æ˜**: æ±‚é€‰æ‹©é›†å†…å„å›¾å…ƒçš„åŒ…å›´ç›’ã€‚(è§’ç‚¹:å·¦ä¸‹ï¼Œå³ä¸Š)ç»„æˆçš„åˆ—è¡¨,ss é€‰æ‹©é›†æˆ–å›¾å…ƒåˆ—è¡¨

**ç”¨æ³•**:
```lisp
(pickset:boxs ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

**è¿”å›å€¼**: (box1 box2 box3)

**ç¤ºä¾‹**:
```lisp
(pickset:boxs (ssget))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:boxs (ss / n en lst)
  "æ±‚é€‰æ‹©é›†å†…å„å›¾å…ƒçš„åŒ…å›´ç›’ã€‚(è§’ç‚¹:å·¦ä¸‹ï¼Œå³ä¸Š)ç»„æˆçš„åˆ—è¡¨,ss é€‰æ‹©é›†æˆ–å›¾å…ƒåˆ—è¡¨"
  "(box1 box2 box3)"
  "(pickset:boxs (ssget))"
  (if (p:picksetp ss)
    (setq ss (pickset:to-list ss)))
  (if (p:ename-listp ss)
    (mapcar (quote (lambda (x)
          (entity:getbox x 0)))
      ss)))
```
</details>

---

### pickset:cluster

**è¯´æ˜**: å¯¹å›¾å…ƒè¿›è¡Œèšç±»åˆ†æï¼ŒæŒ‰ç‰‡åŒºæ±‚å›¾å…ƒé›†çš„åŒ…å›´ç›’ã€‚

**ç”¨æ³•**:
```lisp
(pickset:cluster ss gap)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;2 gap  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: å„å›¾å…ƒç¾¤çš„åŒ…å›´ç›’(ä¸¤ç‚¹åæ ‡), ç»„æˆçš„åˆ—è¡¨

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:cluster (ss gap / a b c ca cc flag l l1 lst n)
  "å¯¹å›¾å…ƒè¿›è¡Œèšç±»åˆ†æï¼ŒæŒ‰ç‰‡åŒºæ±‚å›¾å…ƒé›†çš„åŒ…å›´ç›’ã€‚"
  "å„å›¾å…ƒç¾¤çš„åŒ…å›´ç›’(ä¸¤ç‚¹åæ ‡), ç»„æˆçš„åˆ—è¡¨"
  (if ss (progn (setq l (vl-sort (pickset:boxs ss)
          (quote (lambda (box1 box2 / ax1 ax2 ay1 bx1 bx2 by1)
              (if (equal (setq ax1 (caar box1))
                  (setq bx1 (caar box2))
                  0.001)
                (if (equal (setq ay1 (cadar box1))
                    (setq by1 (cadar box2))
                    0.001)
                  (if (equal (setq ax2 (caadr box1))
                      (setq bx2 (caadr box2))
                      0.001)
                    (< (cadadr box1)
                      (cadadr box2))
                    (< ax2 bx2))
                  (< ay1 by1))
                (< ax1 bx1))))))
      (setq gap (* gap 0.5))
      (setq l (mapcar (quote (lambda (x)
              (list (list (- (caar x)
                    gap)
                  (- (cadar x)
                    gap))
                (list (+ (caadr x)
                    gap)
                  (+ (cadadr x)
                    gap)))))
          l))
      (setq k t r nil)
      (while k (setq a (car l)
          lst nil)
        (while (setq ca (car l))
          (setq l (cdr l))
          (if (geometry:box-intersectp a (setq ca (car l)))
            (progn (setq c (geometry:merge-box a ca))
              (setq a c))
            (if (setq cc (vl-some (quote (lambda (x)
                      (if (geometry:box-intersectp a x)
                        (list (geometry:merge-box a x)
                          x))))
                  lst))
              (progn (if (not (equal (car cc)
                      (cadr cc)))
                  (setq lst (subst (car cc)
                      (cadr cc)
                      lst)))
                (setq a ca))
              (setq lst (cons a lst)
                a ca))))
        (if (= (length lst)
            (length r))
          (setq k nil)
          (setq r lst l lst)))))
  (setq l (mapcar (quote (lambda (x)
          (list (list (- (caar x)
                gap)
              (- (cadar x)
                gap))
            (list (+ (caadr x)
                gap)
              (+ (cadadr x)
                gap)))))
      lst)))
```
</details>

---

### pickset:delsameent

**è¯´æ˜**: åˆ é™¤é‡å¤å›¾å…ƒå‚æ•°:ss:é€‰æ‹©é›†

**ç”¨æ³•**:
```lisp
(pickset:delsameent ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

**è¿”å›å€¼**: æ— 

**ç¤ºä¾‹**:
```lisp
(entity:DelSameEnt (ssget))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:delsameent (ss / list1 s9 xy)
  "åˆ é™¤é‡å¤å›¾å…ƒ\nå‚æ•°:\nss:é€‰æ‹©é›†"
  "æ— "
  "(entity:DelSameEnt (ssget))"
  (foreach e (pickset->list ss)
    (setq xy (cdr (entget e)))
    (if (setq s9 (assoc 5 xy))
      (setq xy (subst (quote (5 . "ASD"))
          s9 xy)))
    (if (member xy list1)
      (entdel e)
      (setq list1 (cons xy list1))))
  (princ))
```
</details>

---

### pickset:erase

**è¯´æ˜**: åˆ é™¤é€‰æ‹©é›†å›¾å…ƒ

**ç”¨æ³•**:
```lisp
(pickset:erase ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

**è¿”å›å€¼**: æœ€åä¸€ä¸ªè¢«åˆ é™¤çš„å›¾å…ƒ

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:erase (ss / e)
  "åˆ é™¤é€‰æ‹©é›†å›¾å…ƒ"
  "æœ€åä¸€ä¸ªè¢«åˆ é™¤çš„å›¾å…ƒ"
  (while (> (sslength ss)
      0)
    (setq e (ssname ss 0))
    (setq ss (ssdel e ss))
    (entdel e)))
```
</details>

---

### pickset:from-entlist

**è¯´æ˜**: å›¾å…ƒåˆ—è¡¨->é€‰æ‹©é›†

**ç”¨æ³•**:
```lisp
(pickset:from-entlist entlst)
```

**å‚æ•°**: 1 entlst  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: é€‰æ‹©é›†

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:from-entlist (entlst / ss)
  "å›¾å…ƒåˆ—è¡¨->é€‰æ‹©é›†"
  "é€‰æ‹©é›†"
  (setq ss (ssadd))
  (foreach i entlst (ssadd i ss))
  ss)
```
</details>

---

### pickset:from-list

**è¯´æ˜**: æŠŠå›¾å…ƒåˆ—è¡¨è½¬åŒ–æˆé€‰æ‹©é›†ï¼Œå‚æ•°

**ç”¨æ³•**:
```lisp
(pickset:from-list lstent)
```

**å‚æ•°**: 1 lstent  : åˆ—è¡¨;

**è¿”å›å€¼**: é€‰æ‹©é›†

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:from-list (lstent / ss)
  "æŠŠå›¾å…ƒåˆ—è¡¨è½¬åŒ–æˆé€‰æ‹©é›†ï¼Œå‚æ•°"
  "é€‰æ‹©é›†"
  (setq ss (ssadd))
  (foreach i lstent (ssadd i ss))
  ss)
```
</details>

---

### pickset:get-sub

**è¯´æ˜**: ä»é€‰æ‹©é›†æˆ–å›¾å…ƒè¡¨ä¸­æŒ‰ filter è§„åˆ™è¿‡æ»¤. å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒ XOR å’Œ é€»è¾‘åµŒå¥—ã€‚

**ç”¨æ³•**:
```lisp
(pickset:get-sub ss filter)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;2 filter  : è¿‡æ»¤dxfç»„ç ;

**è¿”å›å€¼**: è¿‡æ»¤åçš„å›¾å…ƒè¡¨

**ç¤ºä¾‹**:
```lisp
(pickset:get-sub ss '((-4 . "")(1 . "7")(-4 . "<")(1 . "4")(-4 . "OR>")))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:get-sub (ss filter / stack-logic state-compare ss-mid to-filter compares)
  "ä»é€‰æ‹©é›†æˆ–å›¾å…ƒè¡¨ä¸­æŒ‰ filter è§„åˆ™è¿‡æ»¤. å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒ XOR å’Œ é€»è¾‘åµŒå¥—ã€‚"
  "è¿‡æ»¤åçš„å›¾å…ƒè¡¨"
  "(pickset:get-sub ss '((-4 . \"<OR\")(1 . \"1*\")(-4 . \">\")(1 . \"7\")(-4 . \"<\")(1 . \"4\")(-4 . \"OR>\")))"
  (if (= (quote pickset)
      (type ss))
    (setq ss (pickset:to-list ss)))
  (setq stack-logic (quote nil))
  (setq state-compare nil)
  (setq ss-mid (quote nil))
  (defun compares (x)
    (if (atom (cdr (assoc (car filter)
            (entget x))))
      ((eval (read state-compare))
        (cdr (assoc (car filter)
            (entget x)))
        (cdr filter))
      (apply (quote and)
        (mapcar (quote (lambda (op m n)
              ((eval (read op))
                m n)))
          (string:to-list state-compare ",")
          (cdr (assoc (car filter)
              (entget x)))
          (cdr filter)))))
  (defun to-filter (filter / ss-n op)
    (cond ((null (car stack-logic))
        (cond ((null state-compare)
            (if (= (quote str)
                (type (cdr filter)))
              (setq ss (vl-remove-if-not (quote (lambda (x)
                      (and (= (quote str)
                          (type (cdr (assoc (car filter)
                                (entget x)))))
                        (wcmatch (strcase (cdr (assoc (car filter)
                                (entget x))))
                          (strcase (cdr filter))))))
                  ss))
              (setq ss (vl-remove-if-not (quote (lambda (x)
                      (member filter (entget x))))
                  ss))))
          (t (setq != /=)
            (setq <> /=)
            (setq ss (vl-remove-if-not (quote (lambda (x)
                    (compares x)))
                ss)))))
      ((= "<AND"
          (strcase (car stack-logic)))
        (cond ((null state-compare)
            (if (= (quote str)
                (type (cdr filter)))
              (setq ss (vl-remove-if-not (quote (lambda (x)
                      (and (= (quote str)
                          (type (cdr (assoc (car filter)
                                (entget x)))))
                        (wcmatch (strcase (cdr (assoc (car filter)
                                (entget x))))
                          (strcase (cdr filter))))))
                  ss))
              (setq ss (vl-remove-if-not (quote (lambda (x)
                      (member filter (entget x))))
                  ss))))
          (t (setq != /=)
            (setq <> /=)
            (setq ss (append ss (vl-remove-if-not (quote (lambda (x)
                      (compares x)))
                  ss))))))
      ((= "<NOT"
          (strcase (car stack-logic)))
        (cond ((null state-compare)
            (if (= (quote str)
                (type (cdr filter)))
              (setq ss (vl-remove-if (quote (lambda (x)
                      (and (= (quote str)
                          (type (cdr (assoc (car filter)
                                (entget x)))))
                        (wcmatch (strcase (cdr (assoc (car filter)
                                (entget x))))
                          (strcase (cdr filter))))))
                  ss))
              (setq ss (vl-remove-if (quote (lambda (x)
                      (member filter (entget x))))
                  ss))))
          (t (setq != /=)
            (setq <> /=)
            (setq ss (append ss (vl-remove-if (quote (lambda (x)
                      (compares x)))
                  ss))))))
      ((= "<OR"
          (strcase (car stack-logic)))
        (cond ((null state-compare)
            (if (= (quote str)
                (type (cdr filter)))
              (setq ss-mid (append ss-mid (vl-remove-if-not (quote (lambda (x)
                        (and (= (quote str)
                            (type (cdr (assoc (car filter)
                                  (entget x)))))
                          (wcmatch (strcase (cdr (assoc (car filter)
                                  (entget x))))
                            (strcase (cdr filter))))))
                    ss)))
              (setq ss-mid (append ss-mid (vl-remove-if-not (quote (lambda (x)
                        (member filter (entget x))))
                    ss)))))
          (t (setq != /=)
            (setq <> /=)
            (setq ss-mid (append ss-mid (vl-remove-if-not (quote (lambda (x)
                      (compares x)))
                  ss))))))
      (t nil)))
  (foreach filter% filter (cond ((= (car filter%)
          -4)
        (cond ((member (read (cdr filter%))
              (mapcar (quote read)
                (quote ("<AND"
                    "<NOT"
                    "<OR"
                    "<XOR"))))
            (setq stack-logic (cons (cdr filter%)
                stack-logic)))
          ((member (read (cdr filter%))
              (mapcar (quote read)
                (quote ("AND>"
                    "NOT>"))))
            (setq state-compare nil)
            (setq stack-logic (cdr stack-logic)))
          ((member (read (cdr filter%))
              (mapcar (quote read)
                (quote ("OR>"
                    "XOR>"))))
            (setq state-compare nil)
            (setq ss ss-mid)
            (setq ss-mid (quote nil))
            (setq stack-logic (cdr stack-logic)))
          (t (setq state-compare (cdr filter%)))))
      (t (to-filter filter%))))
  (if ss-mid (setq ss ss-mid))
  ss)
```
</details>

---

### pickset:getbox

**è¯´æ˜**: è·å–é€‰æ‹©é›†çš„åŒ…å›´ç›’ã€‚ss ä¸ºé€‰æ‹©é›†ï¼Œå›¾å…ƒæˆ–å›¾å…ƒåˆ—è¡¨

**ç”¨æ³•**:
```lisp
(pickset:getbox ss offset)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;2 offset  : åç§»é‡;

**è¿”å›å€¼**: å¤–æ¡†ï¼ˆåç§»åï¼‰çš„å·¦ä¸‹ï¼Œå³ä¸Šè§’ç‚¹

**ç¤ºä¾‹**:
```lisp
(pickset:getbox sel 0.2)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:getbox (ss offset / ptlist)
  "è·å–é€‰æ‹©é›†çš„åŒ…å›´ç›’ã€‚ss ä¸ºé€‰æ‹©é›†ï¼Œå›¾å…ƒæˆ–å›¾å…ƒåˆ—è¡¨"
  "å¤–æ¡†ï¼ˆåç§»åï¼‰çš„å·¦ä¸‹ï¼Œå³ä¸Šè§’ç‚¹"
  "(pickset:getbox sel 0.2)"
  (cond ((= (quote pickset)
        (type ss))
      (setq ss (pickset:to-list ss)))
    ((= (quote ename)
        (type ss))
      (setq ss (list ss)))
    ((p:vla-listp ss)
      (setq ss (mapcar (quote o2e)
          ss))))
  (if (p:ename-listp ss)
    (progn (setq ptlist (apply (quote append)
          (mapcar (quote (lambda (x)
                (entity:getbox x offset)))
            ss)))
      (list (apply (quote mapcar)
          (cons (quote min)
            ptlist))
        (apply (quote mapcar)
          (cons (quote max)
            ptlist))))
    (progn (@:log "ERROR"
        "parameter is NOT pickset")
      nil)))
```
</details>

---

### pickset:intersect

**è¯´æ˜**: æ±‚ä¸¤ä¸ªé€‰æ‹©é›†çš„äº¤é›†ï¼Œss1,ss2 ä¸ºé€‰æ‹©é›†ï¼Œå›¾å…ƒåˆ—è¡¨ã€‚

**ç”¨æ³•**:
```lisp
(pickset:intersect ss1 ss2)
```

**å‚æ•°**: 1 ss1  : é€‰æ‹©é›†;2 ss2  : é€‰æ‹©é›†;

**è¿”å›å€¼**: å›¾å…ƒåˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(pickset:intersect (ssget)(ssget))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:intersect (ss1 ss2)
  "æ±‚ä¸¤ä¸ªé€‰æ‹©é›†çš„äº¤é›†ï¼Œss1,ss2 ä¸ºé€‰æ‹©é›†ï¼Œå›¾å…ƒåˆ—è¡¨ã€‚"
  "å›¾å…ƒåˆ—è¡¨"
  "(pickset:intersect (ssget)(ssget))"
  (if (p:picksetp ss1)
    (setq ss1 (pickset:to-list ss1)))
  (if (p:picksetp ss2)
    (setq ss2 (pickset:to-list ss2)))
  (if (and (p:ename-listp ss1)
      (p:ename-listp ss2))
    (vl-remove-if (quote (lambda (x)
          (not (member x ss2))))
      ss1)))
```
</details>

---

### pickset:join

**è¯´æ˜**: å°†ç¬¬ä¸€ä¸ªé€‰æ‹©é›†ä¸­çš„å›¾å…ƒåŠ å…¥åˆ°ç¬¬äºŒä¸ªé€‰æ‹©é›†ä¸­ã€‚

**ç”¨æ³•**:
```lisp
(pickset:join ss1 ss2)
```

**å‚æ•°**: 1 ss1  : é€‰æ‹©é›†;2 ss2  : é€‰æ‹©é›†;

**è¿”å›å€¼**: åˆå¹¶åçš„æ–°é€‰æ‹©é›†

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:join (ss1 ss2 / i n ename)
  "å°†ç¬¬ä¸€ä¸ªé€‰æ‹©é›†ä¸­çš„å›¾å…ƒåŠ å…¥åˆ°ç¬¬äºŒä¸ªé€‰æ‹©é›†ä¸­ã€‚"
  "åˆå¹¶åçš„æ–°é€‰æ‹©é›†"
  (setq i -1)
  (setq n (sslength ss1))
  (while (< (setq i (1+ i))
      n)
    (setq ss2 (ssadd (ssname ss1 i)
        ss2)))
  ss2)
```
</details>

---

### pickset:length

**è¯´æ˜**: è¿”å›é€‰æ‹©é›†æˆ–å›¾å…ƒåˆ—è¡¨å†…å›¾å…ƒçš„ä¸ªæ•°ã€‚éé€‰æ‹©é›†å’Œå›¾å…ƒåˆ—è¡¨ï¼Œåˆ™è¿”å›nil

**ç”¨æ³•**:
```lisp
(pickset:length ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:length (ss)
  "è¿”å›é€‰æ‹©é›†æˆ–å›¾å…ƒåˆ—è¡¨å†…å›¾å…ƒçš„ä¸ªæ•°ã€‚éé€‰æ‹©é›†å’Œå›¾å…ƒåˆ—è¡¨ï¼Œåˆ™è¿”å›nil"
  (cond ((= (quote pickset)
        (type ss))
      (sslength ss))
    ((and (listp ss)
        (p:ename-listp ss))
      (length ss))))
```
</details>

---

### pickset:pt-verts

**è¯´æ˜**: å–ç‚¹

**ç”¨æ³•**:
```lisp
(pickset:pt-verts ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:pt-verts (ss / i listpp a b c d)
  "å–ç‚¹"
  (setq i 0 listpp nil)
  (if ss (repeat (sslength ss)
      (setq a (ssname ss i))
      (setq b (entget a))
      (setq ename (cdr (assoc 0 b)))
      (cond ((or nil (= ename "POLYLINE")
            (= ename "LWPOLYLINE"))
          (progn (setq c (getlistofpline a))
            (setq listpp (append c listpp))))
        ((= ename "LINE")
          (progn (setq c (cdr (assoc 10 b)))
            (setq d (cdr (assoc 11 b)))
            (setq listpp (cons c listpp))
            (setq listpp (cons d listpp))))
        ((= ename "POINT")
          (progn (setq c (cdr (assoc 10 b)))
            (setq listpp (cons c listpp)))))
      (setq i (1+ i))))
  listpp)
```
</details>

---

### pickset:ptx

**è¯´æ˜**: å–é€‰æ‹©é›†4è§’ç‚¹åæ ‡çš„ç¬¬nä¸ªï¼Œå·¦ä¸‹ 0 å³ä¸‹ 1 å³ä¸Š 2 å·¦ä¸Š 3

**ç”¨æ³•**:
```lisp
(pickset:ptx sel n)
```

**å‚æ•°**: 1 sel  : é€‰æ‹©é›†;2 n  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: ç¬¬nä¸ªè§’ç‚¹åæ ‡

**ç¤ºä¾‹**:
```lisp
(pickset:ptx sel 0)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:ptx (sel n / ptlist)
  "å–é€‰æ‹©é›†4è§’ç‚¹åæ ‡çš„ç¬¬nä¸ªï¼Œå·¦ä¸‹ 0 å³ä¸‹ 1 å³ä¸Š 2 å·¦ä¸Š 3"
  "ç¬¬nä¸ªè§’ç‚¹åæ ‡"
  "(pickset:ptx sel 0)"
  (setq ptlist (pickset:getbox sel 0))
  (nth n (point:rec-2pt->4pt (car ptlist)
      (cadr ptlist))))
```
</details>

---

### pickset:readme

**è¯´æ˜**: é€‰æ‹©é›†ç›¸å…³å‡½æ•°ã€‚

**ç”¨æ³•**:
```lisp
(pickset:readme )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:readme nil "é€‰æ‹©é›†ç›¸å…³å‡½æ•°ã€‚"
  (princ "é€‰æ‹©é›†ç›¸å…³å‡½æ•°ã€‚ä½¿ç”¨ (require 'pickset:*)
    åŠ è½½è¿™äº›å‡½æ•°")
  (princ))
```
</details>

---

### pickset:sort

**è¯´æ˜**: å›¾å…ƒåˆ—è¡¨æŒ‰ç»„ç 10çš„åæ ‡è¿›è¡Œæ’åºã€‚å‚æ•°:ssPts:å›¾å…ƒåˆ—è¡¨;å‚æ•°:KEY:xyzXYZ ä»»æ„ç»„åˆ ,ä¾‹å¦‚"yX",yåœ¨å‰è¡¨ç¤ºyåæ ‡ä¼˜å…ˆï¼Œå°yè¡¨ç¤ºä»å°åˆ°å¤§(æ³¨:äºŒç»´ç‚¹æ—¶ï¼Œä¸èƒ½æœ‰z);å‚æ•°:Fuzz:æ•°å€¼æˆ–åˆ—è¡¨ï¼Œå…è®¸åå·®ï¼›

**ç”¨æ³•**:
```lisp
(pickset:sort sspts key fuzz)
```

**å‚æ•°**: 1 sspts  : é€‰æ‹©é›†;2 key  : é”®ï¼Œå…³é”®å­—;3 fuzz  : å®¹å·®;

**è¿”å›å€¼**: å›¾å…ƒåˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(pickset:sort (ssget) "Yx" '(3000 10)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:sort (sspts key fuzz / keys funs orders equaled)
  "å›¾å…ƒåˆ—è¡¨æŒ‰ç»„ç 10çš„åæ ‡è¿›è¡Œæ’åºã€‚å‚æ•°:ssPts:å›¾å…ƒåˆ—è¡¨;å‚æ•°:KEY:xyzXYZ ä»»æ„ç»„åˆ ,ä¾‹å¦‚\"yX\",yåœ¨å‰è¡¨ç¤ºyåæ ‡ä¼˜å…ˆï¼Œå°yè¡¨ç¤ºä»å°åˆ°å¤§(æ³¨:äºŒç»´ç‚¹æ—¶ï¼Œä¸èƒ½æœ‰z);å‚æ•°:Fuzz:æ•°å€¼æˆ–åˆ—è¡¨ï¼Œå…è®¸åå·®ï¼›"
  "å›¾å…ƒåˆ—è¡¨"
  "(pickset:sort (ssget)
    \"Yx\"
    '(3000 10)"
    (setq keys (vl-string->list key))
    (setq funs (mapcar (quote (lambda (xyz)
            (if (< xyz 100)
              > <)))
        keys))
    (setq orders (mapcar (quote (lambda (xyz)
            (cond ((< xyz 100)
                (- xyz 88))
              (t (- xyz 120)))))
        keys))
    (defun equal-compare (fun a b fuzz)
      (if equaled (if (not (equal a b fuzz))
          (progn (setq equaled nil)
            (fun a b)))))
    (if (atom fuzz)
      (setq fuzz (list fuzz)))
    (while (< (length fuzz)
        (length keys))
      (setq fuzz (append fuzz (list (last fuzz)))))
    (if (p:picksetp sspts)
      (setq sspts (pickset:to-list sspts)))
    (vl-sort sspts (quote (lambda (x y / i equaled)
          (setq equaled t)
          (apply (quote or)
            (mapcar (quote equal-compare)
              funs (mapcar (quote (lambda (m)
                    (nth m (entity:getdxf x 10))))
                orders)
              (mapcar (quote (lambda (m)
                    (nth m (entity:getdxf y 10))))
                orders)
              fuzz))))))
```
</details>

---

### pickset:sort-by-box

**è¯´æ˜**: å›¾å…ƒåˆ—è¡¨æŒ‰åŒ…å›´ç›’çš„ä¸­å¿ƒç‚¹çš„åæ ‡è¿›è¡Œæ’åºã€‚å‚æ•°:ssPts:å›¾å…ƒåˆ—è¡¨;å‚æ•°:KEY:xyzXYZ ä»»æ„ç»„åˆ ,ä¾‹å¦‚"yX",yåœ¨å‰è¡¨ç¤ºyåæ ‡ä¼˜å…ˆï¼Œå°yè¡¨ç¤ºä»å°åˆ°å¤§(æ³¨:äºŒç»´ç‚¹æ—¶ï¼Œä¸èƒ½æœ‰z);å‚æ•°:Fuzz:æ•°å€¼æˆ–åˆ—è¡¨ï¼Œå…è®¸åå·®ï¼›

**ç”¨æ³•**:
```lisp
(pickset:sort-by-box sspts key fuzz)
```

**å‚æ•°**: 1 sspts  : é€‰æ‹©é›†;2 key  : é”®ï¼Œå…³é”®å­—;3 fuzz  : å®¹å·®;

**è¿”å›å€¼**: å›¾å…ƒåˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(pickset:sort1 (ssget) "Yx" '(3000 10)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:sort-by-box (sspts key fuzz / keys funs orders equaled)
  "å›¾å…ƒåˆ—è¡¨æŒ‰åŒ…å›´ç›’çš„ä¸­å¿ƒç‚¹çš„åæ ‡è¿›è¡Œæ’åºã€‚å‚æ•°:ssPts:å›¾å…ƒåˆ—è¡¨;å‚æ•°:KEY:xyzXYZ ä»»æ„ç»„åˆ ,ä¾‹å¦‚\"yX\",yåœ¨å‰è¡¨ç¤ºyåæ ‡ä¼˜å…ˆï¼Œå°yè¡¨ç¤ºä»å°åˆ°å¤§(æ³¨:äºŒç»´ç‚¹æ—¶ï¼Œä¸èƒ½æœ‰z);å‚æ•°:Fuzz:æ•°å€¼æˆ–åˆ—è¡¨ï¼Œå…è®¸åå·®ï¼›"
  "å›¾å…ƒåˆ—è¡¨"
  "(pickset:sort1 (ssget)
    \"Yx\"
    '(3000 10)"
    (setq keys (vl-string->list key))
    (setq funs (mapcar (quote (lambda (xyz)
            (if (< xyz 100)
              > <)))
        keys))
    (setq orders (mapcar (quote (lambda (xyz)
            (cond ((< xyz 100)
                (- xyz 88))
              (t (- xyz 120)))))
        keys))
    (defun equal-compare (fun a b fuzz)
      (if equaled (if (not (equal a b fuzz))
          (progn (setq equaled nil)
            (fun a b)))))
    (if (atom fuzz)
      (setq fuzz (list fuzz)))
    (while (< (length fuzz)
        (length keys))
      (setq fuzz (append fuzz (list (last fuzz)))))
    (if (p:picksetp sspts)
      (setq sspts (pickset:to-list sspts)))
    (vl-sort sspts (quote (lambda (x y / i equaled)
          (setq equaled t)
          (apply (quote or)
            (mapcar (quote equal-compare)
              funs (mapcar (quote (lambda (m)
                    (nth m (point:centroid (entity:getbox x 0)))))
                orders)
              (mapcar (quote (lambda (m)
                    (nth m (point:centroid (entity:getbox y 0)))))
                orders)
              fuzz))))))
```
</details>

---

### pickset:sort-with-dxf

**è¯´æ˜**: é€‰æ‹©é›†æŒ‰ç…§ç»™å®šçš„ç»„ç å€¼è¿›è¡Œæ’åºã€‚n:å¦‚æœç»„ç å€¼ä¸ºä¸€ä¸ªè¡¨ï¼Œåˆ™ n æŒ‡å‡ºä½¿ç”¨ç¬¬å‡ ä¸ªï¼›å¦åˆ™nil ã€‚ decreasep:Tè¡¨ç¤ºä»å¤§åˆ°å°ï¼Œnilè¡¨ç¤ºä»å°åˆ°å¤§

**ç”¨æ³•**:
```lisp
(pickset:sort-with-dxf ss dxf-i n fuzz decreasep)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;2 dxf-i  : ç»„ç å·;3 n  : æœªè¯†åˆ«å®šä¹‰;4 fuzz  : å®¹å·®;5 decreasep  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: æ’åºåçš„é€‰æ‹©é›†

**ç¤ºä¾‹**:
```lisp
(pickset:sort-with-dxf SS 62 nil 0 T) ;;è¡¨ç¤ºæŒ‰ç…§62(é¢œè‰²å·)ç»„ç çš„å€¼è¿›è¡Œæ’åºï¼Œé¡ºåºä¸ºä»å¤§åˆ°å°
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:sort-with-dxf (ss dxf-i n fuzz decreasep / ent index lst newlst newse tmp)
  "é€‰æ‹©é›†æŒ‰ç…§ç»™å®šçš„ç»„ç å€¼è¿›è¡Œæ’åºã€‚<br />n:å¦‚æœç»„ç å€¼ä¸ºä¸€ä¸ªè¡¨ï¼Œåˆ™ n æŒ‡å‡ºä½¿ç”¨ç¬¬å‡ ä¸ªï¼›å¦åˆ™nil ã€‚<br /> decreasep:Tè¡¨ç¤ºä»å¤§åˆ°å°ï¼Œnilè¡¨ç¤ºä»å°åˆ°å¤§ "
  "æ’åºåçš„é€‰æ‹©é›†"
  "(pickset:sort-with-dxf SS 62 nil 0 T)
  ;;è¡¨ç¤ºæŒ‰ç…§62(é¢œè‰²å·)ç»„ç çš„å€¼è¿›è¡Œæ’åºï¼Œé¡ºåºä¸ºä»å¤§åˆ°å°"
  (setq lst (quote nil)
    index 0)
  (repeat (sslength ss)
    (setq ent (entget (ssname ss index))
      tmp (cdr (assoc dxf-i ent)))
    (if (and n (= (type n)
          (quote int))
        (= (type tmp)
          (quote list))
        (< n (length tmp)))
      (setq tmp (nth n tmp)))
    (setq lst (cons (list tmp (cdr (assoc 5 ent)))
        lst))
    (setq index (1+ index)))
  (if (and fuzz (or (= (type fuzz)
          (quote int))
        (= (type fuzz)
          (quote real)))
      (or (= (type tmp)
          (quote int))
        (= (type tmp)
          (quote real))))
    (setq newlst (vl-sort lst (function (lambda (e1 e2)
            (< (+ (car e1)
                fuzz)
              (car e2))))))
    (setq newlst (vl-sort lst (function (lambda (e1 e2)
            (< (car e1)
              (car e2)))))))
  (if decreasep (setq newlst (reverse newlst)))
  (setq newse (ssadd))
  (foreach tmp newlst (setq newse (ssadd (handent (cadr tmp))
        newse)))
  newse)
```
</details>

---

### pickset:sort1

**è¯´æ˜**: æµ‹è¯•ç‰ˆï¼Œå›¾å…ƒåˆ—è¡¨æŒ‰ç»„ç 10çš„åæ ‡è¿›è¡Œæ’åºã€‚å‚æ•°:ssPts:å›¾å…ƒåˆ—è¡¨;å‚æ•°:KEY:xyzXYZ ä»»æ„ç»„åˆ ,ä¾‹å¦‚"yX",yåœ¨å‰è¡¨ç¤ºyåæ ‡ä¼˜å…ˆï¼Œå°yè¡¨ç¤ºä»å°åˆ°å¤§(æ³¨:äºŒç»´ç‚¹æ—¶ï¼Œä¸èƒ½æœ‰z);å‚æ•°:Fuzz:æ•°å€¼æˆ–åˆ—è¡¨ï¼Œå…è®¸åå·®ï¼›

**ç”¨æ³•**:
```lisp
(pickset:sort1 sspts key fuzz)
```

**å‚æ•°**: 1 sspts  : é€‰æ‹©é›†;2 key  : é”®ï¼Œå…³é”®å­—;3 fuzz  : å®¹å·®;

**è¿”å›å€¼**: å›¾å…ƒåˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(pickset:sort1 (ssget) "Yx" '(3000 10)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:sort1 (sspts key fuzz / keys funs orders equaled)
  "æµ‹è¯•ç‰ˆï¼Œå›¾å…ƒåˆ—è¡¨æŒ‰ç»„ç 10çš„åæ ‡è¿›è¡Œæ’åºã€‚å‚æ•°:ssPts:å›¾å…ƒåˆ—è¡¨;å‚æ•°:KEY:xyzXYZ ä»»æ„ç»„åˆ ,ä¾‹å¦‚\"yX\",yåœ¨å‰è¡¨ç¤ºyåæ ‡ä¼˜å…ˆï¼Œå°yè¡¨ç¤ºä»å°åˆ°å¤§(æ³¨:äºŒç»´ç‚¹æ—¶ï¼Œä¸èƒ½æœ‰z);å‚æ•°:Fuzz:æ•°å€¼æˆ–åˆ—è¡¨ï¼Œå…è®¸åå·®ï¼›"
  "å›¾å…ƒåˆ—è¡¨"
  "(pickset:sort1 (ssget)
    \"Yx\"
    '(3000 10)"
    (setq keys (vl-string->list key))
    (setq funs (mapcar (quote (lambda (xyz)
            (if (< xyz 100)
              > <)))
        keys))
    (setq orders (mapcar (quote (lambda (xyz)
            (cond ((< xyz 100)
                (- xyz 88))
              (t (- xyz 120)))))
        keys))
    (defun equal-compare (fun a b fuzz)
      (if equaled (if (not (equal a b fuzz))
          (progn (setq equaled nil)
            (fun a b)))))
    (if (atom fuzz)
      (setq fuzz (list fuzz)))
    (while (< (length fuzz)
        (length keys))
      (setq fuzz (append fuzz (list (last fuzz)))))
    (if (p:picksetp sspts)
      (setq sspts (pickset:to-list sspts)))
    (vl-sort sspts (quote (lambda (x y / i equaled)
          (setq equaled t)
          (apply (quote or)
            (mapcar (quote equal-compare)
              funs (mapcar (quote (lambda (m)
                    (nth m (entity:getdxf x 10))))
                orders)
              (mapcar (quote (lambda (m)
                    (nth m (entity:getdxf y 10))))
                orders)
              fuzz))))))
```
</details>

---

### pickset:ss-forword-en

**è¯´æ˜**: å°†å›¾å…ƒ ent ä¹‹åçš„æ‰€æœ‰å›¾å…ƒå½¢æˆçš„é€‰æ‹©é›†

**ç”¨æ³•**:
```lisp
(pickset:ss-forword-en en)
```

**å‚æ•°**: 1 en  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: pickset

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:ss-forword-en (en / ss)
  "å°†å›¾å…ƒ ent ä¹‹åçš„æ‰€æœ‰å›¾å…ƒå½¢æˆçš„é€‰æ‹©é›†"
  "pickset"
  (if en (progn (setq ss (ssadd))
      (while (setq en (entnext en))
        (if (not (member (cdr (assoc 0 (entget en)))
              (quote ("ATTRIB"
                  "VERTEX"
                  "SEQEND"))))
          (ssadd en ss)))
      (if (zerop (sslength ss))
        (setq ss nil))
      ss)
    (ssget "_x")))
```
</details>

---

### pickset:ssget

**è¯´æ˜**: è‡ªå®šä¹‰å¸¦æç¤ºç¬¦çš„ssget

**ç”¨æ³•**:
```lisp
(pickset:ssget msg params)
```

**å‚æ•°**: 1 msg  : æç¤ºä¿¡æ¯;2 params  : å‚æ•°åˆ—è¡¨;

**è¿”å›å€¼**: é€‰æ‹©é›†

**ç¤ºä¾‹**:
```lisp
(pickset:ssget "é€‰æ‹©å¯¹è±¡ï¼š" '("_WP" pt_list ((0 . "LINE") (62 . 5))))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:ssget (msg params / sel)
  "è‡ªå®šä¹‰å¸¦æç¤ºç¬¦çš„ssget "
  "é€‰æ‹©é›†"
  "(pickset:ssget \"é€‰æ‹©å¯¹è±¡ï¼š\"
    '(\"_WP\"
      pt_list ((0 . \"LINE\")
        (62 . 5))))"
  (princ msg)
  (setvar (quote nomutt)
    1)
  (setq sel (vl-catch-all-apply (quote ssget)
      params))
  (setvar (quote nomutt)
    0)
  (if (not (vl-catch-all-error-p sel))
    sel))
```
</details>

---

### pickset:ssget-crossline

**è¯´æ˜**: å–å¾—ä¸çº¿ç›¸äº¤çš„é€‰æ‹©é›†

**ç”¨æ³•**:
```lisp
(pickset:ssget-crossline ent filter)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;2 filter  : è¿‡æ»¤dxfç»„ç ;

**è¿”å›å€¼**: é€‰æ‹©é›†

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:ssget-crossline (ent filter /)
  "å–å¾—ä¸çº¿ç›¸äº¤çš„é€‰æ‹©é›†"
  "é€‰æ‹©é›†"
  (if filter (ssget "f"
      (entity:getdxf ent (quote (10 11)))
      filter)
    (ssget "f"
      (entity:getdxf ent (quote (10 11))))))
```
</details>

---

### pickset:sub

**è¯´æ˜**: é€‰æ‹©é›†ç›¸å‡

**ç”¨æ³•**:
```lisp
(pickset:sub ss1 ss2)
```

**å‚æ•°**: 1 ss1  : é€‰æ‹©é›†;2 ss2  : é€‰æ‹©é›†;

**è¿”å›å€¼**: é€‰æ‹©é›† or nil

**ç¤ºä¾‹**:
```lisp
(pickset:Sub (setq ss1 (ssget)) (setq ss2 (ssget)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:sub (ss1 ss2 / ename ss sstemp)
  "é€‰æ‹©é›†ç›¸å‡"
  "é€‰æ‹©é›† or nil"
  "(pickset:Sub (setq ss1 (ssget))
    (setq ss2 (ssget)))"
  (cond ((and (equal (type ss1)
          (quote pickset))
        (equal (type ss2)
          (quote pickset)))
      (cond ((equal (sslength ss1)
            (sslength ss2))
          (vl-cmdf "_.select"
            ss1 "")
          (setq ss (ssget "p"))
          (vl-cmdf "_.select"
            ss2 "")
          (setq sstemp (ssget "p"))
          (repeat (sslength sstemp)
            (setq ename (ssname sstemp 0))
            (ssdel ename sstemp)
            (if (ssmemb ename ss)
              (ssdel ename ss)))
          (if (equal (sslength ss)
              0)
            nil ss))
        (t (command "._Select"
            ss1 "_Remove"
            ss2 "")
          (ssget "_P"))))
    ((and (equal (type ss1)
          (quote pickset))
        (not (equal (type ss2)
            (quote pickset))))
      ss1)
    (t nil)))
```
</details>

---

### pickset:to-array

**è¯´æ˜**: é€‰æ‹©é›†->æ•°

**ç”¨æ³•**:
```lisp
(pickset:to-array ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

**è¿”å›å€¼**: æ•°ç»„

**ç¤ºä¾‹**:
```lisp
(pickset->Array (ssget))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:to-array (ss)
  "é€‰æ‹©é›†->æ•°"
  "æ•°ç»„"
  "(pickset->Array (ssget))"
  (if ss (vla:list->array (pickset:to-vlalist ss)
      9)
    nil))
```
</details>

---

### pickset:to-ax

**è¯´æ˜**: å°†é€‰æ‹©é›†æˆ–å›¾å…ƒåˆ—è¡¨è½¬åŒ–ä¸ºActiveXé€‰æ‹©é›†å¯¹è±¡

**ç”¨æ³•**:
```lisp
(pickset:to-ax ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

**è¿”å›å€¼**: Object

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:to-ax (ss / ssetobj objs cnt)
  "å°†é€‰æ‹©é›†æˆ–å›¾å…ƒåˆ—è¡¨è½¬åŒ–ä¸ºActiveXé€‰æ‹©é›†å¯¹è±¡"
  "Object"
  (if (= (quote pickset)
      (type ss))
    (setq ss (pickset:to-list ss)))
  (setq ssetobj (vla-add (vla-get-selectionsets *doc*)
      (strcat "ss"
        (@:timestamp))))
  (setq objs (vlax-make-safearray vlax-vbobject (cons 0 (1- (length ss))))
    cnt 0)
  (foreach obj% (pickset:to-vlalist ss)
    (vlax-safearray-put-element objs cnt obj%)
    (setq cnt (1+ cnt)))
  (vla-additems ssetobj objs)
  ssetobj)
```
</details>

---

### pickset:to-entlist

**è¯´æ˜**: é€‰æ‹©é›†->å›¾å…ƒåˆ—è¡¨

**ç”¨æ³•**:
```lisp
(pickset:to-entlist ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

**è¿”å›å€¼**: å›¾å…ƒåˆ—è¡¨

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:to-entlist (ss)
  "é€‰æ‹©é›†->å›¾å…ƒåˆ—è¡¨"
  "å›¾å…ƒåˆ—è¡¨"
  (if ss (pickset:to-list-by-ssnamex ss)))
```
</details>

---

### pickset:to-list

**è¯´æ˜**: é€‰æ‹©é›†è½¬å›¾å…ƒåˆ—è¡¨

**ç”¨æ³•**:
```lisp
(pickset:to-list ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

**è¿”å›å€¼**: å›¾å…ƒåˆ—è¡¨

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:to-list (ss)
  "é€‰æ‹©é›†è½¬å›¾å…ƒåˆ—è¡¨"
  "å›¾å…ƒåˆ—è¡¨"
  (if ss (pickset:to-list-by-ssnamex ss)))
```
</details>

---

### pickset:to-list-by-ssname

**è¯´æ˜**: é€‰æ‹©é›†è½¬å›¾å…ƒè¡¨ï¼Œssname æ–¹æ³•

**ç”¨æ³•**:
```lisp
(pickset:to-list-by-ssname ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

**è¿”å›å€¼**: lst

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:to-list-by-ssname (ss / i lst)
  "é€‰æ‹©é›†è½¬å›¾å…ƒè¡¨ï¼Œssname æ–¹æ³•"
  "lst"
  ""
  (setq i -1)
  (if (p:picksetp ss)
    (repeat (sslength ss)
      (setq lst (cons (ssname ss (setq i (1+ i)))
          lst))))
  (reverse lst))
```
</details>

---

### pickset:to-list-by-ssnamex

**è¯´æ˜**: é€‰æ‹©é›†è½¬å›¾å…ƒè¡¨ï¼Œssnamex æ–¹æ³•

**ç”¨æ³•**:
```lisp
(pickset:to-list-by-ssnamex ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

**è¿”å›å€¼**: lst

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:to-list-by-ssnamex (ss / i lst)
  "é€‰æ‹©é›†è½¬å›¾å…ƒè¡¨ï¼Œssnamex æ–¹æ³•"
  "lst"
  ""
  (setq ssx (reverse (ssnamex ss)))
  (while (< (caar ssx)
      0)
    (setq ssx (cdr ssx)))
  (setq lst (reverse (mapcar (quote cadr)
        ssx))))
```
</details>

---

### pickset:to-vlalist

**è¯´æ˜**: é€‰æ‹©é›†æˆ–å›¾å…ƒåˆ—è¡¨è½¬ä¸ºVlaåˆ—è¡¨

**ç”¨æ³•**:
```lisp
(pickset:to-vlalist ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

**è¿”å›å€¼**: Vlaåˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(pickset:to-vlalist (ssget))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:to-vlalist (ss)
  "é€‰æ‹©é›†æˆ–å›¾å…ƒåˆ—è¡¨è½¬ä¸ºVlaåˆ—è¡¨"
  "Vlaåˆ—è¡¨"
  "(pickset:to-vlalist (ssget))"
  (if (= (quote pickset)
      (type ss))
    (setq ss (pickset:to-list ss)))
  (if ss (mapcar (quote vlax-ename->vla-object)
      ss)))
```
</details>

---

### pickset:zoom

**è¯´æ˜**: ç¼©æ”¾é€‰æ‹©é›†ssåˆ°å½“å‰è§†å£.æ˜¾ç¤ºçš„å±å æ¯”å¯ç”±è®¾ç½®é€‰é¡¹ @:magnify æ§åˆ¶ï¼Œå…¶å€¼è¶Šå¤§ï¼Œæ”¾å¤§ç‡è¶Šä½ã€‚é»˜è®¤æ»¡å±

**ç”¨æ³•**:
```lisp
(pickset:zoom ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

**ç¤ºä¾‹**:
```lisp
(pickset:zoom (ssget))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun pickset:zoom (ss / box)
  "ç¼©æ”¾é€‰æ‹©é›†ssåˆ°å½“å‰è§†å£.\næ˜¾ç¤ºçš„å±å æ¯”å¯ç”±è®¾ç½®é€‰é¡¹ @:magnify æ§åˆ¶ï¼Œ\nå…¶å€¼è¶Šå¤§ï¼Œæ”¾å¤§ç‡è¶Šä½ã€‚é»˜è®¤æ»¡å±"
  ""
  "(pickset:zoom (ssget))"
  (setq box (pickset:getbox ss 0))
  (vla-zoomcenter *acad* (apply (quote vlax-3d-point)
      (point:centroid box))
    (* (if (and (setq magnify (@:get-config (quote @:magnify)))
          (> magnify 0.01))
        magnify 1)
      (/ (apply (quote max)
          (mapcar (quote /)
            (mapcar (quote -)
              (cadr box)
              (car box))
            (getvar "SCREENSIZE")))
        0.001))))
```
</details>

---

## point

**æ¨¡å—è¯´æ˜**: ç‚¹åæ ‡å¤„ç†ã€å˜æ¢

### point:2d->3d

**è¯´æ˜**: å°†ä¸€ç»´æˆ–äºŒç»´ç‚¹è½¬æ¢ä¸º3ç»´ç‚¹ï¼Œè‹¥ä¸ºä¸€ä¸ªæ•°å€¼ï¼Œåˆ™å°†æ•°å€¼è½¬ä¸º3ç»´ç‚¹

**ç”¨æ³•**:
```lisp
(point:2d->3d pt-2d)
```

**å‚æ•°**: 1 pt-2d  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: ä¸‰ç»´åæ ‡ç‚¹

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun point:2d->3d (pt-2d)
    "å°†ä¸€ç»´æˆ–äºŒç»´ç‚¹è½¬æ¢ä¸º3ç»´ç‚¹ï¼Œè‹¥ä¸ºä¸€ä¸ªæ•°å€¼ï¼Œåˆ™å°†æ•°å€¼è½¬ä¸º3ç»´ç‚¹"
    "ä¸‰ç»´åæ ‡ç‚¹"
    (cond ((listp pt-2d)
            (if (= 1 (length pt-2d))
                (list (float (car pt-2d))
                    0.0 0.0)
                (if (= 2 (length pt-2d))
                    (list (float (car pt-2d))
                        (float (cadr pt-2d))
                        0.0)
                    (mapcar (quote float)
                        pt-2d))))
        ((realp pt-2d)
            (list pt-2d 0.0 0.0))
        ((intp pt-2d)
            (list (float pt-2d)
                0.0 0.0))
        (t nil)))
```
</details>

---

### point:3d->2d

**è¯´æ˜**: ç”±ä¸‰ç»´ç‚¹åæ ‡è¿”å›äºŒç»´ç‚¹åæ ‡

**ç”¨æ³•**:
```lisp
(point:3d->2d pt-3d)
```

**å‚æ•°**: 1 pt-3d  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: äºŒç»´åæ ‡ç‚¹

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun point:3d->2d (pt-3d)
    "ç”±ä¸‰ç»´ç‚¹åæ ‡è¿”å›äºŒç»´ç‚¹åæ ‡"
    "äºŒç»´åæ ‡ç‚¹"
    (if (listp pt-3d)
        (list (float (car pt-3d))
            (float (cadr pt-3d)))))
```
</details>

---

### point:centroid

**è¯´æ˜**: æ±‚å¤šä¸ªç‚¹çš„å‡ ä½•å½¢å¿ƒ

**ç”¨æ³•**:
```lisp
(point:centroid pts)
```

**å‚æ•°**: 1 pts  : å¤šä¸ªåæ ‡ç‚¹åˆ—è¡¨;

**è¿”å›å€¼**: POINT

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun point:centroid (pts)
  "æ±‚å¤šä¸ªç‚¹çš„å‡ ä½•å½¢å¿ƒ"
  "POINT"
  (if (> (length pts)
      0)
    (mapcar (quote (lambda (x)
          (/ x (float (length pts)))))
      (cons (apply (quote +)
          (mapcar (quote car)
            pts))
        (cons (apply (quote +)
            (mapcar (quote cadr)
              pts))
          (if (caddr (car pts))
            (cons (apply (quote +)
                (mapcar (quote caddr)
                  pts))
              nil)))))))
```
</details>

---

### point:div

**è¯´æ˜**: å°† pt1 pt2 ä¹‹é—´ç­‰åˆ† n ä»½åæ¯ä¸ªç‚¹çš„åæ ‡(ä¸å«pt1 pt2)

**ç”¨æ³•**:
```lisp
(point:div pt1 pt2 n)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;3 n  : æ•´æ•°;

**è¿”å›å€¼**: ç‚¹åæ ‡è¡¨

**ç¤ºä¾‹**:
```lisp
(point:div (getpoint(@:speak"èµ·ç‚¹:")) (getpoint(@:speak"ç»ˆç‚¹:")) 5)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun point:div (pt1 pt2 n / pt)
  "å°† pt1 pt2 ä¹‹é—´ç­‰åˆ† n ä»½åæ¯ä¸ªç‚¹çš„åæ ‡(ä¸å«pt1 pt2)"
  "ç‚¹åæ ‡è¡¨"
  "(point:div (getpoint(@:speak\"èµ·ç‚¹:\"))
    (getpoint(@:speak\"ç»ˆç‚¹:\"))
    5)"
  (setq n (fix n))
  (if (and (> n 1)
      (= (quote point)
        (type-of pt1))
      (= (quote point)
        (type-of pt2)))
    (cons (setq pt (polar pt1 (angle pt1 pt2)
          (/ (distance pt1 pt2)
            (float n))))
      (div pt pt2 (1- n)))))
```
</details>

---

### point:in-box

**è¯´æ˜**: åˆ¤æ–­ pt1 æ˜¯å¦åœ¨çŸ©å½¢å†…

**ç”¨æ³•**:
```lisp
(point:in-box pt1 pt-box1 pt-box2)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;  2 pt-box1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;  3 pt-box2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: T or nil

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun point:in-box (pt1 pt-box1 pt-box2)
    "åˆ¤æ–­ pt1 æ˜¯å¦åœ¨çŸ©å½¢å†…"
    "t or nil"
    (and (>= (car pt1)
            (car pt-box1))
        (<= (car pt1)
            (car pt-box2))
        (>= (cadr pt1)
            (cadr pt-box1))
        (<= (cadr pt1)
            (cadr pt-box2))))
```
</details>

---

### point:mid

**è¯´æ˜**: æ±‚ä¸¤ç‚¹ pt1 pt2 çš„ä¸­ç‚¹

**ç”¨æ³•**:
```lisp
(point:mid pt1 pt2)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;  2 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: ä¸­ç‚¹åæ ‡

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun point:mid (pt1 pt2)
    "æ±‚ä¸¤ç‚¹ pt1 pt2 çš„ä¸­ç‚¹"
    "ä¸­ç‚¹åæ ‡"
    (mapcar (quote (lambda (x y)
                (* 0.5 (+ x y))))
        pt1 pt2))
```
</details>

---

### point:rec-2pt->4pt

**è¯´æ˜**: æ ¹æ®çŸ©å½¢2ç‚¹è®¡ç®—çŸ©å½¢4ç‚¹

**ç”¨æ³•**:
```lisp
(point:rec-2pt->4pt pt1 pt2)
```

**å‚æ•°**: 1 pt1  : å•ä¸ª2D/3Dåæ ‡ç‚¹;  2 pt2  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**è¿”å›å€¼**: çŸ©å½¢çš„å››ç‚¹åæ ‡

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun point:rec-2pt->4pt (pt1 pt2)
    "æ ¹æ®çŸ©å½¢2ç‚¹è®¡ç®—çŸ©å½¢4ç‚¹"
    "çŸ©å½¢çš„å››ç‚¹åæ ‡"
    (mapcar (quote (lambda (x)
                (mapcar (quote apply)
                    x (mapcar (quote list)
                        pt1 pt2))))
        (quote ((min min)
                (max min)
                (max max)
                (min max)))))
```
</details>

---

### point:remove-duplicates

**è¯´æ˜**: å»æ‰ç‚¹åˆ—è¡¨ä¸­çš„é‡å¤æˆ–è·ç¦»è¾ƒå°çš„çš„ç›¸é‚»ç‚¹

**ç”¨æ³•**:
```lisp
(point:remove-duplicates pts)
```

**å‚æ•°**: 1 pts  : å¤šä¸ªåæ ‡ç‚¹åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun point:remove-duplicates (pts / lst)
  "å»æ‰ç‚¹åˆ—è¡¨ä¸­çš„é‡å¤æˆ–è·ç¦»è¾ƒå°çš„çš„ç›¸é‚»ç‚¹"
  ""
  (setq lst (cons (car pts)
      nil))
  (foreach pt pts (if (> (distance pt (car lst))
        0.0001)
      (setq lst (cons pt lst))))
  lst)
```
</details>

---

### point:to-ax

**è¯´æ˜**: å°†ç‚¹åæ ‡è½¬ä¸ºActiveXå¯¹è±¡

**ç”¨æ³•**:
```lisp
(point:to-ax pt)
```

**å‚æ•°**: 1 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun point:to-ax (pt)
  "å°†ç‚¹åæ ‡è½¬ä¸ºActiveXå¯¹è±¡"
  (apply (quote vlax-3d-point)
    pt))
```
</details>

---

## py

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### py:install

**è¯´æ˜**: å®‰è£…Pythonè¿è¡Œç¯å¢ƒ

**ç”¨æ³•**:
```lisp
(py:install )
```

**å‚æ•°**: æ²¡æœ‰ä¸€ä¸ª

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun py:install nil "å®‰è£…Pythonè¿è¡Œç¯å¢ƒ"
  ""
  (or @::enable-start (@::check-pgp)
    (@::patch-pgp))
  (setvar "cmdecho"
    0)
  (@::cmd "powershell"
    "winget install python.python.3.13")
  (setvar "cmdecho"
    1))
```
</details>

---

## re

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### re:match

**è¯´æ˜**: æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç´¢å­—ä¸². pattern ä¸ºä»¥/å¼€å¤´åŠä»¥/+ä¿®é¥°ç¬¦ç»“å°¾çš„å­—ä¸²ï¼Œ\ éœ€å†™æˆ \\ å½¢å¼ã€‚

**ç”¨æ³•**:
```lisp
(re:match pattern string)
```

**å‚æ•°**: 1 pattern  : æœªè¯†åˆ«å®šä¹‰;2 string  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: List

**ç¤ºä¾‹**:
```lisp
(re:match "/ab/g" "cabcdabcd")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun re:match (pattern string / regex s pos len str l flags)
  "æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç´¢å­—ä¸². pattern ä¸ºä»¥/å¼€å¤´åŠä»¥/+ä¿®é¥°ç¬¦ç»“å°¾çš„å­—ä¸²ï¼Œ\\ éœ€å†™æˆ \\\\ å½¢å¼ã€‚"
  "List"
  "(re:match \"/ab/g\"
    \"cabcdabcd\")"
  (setq lst-p (string:to-list pattern "/"))
  (setq flags (strcase (last lst-p)
      t))
  (setq pattern (string:from-lst (reverse (cdr (reverse (cdr lst-p))))
      "/"))
  (setq regex (vlax-create-object "Vbscript.RegExp"))
  (mapcar (quote (lambda (x)
        (vlax-put-property regex x 0)))
    (quote ("Global"
        "IgnoreCase"
        "Multiline")))
  (foreach f (vl-string->list flags)
    (cond ((= f (ascii "g"))
        (vlax-put-property regex "Global"
          1))
      ((= f (ascii "i"))
        (vlax-put-property regex "IgnoreCase"
          1))
      ((= f (ascii "m"))
        (vlax-put-property regex "Multiline"
          1))))
  (vlax-put-property regex "Pattern"
    pattern)
  (setq s (vlax-invoke-method regex (quote execute)
      string))
  (vlax-for o s (setq str (vlax-get-property o "value"))
    (setq l (cons str l)))
  (vlax-release-object regex)
  (reverse l))
```
</details>

---

### re:replace

**è¯´æ˜**: æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢å­—ç¬¦ä¸². pattern ä¸ºä»¥/å¼€å¤´åŠä»¥/+ä¿®é¥°ç¬¦ç»“å°¾çš„å­—ä¸²ï¼Œ\ éœ€å†™æˆ \\ å½¢å¼ã€‚

**ç”¨æ³•**:
```lisp
(re:replace pattern string newstr)
```

**å‚æ•°**: 1 pattern  : æœªè¯†åˆ«å®šä¹‰;2 string  : å­—ç¬¦ä¸²;3 newstr  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: String

**ç¤ºä¾‹**:
```lisp
(re:replace "/ab/g" "cabcdabcd" "mm")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun re:replace (pattern string newstr / regex s pos len str l flags)
  "æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢å­—ç¬¦ä¸². pattern ä¸ºä»¥/å¼€å¤´åŠä»¥/+ä¿®é¥°ç¬¦ç»“å°¾çš„å­—ä¸²ï¼Œ\\ éœ€å†™æˆ \\\\ å½¢å¼ã€‚"
  "String"
  "(re:replace \"/ab/g\"
    \"cabcdabcd\"
    \"mm\")"
  (setq lst-p (string:to-list pattern "/"))
  (setq flags (strcase (last lst-p)
      t))
  (setq pattern (string:from-lst (reverse (cdr (reverse (cdr lst-p))))
      "/"))
  (setq regex (vlax-create-object "Vbscript.RegExp"))
  (mapcar (quote (lambda (x)
        (vlax-put-property regex x 0)))
    (quote ("Global"
        "IgnoreCase"
        "Multiline")))
  (foreach f (vl-string->list flags)
    (cond ((= f (ascii "g"))
        (vlax-put-property regex "Global"
          1))
      ((= f (ascii "i"))
        (vlax-put-property regex "IgnoreCase"
          1))
      ((= f (ascii "m"))
        (vlax-put-property regex "Multiline"
          1))))
  (vlax-put-property regex "Pattern"
    pattern)
  (setq s (vlax-invoke-method regex (quote replace)
      string newstr))
  (vlax-release-object regex)
  s)
```
</details>

---

### re:search

**è¯´æ˜**: æ­£åˆ™è¡¨è¾¾å¼æœç´¢å­—ä¸². pattern ä¸ºä»¥/å¼€å¤´åŠä»¥/+ä¿®é¥°ç¬¦ç»“å°¾çš„å­—ä¸²ï¼Œ\ éœ€å†™æˆ \\ å½¢å¼ã€‚

**ç”¨æ³•**:
```lisp
(re:search pattern string)
```

**å‚æ•°**: 1 pattern  : æœªè¯†åˆ«å®šä¹‰;2 string  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: list

**ç¤ºä¾‹**:
```lisp
(re:search "/ab/g" "cabcdabcd")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun re:search (pattern string / regex s pos len str l flags)
  "æ­£åˆ™è¡¨è¾¾å¼æœç´¢å­—ä¸². pattern ä¸ºä»¥/å¼€å¤´åŠä»¥/+ä¿®é¥°ç¬¦ç»“å°¾çš„å­—ä¸²ï¼Œ\\ éœ€å†™æˆ \\\\ å½¢å¼ã€‚"
  "list"
  "(re:search \"/ab/g\"
    \"cabcdabcd\")"
  (setq lst-p (string:to-list pattern "/"))
  (setq flags (strcase (last lst-p)
      t))
  (setq pattern (string:from-lst (reverse (cdr (reverse (cdr lst-p))))
      "/"))
  (setq regex (vlax-create-object "Vbscript.RegExp"))
  (mapcar (quote (lambda (x)
        (vlax-put-property regex x 0)))
    (quote ("Global"
        "IgnoreCase"
        "Multiline")))
  (foreach f (vl-string->list flags)
    (cond ((= f (ascii "g"))
        (vlax-put-property regex "Global"
          1))
      ((= f (ascii "i"))
        (vlax-put-property regex "IgnoreCase"
          1))
      ((= f (ascii "m"))
        (vlax-put-property regex "Multiline"
          1))))
  (vlax-put-property regex "Pattern"
    pattern)
  (setq s (vlax-invoke-method regex (quote execute)
      string))
  (vlax-for o s (setq pos (vlax-get-property o "FirstIndex")
      len (vlax-get-property o "Length")
      str (vlax-get-property o "value"))
    (setq l (cons (list pos len str)
        l)))
  (vla:dump regex)
  (vlax-release-object regex)
  (reverse l))
```
</details>

---

## reg

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### reg:list-app

**è¯´æ˜**: åˆ—å‡ºvlax-get-or-create-objectå¯ç”¨çš„åº”ç”¨å¯¹è±¡

**ç”¨æ³•**:
```lisp
(reg:list-app )
```

**å‚æ•°**: æ²¡æœ‰ä¸€ä¸ª

**è¿”å›å€¼**: lst

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun reg:list-app nil "åˆ—å‡ºvlax-get-or-create-objectå¯ç”¨çš„åº”ç”¨å¯¹è±¡ "
  "lst"
  (setq axroot "HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\WOW6432Node\\CLSID")
  (setq clsids (vl-remove-if-not (quote (lambda (x / ax)
          (setq sub (mapcar (quote strcase)
              (vl-registry-descendents (strcat axroot "\\"
                  X))))
          (AND (MEMBER (STRCASE "inprocserver32")
              SUB)
            (MEMBER (STRCASE "progid")
              SUB))))
      (VL-REGISTRY-DESCENDENTS AXROOT)))
  (MAPCAR (QUOTE (LAMBDA (X)
        (VL-REGISTRY-READ (STRCAT AXROOT "\\"
            x "\\ProgID"))))
    clsids))
```
</details>

---

## stat

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### stat:classify

**è¯´æ˜**: åˆ†ç±»ç»Ÿè®¡ç”±ä¸€ç³»åˆ—ç±»åˆ«å’Œæ•°å­—ç»„æˆçš„ç‚¹å¯¹è¡¨ã€‚æŒ‰ç±»åˆ«ç»Ÿè®¡æ±‚ç±»åˆ«åæ•°å€¼çš„æ€»å’Œã€‚

**ç”¨æ³•**:
```lisp
(stat:classify lst-cons)
```

**å‚æ•°**: 1 lst-cons  : åˆ—è¡¨;

**è¿”å›å€¼**: lst

**ç¤ºä¾‹**:
```lisp
(stat:classify '((a . 5)(b . 3)(a . 2)(b . 6)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun stat:classify (lst-cons / res)
  "åˆ†ç±»ç»Ÿè®¡ç”±ä¸€ç³»åˆ—ç±»åˆ«å’Œæ•°å­—ç»„æˆçš„ç‚¹å¯¹è¡¨ã€‚æŒ‰ç±»åˆ«ç»Ÿè®¡æ±‚ç±»åˆ«åæ•°å€¼çš„æ€»å’Œã€‚"
  "lst"
  "(stat:classify '((a . 5)(b . 3)(a . 2)(b . 6)))"
  (setq res nil)
  (foreach cons% lst-cons (if (assoc (car cons%)
        res)
      (setq res (subst (cons (car cons%)
            (+ (cdr (assoc (car cons%)
                  res))
              (cdr cons%)))
          (assoc (car cons%)
            res)
          res))
      (setq res (cons cons% res))))
  res)
```
</details>

---

### stat:draw

**è¯´æ˜**: ç»˜åˆ¶æœ€åä¸€æ¬¡ç»Ÿè®¡çš„ç»“æœ

**ç”¨æ³•**:
```lisp
(stat:draw )
```

**å‚æ•°**: æ²¡æœ‰ä¸€ä¸ª

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun stat:draw (/ n pt ent-table *error*)
  "ç»˜åˆ¶æœ€åä¸€æ¬¡ç»Ÿè®¡çš„ç»“æœ"
  (defun *error* (msg)
    (if ent-table (entdel ent-table))
    (princ msg))
  (if @:tmp-stat-result (progn (setq pt (quote (0 0 0)))
      (setq n 0)
      (setq ent-table (table:make pt "ç»Ÿè®¡ç»“æœ"
          (quote ("é¡¹ç›®"
              "ä¸ªæ•°"))
          (mapcar (quote (lambda (x)
                (list (car x)
                  (cdr x))))
            @:tmp-stat-result)))
      (ui:dyndraw ent-table pt))))
```
</details>

---

### stat:mode

**è¯´æ˜**: ä¼—æ•°

**ç”¨æ³•**:
```lisp
(stat:mode stat-res)
```

**å‚æ•°**: 1 stat-res  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun stat:mode (stat-res)
  "ä¼—æ•°"
  (car (vl-sort stat-res (function (lambda (e1 e2)
          (> (cdr e1)
            (cdr e2)))))))
```
</details>

---

### stat:print

**è¯´æ˜**: æ‰“å°æœ€åä¸€æ¬¡ç»Ÿè®¡çš„ç»“æœ

**ç”¨æ³•**:
```lisp
(stat:print )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun stat:print nil "æ‰“å°æœ€åä¸€æ¬¡ç»Ÿè®¡çš„ç»“æœ"
  (princ "Item , Number\n")
  (foreach n @:tmp-stat-result (princ (car n))
    (princ "
      , ")
    (princ (cdr n))
    (princ "\n")))
```
</details>

---

### stat:stat

**è¯´æ˜**: ç»Ÿè®¡åˆ—è¡¨ lst ä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚

**ç”¨æ³•**:
```lisp
(stat:stat lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: å…ƒç´ å’Œä¸ªæ•°ç»„æˆçš„ç‚¹å¯¹è¡¨

**ç¤ºä¾‹**:
```lisp
(stat:stat '(3 a a 2 2)) => ((3 . 1) (A . 2) (2 . 2))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun stat:stat (lst / atom% res)
  "ç»Ÿè®¡åˆ—è¡¨ lst ä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚"
  "å…ƒç´ å’Œä¸ªæ•°ç»„æˆçš„ç‚¹å¯¹è¡¨"
  "(stat:stat '(3 a a 2 2))
  => ((3 . 1)
    (A . 2)
    (2 . 2))"
  (setq res (quote nil))
  (foreach atom% lst (if (assoc atom% res)
      (setq res (subst (cons atom% (+ 1 (cdr (assoc atom% res))))
          (assoc atom% res)
          res))
      (setq res (append res (list (cons atom% 1))))))
  res)
```
</details>

---

## std

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### std:acad-object

**è¯´æ˜**: è¿”å›CADå¯¹è±¡

**ç”¨æ³•**:
```lisp
(std:acad-object )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:acad-object nil "è¿”å›cadå¯¹è±¡"
    (eval (list (quote defun)
            (quote std:acad-object)
            (quote nil)
            (vlax-get-acad-object)))
    (std:acad-object))
```
</details>

---

### std:active-document

**è¯´æ˜**: è¿”å›å½“å‰æ´»åŠ¨æ–‡æ¡£å¯¹è±¡

**ç”¨æ³•**:
```lisp
(std:active-document )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:active-document nil "è¿”å›å½“å‰æ´»åŠ¨æ–‡æ¡£å¯¹è±¡"
    (eval (list (quote defun)
            (quote std:active-document)
            (quote nil)
            (vla-get-activedocument (vlax-get-acad-object))))
    (std:active-document))
```
</details>

---

### std:addmenu

**ç”¨æ³•**:
```lisp
(std:addmenu menugroupname popname popitems insertbeforeitem)
```

**å‚æ•°**: 1 menugroupname  : æœªæ˜ç¡®å®šä¹‰;  2 popname  : æœªæ˜ç¡®å®šä¹‰;  3 popitems  : æœªæ˜ç¡®å®šä¹‰;  4 insertbeforeitem  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:addmenu (menugroupname popname popitems insertbeforeitem / i menubar menuitem n popupmenu)
    (std:removemenuitem popname)
    (setq menubar (vla-get-menubar (vlax-get-acad-object)))
    (if insertbeforeitem (progn (setq n (vla-get-count menubar))
            (setq i (1- n))
            (while (and (>= i 0)
                    (/= insertbeforeitem (vla-get-name (setq menuitem (vla-item menubar i)))))
                (setq i (1- i)))
            (if (< i 0)
                (setq i (vla-get-count menubar))))
        (setq i (vla-get-count menubar)))
    (if (not (setq popupmenu (std:catchapply (quote vla-item)
                    (list (vla-get-menus (vla-item (vla-get-menugroups (vlax-get-acad-object))
                                menugroupname))
                        popname))))
        (setq popupmenu (vla-add (vla-get-menus (vla-item (vla-get-menugroups (vlax-get-acad-object))
                        menugroupname))
                popname)))
    (vlax-for popupmenuitem popupmenu (vla-delete popupmenuitem))
    (vla-insertinmenubar popupmenu i)
    (std:insertpopmenuitems popupmenu popitems)
    (princ))
```
</details>

---

### std:addsupportpath

**ç”¨æ³•**:
```lisp
(std:addsupportpath lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:addsupportpath (lst)
    ((lambda (str lst)
            (if (setq lst (vl-remove-if (quote (lambda (x)
                                (or (vl-string-search (strcase x)
                                        (strcase str))
                                    (not (findfile x)))))
                        lst))
                (setenv "acad"
                    (strcat str ";"
                        (apply (quote strcat)
                            (mapcar (quote (lambda (x)
                                        (strcat x ";")))
                                lst))))))
        (vl-string-right-trim ";"
            (getenv "acad"))
        (mapcar (quote (lambda (x)
                    (vl-string-right-trim "\\"
                        (vl-string-translate "/"
                            "\\"
                            x))))
            lst)))
```
</details>

---

### std:addtoolbars

**ç”¨æ³•**:
```lisp
(std:addtoolbars menugroupname toolbaritems)
```

**å‚æ•°**: 1 menugroupname  : æœªæ˜ç¡®å®šä¹‰;  2 toolbaritems  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:addtoolbars (menugroupname toolbaritems / flyout flyoutbutton helpstring idx items largeiconname left macro menugroupobj name smalliconname toolbar toolbaritem toolbarname toolbars top)
    (if (not (setq menugroupobj (std:catchapply vla-item (list (vla-get-menugroups (vlax-get-acad-object))
                        menugroupname))))
        (progn (alert (strcat "èœå•ç»„\""
                    menugroupname "\"ä¸å­˜åœ¨ï¼æ— æ³•åŠ è½½èœå•æ¡ï¼"))
            (exit)))
    (setq toolbars (vla-get-toolbars menugroupobj))
    (foreach items toolbaritems (setq toolbarname (car items)
            left (cadr items)
            top (caddr items)
            items (cdddr items))
        (if (setq toolbar (std:catchapply vla-item (list toolbars toolbarname)))
            (vla-delete toolbar))
        (setq toolbar (vla-add toolbars toolbarname))
        (vla-put-left toolbar left)
        (vla-put-top toolbar top)
        (setq idx 0)
        (foreach lst items (setq name (car lst)
                helpstring (cadr lst)
                macro (caddr lst)
                smalliconname (cadddr lst)
                largeiconname (car (cddddr lst))
                flyoutbutton (cadr (cddddr lst)))
            (if (not largeiconname)
                (setq largeiconname smalliconname))
            (if flyoutbutton (setq flyout :vlax-true)
                (setq flyout :vlax-false))
            (setq toolbaritem (std:catchapply vla-addtoolbarbutton (list toolbar idx name helpstring macro flyout)))
            (std:catchapply vla-setbitmaps (list toolbaritem smalliconname largeiconname))
            (if flyoutbutton (std:catchapply vla-attachtoolbartoflyout (list toolbaritem menugroupname flyoutbutton)))
            (setq idx (1+ idx)))))
```
</details>

---

### std:catchapply

**ç”¨æ³•**:
```lisp
(std:catchapply fun args)
```

**å‚æ•°**: 1 fun  : æœªæ˜ç¡®å®šä¹‰;  2 args  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:catchapply (fun args / result)
    (if (not (vl-catch-all-error-p (setq result (vl-catch-all-apply (if (= (quote sym)
                                (type fun))
                            fun (function fun))
                        args))))
        result))
```
</details>

---

### std:e->vla

**ç”¨æ³•**:
```lisp
(std:e->vla ename)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:e->vla (ename)
    (vlax-ename->vla-object ename))
```
</details>

---

### std:endundo

**ç”¨æ³•**:
```lisp
(std:endundo doc)
```

**å‚æ•°**: 1 doc  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:endundo (doc)
    (while (= 8 (logand 8 (getvar (quote undoctl))))
        (vla-endundomark doc)))
```
</details>

---

### std:getinput

**è¯´æ˜**: è·å–è¾“å…¥ï¼Œç»“åˆinitgetå’Œgetkwordå‡½æ•°

**ç”¨æ³•**:
```lisp
(std:getinput promptstr inplist default)
```

**å‚æ•°**: 1 promptstr  : æœªè¯†åˆ«å®šä¹‰;2 inplist  : æœªè¯†åˆ«å®šä¹‰;3 default  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:getinput (promptstr inplist default / inp)
  "è·å–è¾“å…¥ï¼Œç»“åˆinitgetå’Œgetkwordå‡½æ•°"
  (initget (if default 0 1)
    (string:from-list inplist "\n            "))
  (if (setq inp (getkword (strcat (if promptstr (strcat promptstr "\n                            [")
            "[")
          (string:from-list inplist "/")
          "]"
          (if (and default (member default inplist))
            (strcat "\n                            <"
              default ">: ")
            ": "))))
    inp default))
```
</details>

---

### std:insertpopmenuitems

**ç”¨æ³•**:
```lisp
(std:insertpopmenuitems popupmenu popitems)
```

**å‚æ•°**: 1 popupmenu  : æœªæ˜ç¡®å®šä¹‰;  2 popitems  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:insertpopmenuitems (popupmenu popitems / k tmp)
    (setq k 0)
    (mapcar (function (lambda (x / label cmdstr hlpstr subitems tmp)
                (setq label (car x)
                    cmdstr (cadr x)
                    hlpstr (caddr x)
                    subitems (cadddr x))
                (if (= label "--")
                    (vla-addseparator popupmenu (setq k (1+ k)))
                    (if (and label cmdstr)
                        (progn (setq tmp (vla-addmenuitem popupmenu (setq k (1+ k))
                                    label cmdstr))
                            (vla-put-helpstring tmp hlpstr))
                        (progn (setq tmp (vla-addsubmenu popupmenu (setq k (1+ k))
                                    label))
                            (if subitems (std:insertpopmenuitems tmp subitems)))))))
        popitems))
```
</details>

---

### std:layers

**è¯´æ˜**: è¿”å›å›¾å±‚é›†åˆ

**ç”¨æ³•**:
```lisp
(std:layers )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:layers nil "è¿”å›å›¾å±‚é›†åˆ"
    (eval (list (quote defun)
            (quote std:layers)
            (quote nil)
            (vla-get-layers (vla-get-activedocument (vlax-get-acad-object)))))
    (std:layers))
```
</details>

---

### std:linetypes

**è¯´æ˜**: è¿”å›çº¿å‹é›†åˆ

**ç”¨æ³•**:
```lisp
(std:linetypes )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:linetypes nil "è¿”å›çº¿å‹é›†åˆ"
    (eval (list (quote defun)
            (quote std:line-types)
            (quote nil)
            (vla-get-linetypes (vla-get-activedocument (vlax-get-acad-object)))))
    (std:line-types))
```
</details>

---

### std:model-space

**è¯´æ˜**: è¿”å›æ¨¡å‹ç©ºé—´å¯¹è±¡

**ç”¨æ³•**:
```lisp
(std:model-space )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:model-space nil "è¿”å›æ¨¡å‹ç©ºé—´å¯¹è±¡"
    (eval (list (quote defun)
            (quote std:model-space)
            (quote nil)
            (vla-get-modelspace (vla-get-activedocument (vlax-get-acad-object)))))
    (std:model-space))
```
</details>

---

### std:osmode-off

**è¯´æ˜**: å…³é—­å¯¹è±¡æ•æ‰ï¼Œä¸å½±å“å¯¹è±¡æ•æ‰è®¾ç½®ã€‚

**ç”¨æ³•**:
```lisp
(std:osmode-off )
```

**å‚æ•°**: æ²¡æœ‰

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:osmode-off nil "å…³é—­å¯¹è±¡æ•æ‰ï¼Œä¸å½±å“å¯¹è±¡æ•æ‰è®¾ç½®ã€‚"
  ""
  (setvar "osmode"
    (boole 7 (getvar "osmode")
      16384)))
```
</details>

---

### std:osmode-on

**è¯´æ˜**: æ‰“å¼€å¯¹è±¡æ•æ‰ï¼Œä¸å½±å“å¯¹è±¡æ•æ‰è®¾ç½®ã€‚

**ç”¨æ³•**:
```lisp
(std:osmode-on )
```

**å‚æ•°**: æ²¡æœ‰

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:osmode-on nil "æ‰“å¼€å¯¹è±¡æ•æ‰ï¼Œä¸å½±å“å¯¹è±¡æ•æ‰è®¾ç½®ã€‚"
  ""
  (setvar "osmode"
    (- (boole 7 (getvar "osmode")
        16384)
      16384)))
```
</details>

---

### std:protect-assign

**ç”¨æ³•**:
```lisp
(std:protect-assign syms)
```

**å‚æ•°**: 1 syms  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:protect-assign (syms)
    (eval (list (quote pragma)
            (list (quote quote)
                (list (cons (quote protect-assign)
                        syms))))))
```
</details>

---

### std:removemenuitem

**ç”¨æ³•**:
```lisp
(std:removemenuitem popname)
```

**å‚æ•°**: 1 popname  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:removemenuitem (popname / menubar menuitem)
    (setq menubar (vla-get-menubar (vlax-get-acad-object)))
    (setq menuitem (std:catchapply (quote vla-item)
            (list menubar popname)))
    (if menuitem (std:catchapply (quote vla-removefrommenubar)
            (list menuitem))))
```
</details>

---

### std:removesupportpath

**ç”¨æ³•**:
```lisp
(std:removesupportpath lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:removesupportpath (lst / del str tmp)
    (defun del (old str / pos)
        (if (setq pos (vl-string-search (strcase old)
                    (strcase str)))
            (strcat (substr str 1 pos)
                (del old (substr str (+ 1 pos (strlen old)))))
            str))
    (setq str (strcat (vl-string-right-trim ";"
                (getenv "acad"))
            ";")
        tmp str)
    (foreach pth lst (setq str (del (strcat (vl-string-right-trim "\\"
                        (vl-string-translate "/"
                            "\\"
                            pth))
                    ";")
                str)))
    (if (/= tmp str)
        (setenv "acad"
            str)))
```
</details>

---

### std:reset-system-variable

**ç”¨æ³•**:
```lisp
(std:reset-system-variable )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:reset-system-variable nil (mapcar (quote setvar)
        (mapcar (quote car)
            *user-system-variable*)
        (mapcar (quote cdr)
            *user-system-variable*))
    (setq *user-system-variable* nil))
```
</details>

---

### std:return

**è¯´æ˜**: è¿”å›å€¼å‡½æ•°ï¼Œç”¨äºåŒ…è£…å°†è¦è¿”å›çš„å€¼ï¼Œä¸»è¦ä½œç”¨è¿˜æ˜¯ä¸ºäº†å«ä¹‰æ›´æ˜ç¡®ã€‚

**ç”¨æ³•**:
```lisp
(std:return value)
```

**å‚æ•°**: 1 value  : å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:return (value)
    "è¿”å›å€¼å‡½æ•°ï¼Œç”¨äºåŒ…è£…å°†è¦è¿”å›çš„å€¼ï¼Œä¸»è¦ä½œç”¨è¿˜æ˜¯ä¸ºäº†å«ä¹‰æ›´æ˜ç¡®ã€‚"
    value)
```
</details>

---

### std:rgb

**è¯´æ˜**: è®¡ç®—RGBé¢œè‰²å¯¹åº”çš„æ•´æ•°å€¼ã€‚Red Green Blue å–å€¼èŒƒå›´ä¸º [0,255]çš„æ•´æ•°æˆ–[0,1)çš„å°æ•°ã€‚

**ç”¨æ³•**:
```lisp
(std:rgb red green blue)
```

**å‚æ•°**: 1 red  : æœªæ˜ç¡®å®šä¹‰;  2 green  : æœªæ˜ç¡®å®šä¹‰;  3 blue  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: RGBé¢œè‰²å€¼

**ç¤ºä¾‹**:
```lisp
(std:rgb 255 0 0) or (std:rgb 0.999 0 0);  çº¢è‰²
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:rgb (red green blue)
    "è®¡ç®—rgbé¢œè‰²å¯¹åº”çš„æ•´æ•°å€¼ã€‚red green blue å–å€¼èŒƒå›´ä¸º [0,255]çš„æ•´æ•°æˆ–[0,1)çš„å°æ•°ã€‚"
"rgbé¢œè‰²å€¼"
"(std:rgb 255 0 0)
or (std:rgb 0.999 0 0);çº¢è‰²"
(cond ((and (<= 0 red)
            (< red 1)
            (<= 0 green)
            (< green 1)
            (<= 0 blue)
            (< blue 1))
        (+ (fix (* 256 red))
            (* 256 (fix (* 256 green)))
            (* 65536 (fix (* 256 blue)))))
    ((and (<= 0 red 255)
            (<= 0 green 255)
            (<= 0 blue 255))
        (+ (fix red)
            (* 256 (fix green))
            (* 65536 (fix blue))))
    (t (+ 255 (* 256 255)
            (* 65536 255)))))
```
</details>

---

### std:save-system-variable

**ç”¨æ³•**:
```lisp
(std:save-system-variable a)
```

**å‚æ•°**: 1 a  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:save-system-variable (a)
    (setq *user-system-variable* (mapcar (quote cons)
            a (mapcar (quote getvar)
                a))))
```
</details>

---

### std:startundo

**ç”¨æ³•**:
```lisp
(std:startundo doc)
```

**å‚æ•°**: 1 doc  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:startundo (doc)
    (std:endundo doc)
    (vla-startundomark doc))
```
</details>

---

### std:tbl-rename

**è¯´æ˜**: é‡å‘½åDXFè¡¨æ ¼ä¸­çš„é¡¹ç›®çš„åç§°ã€‚ è¡¨æ ¼ä¸º:block,dimstyle,layer,layout,linetype,textstyle,view,vports.   å‚æ•°:tbl-name tblè¡¨æ ¼å, old-name åŸåç§°ï¼Œnew-name æ–°åç§°

**ç”¨æ³•**:
```lisp
(std:tbl-rename tbl-name old-name new-name)
```

**å‚æ•°**: 1 tbl-name  : æœªè¯†åˆ«å®šä¹‰;2 old-name  : æœªè¯†åˆ«å®šä¹‰;3 new-name  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: T æˆåŠŸï¼Œnil å¤±è´¥

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:tbl-rename (tbl-name old-name new-name)
  "é‡å‘½åDXFè¡¨æ ¼ä¸­çš„é¡¹ç›®çš„åç§°ã€‚ è¡¨æ ¼ä¸º:block,dimstyle,layer,layout,linetype,textstyle,view,vports. \n  å‚æ•°:tbl-name tblè¡¨æ ¼å, old-name åŸåç§°ï¼Œnew-name æ–°åç§°"
  "T æˆåŠŸï¼Œnil å¤±è´¥"
  ""
  (defun tbl-dxf2obj (tbl-name)
    (cond ((string-equal tbl-name "LTYPE")
        "linetypes")
      ((string-equal tbl-name "STYLE")
        "textstyles")
      ((string-equal tbl-name "UCS")
        "UserCoordinateSystems")
      ((string-equal tbl-name "VPORT")
        "Viewports")
      (t (strcat tbl-name "s"))))
  (if (and (tblsearch tbl-name old-name)
      (not (tblsearch tbl-name new-name))
      (snvalid new-name))
    (progn (if (vl-catch-all-error-p (vl-catch-all-apply (quote vla-put-name)
            (list (vla-item (vlax-get-property *doc* (read (strcat (tbl-dxf2obj tbl-name))))
                old-name)
              new-name)))
        nil t))))
```
</details>

---

### std:textstyles

**è¯´æ˜**: è¿”å›å­—ä½“æ ·å¼é›†åˆ

**ç”¨æ³•**:
```lisp
(std:textstyles )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:textstyles nil "è¿”å›å­—ä½“æ ·å¼é›†åˆ"
    (eval (list (quote defun)
            (quote std:textstyles)
            (quote nil)
            (vla-get-textstyles (vla-get-activedocument (vlax-get-acad-object)))))
    (std:textstyles))
```
</details>

---

### std:timer-end

**è¯´æ˜**: è®¡æ—¶å™¨ç»“æŸå‡½æ•°

**ç”¨æ³•**:
```lisp
(std:timer-end )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:timer-end nil "è®¡æ—¶å™¨ç»“æŸå‡½æ•°"
    (princ "\n    ç”¨æ—¶")
    (princ (* (- (getvar "tdusrtimer")
                @:*timer-prg*)
            86400))
    (princ "ç§’\n")
    (setq @:*timer-prg* nil)
    (princ))
```
</details>

---

### std:timer-start

**è¯´æ˜**: è®¡æ—¶å™¨å¼€å§‹å‡½æ•°

**ç”¨æ³•**:
```lisp
(std:timer-start )
```

**å‚æ•°**: None

**è¿”å›å€¼**: è®¡æ—¶å™¨å…¨å±€å˜é‡

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:timer-start nil "è®¡æ—¶å™¨å¼€å§‹å‡½æ•°"
    "è®¡æ—¶å™¨å…¨å±€å˜é‡"
    (setq @:*timer-prg* (getvar "tdusrtimer")))
```
</details>

---

### std:unprotect-assign

**ç”¨æ³•**:
```lisp
(std:unprotect-assign syms)
```

**å‚æ•°**: 1 syms  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:unprotect-assign (syms)
    (eval (list (quote pragma)
            (list (quote quote)
                (list (cons (quote unprotect-assign)
                        syms))))))
```
</details>

---

### std:vla->e

**ç”¨æ³•**:
```lisp
(std:vla->e obj)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun std:vla->e (obj)
    (vlax-vla-object->ename obj))
```
</details>

---

## string

**æ¨¡å—è¯´æ˜**: å­—ç¬¦ä¸²å¤„ç†ã€æ ¼å¼åŒ–ã€ç¼–ç è½¬æ¢

### string:align-by-length

**è¯´æ˜**: å°†å­—èŠ‚é•¿åº¦å°äº len çš„å­—ç¬¦ä¸²å‰åå¢åŠ ç©ºæ ¼ï¼Œä½¿å…¶é•¿åº¦ç­‰äº lenã€‚å¯ç”¨äºDCLä¸­çš„å­—ç¬¦å¯¹é½ã€‚

**ç”¨æ³•**:
```lisp
(string:align-by-length str len)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 len  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: String

**ç¤ºä¾‹**:
```lisp
(string:align-by-length "abc" 8) => "   abc  "
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:align-by-length (str len / flag)
  "å°†å­—èŠ‚é•¿åº¦å°äº len çš„å­—ç¬¦ä¸²å‰åå¢åŠ ç©ºæ ¼ï¼Œä½¿å…¶é•¿åº¦ç­‰äº lenã€‚å¯ç”¨äºDCLä¸­çš„å­—ç¬¦å¯¹é½ã€‚"
  "String"
  "(string:align-by-length \"abc\"
    8)
  => \"
    abc  \""
  (if (null str)
    (setq str ""))
  (setq flag nil)
  (while (< (string:bytelength str)
      len)
    (if flag (setq str (strcat "
          "
          str))
      (setq str (strcat str "
          ")))
    (setq flag (not flag)))
  str)
```
</details>

---

### string:auto-split

**è¯´æ˜**: è‡ªåŠ¨åˆ†æ®µï¼ŒæŒ‰æ•°å­—-å­—æ¯-æ±‰å­—è‡ªåŠ¨æ–­å¼€å­—ç¬¦ä¸²ä¸ºå­—ç¬¦ä¸²åˆ—è¡¨ã€‚ä¸æ”¯æŒç§‘å­¦è®¡æ•°æ³•çš„æ•°å­—ã€‚

**ç”¨æ³•**:
```lisp
(string:auto-split str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: ç”±å­—ç¬¦ä¸²ç»„æˆçš„åˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(string:auto-split "aa33.3bbæ±‰å­—")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:auto-split (str / curr-type lst tmp% res unitp)
  "è‡ªåŠ¨åˆ†æ®µï¼ŒæŒ‰æ•°å­—-å­—æ¯-æ±‰å­—è‡ªåŠ¨æ–­å¼€å­—ç¬¦ä¸²ä¸ºå­—ç¬¦ä¸²åˆ—è¡¨ã€‚ä¸æ”¯æŒç§‘å­¦è®¡æ•°æ³•çš„æ•°å­—ã€‚"
  "ç”±å­—ç¬¦ä¸²ç»„æˆçš„åˆ—è¡¨"
  "(string:auto-split \"aa33.3bbæ±‰å­—\")"
  (defun is-bracket (asc)
    (member asc (vl-string->list "()")))
  (defun is-operator (asc)
    (member asc (vl-string->list "+-*/Â·")))
  (defun is-unitsuffix (asc)
    (member asc (list 178 179)))
  (defun is-unitprefix (asc)
    (member asc (list 181)))
  (defun is-number (asc)
    (or (= asc 46)
      (and (>= asc 48)
        (<= asc 57))))
  (defun is-alpha (asc)
    (or (and (>= asc 65)
        (<= asc 90))
      (and (>= asc 97)
        (<= asc 122))))
  (defun is-hannum (asc)
    (member asc (string:s2l-ansi "é›¶ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…­ä¹åç™¾åƒä¸‡äº¿å£¹è´°åè‚†ä¼é™†æŸ’æŒç–æ‹¾ä½°ä»Ÿ")))
  (defun is-han (asc)
    (if (and (getvar "lispsys")
        (> (getvar "lispsys")
          0))
      (>= asc 19968)
      (>= asc 32896)))
  (defun is-sign (asc)
    (or (= asc (ascii "+"))
      (= asc (ascii "-"))))
  (defun test-type (asc)
    (cond ((is-number asc)
        (quote number))
      ((is-alpha asc)
        (quote alpha))
      ((is-hannum asc)
        (quote hannumber))
      ((is-han asc)
        (quote han))
      ((is-sign asc)
        (quote sign))
      ((is-bracket asc)
        (quote bracket))
      ((is-operator asc)
        (quote operator))
      ((is-unitsuffix asc)
        (quote unitsuffix))
      ((is-unitprefix asc)
        (quote unitprefix))
      (t nil)))
  (setq res (mapcar (quote (lambda (x)
          (cons x (test-type x))))
      (string:s2l-ansi str)))
  (setq curr-type (cdr (car res)))
  (setq lst (quote nil))
  (foreach asc res (cond ((or (= curr-type (cdr asc))
          (and (= curr-type (quote sign))
            (= (cdr asc)
              (quote number))))
        (setq tmp% (cons (car asc)
            tmp%)))
      (t (progn (setq lst (cons (reverse tmp%)
              lst))
          (setq tmp% (cons (car asc)
              nil))
          (setq curr-type (cdr asc))))))
  (setq lst (reverse (cons (reverse tmp%)
        lst)))
  (setq res (mapcar (quote string:l2s-ansi)
      lst))
  (setq unitp (member (car res)
      @:*units*))
  (setq lst nil)
  (setq tmp% "")
  (foreach word res (cond ((and unitp (member word @:*units*))
        (setq tmp% (strcat tmp% word)))
      (t (progn (if (/= ""
              tmp%)
            (setq lst (cons tmp% lst)))
          (setq tmp% word)
          (setq unitp (member word @:*units*))))))
  (setq lst (reverse (cons tmp% lst)))
  lst)
```
</details>

---

### string:bytelength

**è¯´æ˜**: å­—ç¬¦ä¸²çš„å­—èŠ‚æ•°ï¼Œç”¨äºcad2021ç‰ˆæœ¬ã€‚

**ç”¨æ³•**:
```lisp
(string:bytelength str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: å­—ç¬¦ä¸²çš„å­—èŠ‚æ•°

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:bytelength (str)
  "å­—ç¬¦ä¸²çš„å­—èŠ‚æ•°ï¼Œç”¨äºcad2021ç‰ˆæœ¬ã€‚"
  "å­—ç¬¦ä¸²çš„å­—èŠ‚æ•°"
  (+ (length (vl-string->list str))
    (length (vl-remove-if (quote (lambda (m)
            (< m 256)))
        (vl-string->list str)))))
```
</details>

---

### string:case

**è¯´æ˜**: å¤§å°å†™æ›¿æ¢

**ç”¨æ³•**:
```lisp
(string:case str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:case (str)
  "å¤§å°å†™æ›¿æ¢"
  (vl-list->string (mapcar (quote (lambda (x)
          (cond ((and (>= x 65)
                (< x 97))
              (+ x 32))
            ((and (>= x 97)
                (< x 123))
              (- x 32)))))
      (vl-string->list str))))
```
</details>

---

### string:concat

**è¯´æ˜**: è¿æ¥å­—ç¬¦ä¸²ï¼Œè¿æ¥å‰è¿›è¡Œæ£€æµ‹ã€‚

**ç”¨æ³•**:
```lisp
(string:concat strlst)
```

**å‚æ•°**: 1 strlst  : å­—ç¬¦ä¸²;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:concat (strlst)
  "è¿æ¥å­—ç¬¦ä¸²ï¼Œè¿æ¥å‰è¿›è¡Œæ£€æµ‹ã€‚"
  (cond ((std:stringp strlst)
      strlst)
    ((std:string-listp strlst)
      (apply (quote strcat)
        strlst))
    (t nil)))
```
</details>

---

### string:escape

**è¯´æ˜**: å¯¹å­—ç¬¦ä¸² str ä¸­çš„ chars-need-to å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œè½¬ä¹‰ç¬¦ä¸ºescape-chrã€‚å¦‚æœéœ€è½¬ä¹‰çš„å­—ç¬¦ä¸­å«è½¬ä¹‰ç¬¦ï¼Œéœ€å°†å…¶æ”¾åœ¨é¦–ä½ã€‚

**ç”¨æ³•**:
```lisp
(string:escape str escape-chr chars-need-to)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 escape-chr  : æœªè¯†åˆ«å®šä¹‰;3 chars-need-to  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: string

**ç¤ºä¾‹**:
```lisp
(string:escape "@*" "`" "@*") => "`@`*"
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:escape (str escape-chr chars-need-to)
  "å¯¹å­—ç¬¦ä¸² str ä¸­çš„ chars-need-to å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œè½¬ä¹‰ç¬¦ä¸ºescape-chrã€‚å¦‚æœéœ€è½¬ä¹‰çš„å­—ç¬¦ä¸­å«è½¬ä¹‰ç¬¦ï¼Œéœ€å°†å…¶æ”¾åœ¨é¦–ä½ã€‚"
  "string"
  "(string:escape \"@*\"
    \"`\"
    \"@*\")
  => \"`@`*\""
  (foreach chr (string:s2l-ansi chars-need-to)
    (setq str (string:subst-all (strcat escape-chr (string:l2s-ansi (list chr)))
        (string:l2s-ansi (list chr))
        str))))
```
</details>

---

### string:format

**è¯´æ˜**: å­—ç¬¦ä¸²æ ¼å¼åŒ–å‡½æ•°

**ç”¨æ³•**:
```lisp
(string:format str formatlist)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 formatlist  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:format (str formatlist / i str-length)
  "å­—ç¬¦ä¸²æ ¼å¼åŒ–å‡½æ•°"
  (if (std:stringp formatlist)
    (setq str (string:subst-all formatlist "{0}"
        str))
    (progn (setq i -1)
      (repeat (vl-list-length formatlist)
        (setq str (string:subst-all (nth (setq i (1+ i))
              formatlist)
            (strcat "{"
              (itoa i)
              "}")
            str))))))
```
</details>

---

### string:from-list

**è¯´æ˜**: åˆ—è¡¨è½¬æˆå­—ç¬¦ä¸²

**ç”¨æ³•**:
```lisp
(string:from-list lst separator)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 separator  : åˆ†éš”ç¬¦;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:from-list (lst separator)
  "åˆ—è¡¨è½¬æˆå­—ç¬¦ä¸²"
  (if (cdr lst)
    (strcat (car lst)
      separator (string:from-lst (cdr lst)
        separator))
    (car lst)))
```
</details>

---

### string:from-lst

**è¯´æ˜**: åˆ—è¡¨è½¬æˆå­—ç¬¦ä¸²

**ç”¨æ³•**:
```lisp
(string:from-lst lst separator)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 separator  : åˆ†éš”ç¬¦;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:from-lst (lst separator)
  "åˆ—è¡¨è½¬æˆå­—ç¬¦ä¸²"
  (if (cdr lst)
    (strcat (car lst)
      separator (string:from-lst (cdr lst)
        separator))
    (car lst)))
```
</details>

---

### string:hannumber2number

**è¯´æ˜**: ä¸­æ–‡æ•°å­—è½¬ä¸ºæ•°å­—ç±»å‹

**ç”¨æ³•**:
```lisp
(string:hannumber2number str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: number

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:hannumber2number (str / numlst alst1 alst2 num lnum1 lnum2 fstr a)
  "ä¸­æ–‡æ•°å­—è½¬ä¸ºæ•°å­—ç±»å‹"
  "number"
  (setq numlst (quote (("é›¶"
          . 0)
        ("ä¸€"
          . 1)
        ("å£¹"
          . 1)
        ("äºŒ"
          . 2)
        ("è´°"
          . 2)
        ("ä¸‰"
          . 3)
        ("å"
          . 3)
        ("å››"
          . 4)
        ("è‚†"
          . 4)
        ("äº”"
          . 5)
        ("ä¼"
          . 5)
        ("å…­"
          . 6)
        ("é™†"
          . 6)
        ("ä¸ƒ"
          . 7)
        ("æŸ’"
          . 7)
        ("å…«"
          . 8)
        ("æŒ"
          . 8)
        ("ä¹"
          . 9)
        ("ç–"
          . 9)))
    alst1 (quote (("å"
          . 10)
        ("æ‹¾"
          . 10)
        ("ç™¾"
          . 100)
        ("ä½°"
          . 100)
        ("åƒ"
          . 1000.0)
        ("ä»Ÿ"
          . 1000.0)))
    alst2 (quote (("ä¸‡"
          . 10000.0)
        ("äº¿"
          . 1.0e+08)))
    num 0 lnum1 0 lnum2 0)
  (foreach word (mapcar (quote (lambda (x)
          (string:l2s-ansi (list x))))
      (string:s2l-ansi str))
    (cond ((setq a (assoc word alst2))
        (setq num (+ num (* (+ lnum1 lnum2)
              (cdr a)))
          lnum1 0 lnum2 0))
      ((setq a (assoc word alst1))
        (if (and (zerop lnum2)
            (zerop num))
          (setq num (cdr a))
          (setq lnum1 (+ lnum1 (* lnum2 (cdr a)))
            lnum2 0)))
      ((setq a (assoc word numlst))
        (setq lnum2 (cdr a)))
      (t nil)))
  (+ num lnum1 lnum2))
```
</details>

---

### string:hannumberp

**è¯´æ˜**: ç¡®å®šå­—ç¬¦ä¸²æ˜¯å¦ä¸ºä¸­æ–‡æ•°å­—

**ç”¨æ³•**:
```lisp
(string:hannumberp str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:hannumberp (str)
  "ç¡®å®šå­—ç¬¦ä¸²æ˜¯å¦ä¸ºä¸­æ–‡æ•°å­—"
  (apply (quote and)
    (mapcar (quote (lambda (x)
          (member x (string:s2l-ansi "é›¶ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…­ä¹åç™¾åƒä¸‡äº¿å£¹è´°åè‚†ä¼é™†æŸ’æŒç–æ‹¾ä½°ä»Ÿ"))))
      (string:s2l-ansi str))))
```
</details>

---

### string:indent

**è¯´æ˜**: ç¼©è¿› lisp ä»£ç 

**ç”¨æ³•**:
```lisp
(string:indent str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:indent (str / curr-ind% res)
  "ç¼©è¿› lisp ä»£ç "
  (setq curr-ind% 0)
  (setq res (quote nil))
  (setq str (@:string-subst "\"\n"
      "\"
      "
      (@:string-subst ")\n"
      ")
    "
    str)))
(foreach char% (vl-string->list str)
(cond ((= 40 char%)
    (setq curr-ind% (1+ curr-ind%)))
  ((= 41 char%)
    (setq curr-ind% (1- curr-ind%))))
(setq res (cons char% res))
(if (= 10 char%)
  (repeat (* 4 curr-ind%)
    (setq res (cons 32 res)))))
(vl-list->string (reverse res)))
```
</details>

---

### string:intp

**è¯´æ˜**: ç¡®å®šå­—ç¬¦ä¸²æ˜¯å¦ä¸ºæ•´æ•°

**ç”¨æ³•**:
```lisp
(string:intp str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:intp (str)
  "ç¡®å®šå­—ç¬¦ä¸²æ˜¯å¦ä¸ºæ•´æ•°"
  (and (string:numberp str)
    (not (or (= "."
          (substr str 1 1))
        (= "-."
          (substr str 1 2))
        (= "+."
          (substr str 1 2))))
    (= (quote int)
      (type (read str)))))
```
</details>

---

### string:l2s-ansi

**è¯´æ˜**: byte or word æ•´æ•°å€¼åˆ—è¡¨è½¬å­—ç¬¦ä¸²ã€‚nå½“å°äº128æ—¶ï¼Œå•å­—èŠ‚ï¼Œå½“ä¸¤ä¸ªè¿ç»­çš„å¤§äº128æ—¶ï¼ŒåŒå­—èŠ‚å€¼ã€‚ç”¨äºè½¬æ¢éè‹±æ–‡å­—ä¸²æ—¶é˜²æ­¢é‡ç ã€‚nå½“AutoCAD2021ä¸”lispsys=1æ—¶ï¼Œä¸string:s2l-ansi æˆå¯¹å…¼å®¹ unicode.

**ç”¨æ³•**:
```lisp
(string:l2s-ansi lst-str)
```

**å‚æ•°**: 1 lst-str  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:l2s-ansi (lst-str / h% res)
  "byte or word æ•´æ•°å€¼åˆ—è¡¨è½¬å­—ç¬¦ä¸²ã€‚\nå½“å°äº128æ—¶ï¼Œå•å­—èŠ‚ï¼Œå½“ä¸¤ä¸ªè¿ç»­çš„å¤§äº128æ—¶ï¼ŒåŒå­—èŠ‚å€¼ã€‚ç”¨äºè½¬æ¢éè‹±æ–‡å­—ä¸²æ—¶é˜²æ­¢é‡ç ã€‚\nå½“AutoCAD2021ä¸”lispsys=1æ—¶ï¼Œä¸string:s2l-ansi æˆå¯¹å…¼å®¹ unicode."
  (if (and (getvar "lispsys")
      (<= 1 (getvar "lispsys")))
    (vl-list->string lst-str)
    (progn (setq h% 0)
      (setq res (quote nil))
      (foreach word% lst-str (cond ((>= word% 32896)
            (setq res (cons (/ word% 256)
                res))
            (setq res (cons (rem word% 256)
                res)))
          ((< word% 32896)
            (cond ((= 178 word%)
                (setq res (append (reverse (list 92 85 43 48 48 66 50))
                    res)))
              ((= 179 word%)
                (setq res (append (reverse (list 92 85 43 48 48 66 51))
                    res)))
              (t (setq res (cons word% res)))))))
      (vl-list->string (reverse res)))))
```
</details>

---

### string:length

**è¯´æ˜**: å­—ç¬¦ä¸²é•¿åº¦ï¼Œä¸€ä¸ªæ±‰å­—å 1ä½ã€‚

**ç”¨æ³•**:
```lisp
(string:length str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: int

**ç¤ºä¾‹**:
```lisp
(string:length "ä¸­å›½a") => 3
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:length (str)
  "å­—ç¬¦ä¸²é•¿åº¦ï¼Œä¸€ä¸ªæ±‰å­—å 1ä½ã€‚"
  "int"
  "(string:length \"ä¸­å›½a\")
  => 3"
  (length (string:s2l-ansi str)))
```
</details>

---

### string:lsubstr

**è¯´æ˜**: ä»å·¦ä¾§æ±‚å­ä¸²

**ç”¨æ³•**:
```lisp
(string:lsubstr str len)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 len  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:lsubstr (str len)
  "ä»å·¦ä¾§æ±‚å­ä¸²"
  (substr str 1 len))
```
</details>

---

### string:num-compare

**è¯´æ˜**: å­—ç¬¦ä¸²åœ¨å¤¹æ‚æ•°å­—æ—¶ï¼Œå¦‚æœæ•°å­—å‰åçš„å­—ç¬¦ä¸²ç›¸åŒï¼ŒæŒ‰æ•°å­—å¤§å°æ¯”è¾ƒã€‚fun å¯ç”¨å‡½æ•°ä¸º >, >=, <, <=,2020-03-31

**ç”¨æ³•**:
```lisp
(string:num-compare fun str1 str2)
```

**å‚æ•°**: 1 fun  : æœªè¯†åˆ«å®šä¹‰;2 str1  : å­—ç¬¦ä¸²;3 str2  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: T or nil

**ç¤ºä¾‹**:
```lisp
(string:num-compare < "a5"  "a13")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:num-compare (fun str1 str2)
  "å­—ç¬¦ä¸²åœ¨å¤¹æ‚æ•°å­—æ—¶ï¼Œå¦‚æœæ•°å­—å‰åçš„å­—ç¬¦ä¸²ç›¸åŒï¼ŒæŒ‰æ•°å­—å¤§å°æ¯”è¾ƒã€‚fun å¯ç”¨å‡½æ•°ä¸º >, >=, <, <=,2020-03-31"
  "T or nil"
  "(string:num-compare < \"a5\"
     \"a13\")"
  (apply (quote or)
    (mapcar (quote (lambda (a b)
          (cond ((and (string:intp a)
                (string:intp b))
              (fun (atoi a)
                (atoi b)))
            ((and (string:realp a)
                (string:realp b))
              (fun (atof a)
                (atof b)))
            (t (fun a b)))))
      (string:auto-split str1)
      (string:auto-split str2))))
```
</details>

---

### string:number-format

**è¯´æ˜**: æ ¼å¼åŒ–æ•°å­—è¾“å‡ºã€‚ä½¿è¾“å‡ºçš„å­—ç¬¦ä¸²é•¿åº¦ä¸€è‡´ã€‚å‚æ•°: str-num:æ•°å­—å­—ç¬¦ä¸²ï¼Œint-n,æ•´æ•°ä½æ•°ï¼Œint-fraction:å°æ•°ä½æ•°ï¼Œstr-fill:å¡«å……å­—ç¬¦ï¼Œå­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªä¸ºå‰ç¼€ï¼Œæœ€åä¸€ä¸ªä¸ºåç¼€

**ç”¨æ³•**:
```lisp
(string:number-format str-num int-n int-fraction str-fill)
```

**å‚æ•°**: 1 str-num  : å­—ç¬¦ä¸²;2 int-n  : æ•´æ•°;3 int-fraction  : æ•´æ•°;4 str-fill  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: å­—ç¬¦ä¸²

**ç¤ºä¾‹**:
```lisp
(string:number-format "5.3"n    3 3 " 0")n  = > "  5.300"
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:number-format (str-num int-n int-fraction str-fill / lst-num part-int part-fraction pre-str post-str)
  "æ ¼å¼åŒ–æ•°å­—è¾“å‡ºã€‚ä½¿è¾“å‡ºçš„å­—ç¬¦ä¸²é•¿åº¦ä¸€è‡´ã€‚å‚æ•°: str-num:æ•°å­—å­—ç¬¦ä¸²ï¼Œint-n,æ•´æ•°ä½æ•°ï¼Œint-fraction:å°æ•°ä½æ•°ï¼Œstr-fill:å¡«å……å­—ç¬¦ï¼Œå­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªä¸ºå‰ç¼€ï¼Œæœ€åä¸€ä¸ªä¸ºåç¼€"
  "å­—ç¬¦ä¸²"
  "(string:number-format \"5.3\"\n    3 3 \"
    0\")\n  = > \"
   5.300\""
  (if (numberp str-fill)
    (setq str-fill (rtos str-fill 2 0)))
  (setq pre-str (string:l2s-ansi (list (car (string:s2l-ansi str-fill)))))
  (setq post-str (string:l2s-ansi (list (last (string:s2l-ansi str-fill)))))
  (progn (setq lst-num (string:to-list str-num "."))
    (setq part-int (car lst-num))
    (setq part-fraction (cadr lst-num))
    (repeat (- int-n (strlen part-int))
      (setq part-int (strcat pre-str part-int))))
  (if (and part-fraction (> (strlen part-fraction)
        int-fraction))
    (setq part-fraction (cadr (string:to-list (rtos (atof (strcat "0."
                part-fraction))
            2 int-fraction)
          "."))))
  (if part-fraction (repeat (- int-fraction (strlen part-fraction))
      (setq part-fraction (strcat part-fraction post-str)))
    (progn (setq part-fraction "")
      (repeat int-fraction (setq part-fraction (strcat part-fraction post-str)))))
  (if (or (= ""
        part-fraction)
      (null part-fraction))
    (strcat part-int)
    (strcat part-int "."
      part-fraction)))
```
</details>

---

### string:number2chinese

**è¯´æ˜**: å°†æ•°å­—è½¬åŒ–ä¸ºæ±‰è¯­å¤§å†™.,ä»…æ”¯æŒåˆ°ä¸‡äº¿ï¼Œåªæ”¯æŒæ•´æ•°

**ç”¨æ³•**:
```lisp
(string:number2chinese num)
```

**å‚æ•°**: 1 num  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: String

**ç¤ºä¾‹**:
```lisp
(string:number2chinese 3587823416)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:number2chinese (num / charofcash i n tempa tempstr)
  "å°†æ•°å­—è½¬åŒ–ä¸ºæ±‰è¯­å¤§å†™.,ä»…æ”¯æŒåˆ°ä¸‡äº¿ï¼Œåªæ”¯æŒæ•´æ•°"
  "String"
  "(string:number2chinese 3587823416)"
  (defun _n2big (str)
    (setq str (string:subst-all "å£¹"
        "1"
        str))
    (setq str (string:subst-all "è´°"
        "2"
        str))
    (setq str (string:subst-all "å"
        "3"
        str))
    (setq str (string:subst-all "è‚†"
        "4"
        str))
    (setq str (string:subst-all "ä¼"
        "5"
        str))
    (setq str (string:subst-all "é™†"
        "6"
        str))
    (setq str (string:subst-all "æŸ’"
        "7"
        str))
    (setq str (string:subst-all "æŒ"
        "8"
        str))
    (setq str (string:subst-all "ç–"
        "9"
        str)))
  (setq num (rtos num 2 0))
  (setq i -1 charofcash "")
  (setq n (strlen num))
  (repeat n (setq i (1+ i))
    (setq tempstr (substr num (- n i)
        1))
    (cond ((= i 0)
        (if (= "é›¶"
            tempstr)
          (setq tempstr "")))
      ((= i 1)
        (if (/= "é›¶"
            tempstr)
          (setq tempstr (strcat tempstr "æ‹¾"))))
      ((= i 2)
        (if (/= "é›¶"
            tempstr)
          (setq tempstr (strcat tempstr "ç™¾"))))
      ((= i 3)
        (if (/= "é›¶"
            tempstr)
          (setq tempstr (strcat tempstr "åƒ"))))
      ((= i 4)
        (if (= "é›¶"
            tempstr)
          (setq tempstr "ä¸‡")
          (setq tempstr (strcat tempstr "ä¸‡"))))
      ((= i 5)
        (if (/= "é›¶"
            tempstr)
          (setq tempstr (strcat tempstr "å"))))
      ((= i 6)
        (if (/= "é›¶"
            tempstr)
          (setq tempstr (strcat tempstr "ç™¾"))))
      ((= i 7)
        (if (/= "é›¶"
            tempstr)
          (setq tempstr (strcat tempstr "åƒ"))))
      ((= i 8)
        (if (= "é›¶"
            tempstr)
          (setq tempstr "äº¿")
          (setq tempstr (strcat tempstr "äº¿"))))
      ((= i 9)
        (if (/= "é›¶"
            tempstr)
          (setq tempstr (strcat tempstr "å"))))
      ((= i 10)
        (if (/= "é›¶"
            tempstr)
          (setq tempstr (strcat tempstr "ç™¾"))))
      ((= i 11)
        (if (/= "é›¶"
            tempstr)
          (setq tempstr (strcat tempstr "åƒ"))))
      ((= i 12)
        (if (/= "é›¶"
            tempstr)
          (setq tempstr (strcat tempstr "ä¸‡")))))
    (setq tempa (substr charofcash 1 2))
    (setq charofcash (if (= tempstr "é›¶")
        (cond ((= tempa "é›¶")
            charofcash)
          ((= tempa "")
            charofcash)
          ((= tempa "ä¸‡")
            charofcash)
          ((= tempa "äº¿")
            charofcash)
          (t (strcat tempstr charofcash)))
        (strcat tempstr charofcash))))
  (setq temp (substr charofcash 1 4))
  (if (= "å£¹æ‹¾"
      temp)
    (substr charofcash 3)
    charofcash)
  (_n2big charofcash))
```
</details>

---

### string:numberp

**è¯´æ˜**: ç¡®å®šå­—ç¬¦ä¸²æ˜¯å¦ä¸ºæ•°å­—

**ç”¨æ³•**:
```lisp
(string:numberp str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:numberp (str)
  "ç¡®å®šå­—ç¬¦ä¸²æ˜¯å¦ä¸ºæ•°å­—"
  (numberp (vl-catch-all-apply (quote read)
      (list (cond ((= "."
              (substr str 1 1))
            (strcat "0"
              str))
          ((and (= "-."
                (substr str 1 2))
              (> (strlen str)
                2))
            (strcat "-0"
              (substr str 2)))
          ((and (= "+."
                (substr str 1 2))
              (> (strlen str)
                2))
            (strcat "+0"
              (substr str 2)))
          (t str))))))
```
</details>

---

### string:parse-by-lst

**è¯´æ˜**: å­—ç¬¦ä¸²æŒ‰åˆ†éš”ç¬¦åˆ—è¡¨è½¬åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(string:parse-by-lst lstr delimlst)
```

**å‚æ•°**: 1 lstr  : åˆ—è¡¨;2 delimlst  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: æ‹†åˆ†åçš„åˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(string:parse-by-lst "a-b=c" '("-" "="))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:parse-by-lst (lstr delimlst)
  "å­—ç¬¦ä¸²æŒ‰åˆ†éš”ç¬¦åˆ—è¡¨è½¬åˆ—è¡¨"
  "æ‹†åˆ†åçš„åˆ—è¡¨"
  "(string:parse-by-lst \"a-b=c\"
    '(\"-\"
      \"=\"))"
  (setq lstr (list lstr))
  (foreach del delimlst (setq lstr (apply (quote append)
        (mapcar (quote (lambda (x)
              (string:to-lst x del)))
          lstr))))
  (if (member "
      "
      delimlst)
    (vl-remove ""
      lstr)
    lstr))
```
</details>

---

### string:readme

**è¯´æ˜**: å­—ç¬¦ä¸²æ“ä½œç›¸å…³å‡½æ•°ã€‚

**ç”¨æ³•**:
```lisp
(string:readme )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:readme nil "å­—ç¬¦ä¸²æ“ä½œç›¸å…³å‡½æ•°ã€‚"
  (princ "å­—ç¬¦ä¸²æ“ä½œç›¸å…³å‡½æ•°ã€‚ä½¿ç”¨ (require 'string:*)
    åŠ è½½è¿™äº›å‡½æ•°")
  (princ))
```
</details>

---

### string:realp

**è¯´æ˜**: ç¡®å®šå­—ç¬¦ä¸²æ˜¯å¦ä¸ºå®æ•°

**ç”¨æ³•**:
```lisp
(string:realp str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:realp (str)
  "ç¡®å®šå­—ç¬¦ä¸²æ˜¯å¦ä¸ºå®æ•°"
  (and (string:numberp str)
    (or (= "."
        (substr str 1 1))
      (= "-."
        (substr str 1 2))
      (= "+."
        (substr str 1 2))
      (= (quote int)
        (type (read str)))
      (= (quote real)
        (type (read str))))))
```
</details>

---

### string:regexp-replace

**è¯´æ˜**: æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢å­—ä¸²

**ç”¨æ³•**:
```lisp
(string:regexp-replace string newstr express key)
```

**å‚æ•°**: 1 string  : å­—ç¬¦ä¸²;2 newstr  : æœªæ˜ç¡®å®šä¹‰;3 express  : æœªæ˜ç¡®å®šä¹‰;4 key  : é”®ï¼Œå…³é”®å­—;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:regexp-replace (string newstr express key / regex s)
  "æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢å­—ä¸²"
  (setq regex (vlax-create-object "Vbscript.RegExp"))
  (if (and key (wcmatch key "*g*,*G*"))
    (vlax-put-property regex "Global"
      1)
    (vlax-put-property regex "Global"
      0))
  (if (and key (wcmatch key "*i*,*I*"))
    (vlax-put-property regex "IgnoreCase"
      1)
    (vlax-put-property regex "IgnoreCase"
      0))
  (if (and key (wcmatch key "*m*,*M*"))
    (vlax-put-property regex "Multiline"
      1)
    (vlax-put-property regex "Multiline"
      0))
  (vlax-put-property regex "Pattern"
    express)
  (setq s (vlax-invoke-method regex (quote replace)
      string newstr))
  (vlax-release-object regex)
  s)
```
</details>

---

### string:regexp-search

**è¯´æ˜**: æ­£åˆ™è¡¨è¾¾å¼æœç´¢å­—ä¸². Express = æ­£åˆ™è¡¨è¾¾å¼ key = å­—æ¯ i I m M g Gçš„ç»„åˆå­—ä¸²

**ç”¨æ³•**:
```lisp
(string:regexp-search string express key)
```

**å‚æ•°**: 1 string  : å­—ç¬¦ä¸²;2 express  : æœªæ˜ç¡®å®šä¹‰;3 key  : é”®ï¼Œå…³é”®å­—;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:regexp-search (string express key / regex s pos len str l)
  "æ­£åˆ™è¡¨è¾¾å¼æœç´¢å­—ä¸². Express = æ­£åˆ™è¡¨è¾¾å¼ key = å­—æ¯ i I m M g Gçš„ç»„åˆå­—ä¸²"
  (setq regex (vlax-create-object "Vbscript.RegExp"))
  (if (and key (wcmatch key "*g*,*G*"))
    (vlax-put-property regex "Global"
      1)
    (vlax-put-property regex "Global"
      0))
  (if (and key (wcmatch key "*i*,*I*"))
    (vlax-put-property regex "IgnoreCase"
      1)
    (vlax-put-property regex "IgnoreCase"
      0))
  (if (and key (wcmatch key "*m*,*M*"))
    (vlax-put-property regex "Multiline"
      1)
    (vlax-put-property regex "Multiline"
      0))
  (vlax-put-property regex "Pattern"
    express)
  (setq s (vlax-invoke-method regex (quote execute)
      string))
  (vlax-for o s (setq pos (vlax-get-property o "FirstIndex")
      len (vlax-get-property o "Length")
      str (vlax-get-property o "value"))
    (setq l (cons (list pos len str)
        l)))
  (vlax-release-object regex)
  (reverse l))
```
</details>

---

### string:reverse

**è¯´æ˜**: åè½¬å­—ç¬¦ä¸²,æ”¯æŒä¸­æ–‡

**ç”¨æ³•**:
```lisp
(string:reverse str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: Str

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:reverse (str)
  "åè½¬å­—ç¬¦ä¸²,æ”¯æŒä¸­æ–‡"
  "Str"
  (string:l2s-ansi (reverse (string:s2l-ansi str))))
```
</details>

---

### string:rightsubstr

**è¯´æ˜**: ä»å³ä¾§æ±‚å­ä¸²

**ç”¨æ³•**:
```lisp
(string:rightsubstr str start len)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 start  : æœªæ˜ç¡®å®šä¹‰;3 len  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:rightsubstr (str start len)
  "ä»å³ä¾§æ±‚å­ä¸²"
  (substr str (- (strlen str)
      len start -2)
    len))
```
</details>

---

### string:rsubstr

**è¯´æ˜**: ä»å³ä¾§æ±‚å­ä¸²

**ç”¨æ³•**:
```lisp
(string:rsubstr str len)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 len  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:rsubstr (str len)
  "ä»å³ä¾§æ±‚å­ä¸²"
  (substr str (- (strlen str)
      len -1)))
```
</details>

---

### string:s2l-ansi

**è¯´æ˜**: å­—ç¬¦ä¸²è½¬å­—byte or word æ•´æ•°å€¼åˆ—è¡¨ã€‚nå½“å°äº128æ—¶ï¼Œå•å­—èŠ‚ï¼Œå½“ä¸¤ä¸ªè¿ç»­çš„å¤§äº128æ—¶ï¼ŒåŒå­—èŠ‚å€¼ã€‚ç”¨äºè½¬æ¢éè‹±æ–‡å­—ä¸²æ—¶é˜²æ­¢é‡ç ã€‚nå½“AutoCAD2021ä¸”lispsys=1æ—¶ï¼Œè¿”å› unicode ç ã€‚

**ç”¨æ³•**:
```lisp
(string:s2l-ansi str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:s2l-ansi (str / lst-src lst-str h% res)
  "å­—ç¬¦ä¸²è½¬å­—byte or word æ•´æ•°å€¼åˆ—è¡¨ã€‚\nå½“å°äº128æ—¶ï¼Œå•å­—èŠ‚ï¼Œå½“ä¸¤ä¸ªè¿ç»­çš„å¤§äº128æ—¶ï¼ŒåŒå­—èŠ‚å€¼ã€‚ç”¨äºè½¬æ¢éè‹±æ–‡å­—ä¸²æ—¶é˜²æ­¢é‡ç ã€‚\nå½“AutoCAD2021ä¸”lispsys=1æ—¶ï¼Œè¿”å› unicode ç ã€‚"
  (if (and (getvar "lispsys")
      (<= 1 (getvar "lispsys")))
    (vl-string->list str)
    (progn (setq h% 0)
      (setq res (quote nil))
      (setq lst-src (vl-string->list str))
      (while (setq byte% (car lst-src))
        (cond ((and (= 0 h%)
              (apply (quote and)
                (mapcar (quote =)
                  (list 92 85 43)
                  lst-src)))
            (setq lst-src (cdr lst-src))
            (setq lst-src (cdr lst-src))
            (setq lst-src (cdr lst-src))
            (setq res (cons (fix (m:hex2dec (strcat "0x"
                      (chr (car lst-src))
                      (chr (cadr lst-src))
                      (chr (nth 2 lst-src))
                      (chr (nth 3 lst-src)))))
                res))
            (setq lst-src (cdr lst-src))
            (setq lst-src (cdr lst-src))
            (setq lst-src (cdr lst-src)))
          ((and (= 0 h%)
              (/= byte% 92)
              (or (< byte% 128)
                (> byte% 255)))
            (setq res (cons byte% res)))
          ((and (= 0 h%)
              (> 256 byte% 127))
            (setq h% byte%))
          ((or (and (> 170 h% 127)
                (< byte% 128))
              (and (> 256 h0 170)
                (> 64 byte%)))
            (setq res (cons h% res))
            (setq res (cons byte% res))
            (setq h% 0))
          ((or (and (> 170 h% 127)
                (> 256 byte% 127))
              (and (> 256 h% 170)
                (> byte% 64)))
            (setq res (cons (+ (lsh h% 8)
                  byte%)
                res))
            (setq h% 0)))
        (setq lst-src (cdr lst-src)))
      (reverse res))))
```
</details>

---

### string:search

**è¯´æ˜**: æœç´¢å­—ç¬¦ä¸²pattern æ˜¯å¦ä¸º strçš„å­ä¸²ï¼Œæ˜¯è¿”å›ä½ç½®ï¼ˆæ±‰å­—å ä¸€ä½ï¼‰ã€‚

**ç”¨æ³•**:
```lisp
(string:search pattern str)
```

**å‚æ•°**: 1 pattern  : æœªè¯†åˆ«å®šä¹‰;2 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: int

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:search (pattern str / lst-pattern lst-str pos-st n)
  "æœç´¢å­—ç¬¦ä¸²pattern æ˜¯å¦ä¸º strçš„å­ä¸²ï¼Œæ˜¯è¿”å›ä½ç½®ï¼ˆæ±‰å­—å ä¸€ä½ï¼‰ã€‚"
  "int"
  (setq lst-pattern (string:s2l-ansi pattern))
  (setq len-pattern (length lst-pattern))
  (setq lst-str (string:s2l-ansi str))
  (if (setq lst-substr (member (car lst-pattern)
        lst-str))
    (progn (setq pos-st (- (length lst-str)
          (length lst-substr)))
      (setq n 1)
      (while (and (cdr lst-pattern)
          (= (car (setq lst-pattern (cdr lst-pattern)))
            (car (setq lst-substr (cdr lst-substr)))))
        (setq n (1+ n)))
      (if (= n len-pattern)
        pos-st))))
```
</details>

---

### string:sort-by-number

**è¯´æ˜**: æŒ‰æ•°å­—æ’åºå­—ç¬¦ä¸²åœ¨å¤¹æ‚æ•°å­—æ—¶ï¼Œå¦‚æœæ•°å­—å‰åçš„å­—ç¬¦ä¸²ç›¸åŒï¼ŒæŒ‰æ•°å­—å¤§å°æ’åº,æ”¯æŒä¸­æ–‡æ•°å­—

**ç”¨æ³•**:
```lisp
(string:sort-by-number lst-str)
```

**å‚æ•°**: 1 lst-str  : åˆ—è¡¨;

**è¿”å›å€¼**: æ’åºåçš„å­—ç¬¦ä¸²è¡¨

**ç¤ºä¾‹**:
```lisp
(string:sort-by-number '("a5"       "a1"      "a8"      "b2"      "b1"      "a110"      "a13"))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:sort-by-number (lst-str)
  "æŒ‰æ•°å­—æ’åºå­—ç¬¦ä¸²\nåœ¨å¤¹æ‚æ•°å­—æ—¶ï¼Œå¦‚æœæ•°å­—å‰åçš„å­—ç¬¦ä¸²ç›¸åŒï¼ŒæŒ‰æ•°å­—å¤§å°æ’åº,æ”¯æŒä¸­æ–‡æ•°å­—"
  "æ’åºåçš„å­—ç¬¦ä¸²è¡¨"
  "(string:sort-by-number '(\"a5\"\n       \"a1\"\n      \"a8\"\n      \"b2\"\n      \"b1\"\n      \"a110\"\n      \"a13\"))"
  (vl-sort lst-str (function (lambda (x y / n a b lx ly)
        (setq n 0)
        (setq lx (string:auto-split x))
        (setq ly (string:auto-split y))
        (while (and (< n (length lx))
            (< n (length ly))
            (= (nth n lx)
              (nth n ly)))
          (setq n (1+ n)))
        (setq a (nth n lx)
          b (nth n ly))
        (if (and a b)
          (cond ((and (string:intp a)
                (string:intp b))
              (< (atoi a)
                (atoi b)))
            ((and (string:realp a)
                (string:realp b))
              (< (atof a)
                (atof b)))
            ((and (string:hannumberp a)
                (string:hannumberp b))
              (< (string:hannumber2number a)
                (string:hannumber2number b)))
            (t (< a b))))))))
```
</details>

---

### string:split

**è¯´æ˜**: å°†å­—ç¬¦ä¸²ç”¨separatoråˆ†éš”æˆåˆ—è¡¨ï¼Œseparator å¯ä»¥æ˜¯å­—ç¬¦æˆ–ç”±å­—ç¬¦ç»„æˆçš„è¡¨ã€‚

**ç”¨æ³•**:
```lisp
(string:split str separator)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 separator  : åˆ†éš”ç¬¦;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:split (str separator / pos)
  "å°†å­—ç¬¦ä¸²ç”¨separatoråˆ†éš”æˆåˆ—è¡¨ï¼Œseparator å¯ä»¥æ˜¯å­—ç¬¦æˆ–ç”±å­—ç¬¦ç»„æˆçš„è¡¨ã€‚"
  (cond ((= (quote str)
        (type separator))
      (string:to-list str separator))
    ((listp separator)
      (string:parse-by-lst str separator))))
```
</details>

---

### string:square

**è¯´æ˜**: å­—ç¬¦ä¸²è‡ªä¹˜

**ç”¨æ³•**:
```lisp
(string:square int str)
```

**å‚æ•°**: 1 int  : æ•´æ•°;2 str  : å­—ç¬¦ä¸²;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:square (int str)
  "å­—ç¬¦ä¸²è‡ªä¹˜"
  (if (zerop int)
    str (strcat str (string:square (1- int)
        str))))
```
</details>

---

### string:subst-all

**è¯´æ˜**: ç”¨ str-new æ›¿æ¢ å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„ str-old

**ç”¨æ³•**:
```lisp
(string:subst-all str-new str-old str)
```

**å‚æ•°**: 1 str-new  : å­—ç¬¦ä¸²;2 str-old  : å­—ç¬¦ä¸²;3 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: ç»“æœå­—ç¬¦ä¸²

**ç¤ºä¾‹**:
```lisp
(string:subst-all "qwe"    "abc"    "mabcpoildabce")  => "mqwepoildqwee"
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:subst-all (str-new str-old str / inc len)
  "ç”¨ str-new æ›¿æ¢ å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„ str-old "
  "ç»“æœå­—ç¬¦ä¸²"
  "(string:subst-all \"qwe\"\n    \"abc\"\n    \"mabcpoildabce\")\n  => \"mqwepoildqwee\""
  (if (> (strlen str-old)
      0)
    (progn (setq len (strlen str-new)
        inc 0)
      (while (setq inc (vl-string-search str-old str inc))
        (setq str (vl-string-subst str-new str-old str inc)
          inc (+ inc len)))))
  str)
```
</details>

---

### string:substr

**è¯´æ˜**: æˆªå–å­—ç¬¦ä¸²ï¼Œansi å­—ç¬¦æŒ‰ 1 ä½ è®¡ç®—ã€‚start æœ€å°å€¼ä¸º 1, len æœ€å°ä¸º1

**ç”¨æ³•**:
```lisp
(string:substr str start len)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 start  : æœªæ˜ç¡®å®šä¹‰;3 len  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: ç»“æœå­—ç¬¦ä¸²

**ç¤ºä¾‹**:
```lisp
(string:substr "aä¸­å›½äººbcdå¼€å‘lisp" 2 3) => ä¸­å›½äºº
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:substr (str start len / res i)
  "æˆªå–å­—ç¬¦ä¸²ï¼Œansi å­—ç¬¦æŒ‰ 1 ä½ è®¡ç®—ã€‚start æœ€å°å€¼ä¸º 1, len æœ€å°ä¸º1 "
  "ç»“æœå­—ç¬¦ä¸²"
  "(string:substr \"aä¸­å›½äººbcdå¼€å‘lisp\"
    2 3)
  => ä¸­å›½äºº"
  (setq start (fix start)
    len (fix len))
  (if (< start 1)
    (setq start 1))
  (if (< len 1)
    (setq len 1))
  (setq res nil)
  (setq i -2)
  (repeat len (setq res (cons (nth (+ (setq i (1+ i))
            start)
          (string:s2l-ansi str))
        res)))
  (string:l2s-ansi (vl-remove nil (reverse res))))
```
</details>

---

### string:to-list

**è¯´æ˜**: å­—ç¬¦ä¸²è½¬æˆåˆ—è¡¨ï¼Œæ‹†åˆ†å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šå­—ç¬¦æ¥åˆ†éš”å­—ç¬¦ä¸²ã€‚

**ç”¨æ³•**:
```lisp
(string:to-list str separator)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 separator  : åˆ†éš”ç¬¦;

**è¿”å›å€¼**: æ‹†åˆ†åçš„åˆ—è¡¨

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:to-list (str separator / s2l)
  "å­—ç¬¦ä¸²è½¬æˆåˆ—è¡¨ï¼Œæ‹†åˆ†å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šå­—ç¬¦æ¥åˆ†éš”å­—ç¬¦ä¸²ã€‚"
  "æ‹†åˆ†åçš„åˆ—è¡¨"
  (if (and (p:stringp separator)
      (p:stringp str))
    (if (= ""
        separator)
      (mapcar (quote (lambda (x)
            (string:l2s-ansi (list x))))
        (string:s2l-ansi str))
      (progn (defun s2l (str separator / pos)
          (if (setq pos (vl-string-search separator str))
            (cons (substr str 1 pos)
              (s2l (substr str (+ pos 1 (strlen separator)))
                separator))
            (list str)))
        (s2l str separator)))
    (progn (@:log "ERROR"
        "parameter is not a string")
      nil)))
```
</details>

---

### string:to-lst

**è¯´æ˜**: å­—ç¬¦ä¸²è½¬æˆåˆ—è¡¨

**ç”¨æ³•**:
```lisp
(string:to-lst str separator)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 separator  : åˆ†éš”ç¬¦;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:to-lst (str separator / pos)
  "å­—ç¬¦ä¸²è½¬æˆåˆ—è¡¨"
  (if (= ""
      separator)
    (mapcar (quote (lambda (x)
          (string:l2s-ansi (list x))))
      (string:s2l-ansi str))
    (if (setq pos (vl-string-search separator str))
      (cons (substr str 1 pos)
        (string:to-lst (substr str (+ pos 1 (strlen separator)))
          separator))
      (list str))))
```
</details>

---

### string:trim-space

**è¯´æ˜**: å»é™¤å­—ç¬¦ä¸²ä¸­çš„ç©ºæ ¼

**ç”¨æ³•**:
```lisp
(string:trim-space string)
```

**å‚æ•°**: 1 string  : å­—ç¬¦ä¸²;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun string:trim-space (string)
  "å»é™¤å­—ç¬¦ä¸²ä¸­çš„ç©ºæ ¼"
  (string:subst-all ""
    "
    "
    string))
```
</details>

---

## style

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### style:missing-fonts

**è¯´æ˜**: æ£€æŸ¥ç¼ºå°‘çš„å­—ä½“ï¼Œå¦‚æœæœ‰è¿”å›å­—ä½“æ–‡ä»¶åç»„æˆçš„åˆ—è¡¨ï¼Œæ²¡æœ‰è¿”å›nil

**ç”¨æ³•**:
```lisp
(style:missing-fonts )
```

**å‚æ•°**: None

**è¿”å›å€¼**: å­—ä½“æ–‡ä»¶åç»„æˆçš„åˆ—è¡¨,æˆ–nil

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun style:missing-fonts (/ lst-missing st)
  "æ£€æŸ¥ç¼ºå°‘çš„å­—ä½“ï¼Œå¦‚æœæœ‰è¿”å›å­—ä½“æ–‡ä»¶åç»„æˆçš„åˆ—è¡¨ï¼Œæ²¡æœ‰è¿”å›nil"
  "å­—ä½“æ–‡ä»¶åç»„æˆçš„åˆ—è¡¨,æˆ–nil"
  ""
  (setq st (tblnext "style"
      t))
  (setq lst-missing (cons (list (cdr (assoc 3 st))
        (cdr (assoc 4 st)))
      nil))
  (while (setq st (tblnext "style"))
    (setq lst-missing (cons (list (cdr (assoc 3 st))
          (cdr (assoc 4 st)))
        lst-missing)))
  (vl-remove nil (mapcar (quote (lambda (x)
          (cond ((null (vl-filename-extension x))
              (if (findfile (strcat x ".shx"))
                nil x))
            ((member (strcase (vl-filename-extension x)
                  t)
                (quote (".shx")))
              (if (findfile x)
                nil x))
            ((member (strcase (vl-filename-extension x)
                  t)
                (quote (".ttf"
                    ".ttc")))
              (if (findfile (strcat (getenv "windir")
                    "\\Fonts\\"
                    X))
                nil X)))))
      (LIST:REMOVE-DUPLICATES (VL-REMOVE nil (VL-REMOVE ""
            (APPLY (QUOTE APPEND)
              LST-MISSING)))))))
```
</details>

---

## svg

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### svg:export

**è¯´æ˜**: å°†é€‰æ‹©çš„å›¾å…ƒç”ŸæˆSVG, ss é€‰æ‹©é›†,path è¾“å‡ºæ–‡ä»¶è·¯å¾„ã€‚å½“å‰åªæ”¯æŒäºŒç»´å¤šæ®µçº¿å’Œçº¿æ®µ

**ç”¨æ³•**:
```lisp
(svg:export ss path)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;2 path  : æ–‡ä»¶è·¯å¾„;

**ç¤ºä¾‹**:
```lisp
(svg:export (ssget) "C:/example.svg")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun svg:export (ss path / i out lst-ss color w h ox oy)
  "å°†é€‰æ‹©çš„å›¾å…ƒç”ŸæˆSVG, ss é€‰æ‹©é›†,path è¾“å‡ºæ–‡ä»¶è·¯å¾„ã€‚å½“å‰åªæ”¯æŒäºŒç»´å¤šæ®µçº¿å’Œçº¿æ®µ"
  ""
  "(svg:export (ssget)
    \"C:/example.svg\")"
  (setq lst-ss (pickset:to-list ss))
  (setq box (pickset:getbox ss 1))
  (setq w (- (car (cadr box))
      (car (car box))))
  (setq h (- (cadr (cadr box))
      (cadr (car box))))
  (setq ox (car (car box)))
  (setq oy (cadr (car box)))
  (setq out (open path "w"))
  (write-line "<?xml version=\"1.0\"
    encoding=\"utf-8\"
    standalone=\"no\"?>"
    out)
  (write-line (strcat "<svg width=\"256\"
      height=\"256\"
      viewBox=\"0 0 "
      (rtos w 2 1)
      "
      "
      (rtos h 2 1)
      "\"
      version=\"1.1\"
      xmlns=\"http://www.w3.org/2000/svg\"
      xmlns:xlink=\"http://www.w3.org/1999/xlink\">")
    out)
  (foreach curve lst-ss (setq color (color:rgb2css (entity:get-truecolor curve)))
    (setq bold (entity:getdxf curve 43))
    (if (or (null bold)
        (and bold (= 0 bold)))
      (setq bold 1))
    (cond ((wcmatch (entity:getdxf curve 0)
          "LWPOLYLINE,LINE")
        (write-line (strcat "<polyline points=\""
            (string:from-list (mapcar (quote (lambda (x)
                    (strcat (rtos (- (car x)
                          ox)
                        2 3)
                      ","
                      (rtos (- h (- (cadr x)
                            oy))
                        2 3))))
                (progn (setq pts (curve:get-points curve))
                  (if (and (setq closed (entity:getdxf curve 70))
                      (= 1 closed))
                    (setq pts (append pts (list (car pts))))
                    pts)))
              "
              ")
            "\"
            style=\"fill:none;stroke:"
            color ";stroke-width:"
            (rtos bold 2 3)
            "\"
            />")
          out))
      ((wcmatch (entity:getdxf curve 0)
          "CIRCLE")
        (setq x (entity:getdxf curve 10))
        (write-line (strcat "<circle cx=\""
            (rtos (- (car x)
                ox)
              2 3)
            "\"
            "
            "cy=\""
            (rtos (- h (- (cadr x)
                  oy))
              2 3)
            "\"
            "
            "r=\""
            (rtos (entity:getdxf curve 40)
              2 3)
            "\"
            "
            "stroke=\""
            color "\"
            "
            "stroke-width=\""
            (rtos bold 2 3)
            "\"
            "
            "fill=\"white\"
            />")
          out))))
  (write-line "</svg>"
    out)
  (close out)
  (princ))
```
</details>

---

## sys

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### sys:list-process

**è¯´æ˜**: è·å–å½“å‰è¿è¡Œçš„è¿›ç¨‹å¯¹è±¡åˆ—è¡¨ã€‚

**ç”¨æ³•**:
```lisp
(sys:list-process )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun sys:list-process (/ vlist vobj lcom lexecquery item)
  "è·å–å½“å‰è¿è¡Œçš„è¿›ç¨‹å¯¹è±¡åˆ—è¡¨ã€‚"
  ""
  (vl-load-com)
  (setq vlist (quote nil))
  (if (setq vobj (vlax-create-object "wbemscripting.swbemlocator"))
    (progn (setq lcom (vlax-invoke vobj (quote connectserver)
          "."
          "\\root\\cimv2"
          ""
          ""
          ""
          ""
          128 nil))
      (setq lexecquery (vlax-invoke lcom (quote execquery)
          "Select * from Win32_Process"))
      (vlax-for item lexecquery (setq vlist (cons item vlist)))
      (vlax-release-object lexecquery)
      (vlax-release-object lcom)
      (vlax-release-object vobj)))
  vlist)
```
</details>

---

### sys:list-process-name

**è¯´æ˜**: è·å–å½“å‰è¿è¡Œçš„è¿›ç¨‹å(exeæ–‡ä»¶å)ã€‚

**ç”¨æ³•**:
```lisp
(sys:list-process-name )
```

**å‚æ•°**: None

**è¿”å›å€¼**: String

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun sys:list-process-name nil "è·å–å½“å‰è¿è¡Œçš„è¿›ç¨‹å(exeæ–‡ä»¶å)ã€‚"
  "String"
  (mapcar (quote (lambda (x)
        (vlax-get x (quote name))))
    (sys:list-process)))
```
</details>

---

## system

**æ¨¡å—è¯´æ˜**: ç³»ç»Ÿä¿¡æ¯ã€ç¯å¢ƒå˜é‡

### system:dir

**è¯´æ˜**: å­—ç¬¦ä¸²è·¯å¾„ç›®å½•åŒ–ï¼Œå³ç»“å°¾æ˜¯ \

**ç”¨æ³•**:
```lisp
(system:dir str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun system:dir (str)
  "å­—ç¬¦ä¸²è·¯å¾„ç›®å½•åŒ–ï¼Œå³ç»“å°¾æ˜¯ \\ "
  (if (= 92 (last (vl-string->list str)))
    str (strcat str "\\")))
```
</details>

---

### system:explorer

**è¯´æ˜**: åœ¨èµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€æŒ‡å®šçš„æ–‡ä»¶å¤¹

**ç”¨æ³•**:
```lisp
(system:explorer dir-path)
```

**å‚æ•°**: 1 dir-path  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun system:explorer (dir-path)
  "åœ¨èµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€æŒ‡å®šçš„æ–‡ä»¶å¤¹"
  (startapp (strcat "explorer /e,\""
      (@::path-os dir-path)
      "\""))
  (princ))
```
</details>

---

### system:get-folder

**è¯´æ˜**: è°ƒç”¨Windowsé€šç”¨ç›®å½•é€‰å–å¯¹è¯æ¡†,è¿”å›é€‰ä¸­è·¯å¾„.å‚æ•°: msg-å¯¹è¯æ¡†æç¤ºå­—ç¬¦ä¸²

**ç”¨æ³•**:
```lisp
(system:get-folder msg)
```

**å‚æ•°**: 1 msg  : æç¤ºä¿¡æ¯;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun system:get-folder (msg / winshell shfolder path catchit)
  "è°ƒç”¨Windowsé€šç”¨ç›®å½•é€‰å–å¯¹è¯æ¡†,è¿”å›é€‰ä¸­è·¯å¾„.\nå‚æ•°: msg-å¯¹è¯æ¡†æç¤ºå­—ç¬¦ä¸²"
  (vl-load-com)
  (setq winshell (vlax-create-object "Shell.Application"))
  (setq shfolder (vlax-invoke-method winshell (quote browseforfolder)
      0 msg 1))
  (setq catchit (vl-catch-all-apply (quote (lambda nil (setq shfolder (vlax-get-property shfolder (quote self)))
          (setq path (vlax-get-property shfolder (quote path)))))))
  (if (vl-catch-all-error-p catchit)
    nil path))
```
</details>

---

### system:get-qqids

**è¯´æ˜**: è·å–æœ¬æœºç™»å½•è¿‡çš„QQå·

**ç”¨æ³•**:
```lisp
(system:get-qqids )
```

**å‚æ•°**: æ²¡æœ‰ä¸€ä¸ª

**è¿”å›å€¼**: list

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun system:get-qqids nil "è·å–æœ¬æœºç™»å½•è¿‡çš„QQå·"
  "list"
  (setq u (getenv "userprofile"))
  (if (vl-file-directory-p (strcat u "\\Documents\\Tencent Files"))
    (progn (setq qqids (vl-directory-files (strcat u "\\Documents\\Tencent Files")
          "*"
          -1))
      (setq qqids (vl-remove-if-not (quote (lambda (x)
              (wcmatch x "####*")))
          qqids))))
  qqids)
```
</details>

---

### system:platform

**è¯´æ˜**: è¿”å›windowsæ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯

**ç”¨æ³•**:
```lisp
(system:platform )
```

**å‚æ•°**: æ²¡æœ‰ä¸€ä¸ª

**è¿”å›å€¼**: lst

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun system:platform nil "è¿”å›windowsæ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯"
  "lst"
  (mapcar (quote (lambda (x)
        (cons x (vl-registry-read "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion"
            x))))
    (list "CurrentVersion"
      "ProductName"
      "EditionId"
      "DisplayVersion"
      "CurrentBuild")))
```
</details>

---

### system:python

**è¯´æ˜**: å®‰è£…python

**ç”¨æ³•**:
```lisp
(system:python )
```

**å‚æ•°**: æ²¡æœ‰ä¸€ä¸ª

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun system:python nil "å®‰è£…python"
  (if (and (null (findfile (@::path-os (strcat (getenv "userprofile")
              "/AppData/Local/Programs/Python/Python313/python.EXE"))))
      (system:winget))
    (@::cmd "start"
      "winget install python.python.3.13")))
```
</details>

---

### system:vers

**è¯´æ˜**: CADç‰ˆæœ¬å·

**ç”¨æ³•**:
```lisp
(system:vers )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun system:vers nil "CADç‰ˆæœ¬å·"
  (quote ((autocad (2000 . 15.0)
        (2000i . 15.1)
        (2002 . 15.2)
        (2004 . 16.0)
        (2005 . 16.1)
        (2006 . 16.2)
        (2007 . 17.0)
        (2008 . 17.1)
        (2009 . 17.2)
        (2010 . 18.0)
        (2011 . 18.1)
        (2012 . 18.2)
        (2013 . 19.0)
        (2014 . 19.1)
        (2015 . 20.0)
        (2016 . 20.1)
        (2017 . 21.0)
        (2018 . 22.0)
        (2019 . 23.0)
        (2020 . 23.1)
        (2021 . 24.0)
        (2022 . 24.1))
      (gstarcad)
      (zwcad))))
```
</details>

---

### system:which

**è¯´æ˜**: æŸ¥æ‰¾å®šä½å¯æ‰§è¡Œæ–‡ä»¶

**ç”¨æ³•**:
```lisp
(system:which exename)
```

**å‚æ•°**: 1 exename  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun system:which (exename / res logfile)
  "æŸ¥æ‰¾å®šä½å¯æ‰§è¡Œæ–‡ä»¶"
  (progn (setq logfile (@::path-os (strcat @::*tmp-path* "pslog")))
    (@::cmd "powershell"
      (strcat "Get-Command "
        exename "
        -errorAction SilentlyContinue | Out-File -FilePath "
        logfile "}"))))
```
</details>

---

### system:winget

**è¯´æ˜**: æ—©æœŸçš„win10æ²¡æœ‰winget,è¿™ä¸ªå‡½æ•°ç”¨äºå®‰è£…winget

**ç”¨æ³•**:
```lisp
(system:winget )
```

**å‚æ•°**: æ²¡æœ‰ä¸€ä¸ª

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun system:winget nil "æ—©æœŸçš„win10æ²¡æœ‰winget,è¿™ä¸ªå‡½æ•°ç”¨äºå®‰è£…winget"
  (setq ps1 (list "if (-not ( Get-Command winget -errorAction SilentlyContinue))
      {"
      "
         Add-AppxPackage -RegisterByFamilyName -MainPackage Microsoft.DesktopAppInstaller_8wekyb3d8bbwe"
      "}"
      "if (-not ( Get-Command winget -errorAction SilentlyContinue))
      {"
      "
         Invoke-WebRequest http://s3.atlisp.cn/download/Microsoft.DesktopAppInstaller_8wekyb3d8bbwe.msixbundle"
      "
         Add-AppxPackage -RegisterByFamilyName -MainPackage .Microsoft.DesktopAppInstaller_8wekyb3d8bbwe.msixbundle"
      "}"))
  (setq fp (open (setq file (@::path-os (strcat @::*tmp-path* "get-winget.ps1")))
      "w"))
  (foreach ln ps1 (write-line ln fp))
  (close fp)
  (or @::enable-start (@::check-pgp)
    (@::patch-pgp))
  (@::cmd "powershell"
    (strcat "Get-Content "
      file "| Invoke-Expression"))
  t)
```
</details>

---

### system:winget-src

**è¯´æ˜**: å½“uriä¸º nilæ—¶é‡ç½®ä¸ºå®˜æ–¹æº.

**ç”¨æ³•**:
```lisp
(system:winget-src uri)
```

**å‚æ•°**: 1 uri  : æœªè¯†åˆ«å®šä¹‰;

**ç¤ºä¾‹**:
```lisp
(system:winget-src  "https://mirrors.ustc.edu.cn/winget-source")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun system:winget-src (uri)
  "å½“uriä¸º nilæ—¶é‡ç½®ä¸ºå®˜æ–¹æº."
  ""
  "(system:winget-src  \"https://mirrors.ustc.edu.cn/winget-source\")"
  (if (not (string-equal "administrator"
        (getenv "username")))
    (@::prompt "æœ¬å‡½æ•°éœ€è¦ç®¡ç†å‘˜æƒé™"))
  (or @::enable-start (@::check-pgp)
    (@::patch-pgp))
  (cond ((p:stringp uri)
      (@::cmd "powershell"
        "winget source remove winget;winget source add winget "
        uri))
    ((null uri)
      (@::cmd "powershell"
        "winget source reset winget"))
    (t (@::cmd "powershell"
        "winget source remove winget;winget source add winget \"https://mirrors.ustc.edu.cn/winget-source\""))))
```
</details>

---

### system:wscript

**è¯´æ˜**: è°ƒç”¨WScript è„šæœ¬ï¼Œå¹¶è¿”å›è¾“å‡ºå­—ç¬¦ä¸²

**ç”¨æ³•**:
```lisp
(system:wscript wscode)
```

**å‚æ•°**: 1 wscode  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun system:wscript (wscode / wsh txt)
  "è°ƒç”¨WScript è„šæœ¬ï¼Œå¹¶è¿”å›è¾“å‡ºå­—ç¬¦ä¸²"
  (setq wsh (vlax-create-object "wscript.shell"))
  (setq txt (vlax-invoke (vlax-get (vlax-invoke wsh (quote exec)
          wscode)
        (quote stdout))
      (quote readall)))
  (vlax-release-object wsh)
  txt)
```
</details>

---

## table

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### table:make

**è¯´æ˜**: åˆ›å»ºè¡¨æ ¼ï¼Œå‚æ•°: npt:ä½ç½®ç‚¹ï¼Œntitle:æ ‡é¢˜ ï¼Œ nheaders:è¡¨å¤´è¡¨nmat-data: å•å…ƒæ•°æ®çŸ©é˜µ,ç›®å‰ä»…æ”¯æŒæ–‡å­—å‹è¡¨æ ¼

**ç”¨æ³•**:
```lisp
(table:make pt title headers mat-data)
```

**å‚æ•°**: 1 pt  : å•ä¸ª2D/3Dåæ ‡ç‚¹;2 title  : æœªè¯†åˆ«å®šä¹‰;3 headers  : æœªè¯†åˆ«å®šä¹‰;4 mat-data  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: è¡¨æ ¼å›¾å…ƒ

**ç¤ºä¾‹**:
```lisp
(table:make (getpoint)n    "æˆ‘çš„è¡¨æ ¼"n    '("åˆ—1"n      "åˆ—2"n      "åˆ—3")'((5 3 3)(2 3 3)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun table:make (pt title headers mat-data / unit-h unit-w list-dxf i% rows columns)
  "åˆ›å»ºè¡¨æ ¼ï¼Œå‚æ•°: \npt:ä½ç½®ç‚¹ï¼Œ\ntitle:æ ‡é¢˜ ï¼Œ \nheaders:è¡¨å¤´è¡¨\nmat-data: å•å…ƒæ•°æ®çŸ©é˜µ,ç›®å‰ä»…æ”¯æŒæ–‡å­—å‹è¡¨æ ¼"
  "è¡¨æ ¼å›¾å…ƒ"
  "(table:make (getpoint)\n    \"æˆ‘çš„è¡¨æ ¼\"\n    '(\"åˆ—1\"\n      \"åˆ—2\"\n      \"åˆ—3\")'((5 3 3)(2 3 3)))"
  (if mat-data (progn (setq rows (+ 2 (length mat-data))
        columns (apply (quote max)
          (mapcar (quote length)
            mat-data)))
      (if (null headers)
        (progn (setq i% 0)
          (while (< i% columns)
            (setq headers (cons (strcat "C"
                  (itoa (- columns i%)))
                headers))
            (setq i% (1+ i%)))))
      (setq unit-h (@:scale 3.5)
        unit-w (@:scale 100.0))
      (setq rows (+ 2 (length mat-data))
        columns (apply (quote max)
          (mapcar (quote length)
            mat-data)))
      (setq list-dxf (list (quote (0 . "ACAD_TABLE"))
          (quote (100 . "AcDbEntity"))
          (quote (67 . 0))
          (quote (100 . "AcDbBlockReference"))
          (cons 10 pt)
          (quote (41 . 1.0))
          (quote (42 . 1.0))
          (quote (43 . 1.0))
          (quote (50 . 0.0))
          (quote (70 . 0))
          (quote (71 . 0))
          (quote (44 . 0.0))
          (quote (45 . 0.0))
          (quote (210 0.0 0.0 1.0))
          (quote (100 . "AcDbTable"))
          (quote (280 . 0))
          (quote (11 1.0 0.0 0.0))
          (quote (90 . 22))
          (cons 91 rows)
          (cons 92 columns)
          (quote (93 . 0))
          (quote (94 . 0))
          (quote (95 . 0))
          (quote (96 . 0))))
      (setq list-dxf (append list-dxf (list (cons 141 (* 1.2 unit-h)))))
      (setq i% 0)
      (while (< i% (1- rows))
        (setq list-dxf (append list-dxf (list (cons 141 unit-h))))
        (setq i% (1+ i%)))
      (setq i% 0)
      (while (< i% columns)
        (setq unit-w (* (@:scale 5.0)
            (apply (quote max)
              (mapcar (quote (lambda (x)
                    (strlen (@:to-string (if (nth i% x)
                          (nth i% x)
                          "")))))
                (cons headers mat-data)))))
        (setq list-dxf (append list-dxf (list (cons 142 unit-w))))
        (setq i% (1+ i%)))
      (setq list-dxf (append list-dxf (list (quote (171 . 1))
            (quote (172 . 0))
            (quote (173 . 0))
            (quote (174 . 0))
            (cons 175 columns)
            (quote (176 . 1))
            (quote (91 . 262144))
            (quote (178 . 0))
            (quote (145 . 0.0))
            (cons 140 (@:scale 2.5))
            (quote (92 . 0))
            (quote (301 . "CELL_VALUE"))
            (quote (93 . 6))
            (quote (90 . 4))
            (cons 1 title)
            (quote (94 . 0))
            (cons 300 "")
            (cons 302 title)
            (quote (304 . "ACVALUE_END")))))
      (setq i% 0)
      (while (< i% (1- columns))
        (setq list-dxf (append list-dxf (list (quote (171 . 1))
              (quote (172 . 0))
              (quote (173 . 1))
              (quote (174 . 0))
              (quote (175 . 1))
              (quote (176 . 1))
              (quote (91 . 0))
              (quote (178 . 0))
              (quote (145 . 0.0))
              (cons 140 (@:scale 2.5))
              (quote (92 . 0))
              (quote (301 . "CELL_VALUE"))
              (quote (93 . 6))
              (quote (90 . 0))
              (quote (94 . 0))
              (cons 300 "")
              (cons 302 "")
              (quote (304 . "ACVALUE_END")))))
        (setq i% (1+ i%)))
      (if headers (progn (foreach header% headers (setq list-dxf (append list-dxf (list (quote (171 . 1))
                  (quote (172 . 0))
                  (quote (173 . 0))
                  (quote (174 . 0))
                  (quote (175 . 1))
                  (quote (176 . 1))
                  (quote (91 . 262144))
                  (quote (178 . 0))
                  (quote (145 . 0.0))
                  (cons 140 (@:scale 2.5))
                  (quote (92 . 0))
                  (quote (301 . "CELL_VALUE"))
                  (quote (93 . 6))
                  (quote (90 . 4))
                  (cons 1 (@:to-string header%))
                  (quote (94 . 0))
                  (cons 300 "")
                  (cons 302 (@:to-string header%))
                  (quote (304 . "ACVALUE_END"))))))
          (if (< (length headers)
              columns)
            (setq i% 0)
            (while (< i% (- columns (length headers)))
              (setq list-dxf (append list-dxf (list (quote (171 . 1))
                    (quote (172 . 0))
                    (quote (173 . 0))
                    (quote (174 . 0))
                    (quote (175 . 1))
                    (quote (176 . 1))
                    (quote (91 . 262144))
                    (quote (178 . 0))
                    (quote (145 . 0.0))
                    (cons 140 (@:scale 2.5))
                    (quote (92 . 0))
                    (quote (301 . "CELL_VALUE"))
                    (quote (93 . 6))
                    (quote (90 . 4))
                    (cons 1 "")
                    (quote (94 . 0))
                    (cons 300 "")
                    (cons 302 "")
                    (quote (304 . "ACVALUE_END")))))
              (setq i% (1+ i%))))))
      (foreach row% mat-data (foreach column% row% (setq list-dxf (append list-dxf (list (quote (171 . 1))
                (quote (172 . 0))
                (quote (173 . 0))
                (quote (174 . 0))
                (quote (175 . 1))
                (quote (176 . 1))
                (quote (91 . 262144))
                (quote (178 . 0))
                (quote (145 . 0.0))
                (cons 140 (@:scale 2.5))
                (quote (92 . 0))
                (quote (301 . "CELL_VALUE"))
                (quote (93 . 6))
                (quote (90 . 4))
                (cons 1 (@:to-string column%))
                (quote (94 . 0))
                (cons 300 "")
                (cons 302 (@:to-string column%))
                (quote (304 . "ACVALUE_END"))))))
        (if (< (length row%)
            columns)
          (progn (setq i% 0)
            (while (< i% (- columns (length row%)))
              (setq list-dxf (append list-dxf (list (quote (171 . 1))
                    (quote (172 . 0))
                    (quote (173 . 0))
                    (quote (174 . 0))
                    (quote (175 . 1))
                    (quote (176 . 1))
                    (quote (91 . 262144))
                    (quote (178 . 0))
                    (quote (145 . 0.0))
                    (cons 140 (@:scale 2.5))
                    (quote (92 . 0))
                    (quote (301 . "CELL_VALUE"))
                    (quote (93 . 6))
                    (quote (90 . 4))
                    (cons 1 "")
                    (quote (94 . 0))
                    (cons 300 "")
                    (cons 302 "")
                    (quote (304 . "ACVALUE_END")))))
              (setq i% (1+ i%))))))
      (setq ent (entmakex list-dxf))
      (vla-settextheight (e2o ent)
        acdatarow (@:scale 2.5))
      (vla-settextheight (e2o ent)
        acheaderrow (@:scale 2.5))
      (vla-settextheight (e2o ent)
        actitlerow (@:scale 3.5))
      (vla-setalignment (e2o ent)
        acdatarow acmiddlecenter)
      ent)))
```
</details>

---

### table:read-csv

**è¯´æ˜**: è¯»å– csv æ–‡ä»¶ã€‚

**ç”¨æ³•**:
```lisp
(table:read-csv file)
```

**å‚æ•°**: 1 file  : æ–‡ä»¶å;

**è¿”å›å€¼**: äºŒç»´è¡¨

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun table:read-csv (file)
  "è¯»å– csv æ–‡ä»¶ã€‚"
  "äºŒç»´è¡¨"
  (vl-remove-if (quote (lambda (x)
        (and (= 1 (length x))
          (= ""
            (car x)))))
    (mapcar (quote (lambda (x)
          (string:to-list x ",")))
      (string:to-list (@:get-file-contents (findfile file))
        "\n"))))
```
</details>

---

### table:write-csv

**è¯´æ˜**: å°† äºŒç»´è¡¨ å†™å…¥ csv æ–‡ä»¶ã€‚

**ç”¨æ³•**:
```lisp
(table:write-csv lst file)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 file  : æ–‡ä»¶å;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun table:write-csv (lst file / fp *error*)
  "å°† äºŒç»´è¡¨ å†™å…¥ csv æ–‡ä»¶ã€‚"
  ""
  (defun *error* (msg)
    (if (= (quote file)
        (type fp))
      (close fp))
    (@:*error* msg))
  (setq fp (open file "w"))
  (foreach str-line (mapcar (quote (lambda (x)
          (string:from-list (mapcar (quote @:to-string)
              x)
            ",")))
      lst)
    (write-line str-line fp))
  (close fp)
  t)
```
</details>

---

## tbl

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### tbl:dxf2obj

**è¯´æ˜**: å°† tbl åç§°è½¬åŒ–ä¸º ActiveX å¯¹è±¡ Document çš„å±æ€§å(æŒ‡å‘å¯¹è±¡é›†çš„).

**ç”¨æ³•**:
```lisp
(tbl:dxf2obj tbl-name)
```

**å‚æ•°**: 1 tbl-name  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: symbol

**ç¤ºä¾‹**:
```lisp
(tbl:dxf2obj "layer")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun tbl:dxf2obj (tbl-name)
  "å°† tbl åç§°è½¬åŒ–ä¸º ActiveX å¯¹è±¡ Document çš„å±æ€§å(æŒ‡å‘å¯¹è±¡é›†çš„)."
  "symbol"
  "(tbl:dxf2obj \"layer\")"
  (read (cond ((string-equal tbl-name "APPID")
        "RegisteredApplications")
      ((string-equal tbl-name "LTYPE")
        "linetypes")
      ((string-equal tbl-name "STYLE")
        "textstyles")
      ((string-equal tbl-name "UCS")
        "UserCoordinateSystems")
      ((string-equal tbl-name "VPORT")
        "Viewports")
      (t (strcat tbl-name "s")))))
```
</details>

---

### tbl:list

**è¯´æ˜**: åˆ— DXFè¡¨æ ¼tblä¸­çš„é¡¹ç›®çš„åç§°ã€‚è¡¨æ ¼ä¸º:block,dimstyle,layer,linetype,textstyle,ucs,view,vport.ä¹Ÿæ”¯æŒå¦ç±»çš„layoutï¼Œlayout æœ¬è´¨æ˜¯å±æ€§ blockä¸­çš„åŒ¿åå— *Space# ç³»åˆ—å…¶è¿˜æœ‰ç±»ä¼¼ tbl çš„å¦‚ Materials, tablestyles,mleaderstyle,groups,dictionaries.

**ç”¨æ³•**:
```lisp
(tbl:list tbl-name)
```

**å‚æ•°**: 1 tbl-name  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: lst

**ç¤ºä¾‹**:
```lisp
(tbl:list "layout") ; => ("Model" "å¸ƒå±€1" "å¸ƒå±€2")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun tbl:list (tbl-name / tbl)
  "åˆ— DXFè¡¨æ ¼tblä¸­çš„é¡¹ç›®çš„åç§°ã€‚\nè¡¨æ ¼ä¸º:block,dimstyle,layer,linetype,textstyle,ucs,view,vport.\nä¹Ÿæ”¯æŒå¦ç±»çš„layoutï¼Œlayout æœ¬è´¨æ˜¯å±æ€§ blockä¸­çš„åŒ¿åå— *Space# ç³»åˆ—\nå…¶è¿˜æœ‰ç±»ä¼¼ tbl çš„å¦‚ Materials, tablestyles,mleaderstyle,groups,dictionaries."
  "lst"
  "(tbl:list \"layout\")
  ; => (\"Model\"
    \"å¸ƒå±€1\"
    \"å¸ƒå±€2\")"
  (setq tbl nil)
  (vlax-for item (vlax-get-property *doc* (tbl:dxf2obj tbl-name))
    (setq tbl (cons (vla-get-name item)
        tbl)))
  (reverse tbl))
```
</details>

---

### tbl:rename

**è¯´æ˜**: é‡å‘½åDXFè¡¨æ ¼tblä¸­çš„é¡¹ç›®çš„åç§°ã€‚ è¡¨æ ¼ä¸º:appid,block,dimstyle,layer,ltype,style,ucs,view,vport.æ³¨æ„ layout ä¸å±äº tbl çš„å†…å®¹ï¼Œä½†å±æ€§å¯¹è±¡é›†åˆã€‚è¯·ä½¿ç”¨ layout:rename å‡½æ•°ã€‚å‚æ•°:tbl-name tblè¡¨æ ¼å, old-name åŸåç§°ï¼Œnew-name æ–°åç§°

**ç”¨æ³•**:
```lisp
(tbl:rename tbl-name old-name new-name)
```

**å‚æ•°**: 1 tbl-name  : æœªè¯†åˆ«å®šä¹‰;2 old-name  : æœªè¯†åˆ«å®šä¹‰;3 new-name  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: T æˆåŠŸï¼Œnil å¤±è´¥

**ç¤ºä¾‹**:
```lisp
(tbl:rename "layout" "å¸ƒå±€1" "æˆ‘çš„å¸ƒå±€")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun tbl:rename (tbl-name old-name new-name)
  "é‡å‘½åDXFè¡¨æ ¼tblä¸­çš„é¡¹ç›®çš„åç§°ã€‚ è¡¨æ ¼ä¸º:appid,block,dimstyle,layer,ltype,style,ucs,view,vport.\næ³¨æ„ layout ä¸å±äº tbl çš„å†…å®¹ï¼Œä½†å±æ€§å¯¹è±¡é›†åˆã€‚è¯·ä½¿ç”¨ layout:rename å‡½æ•°ã€‚\nå‚æ•°:tbl-name tblè¡¨æ ¼å, old-name åŸåç§°ï¼Œnew-name æ–°åç§°"
  "T æˆåŠŸï¼Œnil å¤±è´¥"
  "(tbl:rename \"layout\"
    \"å¸ƒå±€1\"
    \"æˆ‘çš„å¸ƒå±€\")"
  (if (and (or (string-equal tbl-name "layout")
        (and (tblsearch tbl-name old-name)
          (not (tblsearch tbl-name new-name))))
      (snvalid new-name))
    (progn (if (vl-catch-all-error-p (vl-catch-all-apply (quote vla-put-name)
            (list (vla-item (vlax-get-property *doc* (tbl:dxf2obj tbl-name))
                old-name)
              new-name)))
        nil t))))
```
</details>

---

## text

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### text:box

**è¯´æ˜**: è·å–å•è¡Œæ–‡æœ¬çš„æ–‡æœ¬æ¡†

**ç”¨æ³•**:
```lisp
(text:box ent-text)
```

**å‚æ•°**: 1 ent-text  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: 4ç‚¹çŸ©å½¢æ¡†

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun text:box (ent-text / tbox box mrz mt)
  "è·å–å•è¡Œæ–‡æœ¬çš„æ–‡æœ¬æ¡†"
  "4ç‚¹çŸ©å½¢æ¡†"
  (setq tbox (apply (quote point:rec-2pt->4pt)
      (textbox (entget ent-text))))
  (setq r1 (- (entity:getdxf ent-text 50)))
  (setq pt-base (entity:getdxf ent-text 10))
  (setq mrz (list (list (setq cr1 (cos r1))
        (setq sr1 (sin r1))
        0 0)
      (list (- sr1)
        cr1 0 0)
      (list 0 0 1 0)
      (list 0 0 0 1)))
  (setq mt (list (list 1 0 0 (car pt-base))
      (list 0 1 0 (cadr pt-base))
      (list 0 0 1 (caddr pt-base))
      (list 0 0 0 1)))
  (mapcar (quote (lambda (x)
        (matrix:mxp mt (matrix:mxp mrz x))))
    tbox))
```
</details>

---

### text:from-markdown

**è¯´æ˜**: å°† markdown æ ¼å¼çš„æ–‡æœ¬è½¬åŒ–ä¸ºmtextæ ¼å¼

**ç”¨æ³•**:
```lisp
(text:from-markdown str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: String

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun text:from-markdown (str / lst-str str-tmp)
  "å°† markdown æ ¼å¼çš„æ–‡æœ¬è½¬åŒ–ä¸ºmtextæ ¼å¼"
  "String"
  (setq lst-str (string:to-list str "\n"))
  (defun handle-strong (str / tmp i res)
    (setq tmp (string:to-list str "**"))
    (setq i 0)
    (foreach unit% tmp (if (= 1 (rem i 2))
        (setq res (cons (strcat "{\\fSimHei|b0|i0|c134|p49;"
              unit% "}")
            res))
        (setq res (cons unit% res)))
      (setq i (1+ i)))
    (string:from-lst (reverse res)
      ""))
  (defun handle-header (str)
    (cond ((= "* "
          (substr str 1 2))
        (strcat "\\C2;Â· \\C3;"
          (substr str 3)))
      ((= "** "
          (substr str 1 3))
        (strcat "\\C2;Â·Â· \\C3;"
          (substr str 4)))
      ((= "*** "
          (substr str 1 4))
        (strcat "\\C2;Â·Â·Â· \\C3;"
          (substr str 5)))
      ((= "**** "
          (substr str 1 5))
        (strcat "\\C2;Â·Â·Â·Â· \\C3;"
          (substr str 6)))
      (t str)))
  (setq lst-str (mapcar (quote handle-header)
      lst-str))
  (setq lst-str (mapcar (quote handle-strong)
      lst-str))
  (string:from-list lst-str "\\P"))
```
</details>

---

### text:get-matrix

**è¯´æ˜**: ä»dwgå›¾ä¸­æ¡†å–å•è¡Œæ–‡æœ¬ï¼Œå½¢æˆäºŒç»´åˆ—è¡¨æ•°æ®

**ç”¨æ³•**:
```lisp
(text:get-matrix )
```

**å‚æ•°**: None

**è¿”å›å€¼**: ç”±å­—ç¬¦ä¸²ç»„æˆçš„äºŒç»´åˆ—è¡¨

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun text:get-matrix (/ ss-txt result lst-tmp row)
  "ä»dwgå›¾ä¸­æ¡†å–å•è¡Œæ–‡æœ¬ï¼Œå½¢æˆäºŒç»´åˆ—è¡¨æ•°æ®"
  "ç”±å­—ç¬¦ä¸²ç»„æˆçš„äºŒç»´åˆ—è¡¨"
  ""
  (setq ss-txt (pickset:to-list (ssget (quote ((0 . "text"))))))
  (setq ss-txt (vl-sort ss-txt (quote (lambda (x y)
          (or (and (equal (cadr (entity:getdxf x 10))
                (cadr (entity:getdxf y 10))
                (* 1.1 (entity:getdxf x 40)))
              (< (car (entity:getdxf x 10))
                (car (entity:getdxf y 10))))
            (> (cadr (entity:getdxf x 10))
              (+ (cadr (entity:getdxf y 10))
                (* 0.5 (entity:getdxf y 40)))))))))
  (setq result (quote nil))
  (setq lst-tmp (list (car ss-txt)))
  (while (setq ss-txt (cdr ss-txt))
    (if (equal (cadr (entity:getdxf (last lst-tmp)
            10))
        (cadr (entity:getdxf (car ss-txt)
            10))
        (* 0.3 (entity:getdxf (last lst-tmp)
            40)))
      (setq lst-tmp (append lst-tmp (list (car ss-txt))))
      (progn (setq result (append result (list lst-tmp)))
        (setq lst-tmp (list (car ss-txt))))))
  (setq result (append result (list lst-tmp)))
  (setq lst-tmp (cdr result))
  (setq result (list (car result)))
  (foreach row lst-tmp (if (= (length row)
        (length (car result)))
      (setq result (append result (list row)))
      (progn (setq i 0)
        (setq j 0)
        (setq row-tmp (quote nil))
        (repeat (length (car result))
          (if (equal (car (entity:getdxf (nth j row)
                  10))
              (car (entity:getdxf (nth i (car result))
                  10))
              (* 1.1 (entity:getdxf (nth i (car result))
                  40)))
            (progn (setq row-tmp (append row-tmp (list (nth j row))))
              (setq i (1+ i))
              (setq j (1+ j)))
            (progn (setq row-tmp (append row-tmp (list "")))
              (setq i (1+ i)))))
        (setq result (append result (list row-tmp))))))
  (mapcar (quote (lambda (x)
        (mapcar (quote (lambda (y)
              (if (= (quote ename)
                  (type y))
                (entity:getdxf y 1)
                y)))
          x)))
    result))
```
</details>

---

### text:get-mtext

**è¯´æ˜**: å–å¤šè¡Œæ–‡ä»¶çš„å†…å®¹ã€‚å½“å†…å®¹é•¿åº¦å¤§äº255æ—¶ï¼Œä¼šæœ‰å¤šä¸ªç»„ç  3.æœ¬å‡½æ•°ç”¨äºç»„åˆè¿™äº›å­—ç¬¦ä¸²ä¸ºä¸€æ•´ä½“ã€‚

**ç”¨æ³•**:
```lisp
(text:get-mtext en-mtext)
```

**å‚æ•°**: 1 en-mtext  : å•ä¸ªå›¾å…ƒ;

**è¿”å›å€¼**: å­—ç¬¦ä¸²

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun text:get-mtext (en-mtext / dxfs)
  "å–å¤šè¡Œæ–‡ä»¶çš„å†…å®¹ã€‚å½“å†…å®¹é•¿åº¦å¤§äº255æ—¶ï¼Œä¼šæœ‰å¤šä¸ªç»„ç  3.æœ¬å‡½æ•°ç”¨äºç»„åˆè¿™äº›å­—ç¬¦ä¸²ä¸ºä¸€æ•´ä½“ã€‚"
  "å­—ç¬¦ä¸²"
  ""
  (setq dxfs (entget en-mtext))
  (apply (quote strcat)
    (mapcar (quote cdr)
      (vl-remove-if (quote (lambda (x)
            (and (/= 3 (car x))
              (/= 1 (car x)))))
        dxfs))))
```
</details>

---

### text:gettextwidth

**ç”¨æ³•**:
```lisp
(text:gettextwidth str edata)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;  2 edata  : æœªæ˜ç¡®å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun text:gettextwidth (str edata / box1 bo2)
    (if (not str)
        (setq str (cdr (assoc 1 edata))))
    (setq box1 (textbox (list-substassoc (list (cons 1 (strcat "m"
                            str "m")))
                edata t)))
    (setq box2 (textbox (list-substassoc (list (cons 1 "mm"))
                edata t)))
    (- (- (caadr box1)
            (caar box1))
        (- (caadr box2)
            (caar box2))))
```
</details>

---

### text:mtext->text

**è¯´æ˜**: å»é™¤å¤šè¡Œæ–‡æœ¬ä¸­çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæœ¬å‡½æ•°ä¸ºæµ‹è¯•ç‰ˆï¼Œä¸ä¿è¯ç»“æœæ­£ç¡®ã€‚

**ç”¨æ³•**:
```lisp
(text:mtext->text str-m)
```

**å‚æ•°**: 1 str-m  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: ç»“æœå­—ç¬¦ä¸²

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun text:mtext->text (str-m / lst-str str-m% purge-fmt)
    "å»é™¤å¤šè¡Œæ–‡æœ¬ä¸­çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæœ¬å‡½æ•°ä¸ºæµ‹è¯•ç‰ˆï¼Œä¸ä¿è¯ç»“æœæ­£ç¡®ã€‚"
    "ç»“æœå­—ç¬¦ä¸²"
    (if (and (= "{"
                (substr str-m 1 1))
            (= "}"
                (substr str-m (strlen str-m)
                    1)))
        (@:list-to-string (mapcar (function (lambda (x)
                        (@:string-subst "
                            "
                            "\\p"
                            (if (or (/= "\\"
                                        (substr x 1 1))
                                    (= "\\p"
                                        (substr x 1 2)))
                                x ""))))
                (@:string-to-list (substr str-m 2 (- (strlen str-m)
                            2))
                    ";"))
            "")
        str-m))
```
</details>

---

### text:mtext->text2

**è¯´æ˜**: å»é™¤å¤šè¡Œæ–‡æœ¬ä¸­çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæœ¬å‡½æ•°ä¸ºæµ‹è¯•ç‰ˆï¼Œä¸ä¿è¯ç»“æœæ­£ç¡®ã€‚

**ç”¨æ³•**:
```lisp
(text:mtext->text2 str-m)
```

**å‚æ•°**: 1 str-m  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: ç»“æœå­—ç¬¦ä¸²

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun text:mtext->text2 (str-m / lst-str str-m% purge-fmt)
    "å»é™¤å¤šè¡Œæ–‡æœ¬ä¸­çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæœ¬å‡½æ•°ä¸ºæµ‹è¯•ç‰ˆï¼Œä¸ä¿è¯ç»“æœæ­£ç¡®ã€‚"
    "ç»“æœå­—ç¬¦ä¸²"
    (setq lst-str (string:parse-by-lst str-m (quote ("\\"
                    "{"
                    "}"))))
    (defun purge-fmt (str-m)
        (if (/= ""
                str-m)
            (cond ((and (/= "s"
                            (substr str-m 1 1))
                        (= ";"
                            (substr str-m (strlen str-m))))
                    (setq str-m ""))
                ((and (= "s"
                            (substr str-m 1 1))
                        (= ";"
                            (substr str-m (strlen str-m)))
                        (setq str-m (substr str-m 2 (- (strlen str-m)
                                    2)))))
                (t (setq str-m (substr str-m 2)))))
        (setq lst-str (string:to-list str-m ";"))
        (if (> (length lst-str)
                1)
            (setq str-m (last lst-str)))
        str-m)
    (string:from-list (vl-remove ""
            (mapcar (quote purge-fmt)
                lst-str))
        ""))
```
</details>

---

### text:parse-mtext

**è¯´æ˜**: è§£æå¤šè¡Œæ–‡æœ¬ä¸­çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œç›®å‰ä¸ºæµ‹è¯•ç‰ˆï¼Œä¸ä¿è¯ç»“æœå®Œå…¨æ­£ç¡®ã€‚

**ç”¨æ³•**:
```lisp
(text:parse-mtext str-m)
```

**å‚æ•°**: 1 str-m  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: ç»“æœè¡¨. ((fmt . t)(str)...(fmt . t)). æŸå•å…ƒä¸ºç‚¹å¯¹ä¸” (cdr å•å…ƒ) ä¸º t æ—¶è¡¨ç¤ºä¸ºæ ¼å¼ä¸²ï¼Œnil æ—¶ä¸ºçš„å†…å®¹ä¸²

**ç¤ºä¾‹**:
```lisp
(text:parse-mtext "\\A1;m{\\H0.7x;\\S3^;} {\\H0.7x;\\S^2;\\H1.4286x; aN\\KN BBB\\k  \\OOO \\oabc  \\P\\P\\fSimSun|b0|i0|c134|p2;sdfaf}")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun text:parse-mtext (str-m / flag flag-char str-list lst-res fmt% str%)
  "è§£æå¤šè¡Œæ–‡æœ¬ä¸­çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œç›®å‰ä¸ºæµ‹è¯•ç‰ˆï¼Œä¸ä¿è¯ç»“æœå®Œå…¨æ­£ç¡®ã€‚"
  "ç»“æœè¡¨. ((fmt . t)(str)...(fmt . t)). æŸå•å…ƒä¸ºç‚¹å¯¹ä¸” (cdr å•å…ƒ)
  ä¸º t æ—¶è¡¨ç¤ºä¸ºæ ¼å¼ä¸²ï¼Œnil æ—¶ä¸ºçš„å†…å®¹ä¸²"
  "(text:parse-mtext \"\\\\A1;m{\\\\H0.7x;\\\\S3^;} {\\\\H0.7x;\\\\S^2;\\\\H1.4286x; aN\\\\KN BBB\\\\k  \\\\OOO \\\\oabc  \\\\P\\\\P\\\\fSimSun|b0|i0|c134|p2;sdfaf}\")"
  (if (= (quote str)
      (type str-m))
    (progn (setq flag nil)
      (setq res nil)
      (setq str-list (vl-string->list str-m))
      (while (setq asc% (car str-list))
        (cond (flag (setq fmt% (cons asc% fmt%))
            (cond ((= ";"
                  (chr asc%))
                (setq flag nil)
                (setq flag-char nil)
                (setq lst-res (cons (cons fmt% t)
                    lst-res))
                (setq fmt% nil))
              ((and first (member (chr asc%)
                    (list "{"
                      "}"
                      (chr 92))))
                (setq flag nil)
                (setq fmt% nil)
                (setq str% (cons asc% str%)))
              ((and first (member (chr asc%)
                    (quote ("P"
                        "K"
                        "k"
                        "O"
                        "o"
                        "S"))))
                (setq flag nil)
                (setq flag-char (chr asc%))
                (setq lst-res (cons (cons fmt% t)
                    lst-res))
                (setq fmt% nil))
              (t))
            (setq first nil))
          ((= flag-char "S")
            (cond ((member (chr asc%)
                  (quote ("^")))
                (if str% (setq lst-res (cons (cons str% nil)
                      lst-res)))
                (setq str% nil)
                (setq lst-res (cons (cons (list asc%)
                      t)
                    lst-res)))
              ((member (chr asc%)
                  (quote (";")))
                (setq flag-char nil)
                (if str% (setq lst-res (cons (cons str% nil)
                      lst-res)))
                (setq str% nil)
                (setq lst-res (cons (cons (list asc%)
                      t)
                    lst-res)))
              (t (setq str% (cons asc% str%)))))
          ((member (chr asc%)
              (quote ("{")))
            (setq fmt% (cons asc% fmt%)))
          ((member (chr asc%)
              (quote ("}")))
            (if str% (setq lst-res (cons (cons str% nil)
                  lst-res)))
            (setq str% nil)
            (setq fmt% (cons asc% fmt%))
            (setq lst-res (cons (cons fmt% t)
                lst-res))
            (setq fmt% nil))
          ((= 92 asc%)
            (setq flag t)
            (setq first t)
            (setq fmt% (cons asc% fmt%))
            (if str% (setq lst-res (cons (cons str% nil)
                  lst-res)))
            (setq str% nil))
          (t (setq str% (cons asc% str%))))
        (setq str-list (cdr str-list)))
      (if str% (setq lst-res (cons str% lst-res)))
      (if fmt% (setq lst-res (cons fmt% lst-res)))
      (reverse (mapcar (quote (lambda (x)
              (if (atom (car x))
                (setq x (list x)))
              (cons (vl-list->string (reverse (if (listp (car x))
                      (car x)
                      (list x))))
                (cdr x))))
          lst-res)))
    nil))
```
</details>

---

### text:remove-fmt

**è¯´æ˜**: å»é™¤å¤šè¡Œæ–‡æœ¬ä¸­çš„æ ¼å¼åŒ–å­—ç¬¦ä¸².

**ç”¨æ³•**:
```lisp
(text:remove-fmt str-mtext)
```

**å‚æ•°**: 1 str-mtext  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: ç»“æœå­—ç¬¦ä¸²

**ç¤ºä¾‹**:
```lisp
(text:remove-fmt "\\A1;m{\\H0.7x;\\S3^;} {\\H0.7x;\\S^2;\\H1.4286x; aN\\KN BBB\\k  \\OOO \\oabc  \\P\\P\\fSimSun|b0|i0|c134|p2;sdfaf}")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun text:remove-fmt (str-mtext / res)
  "å»é™¤å¤šè¡Œæ–‡æœ¬ä¸­çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²."
  "ç»“æœå­—ç¬¦ä¸²"
  "(text:remove-fmt \"\\\\A1;m{\\\\H0.7x;\\\\S3^;} {\\\\H0.7x;\\\\S^2;\\\\H1.4286x; aN\\\\KN BBB\\\\k  \\\\OOO \\\\oabc  \\\\P\\\\P\\\\fSimSun|b0|i0|c134|p2;sdfaf}\")"
  (if (setq res (mapcar (quote car)
        (vl-remove-if (quote (lambda (x)
              (cdr x)))
          (text:parse-mtext str-mtext))))
    (apply (quote strcat)
      res)))
```
</details>

---

### text:stringexplode

**ç”¨æ³•**:
```lisp
(text:stringexplode str_given)
```

**å‚æ•°**: 1 str_given  : å­—ç¬¦ä¸²;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun text:stringexplode (str_given / strlst_defined strlst_defined2 str_defined i_length str_lst_return e)
    (while (> (strlen str_given)
            0)
        (cond ((and (> (strlen str_given)
                        2)
                    (setq startdefinednum (vl-string-search "%"
                            str_given 0))
                    (= startdefinednum 0))
                (if (setq againdefinednum (vl-string-search "%"
                            str_given (1+ startdefinednum)))
                    (if (member (substr str_given (+ startdefinednum 1)
                                3)
                            (quote ("%%o"
                                    "%%o"
                                    "%%u"
                                    "%%u"
                                    "%%p"
                                    "%%p"
                                    "%%c"
                                    "%%c"
                                    "%%d"
                                    "%%d"
                                    "%%%")))
                        (setq definedstr (substr str_given (+ startdefinednum 1)
                                3)
                            str_lst_return (cons definedstr str_lst_return)
                            str_given (substr str_given 4))
                        (setq definedstr (substr str_given (+ startdefinednum 1)
                                5)
                            str_lst_return (cons definedstr str_lst_return)
                            str_given (substr str_given 6)))))
            ((and (> (strlen str_given)
                        6)
                    (setq startdefinednum (vl-string-search "\\"
                            str_given flagnum))
                    (= startdefinednum 0))
                (if (setq againdefinednum (vl-string-search "u"
                            str_given (1+ startdefinednum)))
                    (if (member (substr str_given (+ startdefinednum 1)
                                8)
                            (quote ("\u+23f61"
                                    "\u+23f62"
                                    "\u+23f63"
                                    "\u+23f64"
                                    "\u+23f65"
                                    "\u+23f66"
                                    "\u+23f67"
                                    "\u+23f68"
                                    "\u+23f69")))
                        (setq definedstr (substr str_given (+ startdefinednum 1)
                                8)
                            str_lst_return (cons definedstr str_lst_return)
                            str_given (substr str_given 9))
                        (setq definedstr (substr str_given (+ startdefinednum 1)
                                7)
                            str_lst_return (cons definedstr str_lst_return)
                            str_given (substr str_given 8)))))
            ((> (ascii (substr str_given 1 1))
                    128)
                (setq str_lst_return (cons (substr str_given 1 2)
                        str_lst_return))
                (setq str_given (substr str_given 3)))
            (t (setq str_lst_return (cons (substr str_given 1 1)
                        str_lst_return))
                (setq str_given (substr str_given 2)))))
    (reverse str_lst_return))
```
</details>

---

## timer

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### timer:begin

**è¯´æ˜**: è®¡æ—¶å™¨å¼€å§‹

**ç”¨æ³•**:
```lisp
(timer:begin )
```

**å‚æ•°**: æ²¡æœ‰ä¸€ä¸ª

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun timer:begin nil "è®¡æ—¶å™¨å¼€å§‹"
  (if (> (@::acadver)
      21.9)
    (setq *timer* (getvar "millisecs"))
    (setq *timer* (getvar "TDUSRTIMER"))))
```
</details>

---

### timer:end

**è¯´æ˜**: è®¡æ—¶å™¨ç»“æŸã€‚time å¼€å§‹æ—¶é—´ p æ˜¯å¦æ‰“å°ã€‚

**ç”¨æ³•**:
```lisp
(timer:end time p)
```

**å‚æ•°**: 1 time  : æœªè¯†åˆ«å®šä¹‰;2 p  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun timer:end (time p / usetime)
  "è®¡æ—¶å™¨ç»“æŸã€‚time å¼€å§‹æ—¶é—´ p æ˜¯å¦æ‰“å°ã€‚"
  (if (not time)
    (setq time *timer*))
  (if (> (@::acadver)
      21.9)
    (setq usetime (- (getvar "millisecs")
        time))
    (setq usetime (* 86400000 (- (getvar "TDUSRTIMER")
          time))))
  (if p (print (strcat "use time: "
        (rtos usetime 2 0)
        "
        micro second.")))
  usetime)
```
</details>

---

## ui

**æ¨¡å—è¯´æ˜**: ç”¨æˆ·ç•Œé¢ã€å¯¹è¯æ¡†

### ui:button-select

**è¯´æ˜**: æ˜¾ç¤ºæŒ‰é’®åˆ—è¡¨é€‰æ‹©é¢æ¿ã€‚é€‰æ‹©æ‰€éœ€é¡¹å¹¶è¿”å›ï¼Œæ— éœ€ç‚¹å‡»ç¡®å®šã€‚

**ç”¨æ³•**:
```lisp
(ui:button-select str-subject lst)
```

**å‚æ•°**: 1 str-subject  : å­—ç¬¦ä¸²;2 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: é€‰ä¸­çš„å†…å®¹

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:button-select (str-subject lst / dcl_fp dcl-tmp dcl_id para% result initget%)
  "æ˜¾ç¤ºæŒ‰é’®åˆ—è¡¨é€‰æ‹©é¢æ¿ã€‚\né€‰æ‹©æ‰€éœ€é¡¹å¹¶è¿”å›ï¼Œæ— éœ€ç‚¹å‡»ç¡®å®šã€‚"
  "é€‰ä¸­çš„å†…å®¹"
  ""
  (setq result nil)
  (if lst (if (= 1 (getvar "filedia"))
      (progn (progn (setq dcl-tmp (strcat @:*tmp-path* "tmp-bselect.dcl"))
          (setq dcl_fp (open dcl-tmp "w"))
          (write-line (strcat "select : dialog {"
              "label = \""
              str-subject "\"; "
              ":column {label=\""
              str-subject "\"; ")
            dcl_fp)
          (setq i% 1)
          (setq bt-width 18)
          (foreach opt% lst (write-line (strcat ":button{ fixed_width=true; width="
                (itoa bt-width)
                ";key=\"S_"
                (itoa i%)
                "\";label=\""
                opt% "\";action=\"(setq result \\\""
                  opt% "\\\")(done_dialog)\";}")
              dcl_fp)
            (setq i% (1+ i%)))
          (write-line "} :spacer {} ok_cancel; }"
            dcl_fp)
          (close dcl_fp))
        (setq dcl_id (load_dialog dcl-tmp))
        (if (not (new_dialog "select"
              dcl_id))
          (exit))
        (action_tile "accept"
          "(done_dialog 1)")
        (start_dialog)
        (unload_dialog dcl_id)
        (vl-file-delete dcl-tmp)
        result)
      (progn (setq i% 0)
        (setq opt% ""
          initget% "0")
        (foreach lst% lst (setq opt% (strcat opt% (itoa (1+ i%))
              ":"
              lst% "\n"))
          (setq initget% (strcat initget% "\n              "
              (itoa (1+ i%))))
          (setq i% (1+ i%)))
        (initget 1 initget%)
        (nth (1- (atoi (getkword (strcat "è¯·è¾“å…¥è¦æ“ä½œçš„åºå· : \n"
                  opt%))))
          lst)))
    (progn (alert (_ "parameter is nil."))
      nil)))
```
</details>

---

### ui:confirm

**è¯´æ˜**: ç¡®è®¤å¯¹è¯æ¡†. å‚æ•°ï¼šlst-str å•ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ–å­—ç¬¦ä¸²åˆ—è¡¨ã€‚

**ç”¨æ³•**:
```lisp
(ui:confirm lst-str)
```

**å‚æ•°**: 1 lst-str  : åˆ—è¡¨;

**è¿”å›å€¼**: T or nil

**ç¤ºä¾‹**:
```lisp
(ui:confirm "ä½ é‡åˆ°çœŸçˆ±äº†å—?")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:confirm (lst-str / *error* result dcl-fp dcl-tmp)
  "ç¡®è®¤å¯¹è¯æ¡†. å‚æ•°ï¼šlst-str å•ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ–å­—ç¬¦ä¸²åˆ—è¡¨ã€‚"
  "T or nil"
  "(ui:confirm \"ä½ é‡åˆ°çœŸçˆ±äº†å—?\")"
  (defun *error* (msg)
    (if (= (quote file)
        (type dcl-fp))
      (close dcl-fp))
    (vl-file-delete dcl-tmp)
    (prin1 msg))
  (setq result nil)
  (setq dcl-tmp (strcat @:*prefix* "tmp-confirm.dcl"))
  (setq dcl-fp (open dcl-tmp "w"))
  (write-line "confirm :dialog{label=\"Confirm\";:spacer{}:column{"
    dcl-fp)
  (if (not (listp lst-str))
    (setq lst-str (list lst-str)))
  (foreach str (mapcar (quote @:to-string)
      lst-str)
    (write-line (strcat ":text{label="
        (chr 34)
        (string::subst-dqm str)
        "\";}")
      dcl-fp))
  (write-line "} :spacer{} ok_cancel;}"
    dcl-fp)
  (close dcl-fp)
  (setq dcl_id (load_dialog dcl-tmp))
  (if (not (new_dialog "confirm"
        dcl_id ""))
    (exit))
  (action_tile "accept"
    "(setq result T)(done_dialog 1)")
  (start_dialog)
  (unload_dialog dcl_id)
  (vl-file-delete dcl-tmp)
  result)
```
</details>

---

### ui:confirm1

**è¯´æ˜**: ç¡®è®¤å¯¹è¯æ¡†1. å‚æ•°ï¼šlst-str å•ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ–å­—ç¬¦ä¸²åˆ—è¡¨ã€‚å‚æ•° str-Yes-No å­—ç¬¦ä¸²ç”¨ - åˆ†éš”æˆä¸¤éƒ¨åˆ†ï¼Œå‰é¢ä¸ºaccept,åé¢ä¸º Cancel.å¦‚ æ˜¯-å¦ï¼Œæ„¿æ„-ä¸æ„¿æ„ã€‚

**ç”¨æ³•**:
```lisp
(ui:confirm1 lst-str str-yes-no)
```

**å‚æ•°**: 1 lst-str  : åˆ—è¡¨;2 str-yes-no  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: T or nil

**ç¤ºä¾‹**:
```lisp
(ui:confirm1 '("ä½ å®¶é—¨å£æœ‰ä¸¤åŒé‹ã€‚"      "ä¸€åŒæ˜¯ä½ çš„ã€‚"      "å¦ä¸€åŒä¹Ÿæ˜¯ä½ çš„ã€‚"      "ä½ æ„Ÿè§‰å­¤ç‹¬å—ï¼Ÿ")    "æ˜¯-å¦")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:confirm1 (lst-str str-yes-no / *error* result dcl-fp dcl-tmp)
  "ç¡®è®¤å¯¹è¯æ¡†1.\n å‚æ•°ï¼šlst-str å•ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ–å­—ç¬¦ä¸²åˆ—è¡¨ã€‚\nå‚æ•° str-Yes-No å­—ç¬¦ä¸²ç”¨ - åˆ†éš”æˆä¸¤éƒ¨åˆ†ï¼Œå‰é¢ä¸ºaccept,åé¢ä¸º Cancel.å¦‚ æ˜¯-å¦ï¼Œæ„¿æ„-ä¸æ„¿æ„ã€‚"
  "T or nil"
  "(ui:confirm1 '(\"ä½ å®¶é—¨å£æœ‰ä¸¤åŒé‹ã€‚\"\n      \"ä¸€åŒæ˜¯ä½ çš„ã€‚\"\n      \"å¦ä¸€åŒä¹Ÿæ˜¯ä½ çš„ã€‚\"\n      \"ä½ æ„Ÿè§‰å­¤ç‹¬å—ï¼Ÿ\")\n    \"æ˜¯-å¦\")"
  (setq @:this (quote ui:confirm1))
  (defun *error* (msg)
    (if (= (quote file)
        (type dcl-fp))
      (close dcl-fp))
    (vl-file-delete dcl-tmp)
    (@:*error* msg))
  (if (= (quote str)
      (type lst-str))
    (setq lst-str (list lst-str)))
  (dcl:dialog "confirm")
  (dcl:mtext "mt"
    (length lst-str)
    (max (apply (quote max)
        (mapcar (quote string:bytelength)
          lst-str))
      50))
  (dcl:end-dialog str-yes-no)
  "3. Control åˆ›å»ºæ§åˆ¶æµç¨‹"
  (dcl:new "confirm")
  (set_tile "title"
    "è¯·ç¡®è®¤ä»¥ä¸‹äº‹é¡¹")
  (dcl:set-mtext "mt"
    (string:from-list lst-str "\n"))
  "6. Show dialog æ˜¾ç¤ºå¹¶è¿›è¡Œäº¤äº’"
  (if (> (dcl:show)
      0)
    t nil))
```
</details>

---

### ui:dyndraw

**è¯´æ˜**: åŠ¨æ€ç»˜å›¾ï¼Œentséšå…‰æ ‡ç§»åŠ¨ï¼ŒæŒ‰å·¦é”®å®šä½ï¼Œå³é”®åˆ é™¤

**ç”¨æ³•**:
```lisp
(ui:dyndraw ents pt-base)
```

**å‚æ•°**: 1 ents  : å›¾å…ƒåˆ—è¡¨;2 pt-base  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**ç¤ºä¾‹**:
```lisp
(ui:dyndraw (ssget)(getpoint))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:dyndraw (ents pt-base / flag r *error*)
  "åŠ¨æ€ç»˜å›¾ï¼Œentséšå…‰æ ‡ç§»åŠ¨ï¼ŒæŒ‰å·¦é”®å®šä½ï¼Œå³é”®åˆ é™¤"
  ""
  "(ui:dyndraw (ssget)(getpoint))"
  (defun *error* (msg)
    (if ents (progn (if (= (quote ename)
            (type ents))
          (setq ents (list ents)))
        (if (= (quote pickset)
            (type ents))
          (setq ents (pickset:to-list ents)))
        (if (p:ename-listp ents)
          (mapcar (quote entdel)
            ents))))
    (princ msg))
  (if (= (quote ename)
      (type ents))
    (setq ents (list ents)))
  (if (= (quote pickset)
      (type ents))
    (setq ents (pickset:to-list ents)))
  (setq flag t)
  (if (p:ename-listp ents)
    (progn (while flag (setq gr (grread t 16))
        (cond ((= 3 (car gr))
            "æŒ‰ä¸‹é¼ æ ‡å·¦é”®"
            (setq flag nil))
          ((or (= 25 (car gr))
              (= 11 (car gr)))
            "æŒ‰ä¸‹é¼ æ ‡å³é”®"
            (mapcar (quote entdel)
              ents)
            (setq ents nil)
            (setq flag nil))
          ((= 5 (car gr))
            "ç§»åŠ¨é¼ æ ‡"
            (mapcar (function (lambda (x)
                  (vla-move (e2o x)
                    (point:to-ax pt-base)
                    (point:to-ax (cadr gr)))))
              ents)
            (setq pt-base (cadr gr)))
          (t "å…¶å®ƒæƒ…å†µ"
            (princ gr))))
      ents)))
```
</details>

---

### ui:dynquery

**è¯´æ˜**: åŠ¨æ€æŸ¥è¯¢ã€‚æ˜¾ç¤º func è¿”å›çš„æ–‡æœ¬åˆ—è¡¨ã€‚func æ˜¯å¯¹å…‰æ ‡æ‰€åœ¨å›¾å…ƒè¿›è¡Œçš„è¿ç®—ç»“æœã€‚nå½¢å¼å¦‚ '(lambda (x) (list (entity:getdxf x 0)))

**ç”¨æ³•**:
```lisp
(ui:dynquery func)
```

**å‚æ•°**: 1 func  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: nil,æ‰§è¡Œè¿‡ç¨‹åŠ¨æ€æ˜¾ç¤ºç”¨æˆ·å®šä¹‰çš„å†…å®¹

**ç¤ºä¾‹**:
```lisp
(ui:dynquery '(lambda (x) (list (entity:getdxf x '(0 8)))))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:dynquery (func / *error* dxf fx add_background add_box add_text display olderr oldos oldfill ss pd gr pt ent entold)
  "åŠ¨æ€æŸ¥è¯¢ã€‚æ˜¾ç¤º func è¿”å›çš„æ–‡æœ¬åˆ—è¡¨ã€‚func æ˜¯å¯¹å…‰æ ‡æ‰€åœ¨å›¾å…ƒè¿›è¡Œçš„è¿ç®—ç»“æœã€‚\nå½¢å¼å¦‚ '(lambda (x)
    (list (entity:getdxf x 0)))"
  "nil,æ‰§è¡Œè¿‡ç¨‹åŠ¨æ€æ˜¾ç¤ºç”¨æˆ·å®šä¹‰çš„å†…å®¹"
  "(ui:dynquery '(lambda (x)
      (list (entity:getdxf x '(0 8)))))"
  (defun *error* (msg / i%)
    (if (> (sslength ss)
        0)
      (mapcar (quote entdel)
        (pickset:to-list ss)))
    (print msg)
    (pop-var)
    (princ))
  (defun fx (ang)
    (cond ((>= (/ pi 2)
          ang 0)
        (list pi (+ pi (/ pi 2))
          1))
      ((>= pi ang (/ pi 2))
        (list 0 (+ pi (/ pi 2))
          1))
      ((>= (+ pi (/ pi 2))
          ang pi)
        (list 0 (/ pi 2)
          0))
      ((>= (* 2 pi)
          ang (+ pi (/ pi 2)))
        (list pi (/ pi 2)
          0))))
  (defun add_background (p1 p2 p3 p4)
    (entmakex (list (cons 0 "SOLID")
        (cons 100 "AcDbEntity")
        (cons 62 8)
        (cons 100 "AcDbTrace")
        (cons 10 p1)
        (cons 11 p4)
        (cons 12 p2)
        (cons 13 p3))))
  (defun add_box (pts / dxfcodes)
    (setq dxfcodes (list (cons 0 "LWPOLYLINE")
        (cons 100 "AcDbEntity")
        (cons 100 "AcDbPolyline")
        (cons 62 2)
        (cons 90 (length pts))
        (cons 70 1)
        (cons 43 0)
        (cons 38 0.0)
        (cons 39 0.0)))
    (foreach pt% pts (setq dxfcodes (append dxfcodes (list (cons 10 pt%)
            (cons 40 0.0)
            (cons 41 0.0)
            (cons 42 0.0)
            (cons 91 0)))))
    (entmakex (append dxfcodes (list (quote (210 0.0 0.0 1.0))))))
  (defun add_text (pt h ang txt style jus)
    (entmakex (list (cons 0 "TEXT")
        (cons 100 "AcDbEntity")
        (cons 62 2)
        (cons 100 "AcDbText")
        (if (= jus 0)
          (cons 10 pt)
          (list 10 0.0 0.0 0.0))
        (cons 40 h)
        (cons 1 txt)
        (cons 50 ang)
        (cons 7 style)
        (cons 72 (cond ((= jus 0)
              0)
            ((= jus 1)
              1)
            ((= jus 2)
              1)
            ((= jus 3)
              2)))
        (if (= jus 0)
          (list 11 0.0 0.0 0.0)
          (cons 11 pt))
        (cons 100 "AcDbText")
        (cons 73 (cond ((= jus 0)
              0)
            ((= jus 1)
              2)
            ((= jus 2)
              3)
            ((= jus 3)
              2))))))
  (defun display (ent func / obj laynm name st1 st2 st3 lst h ang n box-pts text-style)
    (setq text-style "vitalhz")
    (if (null (tblsearch "style"
          text-style))
      (setq text-style (getvar "textstyle")))
    (setq obj (vlax-ename->vla-object ent))
    (setq laynm (strcat "å›¾å±‚:"
        (entity:getdxf ent 8)))
    (setq name (entity:getdxf ent 0))
    (setq lst (func ent))
    (if (= (quote str)
        (type lst))
      (setq lst (list lst)))
    (if (or (null lst)
        (not (listp lst)))
      (setq lst (list "Error! Not defined function.")))
    (setq lst (vl-remove nil lst))
    (setq lst (mapcar (quote @:to-string)
        lst))
    (setq ss (ssadd))
    (setq h (/ (getvar "viewsize")
        40))
    (setq ang (fx (angle (getvar "viewctr")
          pt)))
    (setq n (* 1.4 (1+ (/ (apply (quote max)
              (mapcar (quote strlen)
                lst))
            2.0))))
    (setq box-pts (list pt (setq st1 (polar pt (* 1.5 pi)
            (+ h (* 1.8 h (1+ (length lst))))))
        (polar st1 0 (* n h))
        (polar pt 0 (* n h))))
    (ssadd (apply (quote add_background)
        box-pts)
      ss)
    (ssadd (add_box box-pts)
      ss)
    (setq st2 (polar pt 0 (/ (* n h)
          2)))
    (setq n -1)
    (repeat (length lst)
      (ssadd (add_text (setq st2 (polar st2 (* 1.5 pi)
              (* 1.8 h)))
          h 0 (nth (setq n (1+ n))
            lst)
          text-style 1)
        ss)))
  (push-var)
  (command "_.undo"
    "_m")
  (prompt "\n*** Move cursor to entity for show infomationï¼***")
  (setvar "osmode"
    0)
  (setvar "fillmode"
    1)
  (setvar "cmdecho"
    0)
  (setq ss (ssadd))
  (while (and (setq gr (grread t 1))
      (= (car gr)
        5))
    (if (and (listp (cadr gr))
        (> (length (cadr gr))
          1)
        (setq pt (cadr gr))
        (setq respt (nentselp (cadr gr)))
        (setq ent (if (= (type (last (last respt)))
              (quote ename))
            (last (last respt))
            (car respt)))
        (not (equal ent entold))
        (not (ssmemb ent ss)))
      (progn (if entold (redraw entold 4))
        (if (> (sslength ss)
            0)
          (mapcar (quote entdel)
            (pickset:to-list ss)))
        (redraw ent 3)
        (display ent (eval func))
        (setq entold ent))))
  (if entold (redraw entold 4))
  (if (> (sslength ss)
      0)
    (mapcar (quote entdel)
      (pickset:to-list ss)))
  (pop-var)
  (princ))
```
</details>

---

### ui:dynrotate

**è¯´æ˜**: åŠ¨æ€ç»˜å›¾ï¼Œentséšå…‰æ ‡æ—‹è½¬ï¼ŒæŒ‰å·¦é”®å®šä½ï¼Œå³é”®åˆ é™¤

**ç”¨æ³•**:
```lisp
(ui:dynrotate ents pt-base)
```

**å‚æ•°**: 1 ents  : å›¾å…ƒåˆ—è¡¨;2 pt-base  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**ç¤ºä¾‹**:
```lisp
(ui:dynrotate (ssget)(getpoint))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:dynrotate (ents pt-base / flag r)
  "åŠ¨æ€ç»˜å›¾ï¼Œentséšå…‰æ ‡æ—‹è½¬ï¼ŒæŒ‰å·¦é”®å®šä½ï¼Œå³é”®åˆ é™¤"
  ""
  "(ui:dynrotate (ssget)(getpoint))"
  (if (= (quote ename)
      (type ents))
    (setq ents (list ents)))
  (if (= (quote pickset)
      (type ents))
    (setq ents (pickset:to-list ents)))
  (setq flag t)
  (setq ang-base 0)
  (while flag (setq gr (grread t 16))
    (cond ((= 3 (car gr))
        "æŒ‰ä¸‹é¼ æ ‡å·¦é”®"
        (setq flag nil))
      ((or (= 25 (car gr))
          (= 11 (car gr)))
        "æŒ‰ä¸‹é¼ æ ‡å³é”®"
        (mapcar (quote entdel)
          ents)
        (setq flag nil))
      ((= 5 (car gr))
        "ç§»åŠ¨é¼ æ ‡"
        (mapcar (function (lambda (x)
              (vla-rotate (e2o x)
                (point:to-ax pt-base)
                (- (angle pt-base (cadr gr))
                  ang-base))))
          ents)
        (setq ang-base (angle pt-base (cadr gr)))
        (princ "\n")
        (princ (angtos ang-base 0 3)))
      (t "å…¶å®ƒæƒ…å†µ"
        (princ gr))))
  (princ))
```
</details>

---

### ui:dynscale

**è¯´æ˜**: åŠ¨æ€ç»˜å›¾ï¼Œentséšå…‰æ ‡ç¼©æ”¾ï¼ŒæŒ‰å·¦é”®å®šä½ï¼Œå³é”®åˆ é™¤

**ç”¨æ³•**:
```lisp
(ui:dynscale ents pt-base)
```

**å‚æ•°**: 1 ents  : å›¾å…ƒåˆ—è¡¨;2 pt-base  : å•ä¸ª2D/3Dåæ ‡ç‚¹;

**ç¤ºä¾‹**:
```lisp
(ui:dynscale (ssget)(getpoint))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:dynscale (ents pt-base / flag r)
  "åŠ¨æ€ç»˜å›¾ï¼Œentséšå…‰æ ‡ç¼©æ”¾ï¼ŒæŒ‰å·¦é”®å®šä½ï¼Œå³é”®åˆ é™¤"
  ""
  "(ui:dynscale (ssget)(getpoint))"
  (if (= (quote ename)
      (type ents))
    (setq ents (list ents)))
  (if (= (quote pickset)
      (type ents))
    (setq ents (pickset:to-list ents)))
  (setq scale-base 1)
  (setq flag t)
  (while flag (setq gr (grread t 16))
    (cond ((= 3 (car gr))
        "æŒ‰ä¸‹é¼ æ ‡å·¦é”®"
        (setq flag nil))
      ((or (= 25 (car gr))
          (= 11 (car gr)))
        "æŒ‰ä¸‹é¼ æ ‡å³é”®"
        (mapcar (quote entdel)
          ents)
        (setq flag nil))
      ((= 5 (car gr))
        "ç§»åŠ¨é¼ æ ‡"
        (mapcar (function (lambda (x)
              (vla-scaleentity (e2o x)
                (point:to-ax pt-base)
                (/ (* 0.001 (distance pt-base (cadr gr)))
                  scale-base))))
          ents)
        (setq scale-base (* 0.001 (distance pt-base (cadr gr)))))
      (t "å…¶å®ƒæƒ…å†µ"
        (princ gr))))
  (princ))
```
</details>

---

### ui:getdist

**è¯´æ˜**: å½“æŒ‰ä¸‹é”®ç›˜æ•°å­—é”®æ—¶ï¼Œè¿”å›æ•°å€¼ï¼Œå½“é¼ æ ‡å·¦é”®ç‚¹å–æ–‡å­—æˆ–æ ‡æ³¨æ—¶ï¼Œå–æ–‡å­—æˆ–æ ‡æ³¨çš„å€¼ã€‚

**ç”¨æ³•**:
```lisp
(ui:getdist msg)
```

**å‚æ•°**: 1 msg  : æç¤ºä¿¡æ¯;

**è¿”å›å€¼**: Number

**ç¤ºä¾‹**:
```lisp
(ui:getdist "Please input number or select text/dimension")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:getdist (msg / flag sn ents ss)
  "å½“æŒ‰ä¸‹é”®ç›˜æ•°å­—é”®æ—¶ï¼Œè¿”å›æ•°å€¼ï¼Œå½“é¼ æ ‡å·¦é”®ç‚¹å–æ–‡å­—æˆ–æ ‡æ³¨æ—¶ï¼Œå–æ–‡å­—æˆ–æ ‡æ³¨çš„å€¼ã€‚"
  "Number"
  "(ui:getdist \"Please input number or select text/dimension\")"
  (princ msg)
  (setq sn "")
  (setq flag t)
  (while flag (setq gr (grread t 16))
    "å¤„ç†è¾“å…¥"
    (cond ((= 2 (car gr))
        "æŒ‰ä¸‹äº†é”®ç›˜æŒ‰é”®"
        (cond ((member (cadr gr)
              (vl-string->list "0123456789."))
            "æŒç»­è¾“å…¥æ•°å­—é”®"
            (setq sn (strcat sn (chr (cadr gr))))
            (princ (chr (cadr gr))))
          ((member (cadr gr)
              (quote (13 32)))
            "å›è½¦ æˆ–ç©ºæ ¼ï¼Œè¿”å›è¾“å…¥çš„å€¼"
            (princ "\n")
            (setq flag nil))))
      ((= 3 (car gr))
        "æŒ‰ä¸‹é¼ æ ‡å·¦é”®ï¼Œé€‰ä¸­å›¾å…ƒï¼Œè¯»å€¼"
        (setq ents (pickset:to-list (ssget (cadr gr)
              (quote ((0 . "DIM*,TEXT"))))))
        (if ents (progn (if (/= (entity:getdxf (car ents)
                  1)
                "")
              (setq sn (entity:getdxf (car ents)
                  1))
              (if (entity:getdxf (car ents)
                  42)
                (setq sn (entity:getdxf (car ents)
                    42))))
            (setq flag nil))))
      ((= 5 (car gr))
        "ç§»åŠ¨é¼ æ ‡,é«˜äº®å›¾å…ƒ"
        (if ss (redraw (ssname ss 0)
            4))
        (setq ss (ssget (cadr gr)
            (quote ((0 . "DIM*,TEXT")))))
        (if ss (redraw (ssname ss 0)
            3)))))
  (if (= (quote str)
      (type sn))
    (atof sn)
    (if (numberp sn)
      sn)))
```
</details>

---

### ui:getstring

**è¯´æ˜**: å½“æŒ‰ä¸‹é”®ç›˜å­—ç¬¦é”®æ—¶ï¼Œè¿”å›å­—ç¬¦ä¸²ï¼Œå½“é¼ æ ‡å·¦é”®ç‚¹å–æ–‡å­—æˆ–æ ‡æ³¨æ—¶ï¼Œå–æ–‡å­—æˆ–æ ‡æ³¨çš„å€¼ã€‚

**ç”¨æ³•**:
```lisp
(ui:getstring msg)
```

**å‚æ•°**: 1 msg  : æç¤ºä¿¡æ¯;

**è¿”å›å€¼**: String

**ç¤ºä¾‹**:
```lisp
(ui:getstring "Please input string or select text/dimension")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:getstring (msg / flag sn ents ss)
  "å½“æŒ‰ä¸‹é”®ç›˜å­—ç¬¦é”®æ—¶ï¼Œè¿”å›å­—ç¬¦ä¸²ï¼Œå½“é¼ æ ‡å·¦é”®ç‚¹å–æ–‡å­—æˆ–æ ‡æ³¨æ—¶ï¼Œå–æ–‡å­—æˆ–æ ‡æ³¨çš„å€¼ã€‚"
  "String"
  "(ui:getstring \"Please input string or select text/dimension\")"
  (princ msg)
  (setq sn "")
  (setq flag t)
  (while flag (setq gr (grread t 16))
    "å¤„ç†è¾“å…¥"
    (cond ((= 2 (car gr))
        "æŒ‰ä¸‹äº†é”®ç›˜æŒ‰é”®"
        (cond ((member (cadr gr)
              (quote (13 32)))
            "å›è½¦ æˆ–ç©ºæ ¼ï¼Œè¿”å›è¾“å…¥çš„å€¼"
            (princ "\n")
            (setq flag nil))
          (t "æŒç»­è¾“å…¥å­—ç¬¦"
            (setq sn (strcat (chr (cadr gr))
                (getstring (chr (cadr gr)))))
            (setq flag nil))))
      ((= 3 (car gr))
        "æŒ‰ä¸‹é¼ æ ‡å·¦é”®ï¼Œé€‰ä¸­å›¾å…ƒï¼Œè¯»å€¼"
        (setq ents (pickset:to-list (ssget (cadr gr)
              (quote ((0 . "DIM*,TEXT"))))))
        (if ents (progn (if (/= (entity:getdxf (car ents)
                  1)
                "")
              (setq sn (entity:getdxf (car ents)
                  1))
              (if (entity:getdxf (car ents)
                  42)
                (setq sn (entity:getdxf (car ents)
                    42))))
            (if (> (strlen sn)
                0)
              (setq flag nil)))))
      ((= 5 (car gr))
        "ç§»åŠ¨é¼ æ ‡,é«˜äº®å›¾å…ƒ"
        (if ss (redraw (ssname ss 0)
            4))
        (setq ss (ssget (cadr gr)
            (quote ((0 . "DIM*,TEXT")))))
        (if ss (redraw (ssname ss 0)
            3)))))
  sn)
```
</details>

---

### ui:input

**è¯´æ˜**: æ˜¾ç¤ºè¾“å…¥ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡æœ¬è¾“å…¥çš„é¢æ¿ï¼Œè¿”å›æ‰€æœ‰æ–‡æœ¬æ¡†çš„å€¼ã€‚lst ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—è¡¨ç»„æˆ     æ¯ä¸ªå…ƒç´ ç”± (label é»˜è®¤å€¼ è¯´æ˜ æ˜¯å¦å¯†æ–‡/åˆ—è¡¨åŠåˆ—è¡¨é»˜è®¤åºå·(ä»¥0å¼€å§‹))  ç»„æˆ ã€‚label ä¸å¯çœç•¥ï¼Œé»˜è®¤å€¼ã€è¯´æ˜å’Œå¯†æ–‡/åºå· å¯çœç•¥ã€‚å½“ä¸º <*> æ—¶ï¼Œä¸ºç‰¹æ®Šå¤„ç†ç¬¦å·ï¼Œå¦‚  æ°´å¹³çº¿ï¼Œ å•è¡Œæ–‡æœ¬ã€‚é»˜è®¤å€¼(ç¬¬äºŒé¡¹):    å½“æ²¡æœ‰é»˜è®¤å€¼åŠä»¥åå„é¡¹æ—¶ï¼Œæ˜¾ç¤ºä¸ºæ–‡æœ¬ç¼–è¾‘æ¡†    å½“ä¸ºæ•°å€¼å‹å’Œå­—ç¬¦ä¸²æ—¶ï¼Œä¸”ç¬¬4é¡¹ä¸ä¸ºåˆ—è¡¨æ—¶æ˜¾ç¤ºæ–‡æœ¬ç¼–è¾‘æ¡†    å½“ä¸ºæ•°å€¼å‹å’Œå­—ç¬¦ä¸²æ—¶ï¼Œä¸”ç¬¬4é¡¹ä¸ºåˆ—è¡¨æ—¶æ˜¾ç¤ºä¸‹æ‹‰èœå•    å½“ä¸ºæ•°å€¼å‹å’Œå­—ç¬¦ä¸²æ—¶ï¼Œä¸”ç¬¬4é¡¹ä¸º T æ—¶æ˜¾ç¤ºå¯†ç ç¼–è¾‘æ¡†    å½“ä¸º T or nil æ—¶ï¼Œæ˜¾ç¤ºå¤é€‰æ¡†ï¼Œ    å½“ä¸ºåˆ—è¡¨æ—¶ï¼Œæ˜¾ç¤ºä¸‹æ‹‰èœå•ã€‚ç¬¬4é¡¹ä¸ºæ•°å­—æ—¶ï¼Œä¸ºåˆ—è¡¨é»˜è®¤å€¼ç´¢å¼•å·ã€‚

**ç”¨æ³•**:
```lisp
(ui:input str-subject lst)
```

**å‚æ•°**: 1 str-subject  : å­—ç¬¦ä¸²;2 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: æ‰€æœ‰è¾“å…¥æ¡†çš„ label å’Œ å€¼ ç»„æˆçš„ç‚¹å¯¹è¡¨ï¼Œæˆ– nil

**ç¤ºä¾‹**:
```lisp
(ui:input "è¯·è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š"    '(("Name1")("Name2"        "VitalGG"        "å¸¦é»˜è®¤å€¼çš„è¾“å…¥æ¡†")      ("Pass1"        "123456"        "å¯†ç æ¡†"        T)      ("Bool:"        T "çœŸå‡å€¼")      ("Popup1:"        ("one"          "two"          "three")        "ä¸‹æ‹‰åˆ—è¡¨")("Popup2:"        3 "ä¸‹æ‹‰åˆ—è¡¨2"        (1 2 3 4 5))))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:input (str-subject lst / *error* dcl_fp dcl-tmp dcl_id para% set-result result initget%)
  "æ˜¾ç¤ºè¾“å…¥ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡æœ¬è¾“å…¥çš„é¢æ¿ï¼Œè¿”å›æ‰€æœ‰æ–‡æœ¬æ¡†çš„å€¼ã€‚\nlst ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—è¡¨ç»„æˆ \n    æ¯ä¸ªå…ƒç´ ç”± (label é»˜è®¤å€¼ è¯´æ˜ æ˜¯å¦å¯†æ–‡/åˆ—è¡¨åŠåˆ—è¡¨é»˜è®¤åºå·(ä»¥0å¼€å§‹))\n  ç»„æˆ ã€‚\nlabel ä¸å¯çœç•¥ï¼Œé»˜è®¤å€¼ã€è¯´æ˜å’Œå¯†æ–‡/åºå· å¯çœç•¥ã€‚å½“ä¸º <*> æ—¶ï¼Œä¸ºç‰¹æ®Šå¤„ç†ç¬¦å·ï¼Œå¦‚ <hr> æ°´å¹³çº¿ï¼Œ<text> å•è¡Œæ–‡æœ¬ã€‚\né»˜è®¤å€¼(ç¬¬äºŒé¡¹):\n    å½“æ²¡æœ‰é»˜è®¤å€¼åŠä»¥åå„é¡¹æ—¶ï¼Œæ˜¾ç¤ºä¸ºæ–‡æœ¬ç¼–è¾‘æ¡†\n    å½“ä¸ºæ•°å€¼å‹å’Œå­—ç¬¦ä¸²æ—¶ï¼Œä¸”ç¬¬4é¡¹ä¸ä¸ºåˆ—è¡¨æ—¶æ˜¾ç¤ºæ–‡æœ¬ç¼–è¾‘æ¡†\n    å½“ä¸ºæ•°å€¼å‹å’Œå­—ç¬¦ä¸²æ—¶ï¼Œä¸”ç¬¬4é¡¹ä¸ºåˆ—è¡¨æ—¶æ˜¾ç¤ºä¸‹æ‹‰èœå•\n    å½“ä¸ºæ•°å€¼å‹å’Œå­—ç¬¦ä¸²æ—¶ï¼Œä¸”ç¬¬4é¡¹ä¸º T æ—¶æ˜¾ç¤ºå¯†ç ç¼–è¾‘æ¡†\n    å½“ä¸º T or nil æ—¶ï¼Œæ˜¾ç¤ºå¤é€‰æ¡†ï¼Œ\n    å½“ä¸ºåˆ—è¡¨æ—¶ï¼Œæ˜¾ç¤ºä¸‹æ‹‰èœå•ã€‚ç¬¬4é¡¹ä¸ºæ•°å­—æ—¶ï¼Œä¸ºåˆ—è¡¨é»˜è®¤å€¼ç´¢å¼•å·ã€‚\n"
  "æ‰€æœ‰è¾“å…¥æ¡†çš„ label å’Œ å€¼ ç»„æˆçš„ç‚¹å¯¹è¡¨ï¼Œæˆ– nil"
  "(ui:input \"è¯·è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š\"\n    '((\"Name1\")(\"Name2\"\n        \"VitalGG\"\n        \"å¸¦é»˜è®¤å€¼çš„è¾“å…¥æ¡†\")\n      (\"Pass1\"\n        \"123456\"\n        \"å¯†ç æ¡†\"\n        T)\n      (\"Bool:\"\n        T \"çœŸå‡å€¼\")\n      (\"Popup1:\"\n        (\"one\"\n          \"two\"\n          \"three\")\n        \"ä¸‹æ‹‰åˆ—è¡¨\")(\"Popup2:\"\n        3 \"ä¸‹æ‹‰åˆ—è¡¨2\"\n        (1 2 3 4 5))))"
  (defun *error* (msg)
    (if (= (quote file)
        (type dcl_fp))
      (close dcl_fp))
    (princ msg)
    (princ))
  (setq width-label (+ 4 (apply (quote max)
        (mapcar (quote (lambda (x)
              (strlen (car x))))
          lst))))
  (setq width-value (+ 2 (apply (quote max)
        (mapcar (quote (lambda (x)
              (strlen (@:to-string (cadr x)))))
          (vl-remove-if (quote (lambda (x)
                (or (null (cadr x))
                  (wcmatch (car x)
                    "<*>"))))
            lst)))))
  (if (> 5 width-value)
    (setq width-value 20))
  (setq width-desc (apply (quote max)
      (mapcar (quote (lambda (x)
            (strlen (@:to-string (caddr x)))))
        (vl-remove-if (quote (lambda (x)
              (null (caddr x))))
          lst))))
  (cond (is-gcad (setq width-desc (fix (* 1.5 width-desc))))
    ((< (@:acadver)
        22)
      (setq width-desc (fix (* 1.5 width-desc)))
      (setq width-desc (if (> width-desc 24)
          (fix (* width-desc 0.8))
          width-desc)))
    ((< (@:acadver)
        24)
      (setq width-desc (fix (* 1.0 width-desc)))
      (setq width-desc (fix (* width-desc 0.5))))
    (t (setq width-desc (fix (* 2.0 width-desc)))
      (setq width-desc (if (> width-desc 27)
          (fix (* width-desc 1.0))
          width-desc))))
  (defun set-result (/ i%)
    (setq result (quote nil))
    (setq i% 1)
    (foreach opt% lst (cond ((or (= 1 (length opt%))
            (and (< 1 (length opt%))
              (member (type-of (cadr opt%))
                (quote (int real str)))))
          (setq result (cons (@:to-type (get_tile (strcat "S_"
                    (itoa i%)))
                (if (cadr opt%)
                  (type-of (cadr opt%))
                  (quote str)))
              result)))
        ((or (= (cadr opt%)
              t)
            (= (cadr opt%)
              nil))
          (setq result (cons (if (= "1"
                  (get_tile (strcat "S_"
                      (itoa i%))))
                t nil)
              result)))
        ((listp (cadr opt%))
          (setq result (cons (nth (atoi (get_tile (strcat "S_"
                      (itoa i%))))
                (cadr opt%))
              result))))
      (setq i% (1+ i%))))
  (if lst (if (= 1 (getvar "filedia"))
      (progn (setq dcl-tmp (strcat @:*tmp-path* "tmp-input.dcl"))
        (setq dcl_fp (open dcl-tmp "w"))
        (write-line (strcat "input : dialog {"
            "label = \""
            str-subject "\"; "
            ":column {label=\""
            str-subject "\"; alignment=left;")
          dcl_fp)
        (setq i% 1)
        (setq bt-width 28)
        (foreach opt% lst (cond ((and (> (length opt%)
                  3)
                (= (quote list)
                  (type (nth 3 opt%))))
              (write-line (strcat ":row{:popup_list { fixed_width=true; width="
                  (itoa bt-width)
                  ";key=\"S_"
                  (itoa i%)
                  "\";"
                  "label=\""
                  (car opt%)
                  "\";"
                  (if (vl-position (cadr opt%)
                      (nth 3 opt%))
                    (strcat "value=\""
                      (itoa (vl-position (cadr opt%)
                          (nth 3 opt%)))
                      "\";")
                    "")
                  "}"
                  (if (or (caddr opt%)
                      (> width-desc 0))
                    (strcat ":text{value=\""
                      (@:to-string (caddr opt%))
                      "\";fixed_width=true; width="
                      (itoa width-desc)
                      ";alignment=left;}")
                    "")
                  "}")
                dcl_fp))
            ((wcmatch (car opt%)
                "<*>")
              (cond ((= "<hr>"
                    (car opt%))
                  (write-line (strcat ":image{ height=0.1; color=250; fixed_height=true;}")
                    dcl_fp))
                ((= "<text>"
                    (car opt%))
                  (write-line (strcat ":text{label=\""
                      (@:to-string (cadr opt%))
                      "\";}")
                    dcl_fp))
                ((= "<button>"
                    (car opt%))
                  (write-line (strcat ":button{label=\""
                      (@:to-string (cadr opt%))
                      "\";}")
                    dcl_fp))))
            ((or (= 1 (length opt%))
                (and (> (length opt%)
                    1)
                  (member (type-of (cadr opt%))
                    (quote (int real str)))))
              (write-line (strcat ":row{:text{ value=\""
                  (car opt%)
                  "\";width="
                  (itoa width-label)
                  ";fixed_width=true;}"
                  ":edit_box { fixed_width=true; width="
                  (itoa width-value)
                  ";key=\"S_"
                  (itoa i%)
                  "\";"
                  "value=\""
                  (if (cadr opt%)
                    (@:string-subst "\\\\"
                      "\\"
                      (@:to-string (cadr opt%)))
                    "")
                  "\";"
                  (if (nth 3 opt%)
                    "password_char=\"*\";"
                    "")
                  "}"
                  (if (or (caddr opt%)
                      (> width-desc 0))
                    (strcat ":text{value=\""
                      (@:to-string (caddr opt%))
                      "\";fixed_width=true; width="
                      (itoa width-desc)
                      ";alignment=left;}")
                    "")
                  "}")
                dcl_fp))
            ((or (= (cadr opt%)
                  t)
                (= (cadr opt%)
                  nil))
              (write-line (strcat ":row{:text{value=\""
                  (car opt%)
                  "\"; fixed_width=true;width="
                  (itoa width-label)
                  ";} :toggle{fixed_width=true;width="
                  (itoa width-value)
                  ";key=\"S_"
                  (itoa i%)
                  "\";"
                  "label=\"\";value=\""
                  (if (cadr opt%)
                    "1"
                    "0")
                  "\";alignment=left;"
                  "}"
                  (if (or (caddr opt%)
                      (> width-desc 0))
                    (strcat ":text{value=\""
                      (@:to-string (caddr opt%))
                      "\";fixed_width=true; width="
                      (itoa width-desc)
                      ";alignment=left;}")
                    "")
                  "}")
                dcl_fp))
            ((= (quote list)
                (type-of (cadr opt%)))
              (write-line (strcat ":row{:popup_list { fixed_width=true; width="
                  (itoa bt-width)
                  ";key=\"S_"
                  (itoa i%)
                  "\";"
                  "label=\""
                  (car opt%)
                  "\";"
                  (if (= (quote int)
                      (type-of (nth 3 opt%)))
                    (strcat "value=\""
                      (itoa (nth 3 opt%))
                      "\";")
                    "")
                  "}"
                  (if (or (caddr opt%)
                      (> width-desc 0))
                    (strcat ":text{value=\""
                      (@:to-string (caddr opt%))
                      "\";fixed_width=true; width="
                      (itoa width-desc)
                      ";alignment=left;}")
                    "")
                  "}")
                dcl_fp)))
          (setq i% (1+ i%)))
        (write-line "} :spacer {} ok_cancel; }"
          dcl_fp)
        (close dcl_fp)
        (setq dcl_id (load_dialog dcl-tmp))
        (if (not (new_dialog "input"
              dcl_id))
          (exit))
        (setq i% 1)
        (foreach opt% lst (if (listp (cadr opt%))
            (progn (start_list (strcat "S_"
                  (itoa i%)))
              (mapcar (quote add_list)
                (mapcar (quote @:to-string)
                  (cadr opt%)))
              (end_list)))
          (setq i% (1+ i%)))
        (setq i% 1)
        (foreach opt% lst (if (and (nth 3 opt%)
              (listp (nth 3 opt%)))
            (progn (start_list (strcat "S_"
                  (itoa i%)))
              (mapcar (quote add_list)
                (mapcar (quote @:to-string)
                  (nth 3 opt%)))
              (end_list)))
          (setq i% (1+ i%)))
        (action_tile "accept"
          "(set-result)(done_dialog 1)")
        (start_dialog)
        (unload_dialog dcl_id)
        (vl-file-delete dcl-tmp)
        (vl-remove-if (quote (lambda (x)
              (wcmatch (car x)
                "<*>")))
          (mapcar (quote cons)
            (mapcar (quote car)
              lst)
            (reverse result)))))
    (progn (alert (_ "parameter is nil."))
      nil)))
```
</details>

---

### ui:kword

**è¯´æ˜**: ä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©,å½“ lst-strå­—ç¬¦ä¸²è¡¨ä¸­æœ‰ç©ºæ ¼å’Œæ±‰å­—ï¼Œæç¤ºä¿¡æ¯å°†æ˜¾ç¤ºé€‰æ‹©åºå·

**ç”¨æ³•**:
```lisp
(ui:kword title lst-str)
```

**å‚æ•°**: 1 title  : æœªè¯†åˆ«å®šä¹‰;2 lst-str  : åˆ—è¡¨;

**è¿”å›å€¼**: é€‰ä¸­çš„å­—ç¬¦ä¸²

**ç¤ºä¾‹**:
```lisp
(ui:kword "Please select:" '("a""b""c"))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:kword (title lst-str / olddyn olddynprompt *error* short?)
  "ä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©,å½“ lst-strå­—ç¬¦ä¸²è¡¨ä¸­æœ‰ç©ºæ ¼å’Œæ±‰å­—ï¼Œæç¤ºä¿¡æ¯å°†æ˜¾ç¤ºé€‰æ‹©åºå·"
  "é€‰ä¸­çš„å­—ç¬¦ä¸²"
  "(ui:kword \"Please select:\"
    '(\"a\"\"b\"\"c\"))"
  (defun *error* (msg)
    (if olddyn (setvar "dynmode"
        olddyn))
    (if olddynprompt (setvar "dynprompt"
        olddynprompt))
    (princ msg)
    (princ))
  (if (and (listp lst-str)
      (> (length lst-str)
        0)
      (p:stringp title))
    (progn (setq short? t)
      (mapcar (quote (lambda (x / lst)
            (setq lst (string:s2l-ansi x))
            (if (or (member 32 lst)
                (> (apply (quote max)
                    lst)
                  128))
              (setq short? nil))))
        lst-str)
      (if (setq olddynprompt (getvar "dynprompt"))
        (setvar "dynprompt"
          1))
      (if (setq olddyn (getvar "dynmode"))
        (setvar "dynmode"
          3))
      (setq lst-n (mapcar (quote itoa)
          (list:range 1 (length lst-str)
            1)))
      (initget (string:from-list (if short? lst-str lst-n)
          "
          "))
      (setq res (getkword (strcat title "["
            (string:from-list (if short? lst-str (mapcar (quote (lambda (x y)
                      (strcat x "("
                          y ")")))
                  lst-str lst-n))
              "/")
            "]")))
      (if olddyn (setvar "dynmode"
          olddyn))
      (if olddynprompt (setvar "dynprompt"
          olddynprompt))
      (if short? res (cdr (assoc res (mapcar (quote cons)
              lst-n lst-str)))))))
```
</details>

---

### ui:progress

**è¯´æ˜**: æä¾›ä¸€ä¸ªè¿›åº¦æ¡åŠŸèƒ½å‡½æ•°ï¼Œcurrent æ˜¯å½“å‰è¿›åº¦   max-number æ˜¯è¿›åº¦æ€»é‡è°ƒç”¨å®Œæˆä¹‹åï¼Œå¯ä»¥ä½¿ç”¨(GRTEXT)  æ¸…é™¤è¿›åº¦

**ç”¨æ³•**:
```lisp
(ui:progress current max-number)
```

**å‚æ•°**: 1 current  : æœªè¯†åˆ«å®šä¹‰;2 max-number  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: æ— è¿”å›å€¼

**ç¤ºä¾‹**:
```lisp
(SETQ CURRENT 0)(repeat 1000 (UI:PROGRESS (setq CURRENT (1+ CURRENT))      1000))(grtext)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:progress (current max-number)
  "\næä¾›ä¸€ä¸ªè¿›åº¦æ¡åŠŸèƒ½å‡½æ•°ï¼Œcurrent æ˜¯å½“å‰è¿›åº¦   max-number æ˜¯è¿›åº¦æ€»é‡\nè°ƒç”¨å®Œæˆä¹‹åï¼Œå¯ä»¥ä½¿ç”¨(GRTEXT)\n  æ¸…é™¤è¿›åº¦\n"
  "æ— è¿”å›å€¼"
  "\n(SETQ CURRENT 0)\n(repeat 1000 (UI:PROGRESS (setq CURRENT (1+ CURRENT))\n      1000))\n(grtext)\n"
  (require (quote music-die:multi-element))
  (grtext -1 (strcat (substr "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"
        1 (* 2 (fix (* 10 (/ current max-number 1.0)))))
      (nth (fix (* 7 (- (* 10 (/ current max-number 1.0))
              (fix (* 10 (/ current max-number 1.0))))))
        (quote ("â–"
            "â–"
            "â–"
            "â–Œ"
            "â–‹"
            "â–Š"
            "â–‰")))
      (apply (quote strcat)
        (music-die:multi-element "\n          "
          (- 20 (* 2 (fix (* 10 (/ current max-number 1.0)))))))
      (rtos current)
      "/"
      (rtos max-number))))
```
</details>

---

### ui:progress1

**è¯´æ˜**: åŸºäº ACET çš„çŠ¶æ€æ è¿›åº¦æ¡.

**ç”¨æ³•**:
```lisp
(ui:progress1 ratio)
```

**å‚æ•°**: 1 ratio  : æœªè¯†åˆ«å®šä¹‰;

**ç¤ºä¾‹**:
```lisp
(ui:progress1 30)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:progress1 (ratio)
  "åŸºäº ACET çš„çŠ¶æ€æ è¿›åº¦æ¡."
  ""
  "(ui:progress1 30)"
  (if (type acet-ui-progress)
    (progn (if (null progress)
        (setq progress (acet-ui-progress "å·²ç»å®Œæˆ"
            100)))
      (acet-ui-progress ratio)
      (if (>= ratio 100)
        (setq progress (acet-ui-progress))))
    (princ "æ²¡æœ‰å®‰è£… ExpressTools")))
```
</details>

---

### ui:select

**è¯´æ˜**: æ˜¾ç¤ºåˆ—è¡¨é€‰æ‹©é¢æ¿ï¼Œé€‰æ‹©æ‰€éœ€é¡¹å¹¶è¿”å›ã€‚

**ç”¨æ³•**:
```lisp
(ui:select str-subject lst)
```

**å‚æ•°**: 1 str-subject  : å­—ç¬¦ä¸²;2 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: é€‰ä¸­çš„å†…å®¹

**ç¤ºä¾‹**:
```lisp
(ui:select "è¯·é€‰æ‹©ä½ éœ€è¦æ“ä½œçš„é¡¹"    '("æˆ‘æ„¿æ„"      "ä¸æ„¿æ„"       "ä½ æ˜¯ä¸€ä¸ªå¥½äºº"))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:select (str-subject lst / dcl_fp dcl-tmp dcl_id para% set-result result initget%)
  "æ˜¾ç¤ºåˆ—è¡¨é€‰æ‹©é¢æ¿ï¼Œé€‰æ‹©æ‰€éœ€é¡¹å¹¶è¿”å›ã€‚"
  "é€‰ä¸­çš„å†…å®¹"
  "(ui:select \"è¯·é€‰æ‹©ä½ éœ€è¦æ“ä½œçš„é¡¹\"\n    '(\"æˆ‘æ„¿æ„\"\n      \"ä¸æ„¿æ„\"\n       \"ä½ æ˜¯ä¸€ä¸ªå¥½äºº\"))"
  (defun set-result (/ i%)
    (setq i% 1)
    (foreach opt% lst (if (= "1"
          (get_tile (strcat "S_"
              (itoa i%))))
        (setq result (nth (1- i%)
            lst)))
      (setq i% (1+ i%))))
  (if lst (if (= 1 (getvar "filedia"))
      (progn (progn (setq dcl-tmp (strcat @:*tmp-path* "tmp-select.dcl"))
          (setq dcl_fp (open dcl-tmp "w"))
          (write-line (strcat "select : dialog {"
              "label = \""
              str-subject "\"; "
              ":radio_column {label=\""
              str-subject "\"; ")
            dcl_fp)
          (setq i% 1)
          (setq bt-width 18)
          (foreach opt% lst (write-line (strcat ":radio_button{ fixed_width=true; width="
                (itoa bt-width)
                ";key=\"S_"
                (itoa i%)
                "\";label=\""
                opt% "\";}")
              dcl_fp)
            (setq i% (1+ i%)))
          (write-line "} :spacer {} ok_cancel; }"
            dcl_fp)
          (close dcl_fp))
        (setq dcl_id (load_dialog dcl-tmp))
        (if (not (new_dialog "select"
              dcl_id))
          (exit))
        (action_tile "accept"
          "(set-result)(done_dialog 1)")
        (start_dialog)
        (unload_dialog dcl_id)
        (vl-file-delete dcl-tmp)
        result)
      (progn (setq i% 0)
        (setq opt% ""
          initget% "0")
        (foreach lst% lst (setq opt% (strcat opt% (itoa (1+ i%))
              ":"
              lst% "\n"))
          (setq initget% (strcat initget% "\n              "
              (itoa (1+ i%))))
          (setq i% (1+ i%)))
        (initget 1 initget%)
        (nth (1- (atoi (getkword (strcat "è¯·è¾“å…¥è¦æ“ä½œçš„åºå· : \n"
                  opt%))))
          lst)))
    (progn (alert (_ "parameter is nil."))
      nil)))
```
</details>

---

### ui:select-multi

**è¯´æ˜**: æ˜¾ç¤ºåˆ—è¡¨é€‰æ‹©é¢æ¿ï¼Œé€‰æ‹©å¤šä¸ªæ‰€éœ€é¡¹å¹¶è¿”å›ã€‚

**ç”¨æ³•**:
```lisp
(ui:select-multi str-subject lst)
```

**å‚æ•°**: 1 str-subject  : å­—ç¬¦ä¸²;2 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: é€‰ä¸­çš„å†…å®¹

**ç¤ºä¾‹**:
```lisp
(ui:select-multi "è¯·é€‰æ‹©ä½ å–œæ¬¢çš„äºº"    '("AB"      "Lisa"       "VitalGG"))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:select-multi (str-subject lst / dcl_fp dcl-tmp dcl_id para% set-result result initget%)
  "æ˜¾ç¤ºåˆ—è¡¨é€‰æ‹©é¢æ¿ï¼Œé€‰æ‹©å¤šä¸ªæ‰€éœ€é¡¹å¹¶è¿”å›ã€‚"
  "é€‰ä¸­çš„å†…å®¹"
  "(ui:select-multi \"è¯·é€‰æ‹©ä½ å–œæ¬¢çš„äºº\"\n    '(\"AB\"\n      \"Lisa\"\n       \"VitalGG\"))"
  (defun set-result (/ i%)
    (setq result (quote nil))
    (setq i% 1)
    (foreach opt% lst (if (= "1"
          (get_tile (strcat "S_"
              (itoa i%))))
        (setq result (cons (nth (1- i%)
              lst)
            result)))
      (setq i% (1+ i%))))
  (if lst (if (= 1 (getvar "filedia"))
      (progn (setq dcl-tmp (strcat @:*tmp-path* "tmp-select.dcl"))
        (setq dcl_fp (open dcl-tmp "w"))
        (write-line (strcat "select : dialog {"
            "label = \""
            str-subject "\"; "
            ":column {label=\""
            str-subject "\"; ")
          dcl_fp)
        (setq i% 1)
        (setq bt-width 18)
        (foreach opt% lst (write-line (strcat ":toggle{ fixed_width=true; width="
              (itoa bt-width)
              ";key=\"S_"
              (itoa i%)
              "\";label=\""
              opt% "\";}")
            dcl_fp)
          (setq i% (1+ i%)))
        (write-line "} :spacer {} ok_cancel; }"
          dcl_fp)
        (close dcl_fp)
        (setq dcl_id (load_dialog dcl-tmp))
        (if (not (new_dialog "select"
              dcl_id))
          (exit))
        (action_tile "accept"
          "(set-result)(done_dialog 1)")
        (start_dialog)
        (unload_dialog dcl_id)
        (vl-file-delete dcl-tmp)
        result))
    (progn (alert (_ "parameter is nil."))
      nil)))
```
</details>

---

### ui:table

**è¯´æ˜**: è¡¨æ ¼ç¼–è¾‘,çº¯DCLæ–¹å¼å®ç°,ä½¿ç”¨å‰å…ˆè®¾ç½® ui:*table-title* æ ‡é¢˜ï¼Œèµ‹å€¼ç»™ ui:*table-numbers-per-page* (æ•´æ•°)ï¼Œå¯ä»¥è®¾ç½®æ¯é¡µçš„è¡Œæ•°(é»˜è®¤ä¸º20)ã€‚ui:*table-widths* ç”¨äºå®šä¹‰æ¯åˆ—çš„å®½åº¦ï¼Œé»˜è®¤æ¯åˆ—å®½åº¦ä¸º10ã€‚æœ€å¤§æ”¯æŒåˆ—æ•°ä¸º26åˆ—ã€‚

**ç”¨æ³•**:
```lisp
(ui:table lst-data)
```

**å‚æ•°**: 1 lst-data  : åˆ—è¡¨;

**è¿”å›å€¼**: ä¿®æ”¹åçš„æ•°æ®

**ç¤ºä¾‹**:
```lisp
(setq ui:*table-title* "æˆ‘çš„è¡¨æ ¼")(setq ui:*table-widths* '(10 5 10 15))(ui:table '(("å§“å"        "æ€§åˆ«"        "å¹´é¾„"        "èº«é«˜")("å¼ ä¸‰"        "ç”·"        18 180)("æå››"        "å¥³"        18 170)("ç‹äº”"        "ç”·"        18 180)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:table (lst-data / tmp-data dcl-tmp dcl_fp dcl_id pkg para% curr-page per-page tbl-widths tbl-title page-up page-down *error* show-data-list callback-accept)
  "è¡¨æ ¼ç¼–è¾‘,çº¯DCLæ–¹å¼å®ç°,ä½¿ç”¨å‰å…ˆè®¾ç½® ui:*table-title* æ ‡é¢˜ï¼Œèµ‹å€¼ç»™ ui:*table-numbers-per-page* (æ•´æ•°)ï¼Œå¯ä»¥è®¾ç½®æ¯é¡µçš„è¡Œæ•°(é»˜è®¤ä¸º20)ã€‚ui:*table-widths* ç”¨äºå®šä¹‰æ¯åˆ—çš„å®½åº¦ï¼Œé»˜è®¤æ¯åˆ—å®½åº¦ä¸º10ã€‚æœ€å¤§æ”¯æŒåˆ—æ•°ä¸º26åˆ—ã€‚"
  "ä¿®æ”¹åçš„æ•°æ®"
  "(setq ui:*table-title* \"æˆ‘çš„è¡¨æ ¼\")(setq ui:*table-widths* '(10 5 10 15))(ui:table '((\"å§“å\"\n        \"æ€§åˆ«\"\n        \"å¹´é¾„\"\n        \"èº«é«˜\")(\"å¼ ä¸‰\"\n        \"ç”·\"\n        18 180)(\"æå››\"\n        \"å¥³\"\n        18 170)(\"ç‹äº”\"\n        \"ç”·\"\n        18 180)))"
  (defun *error* (msg)
    (if (= (quote file)
        (type dcl_fp))
      (close dcl_fp))
    (@:*error* msg))
  (if (and ui:*table-title* (= (quote str)
        (type ui:*table-title*)))
    (setq tbl-title ui:*table-title*)
    (setq tbl-title (_ "Table Editor")))
  (if (> (length (car lst-data))
      26)
    (progn (alert (_ "Max number of columns is 26."))
      (exit)))
  (if (and ui:*table-widths* (apply (quote and)
        (mapcar (quote numberp)
          ui:*table-widths*))
      (> (apply (quote min)
          ui:*table-widths*)
        0)
      (= (length ui:*table-widths*)
        (length (car lst-data))))
    (setq tbl-widths ui:*table-widths*)
    (progn (repeat (length (car lst-data))
        (setq tbl-widths (cons 10 tbl-widths)))))
  (if (and ui:*table-numbers-per-page* (= (quote int)
        (type ui:*table-numbers-per-page*)))
    (setq per-page ui:*table-numbers-per-page*)
    (setq per-page 20))
  (setq tmp-data lst-data)
  (defun save-table (/ lst-dcl)
    "save dcl data to lst-data"
    (setq lst-dcl (quote nil))
    (setq r% 0)
    (repeat (min per-page (- (length (cdr tmp-data))
          (* curr-page per-page)))
      (setq c% 64)
      (setq r% (1+ r%))
      (setq lst-r% (quote nil))
      (repeat (length (car tmp-data))
        (setq lst-r% (cons (get_tile (strcat (chr (setq c% (1+ c%)))
                (itoa r%)))
            lst-r%)))
      (setq lst-dcl (cons (reverse lst-r%)
          lst-dcl)))
    (setq lst-dcl (reverse lst-dcl))
    (setq i% 0)
    (setq tmp-data-prev (quote nil))
    (repeat (min (* curr-page per-page)
        (length (cdr tmp-data)))
      (setq tmp-data-prev (cons (nth (setq i% (1+ i%))
            tmp-data)
          tmp-data-prev)))
    (setq i% (* (1+ curr-page)
        per-page))
    (setq tmp-data-last (quote nil))
    (if (> (- (length (cdr tmp-data))
          (* (1+ curr-page)
            per-page))
        0)
      (repeat (- (length (cdr tmp-data))
          (* (1+ curr-page)
            per-page))
        (setq tmp-data-last (cons (nth (setq i% (1+ i%))
              tmp-data)
            tmp-data-last))))
    (setq tmp-data (append (list (car tmp-data))
        (reverse tmp-data-prev)
        lst-dcl (reverse tmp-data-last))))
  (defun callback-accept nil (save-table)
    (setq lst-data (mapcar (quote (lambda (x type1)
            (mapcar (quote (lambda (y ty)
                  (if (p:stringp y)
                    (@:to-type y (type ty))
                    y)))
              x type1)))
        tmp-data lst-data)))
  (defun page-up nil (save-table)
    (setq curr-page (1- curr-page))
    (set_tile "scrollbar"
      (itoa (- (1- total-page)
          curr-page)))
    (show-data-list))
  (defun page-down nil (save-table)
    (setq curr-page (1+ curr-page))
    (set_tile "scrollbar"
      (itoa (- (1- total-page)
          curr-page)))
    (show-data-list))
  (defun to-page nil (save-table)
    (setq curr-page (- (1- total-page)
        (atoi (get_tile "scrollbar"))))
    (show-data-list))
  (defun show-data-list (/ tmp-unit)
    (setq i% 0)
    (repeat (length (car tmp-data))
      (set_tile (strcat "header"
          (itoa (setq i% (1+ i%))))
        (nth (1- i%)
          (car tmp-data))))
    (setq c% 64)
    (repeat (length (car tmp-data))
      (setq r% 0 c% (1+ c%))
      (repeat (min per-page (- (length (cdr tmp-data))
            (* per-page curr-page)))
        (setq tmp-unit (nth (- c% 65)
            (nth (1- (+ (setq r% (1+ r%))
                  (* per-page curr-page)))
              (cdr tmp-data))))
        (set_tile (strcat (chr c%)
            (itoa r%))
          (cond ((p:intp tmp-unit)
              (string:number-format (@:to-string tmp-unit)
                5 0))
            ((numberp tmp-unit)
              (string:number-format (@:to-string tmp-unit)
                5 3))
            (t (@:to-string tmp-unit))))
        (mode_tile (strcat (chr c%)
            (itoa r%))
          0)
        (set_tile (strcat "rno"
            (itoa r%))
          (string:number-format (@:to-string (+ r% (* per-page curr-page)))
            7 0)))
      (while (< r% per-page)
        (repeat (length (car tmp-data))
          (set_tile (strcat (chr c%)
              (itoa (setq r% (1+ r%))))
            "")
          (mode_tile (strcat (chr c%)
              (itoa r%))
            1)
          (set_tile (strcat "rno"
              (itoa r%))
            ""))))
    (set_tile "curr_total"
      (strcat (itoa (1+ curr-page))
        "/"
        (itoa (1+ (/ (1- (length (cdr tmp-data)))
              per-page)))))
    (if (= 0 curr-page)
      (mode_tile "prev"
        1)
      (mode_tile "prev"
        0))
    (if (= (/ (1- (length (cdr tmp-data)))
          per-page)
        curr-page)
      (mode_tile "next"
        1)
      (mode_tile "next"
        0)))
  (if (/= (quote int)
      (type theme:bg-color))
    (setq theme:bg-color 151))
  (setq curr-page 0 total-page (fix (1+ (/ (1- (length (cdr tmp-data)))
          per-page))))
  (progn (setq dcl-tmp (strcat @:*tmp-path* "tmp-table-ed.dcl"))
    (setq dcl_fp (open dcl-tmp "w"))
    (write-line (strcat "table_ed : dialog {"
        "label = \""
        tbl-title "\";"
        ": column { "
        ":row{"
        ": column { ")
      dcl_fp)
    (write-line (strcat ": row { ")
      dcl_fp)
    (write-line (strcat ":edit_box{key=\"rno\";value=\"\n         è¡Œå·\";width=2;fixed_width=true;horizontal_margin=none;vertical_margin=none;is_enabled=false;}")
      dcl_fp)
    (setq i% 0)
    (repeat (length (car tmp-data))
      (write-line (strcat ":edit_box{key=\"header"
          (itoa (setq i% (1+ i%)))
          "\";value=\"\";width="
          (itoa (nth (1- i%)
              tbl-widths))
          ";fixed_width=true;horizontal_margin=none;vertical_margin=none;is_enabled=false;}")
        dcl_fp))
    (write-line (strcat "}")
      dcl_fp)
    (setq r% 0)
    (repeat (min per-page (length (cdr tmp-data)))
      (write-line (strcat ":row{")
        dcl_fp)
      (setq r% (1+ r%)
        c% 64)
      (write-line (strcat ":edit_box{key=\"rno"
          (itoa r%)
          "\";value=\"\";width=2;fixed_width=true;horizontal_margin=none;vertical_margin=none;is_enabled=false;}")
        dcl_fp)
      (repeat (length (car tmp-data))
        (write-line (strcat ":edit_box{key=\""
            (chr (setq c% (1+ c%)))
            (itoa r%)
            "\";value=\"\";width="
            (itoa (nth (- c% 65)
                tbl-widths))
            ";fixed_width=true;horizontal_margin=none;vertical_margin=none;}")
          dcl_fp))
      (write-line (strcat "}")
        dcl_fp))
    (write-line (strcat "}")
      dcl_fp)
    (if (> (length (cdr tmp-data))
        per-page)
      (write-line (strcat ":slider{key=\"scrollbar\";layout=vertical;value="
          (itoa (1- total-page))
          ";max_value="
          (itoa (1- total-page))
          ";min_value=0;small_increment=1;}")
        dcl_fp))
    (write-line "}"
      dcl_fp)
    (if (> (length (cdr tmp-data))
        per-page)
      (progn (write-line ":spacer{}}:spacer{}"
          dcl_fp)
        (write-line ":row{alignment=centered;children_alignment=centered;:button{label=\"(<)Prev\";mnemonic=\"<\";key=\"prev\";is_enabled=false;}:spacer{} :text_part{key=\"curr_total\"; value=\"\";alignment=\"centered\";width=10;}:button{label=\"Next(>)\";mnemonic=\">\";key=\"next\";is_enabled=false;}}"
          dcl_fp))
      (write-line "}"
        dcl_fp))
    (write-line ":spacer{} ok_cancel; }"
      dcl_fp)
    (close dcl_fp))
  (setq dcl_id (load_dialog dcl-tmp))
  (if (not (new_dialog "table_ed"
        dcl_id))
    (exit))
  (action_tile "prev"
    "(page-up)")
  (action_tile "next"
    "(page-down)")
  (action_tile "scrollbar"
    "(to-page)")
  (action_tile "accept"
    "(callback-accept)(done_dialog 0)")
  (show-data-list)
  (start_dialog)
  (unload_dialog dcl_id)
  (vl-file-delete dcl-tmp)
  lst-data)
```
</details>

---

### ui:table-widths

**è¯´æ˜**: æ±‚ç”¨äºdclè¡¨æ ¼çš„å„åˆ—çš„è‡ªé€‚åº”å®½åº¦ã€‚

**ç”¨æ³•**:
```lisp
(ui:table-widths lst-data)
```

**å‚æ•°**: 1 lst-data  : åˆ—è¡¨;

**è¿”å›å€¼**: æ•°å€¼è¡¨

**ç¤ºä¾‹**:
```lisp
(ui:table-widths '(("å§“å"        "æ€§åˆ«"        "å¹´é¾„"        "èº«é«˜")("å¼ ä¸‰""ç”·"18 180)("æå››"        "å¥³"        18 170)("ç‹äº”"        "ç”·"        18 180)))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun ui:table-widths (lst-data)
  "æ±‚ç”¨äºdclè¡¨æ ¼çš„å„åˆ—çš„è‡ªé€‚åº”å®½åº¦ã€‚"
  "æ•°å€¼è¡¨"
  "(ui:table-widths '((\"å§“å\"\n        \"æ€§åˆ«\"\n        \"å¹´é¾„\"\n        \"èº«é«˜\")(\"å¼ ä¸‰\"\"ç”·\"18 180)(\"æå››\"\n        \"å¥³\"\n        18 170)(\"ç‹äº”\"\n        \"ç”·\"\n        18 180)))"
  (mapcar (quote (lambda (x)
        (+ 2 (apply (quote max)
            (mapcar (quote (lambda (y)
                  (strbytelen (@:to-string y))))
              x)))))
    (apply (quote mapcar)
      (cons (quote list)
        lst-data))))
```
</details>

---

## vectra

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### vectra:acos

**ç”¨æ³•**:
```lisp
(vectra:acos f)
```

**å‚æ•°**: 1 f  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:acos (f)
  (if (equal f 0.0 1.0e-06)
    (* pi 0.5)
    (atan (/ (sqrt (- 1 (* f f)))
        f))))
```
</details>

---

### vectra:angle-include

**ç”¨æ³•**:
```lisp
(vectra:angle-include a1 a2)
```

**å‚æ•°**: 1 a1  : æœªè¯†åˆ«å®šä¹‰;2 a2  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:angle-include (a1 a2 / r)
  (setq r (abs (rem (- a1 a2)
        $2pi)))
  (if (> r pi)
    (- $2pi r)
    r))
```
</details>

---

### vectra:angle-normal

**ç”¨æ³•**:
```lisp
(vectra:angle-normal a)
```

**å‚æ•°**: 1 a  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:angle-normal (a)
  (setq a (rem a $2pi))
  (if (< a 0)
    (setq a (+ a $2pi)))
  a)
```
</details>

---

### vectra:angle-regular

**ç”¨æ³•**:
```lisp
(vectra:angle-regular a)
```

**å‚æ•°**: 1 a  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:angle-regular (a)
  (if (> a $pi/2)
    (- a pi)
    (if (< a (- $pi/2))
      (+ a pi)
      a)))
```
</details>

---

### vectra:angle-reverse

**ç”¨æ³•**:
```lisp
(vectra:angle-reverse a)
```

**å‚æ•°**: 1 a  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:angle-reverse (a)
  (rem (+ pi a)
    $2pi))
```
</details>

---

### vectra:array-create

**ç”¨æ³•**:
```lisp
(vectra:array-create n)
```

**å‚æ•°**: 1 n  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:array-create (n /)
  (vlax-make-safearray vlax-vbvariant (cons 0 n)))
```
</details>

---

### vectra:array-get

**ç”¨æ³•**:
```lisp
(vectra:array-get arr n)
```

**å‚æ•°**: 1 arr  : æœªè¯†åˆ«å®šä¹‰;2 n  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:array-get (arr n /)
  (vectra:var->list (vlax-safearray-get-element arr n)))
```
</details>

---

### vectra:array-set

**ç”¨æ³•**:
```lisp
(vectra:array-set arr n value)
```

**å‚æ•°**: 1 arr  : æœªè¯†åˆ«å®šä¹‰;2 n  : æœªè¯†åˆ«å®šä¹‰;3 value  : å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:array-set (arr n value /)
  (vlax-safearray-put-element arr n (vectra:list->var value)))
```
</details>

---

### vectra:benchmark

**ç”¨æ³•**:
```lisp
(vectra:benchmark expr n)
```

**å‚æ•°**: 1 expr  : è¡¨è¾¾å¼ï¼Œä¸€èˆ¬æŒ‡lispè¡¨è¾¾å¼;2 n  : æ•´æ•°;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:benchmark (expr n / elapse tps start)
  (setq start (getvar "MILLISECS"))
  (repeat n (eval expr))
  (setq elapse (- (getvar "MILLISECS")
      start))
  (if (equal elapse 0.0 1.0e-06)
    (strcat "Benchmark loops = "
      (itoa n)
      ", in "
      (rtos elapse 2 4)
      "
      ms")
    (strcat "Benchmark loops = "
      (itoa n)
      ", in "
      (rtos elapse 2 4)
      "
      ms, "
      (rtos (/ n elapse 0.001)
        2 0)
      "
      invoke / s")))
```
</details>

---

### vectra:block-items

**ç”¨æ³•**:
```lisp
(vectra:block-items en)
```

**å‚æ•°**: 1 en  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:block-items (en /)
  (setq $p-block-walked nil)
  (vectra:block-items-inner en))
```
</details>

---

### vectra:block-items-inner

**ç”¨æ³•**:
```lisp
(vectra:block-items-inner en)
```

**å‚æ•°**: 1 en  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:block-items-inner (en / name r)
  (if (= (quote str)
      (type en))
    (setq en (tblobjname "block"
        en)))
  (while (setq en (entnext en))
    (if (= "INSERT"
        (vectra:dxf en 0))
      (progn (setq name (vectra:dxf en 2))
        (if (not (member name $p-block-walked))
          (setq r (append r (vectra:block-items name))
            $p-block-walked (cons name $p-block-walked))))
      (setq r (cons en r))))
  r)
```
</details>

---

### vectra:block-trans

**ç”¨æ³•**:
```lisp
(vectra:block-trans p geom)
```

**å‚æ•°**: 1 p  : æœªè¯†åˆ«å®šä¹‰;2 geom  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:block-trans (p geom /)
  (mapcar (quote +)
    (vectra:mxv (car geom)
      p)
    (cadr geom)))
```
</details>

---

### vectra:ceiling

**ç”¨æ³•**:
```lisp
(vectra:ceiling f dig)
```

**å‚æ•°**: 1 f  : æœªè¯†åˆ«å®šä¹‰;2 dig  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:ceiling (f dig / num)
  (setq num (expt 10.0 dig))
  (/ (fix (+ 0.5 (* f num)))
    num))
```
</details>

---

### vectra:clipboard-get

**ç”¨æ³•**:
```lisp
(vectra:clipboard-get )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:clipboard-get (/ html result)
  (and (setq html (vlax-create-object "htmlfile"))
    (setq result (vlax-invoke (vlax-get (vlax-get html (quote parentwindow))
          (quote clipboarddata))
        (quote getdata)
        "Text"))
    (vlax-release-object html))
  result)
```
</details>

---

### vectra:clipboard-set

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:clipboard-set (str / html result)
  (and (= (type str)
      (quote str))
    (setq html (vlax-create-object "htmlfile"))
    (setq result (vlax-invoke (vlax-get (vlax-get html (quote parentwindow))
          (quote clipboarddata))
        (quote setdata)
        "Text"
        str))
    (vlax-release-object html)))
```
</details>

---

### vectra:commandrun

**ç”¨æ³•**:
```lisp
(vectra:commandrun func)
```

**å‚æ•°**: 1 func  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:commandrun (func / *error*)
  (defun *error* (s)
    (vectra:error-handler s))
  (vectra:error-start0)
  (vectra:startundomark)
  (eval func)
  (vectra:endundomark)
  (vectra:error-end)
  (princ))
```
</details>

---

### vectra:commandrun-s

**ç”¨æ³•**:
```lisp
(vectra:commandrun-s func sysvars)
```

**å‚æ•°**: 1 func  : æœªè¯†åˆ«å®šä¹‰;2 sysvars  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:commandrun-s (func sysvars / *error*)
  (defun *error* (s)
    (vectra:error-handler s))
  (vectra:error-start sysvars)
  (vectra:startundomark)
  (eval func)
  (vectra:endundomark)
  (vectra:error-end)
  (princ))
```
</details>

---

### vectra:confirm

**ç”¨æ³•**:
```lisp
(vectra:confirm msg default)
```

**å‚æ•°**: 1 msg  : æç¤ºä¿¡æ¯;2 default  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:confirm (msg default / r)
  (initget "Y N ")
  (if (null (setq r (getkword (strcat msg "
            [æ˜¯(Y)/å¦(N)] <"
            default ">:"))))
    (setq r default))
  r)
```
</details>

---

### vectra:csvfile-read

**ç”¨æ³•**:
```lisp
(vectra:csvfile-read filename)
```

**å‚æ•°**: 1 filename  : æ–‡ä»¶å;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:csvfile-read (filename / r rows)
  (if (setq rows (vectra:file-read filename))
    (progn (foreach row rows (setq row (vl-string-trim "
            \t\n,"
            row))
        (if (and (/= row "")
            (/= (vectra:string-left row 2)
              "//")
            (setq row (vectra:string-tokenize row ",")))
          (setq row (mapcar (function (lambda (e)
                  (vl-string-subst "\""
                    "\"\"\""
                    e)))
              row)
            r (cons row r))))
      (reverse r))))
```
</details>

---

### vectra:csvfile-readcache

**ç”¨æ³•**:
```lisp
(vectra:csvfile-readcache filename cache)
```

**å‚æ•°**: 1 filename  : æ–‡ä»¶å;2 cache  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:csvfile-readcache (filename cache / data)
  (if (and (setq filename (findfile filename))
      (setq filename (strcase filename))
      (null (setq data (vectra:get (vl-symbol-value cache)
            filename))))
    (progn (setq data (vectra:csvfile-read filename))
      (set cache (cons (cons filename data)
          (vl-symbol-value cache)))))
  data)
```
</details>

---

### vectra:csvread-get

**ç”¨æ³•**:
```lisp
(vectra:csvread-get csv key)
```

**å‚æ•°**: 1 csv  : æœªè¯†åˆ«å®šä¹‰;2 key  : é”®ï¼Œå…³é”®å­—;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:csvread-get (csv key /)
  (mapcar (function cons)
    (car csv)
    (vectra:get1 (cdr csv)
      key)))
```
</details>

---

### vectra:csvread-get1

**ç”¨æ³•**:
```lisp
(vectra:csvread-get1 csv key)
```

**å‚æ•°**: 1 csv  : æœªè¯†åˆ«å®šä¹‰;2 key  : é”®ï¼Œå…³é”®å­—;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:csvread-get1 (csv key / r)
  (setq r (vectra:csvread-get csv key))
  (mapcar (function (lambda (e)
        (if (= "#"
            (vectra:string-left (car e)
              1))
          (cons (vl-string-trim "#"
              (car e))
            (atof (cdr e)))
          e)))
    r))
```
</details>

---

### vectra:csvread-keys

**ç”¨æ³•**:
```lisp
(vectra:csvread-keys csv)
```

**å‚æ•°**: 1 csv  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:csvread-keys (csv /)
  (mapcar (function car)
    (cdr csv)))
```
</details>

---

### vectra:deg->rad

**ç”¨æ³•**:
```lisp
(vectra:deg->rad deg)
```

**å‚æ•°**: 1 deg  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:deg->rad (deg)
  (* pi (/ deg 180.0)))
```
</details>

---

### vectra:directory-make

**ç”¨æ³•**:
```lisp
(vectra:directory-make folder)
```

**å‚æ•°**: 1 folder  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:directory-make (folder / folders cur)
  (setq folder (vl-string-trim "\\/"
      folder)
    folders (vectra:string-tokenize folder "\\/")
    cur (car folders)
    folders (cdr folders))
  (foreach e folders (setq cur (strcat cur "\\"
        E))
    (IF (NULL (VL-FILE-DIRECTORY-P CUR))
      (VL-MKDIR CUR))))
```
</details>

---

### vectra:dxf

**ç”¨æ³•**:
```lisp
(vectra:dxf ename keys)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 keys  : é”®ï¼Œå…³é”®å­—;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:dxf (ename keys /)
  (vectra:get (entget ename)
    keys))
```
</details>

---

### vectra:dxf1

**ç”¨æ³•**:
```lisp
(vectra:dxf1 ename keys)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 keys  : é”®ï¼Œå…³é”®å­—;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:dxf1 (ename keys /)
  (vectra:get1 (entget ename)
    keys))
```
</details>

---

### vectra:dxfs

**ç”¨æ³•**:
```lisp
(vectra:dxfs ename sym keys)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 sym  : æœªè¯†åˆ«å®šä¹‰;3 keys  : é”®ï¼Œå…³é”®å­—;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:dxfs (ename sym keys /)
  (mapcar (function set)
    sym (vectra:dxf ename keys)))
```
</details>

---

### vectra:edit-value

**ç”¨æ³•**:
```lisp
(vectra:edit-value msg old)
```

**å‚æ•°**: 1 msg  : æç¤ºä¿¡æ¯;2 old  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:edit-value (msg old / value)
  (cond ((= (quote real)
        (type old))
      (setq value (getdist (strcat msg "
            <"
            (rtos old 2 2)
            ">: "))))
    ((= (quote int)
        (type old))
      (setq value (getint (strcat msg "
            <"
            (itoa old)
            ">: "))))
    ((= (quote list)
        (type old))
      (setq value (getpoint (strcat msg "
            <"
            (vl-princ-to-string old)
            ">: "))))
    ((= (quote str)
        (type old))
      (setq value (getstring (strcat msg "
            <"
            old ">: ")))))
  (if (or (null value)
      (= ""
        value))
    old value))
```
</details>

---

### vectra:enamep

**ç”¨æ³•**:
```lisp
(vectra:enamep v)
```

**å‚æ•°**: 1 v  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:enamep (v)
  (= (quote ename)
    (type v)))
```
</details>

---

### vectra:enames->ss

**ç”¨æ³•**:
```lisp
(vectra:enames->ss enames)
```

**å‚æ•°**: 1 enames  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:enames->ss (enames / ss)
  (setq ss (ssadd))
  (foreach en enames (ssadd en ss))
  ss)
```
</details>

---

### vectra:enames-after

**ç”¨æ³•**:
```lisp
(vectra:enames-after en ss)
```

**å‚æ•°**: 1 en  : å•ä¸ªå›¾å…ƒ;2 ss  : é€‰æ‹©é›†;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:enames-after (en ss /)
  (if (null ss)
    (setq ss (ssadd)))
  (while (setq en (entnext en))
    (setq ss (ssadd en ss)))
  ss)
```
</details>

---

### vectra:endundomark

**ç”¨æ³•**:
```lisp
(vectra:endundomark )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:endundomark nil (if $p-undo-started (progn (vla-endundomark (vla-get-activedocument (vlax-get-acad-object)))
      (setq $p-undo-started nil))))
```
</details>

---

### vectra:ensure-ename

**ç”¨æ³•**:
```lisp
(vectra:ensure-ename obj)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:ensure-ename (obj)
  (if (/= (quote ename)
      (type obj))
    (vlax-vla-object->ename obj)
    obj))
```
</details>

---

### vectra:ensure-object

**ç”¨æ³•**:
```lisp
(vectra:ensure-object obj)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:ensure-object (obj)
  (if (= (quote ename)
      (type obj))
    (vlax-ename->vla-object obj)
    obj))
```
</details>

---

### vectra:entmake

**ç”¨æ³•**:
```lisp
(vectra:entmake dxf)
```

**å‚æ•°**: 1 dxf  : ç»„ç å·;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:entmake (dxf / r)
  (vectra:linetype-get $addnew-linetype)
  (vl-catch-all-apply (quote entmakex)
    (list (append dxf (list (cons 8 $addnew-layer)
          (cons 6 $addnew-linetype)
          (cons 62 $addnew-color)
          (cons 370 $addnew-lineweight)))))
  (setq r (entlast))
  (if (null (vl-catch-all-error-p r))
    (if $addnew-xdata (vectra:xdata-set r (car $addnew-xdata)
        (cdr $addnew-xdata))))
  r)
```
</details>

---

### vectra:entmod

**ç”¨æ³•**:
```lisp
(vectra:entmod ent datas)
```

**å‚æ•°**: 1 ent  : å•ä¸ªå›¾å…ƒ;2 datas  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:entmod (ent datas /)
  (entmod (vectra:set (entget ent)
      datas)))
```
</details>

---

### vectra:entsel

**ç”¨æ³•**:
```lisp
(vectra:entsel msg filter)
```

**å‚æ•°**: 1 msg  : æç¤ºä¿¡æ¯;2 filter  : è¿‡æ»¤dxfç»„ç ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:entsel (msg filter /)
  (vectra:entsel-inner msg filter nil))
```
</details>

---

### vectra:entsel-inner

**ç”¨æ³•**:
```lisp
(vectra:entsel-inner msg filter nested)
```

**å‚æ•°**: 1 msg  : æç¤ºä¿¡æ¯;2 filter  : è¿‡æ»¤dxfç»„ç ;3 nested  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:entsel-inner (msg filter nested / ent kword)
  (if (and msg (setq kword (mapcar (quote car)
          (vl-remove-if-not (quote vl-consp)
            (vectra:template-parse-inner msg "("
                ")")))))
    (setq kword (vectra:string-connect kword "
        ")
      kword (strcat kword "
         "))
    (setq kword "
       "))
  (while (null ent)
    (initget kword)
    (if nested (setq ent (nentsel msg))
      (setq ent (entsel msg)))
    (cond ((null ent)
        (princ "æœªé€‰æ‹©å¯¹è±¡ã€‚"))
      ((= (type ent)
          (quote list))
        (if (and filter (not (wcmatch (vectra:dxf (car ent)
                  0)
                filter)))
          (progn (princ "é€‰æ‹©å¯¹è±¡å·²è¢«è¿‡æ»¤ã€‚")
            (setq ent nil))))))
  ent)
```
</details>

---

### vectra:error-end

**ç”¨æ³•**:
```lisp
(vectra:error-end )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:error-end nil (if $p-sysvars-saved (progn (vectra:setvars $p-sysvars-saved)
      (setq $p-sysvars-saved nil))))
```
</details>

---

### vectra:error-handler

**ç”¨æ³•**:
```lisp
(vectra:error-handler s)
```

**å‚æ•°**: 1 s  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:error-handler (s)
  (if (or (= s "Function cancelled")
      (= s "quit / exit abort")
      (= s "å‡½æ•°è¢«å–æ¶ˆ"))
    (princ)
    (princ s))
  (while (not (equal (getvar "CMDNAMES")
        ""))
    (command nil))
  (vectra:osnap-restore)
  (vectra:endundomark)
  (vectra:error-end)
  (princ))
```
</details>

---

### vectra:error-start

**ç”¨æ³•**:
```lisp
(vectra:error-start vars)
```

**å‚æ•°**: 1 vars  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:error-start (vars /)
  (setq $p-sysvars-saved (vectra:setvars vars)))
```
</details>

---

### vectra:error-start0

**ç”¨æ³•**:
```lisp
(vectra:error-start0 )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:error-start0 (/)
  (vectra:error-start (quote (("CMDECHO"
          . 0)))))
```
</details>

---

### vectra:file-read

**ç”¨æ³•**:
```lisp
(vectra:file-read filename)
```

**å‚æ•°**: 1 filename  : æ–‡ä»¶å;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:file-read (filename / content file line)
  (if (and (setq filename (findfile filename))
      (setq file (open filename "r")))
    (progn (while (setq line (read-line file))
        (setq content (cons line content)))
      (close file)))
  (reverse content))
```
</details>

---

### vectra:file-readstring

**ç”¨æ³•**:
```lisp
(vectra:file-readstring filename)
```

**å‚æ•°**: 1 filename  : æ–‡ä»¶å;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:file-readstring (filename / content)
  (if (setq content (vectra:file-read filename))
    (vectra:string-connect content "\r\n")))
```
</details>

---

### vectra:file-search

**ç”¨æ³•**:
```lisp
(vectra:file-search path patten)
```

**å‚æ•°**: 1 path  : æ–‡ä»¶è·¯å¾„;2 patten  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:file-search (path patten / r)
  (foreach dir (cddr (vl-directory-files path nil -1))
    (setq r (append r (vectra:file-search (strcat path "\\"
            DIR)
          PATTEN))))
  (FOREACH FILE (VL-DIRECTORY-FILES PATH PATTEN 0)
    (SETQ R (CONS (STRCAT PATH "\\"
          file)
        r)))
  r)
```
</details>

---

### vectra:get

**ç”¨æ³•**:
```lisp
(vectra:get lst keys)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 keys  : é”®ï¼Œå…³é”®å­—;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:get (lst keys /)
  (if (atom keys)
    (cdr (assoc keys lst))
    (mapcar (function (lambda (e)
          (cdr (assoc e lst))))
      keys)))
```
</details>

---

### vectra:get-block

**ç”¨æ³•**:
```lisp
(vectra:get-block name)
```

**å‚æ•°**: 1 name  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:get-block (name /)
  (vl-catch-all-apply (quote vla-item)
    (list (vla-get-blocks (vla-get-activedocument (vlax-get-acad-object)))
      name)))
```
</details>

---

### vectra:get-bulge

**ç”¨æ³•**:
```lisp
(vectra:get-bulge v1 v2)
```

**å‚æ•°**: 1 v1  : æœªè¯†åˆ«å®šä¹‰;2 v2  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:get-bulge (v1 v2 / a1 a2 bulge dot)
  (setq dot (sp-dotproduct v1 v2)
    a1 (sp-angle v1)
    a2 (sp-angle v2))
  (if (< dot 0)
    (setq bulge (tan (/ (acos (abs dot))
          4.0)))
    (setq bulge (tan (/ (- pi (acos (abs dot)))
          4.0))))
  (setq a2 (- a2 a1))
  (if (or (and (>= a2 0)
        (< a2 pi))
      (and (< a2 0)
        (< a2 (- pi))))
    (setq bulge (- bulge)))
  bulge)
```
</details>

---

### vectra:get1

**ç”¨æ³•**:
```lisp
(vectra:get1 lst keys)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 keys  : é”®ï¼Œå…³é”®å­—;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:get1 (lst keys / e)
  (if (atom keys)
    (cons keys (vectra:get lst keys))
    (mapcar (quote cons)
      keys (vectra:get lst keys))))
```
</details>

---

### vectra:getdist

**ç”¨æ³•**:
```lisp
(vectra:getdist msg old p)
```

**å‚æ•°**: 1 msg  : æç¤ºä¿¡æ¯;2 old  : æœªè¯†åˆ«å®šä¹‰;3 p  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:getdist (msg old p / value)
  (if p (setq value (getdist (strcat msg "
          <"
          (rtos old 2 2)
          ">: ")
        p))
    (setq value (getdist (strcat msg "
          <"
          (rtos old 2 2)
          ">: "))))
  (if (null value)
    old value))
```
</details>

---

### vectra:getint

**ç”¨æ³•**:
```lisp
(vectra:getint msg init default)
```

**å‚æ•°**: 1 msg  : æç¤ºä¿¡æ¯;2 init  : æœªè¯†åˆ«å®šä¹‰;3 default  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:getint (msg init default / r)
  (if init (initget init))
  (if (null (setq r (getint (strcat msg "
            <"
            (itoa default)
            ">"))))
    default r))
```
</details>

---

### vectra:getkword

**ç”¨æ³•**:
```lisp
(vectra:getkword msg kword default)
```

**å‚æ•°**: 1 msg  : æç¤ºä¿¡æ¯;2 kword  : æœªè¯†åˆ«å®šä¹‰;3 default  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:getkword (msg kword default / r)
  (initget kword)
  (if (null (setq r (getkword (strcat msg "
            <"
            default ">: "))))
    default r))
```
</details>

---

### vectra:getkword1

**ç”¨æ³•**:
```lisp
(vectra:getkword1 msg kwords default)
```

**å‚æ•°**: 1 msg  : æç¤ºä¿¡æ¯;2 kwords  : æœªè¯†åˆ«å®šä¹‰;3 default  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:getkword1 (msg kwords default / r)
  (initget (vectra:string-connect (mapcar (quote car)
        kwords)
      "
      "))
  (setq r (getkword (strcat msg "
        ["
        (vectra:string-connect (mapcar (function (lambda (e)
                (strcat (cadr e)
                  "("
                    (car e)
                    ")")))
            kwords)
          "/")
        "] <"
        default ">: ")))
  (if (null r)
    default r))
```
</details>

---

### vectra:hash

**ç”¨æ³•**:
```lisp
(vectra:hash lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:hash (lst /)
  (setq h (getvar (quote millisecs)))
  (if (atom lst)
    (setq h (vectra:hash-1 lst h))
    (foreach e lst (setq h (vectra:hash-1 e h)))))
```
</details>

---

### vectra:hash-1

**ç”¨æ³•**:
```lisp
(vectra:hash-1 e h)
```

**å‚æ•°**: 1 e  : æœªè¯†åˆ«å®šä¹‰;2 h  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:hash-1 (e h /)
  (+ (fix e)
    (* 31 h)))
```
</details>

---

### vectra:insert-seqs

**ç”¨æ³•**:
```lisp
(vectra:insert-seqs en)
```

**å‚æ•°**: 1 en  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:insert-seqs (en / r)
  (while (and (setq en (entnext en))
      (/= "SEQEND"
        (vectra:dxf en 0)))
    (setq r (cons en r)))
  r)
```
</details>

---

### vectra:item

**ç”¨æ³•**:
```lisp
(vectra:item obj name)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;2 name  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:item (obj name / r)
  (if (vl-catch-all-error-p (setq r (vl-catch-all-apply (quote vla-item)
          (list obj name))))
    nil r))
```
</details>

---

### vectra:jscript-eval

**ç”¨æ³•**:
```lisp
(vectra:jscript-eval func_str)
```

**å‚æ•°**: 1 func_str  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:jscript-eval (func_str /)
  (if (null $p-scriptcontrol)
    (progn (setq $p-scriptcontrol (vlax-create-object "Aec32BitAppServer.AecScriptControl.1"))
      (vl-catch-all-apply (quote vlax-put)
        (list $p-scriptcontrol "language"
          "jscript"))))
  (if (null $p-scriptcontrol)
    nil (vl-catch-all-apply (quote vlax-invoke)
      (list $p-scriptcontrol "eval"
        func_str))))
```
</details>

---

### vectra:layer-get

**ç”¨æ³•**:
```lisp
(vectra:layer-get name conf)
```

**å‚æ•°**: 1 name  : æœªè¯†åˆ«å®šä¹‰;2 conf  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:layer-get (name conf / dxf layer)
  (if (null (setq layer (tblsearch "LAYER"
          name)))
    (progn (setq dxf (list (quote (0 . "LAYER"))
          (quote (100 . "AcDbSymbolTableRecord"))
          (quote (100 . "AcDbLayerTableRecord"))
          (quote (70 . 0))
          (quote (6 . "Continuous"))
          (cons 2 name)))
      (if (car conf)
        (setq dxf (append dxf (list (cons 62 (atoi (car conf)))))))
      (if (cadr conf)
        (progn (vectra:linetype-get (cadr conf))
          (setq dxf (append dxf (list (cons 6 (cadr conf)))))))
      (if (caddr conf)
        (setq dxf (append dxf (list (cons 370 (atoi (caddr conf)))))))
      (if (and (not (null (cadddr conf)))
          (= "FALSE"
            (strcase (cadddr conf))))
        (setq dxf (append dxf (list (cons 290 0)))))
      (entmake dxf))
    layer))
```
</details>

---

### vectra:layer-get1

**ç”¨æ³•**:
```lisp
(vectra:layer-get1 name dxf)
```

**å‚æ•°**: 1 name  : æœªè¯†åˆ«å®šä¹‰;2 dxf  : ç»„ç å·;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:layer-get1 (name dxf / r)
  (setq r (tblsearch "LAYER"
      name))
  (if (null r)
    (setq r (entmake (vectra:set (list (quote (0 . "LAYER"))
            (quote (100 . "AcDbSymbolTableRecord"))
            (quote (100 . "AcDbLayerTableRecord"))
            (quote (70 . 0))
            (quote (6 . "Continuous"))
            (quote (62 . 7))
            (quote (370 . -3))
            (cons 2 name))
          dxf))))
  r)
```
</details>

---

### vectra:line-closestpoint

**ç”¨æ³•**:
```lisp
(vectra:line-closestpoint line p extend)
```

**å‚æ•°**: 1 line  : æœªè¯†åˆ«å®šä¹‰;2 p  : æœªè¯†åˆ«å®šä¹‰;3 extend  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:line-closestpoint (line p extend)
  (vlax-curve-getclosestpointto (vectra:ensure-object line)
    p extend))
```
</details>

---

### vectra:line-getangle

**ç”¨æ³•**:
```lisp
(vectra:line-getangle line)
```

**å‚æ•°**: 1 line  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:line-getangle (line /)
  (apply (quote angle)
    (vectra:dxf (vectra:ensure-ename line)
      (quote (10 11)))))
```
</details>

---

### vectra:line-getendnear

**ç”¨æ³•**:
```lisp
(vectra:line-getendnear line p)
```

**å‚æ•°**: 1 line  : æœªè¯†åˆ«å®šä¹‰;2 p  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:line-getendnear (line p / pts)
  (setq pts (vectra:dxf1 line (quote (10 11))))
  (if (< (distance (cdar pts)
        p)
      (distance (cdadr pts)
        p))
    (car pts)
    (cadr pts)))
```
</details>

---

### vectra:line-getinters

**ç”¨æ³•**:
```lisp
(vectra:line-getinters l1 l2)
```

**å‚æ•°**: 1 l1  : æœªè¯†åˆ«å®šä¹‰;2 l2  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:line-getinters (l1 l2 / dx1 dx2)
  (setq dx1 (entget l1)
    dx2 (entget l2))
  (inters (cdr (assoc 10 dx1))
    (cdr (assoc 11 dx1))
    (cdr (assoc 10 dx2))
    (cdr (assoc 11 dx2))
    nil))
```
</details>

---

### vectra:line-parallel

**ç”¨æ³•**:
```lisp
(vectra:line-parallel l1 l2)
```

**å‚æ•°**: 1 l1  : æœªè¯†åˆ«å®šä¹‰;2 l2  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:line-parallel (l1 l2 / a)
  (setq a (vectra:angle-include (vectra:line-getangle l1)
      (vectra:line-getangle l2)))
  (or (equal a pi 0.01)
    (equal a 0.0 0.01)))
```
</details>

---

### vectra:linetype-get

**ç”¨æ³•**:
```lisp
(vectra:linetype-get name)
```

**å‚æ•°**: 1 name  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:linetype-get (name / lt)
  (setq lt (vl-catch-all-apply (quote vla-item)
      (list (vla-get-linetypes (vla-get-activedocument (vlax-get-acad-object)))
        name)))
  (if (vl-catch-all-error-p lt)
    (setq lt (vectra:linetype-load name "acad.lin")))
  lt)
```
</details>

---

### vectra:linetype-load

**ç”¨æ³•**:
```lisp
(vectra:linetype-load name filename)
```

**å‚æ•°**: 1 name  : æœªè¯†åˆ«å®šä¹‰;2 filename  : æ–‡ä»¶å;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:linetype-load (name filename /)
  (vla-load (vla-get-linetypes (vla-get-activedocument (vlax-get-acad-object)))
    name filename))
```
</details>

---

### vectra:lisp-load

**ç”¨æ³•**:
```lisp
(vectra:lisp-load filename)
```

**å‚æ•°**: 1 filename  : æ–‡ä»¶å;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:lisp-load (filename /)
  (if (setq content (vectra:file-readstring filename))
    (read content)
    (princ (strcat "\npsk-load-lispfileé”™è¯¯: æ— æ³•åŠ è½½æ–‡ä»¶ \""
        filename "\""))))
```
</details>

---

### vectra:list->var

**ç”¨æ³•**:
```lisp
(vectra:list->var lsp)
```

**å‚æ•°**: 1 lsp  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:list->var (lsp / e n var)
  (if (vl-consp lsp)
    (progn (setq n (1- (length lsp))
        var (vlax-make-safearray vlax-vbvariant (cons 0 n)))
      (vlax-safearray-fill var (mapcar (quote (lambda (e)
              (vectra:list->var e)))
          lsp))
      var)
    (vlax-make-variant lsp)))
```
</details>

---

### vectra:make-arc

**ç”¨æ³•**:
```lisp
(vectra:make-arc point radius start end)
```

**å‚æ•°**: 1 point  : æœªè¯†åˆ«å®šä¹‰;2 radius  : æœªè¯†åˆ«å®šä¹‰;3 start  : æœªè¯†åˆ«å®šä¹‰;4 end  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:make-arc (point radius start end /)
  (vectra:entmake (list (quote (0 . "ARC"))
      (cons 10 point)
      (cons 40 radius)
      (cons 50 start)
      (cons 51 end))))
```
</details>

---

### vectra:make-block

**ç”¨æ³•**:
```lisp
(vectra:make-block name funcname params)
```

**å‚æ•°**: 1 name  : æœªè¯†åˆ«å®šä¹‰;2 funcname  : æœªè¯†åˆ«å®šä¹‰;3 params  : å‚æ•°åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:make-block (name funcname params / en r)
  (entmake (list (cons 0 "BLOCK")
      (cons 2 name)
      (cons 70 (if (= "*U"
            name)
          1 0))
      (cons 10 $addnew-block-base)))
  (setq r (vl-catch-all-apply funcname params))
  (setq en (entmake (quote ((0 . "ENDBLK")))))
  (if (vl-catch-all-error-p r)
    (progn (princ (strcat "\nerror in vectra:make-block:"
          (vl-princ-to-string (cons funcname params))))
      nil)
    en))
```
</details>

---

### vectra:make-circle

**ç”¨æ³•**:
```lisp
(vectra:make-circle center radius)
```

**å‚æ•°**: 1 center  : æœªè¯†åˆ«å®šä¹‰;2 radius  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:make-circle (center radius /)
  (vectra:entmake (list (quote (0 . "CIRCLE"))
      (cons 10 center)
      (cons 40 radius))))
```
</details>

---

### vectra:make-ellipse

**ç”¨æ³•**:
```lisp
(vectra:make-ellipse p1 p2 r1)
```

**å‚æ•°**: 1 p1  : æœªè¯†åˆ«å®šä¹‰;2 p2  : æœªè¯†åˆ«å®šä¹‰;3 r1  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:make-ellipse (p1 p2 r1)
  (vectra:entmake (list (quote (0 . "ELLIPSE"))
      (quote (100 . "AcDbEntity"))
      (quote (100 . "AcDbEllipse"))
      (cons 10 p1)
      (cons 11 p2)
      (cons 40 r1)
      (cons 41 0.0)
      (quote (42 . 6.28319)))))
```
</details>

---

### vectra:make-insert

**ç”¨æ³•**:
```lisp
(vectra:make-insert name point sx sy sz ang)
```

**å‚æ•°**: 1 name  : æœªè¯†åˆ«å®šä¹‰;2 point  : æœªè¯†åˆ«å®šä¹‰;3 sx  : æœªè¯†åˆ«å®šä¹‰;4 sy  : æœªè¯†åˆ«å®šä¹‰;5 sz  : æœªè¯†åˆ«å®šä¹‰;6 ang  : è§’åº¦å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:make-insert (name point sx sy sz ang)
  (vectra:entmake (list (quote (0 . "INSERT"))
      (cons 2 name)
      (cons 10 point)
      (cons 41 sx)
      (cons 42 sy)
      (cons 43 sz)
      (cons 50 ang))))
```
</details>

---

### vectra:make-insert-with-funcs

**ç”¨æ³•**:
```lisp
(vectra:make-insert-with-funcs name point funcname params)
```

**å‚æ•°**: 1 name  : æœªè¯†åˆ«å®šä¹‰;2 point  : æœªè¯†åˆ«å®šä¹‰;3 funcname  : æœªè¯†åˆ«å®šä¹‰;4 params  : å‚æ•°åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:make-insert-with-funcs (name point funcname params /)
  (setq name (vectra:make-block name funcname params))
  (vectra:make-insert name point 1.0 1.0 1.0 0.0))
```
</details>

---

### vectra:make-insert-with-funcs-a

**ç”¨æ³•**:
```lisp
(vectra:make-insert-with-funcs-a name point funcname params sx sy sz ang)
```

**å‚æ•°**: 1 name  : æœªè¯†åˆ«å®šä¹‰;2 point  : æœªè¯†åˆ«å®šä¹‰;3 funcname  : æœªè¯†åˆ«å®šä¹‰;4 params  : å‚æ•°åˆ—è¡¨;5 sx  : æœªè¯†åˆ«å®šä¹‰;6 sy  : æœªè¯†åˆ«å®šä¹‰;7 sz  : æœªè¯†åˆ«å®šä¹‰;8 ang  : è§’åº¦å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:make-insert-with-funcs-a (name point funcname params sx sy sz ang /)
  (setq name (vectra:make-block name funcname params))
  (vectra:make-insert name point sx sy sz ang))
```
</details>

---

### vectra:make-line

**ç”¨æ³•**:
```lisp
(vectra:make-line p1 p2)
```

**å‚æ•°**: 1 p1  : æœªè¯†åˆ«å®šä¹‰;2 p2  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:make-line (p1 p2 /)
  (vectra:entmake (list (quote (0 . "LINE"))
      (cons 10 p1)
      (cons 11 p2))))
```
</details>

---

### vectra:make-polyline

**ç”¨æ³•**:
```lisp
(vectra:make-polyline points closed width)
```

**å‚æ•°**: 1 points  : æœªè¯†åˆ«å®šä¹‰;2 closed  : æœªè¯†åˆ«å®šä¹‰;3 width  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:make-polyline (points closed width / e)
  (vectra:entmake (append (list (quote (0 . "LWPOLYLINE"))
        (quote (100 . "AcDbEntity"))
        (quote (100 . "AcDbPolyline"))
        (cons 90 (length points))
        (cons 70 closed)
        (cons 43 width))
      (mapcar (quote (lambda (e)
            (cons 10 e)))
        points))))
```
</details>

---

### vectra:make-setenv

**ç”¨æ³•**:
```lisp
(vectra:make-setenv vars)
```

**å‚æ•°**: 1 vars  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:make-setenv (vars / rv)
  (setq rv (list $addnew-layer $addnew-color $addnew-linetype $addnew-lineweight $addnew-textstyle $addnew-block-base))
  (vectra:set-symbol-notnull (quote $addnew-layer)
    (car vars))
  (vectra:set-symbol-notnull (quote $addnew-color)
    (cadr vars))
  (vectra:set-symbol-notnull (quote $addnew-linetype)
    (caddr vars))
  (vectra:set-symbol-notnull (quote $addnew-lineweight)
    (cadddr vars))
  (vectra:set-symbol-notnull (quote $addnew-textstyle)
    (car (cddddr vars)))
  (vectra:set-symbol-notnull (quote $addnew-block-base)
    (cadr (cddddr vars)))
  rv)
```
</details>

---

### vectra:make-sharparc

**ç”¨æ³•**:
```lisp
(vectra:make-sharparc p r a4 a5)
```

**å‚æ•°**: 1 p  : æœªè¯†åˆ«å®šä¹‰;2 r  : æœªè¯†åˆ«å®šä¹‰;3 a4  : æœªè¯†åˆ«å®šä¹‰;4 a5  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:make-sharparc (p r a4 a5)
  (if (or (and (> a5 a4)
        (< (- a5 a4)
          pi))
      (and (< a5 a4)
        (> (- a4 a5)
          pi)))
    (vectra:make-arc p r a4 a5)
    (vectra:make-arc p r a5 a4)))
```
</details>

---

### vectra:make-text

**ç”¨æ³•**:
```lisp
(vectra:make-text text point align height width ang)
```

**å‚æ•°**: 1 text  : æœªè¯†åˆ«å®šä¹‰;2 point  : æœªè¯†åˆ«å®šä¹‰;3 align  : æœªè¯†åˆ«å®šä¹‰;4 height  : æœªè¯†åˆ«å®šä¹‰;5 width  : æœªè¯†åˆ«å®šä¹‰;6 ang  : è§’åº¦å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:make-text (text point align height width ang / c)
  (vectra:textstyle-get $addnew-textstyle "gbenor.shx"
    "hztxt.shx"
    0.7)
  (setq c (cdr (assoc (strcase align)
        (quote (("L"
              0 0)
            ("C"
              1 0)
            ("R"
              2 0)
            ("A"
              3 0)
            ("M"
              4 3)
            ("F"
              5 0)
            ("TL"
              0 3)
            ("TC"
              1 3)
            ("TR"
              2 3)
            ("ML"
              0 2)
            ("MC"
              1 2)
            ("MR"
              2 2)
            ("BL"
              0 1)
            ("BC"
              1 1)
            ("BR"
              2 1))))))
  (vectra:entmake (list (quote (0 . "TEXT"))
      (cons 1 text)
      (cons 7 $addnew-textstyle)
      (cons 10 point)
      (cons 11 point)
      (cons 40 height)
      (cons 41 width)
      (cons 50 ang)
      (cons 72 (car c))
      (cons 73 (cadr c)))))
```
</details>

---

### vectra:mid

**ç”¨æ³•**:
```lisp
(vectra:mid p1 p2)
```

**å‚æ•°**: 1 p1  : æœªè¯†åˆ«å®šä¹‰;2 p2  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:mid (p1 p2 / e)
  (mapcar (function (lambda (e)
        (/ e 2.0)))
    (mapcar (function +)
      p1 p2)))
```
</details>

---

### vectra:mxm

**ç”¨æ³•**:
```lisp
(vectra:mxm m q)
```

**å‚æ•°**: 1 m  : æœªè¯†åˆ«å®šä¹‰;2 q  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:mxm (m q)
  (mapcar (quote (lambda (r)
        (vectra:mxv (vectra:trp q)
          r)))
    m))
```
</details>

---

### vectra:mxv

**ç”¨æ³•**:
```lisp
(vectra:mxv m v)
```

**å‚æ•°**: 1 m  : æœªè¯†åˆ«å®šä¹‰;2 v  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:mxv (m v)
  (mapcar (quote (lambda (r)
        (apply (quote +)
          (mapcar (quote *)
            r v))))
    m))
```
</details>

---

### vectra:nentsel

**ç”¨æ³•**:
```lisp
(vectra:nentsel msg filter)
```

**å‚æ•°**: 1 msg  : æç¤ºä¿¡æ¯;2 filter  : è¿‡æ»¤dxfç»„ç ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:nentsel (msg filter /)
  (vectra:entsel-inner msg filter t))
```
</details>

---

### vectra:number-padding

**ç”¨æ³•**:
```lisp
(vectra:number-padding number len)
```

**å‚æ•°**: 1 number  : æœªè¯†åˆ«å®šä¹‰;2 len  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:number-padding (number len / r)
  (setq r (itoa number))
  (repeat (- len (strlen r))
    (setq r (strcat "0"
        r)))
  r)
```
</details>

---

### vectra:number-padding-last

**ç”¨æ³•**:
```lisp
(vectra:number-padding-last number len)
```

**å‚æ•°**: 1 number  : æœªè¯†åˆ«å®šä¹‰;2 len  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:number-padding-last (number len / p r)
  (setq r (rtos number 2 len))
  (if (/= len 0)
    (progn (setq p (vl-string-search "."
          r))
      (if (null p)
        (setq p (strlen r)
          r (strcat r ".")))
      (repeat (- len (strlen r)
          (- p)
          -1)
        (setq r (strcat r "0")))))
  r)
```
</details>

---

### vectra:osnap-disable

**ç”¨æ³•**:
```lisp
(vectra:osnap-disable )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:osnap-disable nil (if (null $p-saved-osmode)
    (setq $p-saved-osmode (getvar "OSMODE")))
  (if (< $p-saved-osmode 16384)
    (setvar "OSMODE"
      (+ $p-saved-osmode 16384))))
```
</details>

---

### vectra:osnap-restore

**ç”¨æ³•**:
```lisp
(vectra:osnap-restore )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:osnap-restore nil (if (not (null $p-saved-osmode))
    (progn (setvar "OSMODE"
        $p-saved-osmode)
      (setq $p-saved-osmode nil))))
```
</details>

---

### vectra:rad->deg

**ç”¨æ³•**:
```lisp
(vectra:rad->deg rad)
```

**å‚æ•°**: 1 rad  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:rad->deg (rad)
  (* 180.0 (/ rad pi)))
```
</details>

---

### vectra:readme

**è¯´æ˜**: æ¥æºäºæ˜ç»å¤§ä½¬ vectra å¼€æºçš„ 152ä¸ªå‡½æ•°.

**ç”¨æ³•**:
```lisp
(vectra:readme )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:readme nil "æ¥æºäºæ˜ç»å¤§ä½¬ vectra å¼€æºçš„ 152ä¸ªå‡½æ•°.")
```
</details>

---

### vectra:refgeom

**ç”¨æ³•**:
```lisp
(vectra:refgeom ename)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:refgeom (ename / elst ang norm mat)
  (setq elst (entget ename)
    ang (cdr (assoc 50 elst))
    norm (cdr (assoc 210 elst)))
  (list (setq mat (vectra:mxm (mapcar (function (lambda (v)
              (trans v 0 norm t)))
          (quote ((1.0 0.0 0.0)
              (0.0 1.0 0.0)
              (0.0 0.0 1.0))))
        (vectra:mxm (list (list (cos ang)
              (- (sin ang))
              0.0)
            (list (sin ang)
              (cos ang)
              0.0)
            (quote (0.0 0.0 1.0)))
          (list (list (cdr (assoc 41 elst))
              0.0 0.0)
            (list 0.0 (cdr (assoc 42 elst))
              0.0)
            (list 0.0 0.0 (cdr (assoc 43 elst)))))))
    (mapcar (quote -)
      (trans (cdr (assoc 10 elst))
        norm 0)
      (vectra:mxv mat (cdr (assoc 10 (tblsearch "BLOCK"
              (cdr (assoc 2 elst)))))))))
```
</details>

---

### vectra:regexp-match

**ç”¨æ³•**:
```lisp
(vectra:regexp-match str pattern)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 pattern  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:regexp-match (str pattern / matchs reg r)
  (setq reg (vlax-create-object "vbscript.regexp"))
  (vlax-put-property reg (quote global)
    1)
  (vlax-put-property reg (quote ignorecase)
    1)
  (vlax-put-property reg (quote pattern)
    pattern)
  (setq matchs (vlax-invoke reg (quote execute)
      str))
  (vlax-for k matchs (setq r (cons (vlax-get k (quote value))
        r)))
  (vlax-release-object reg)
  (reverse r))
```
</details>

---

### vectra:regexp-replace

**ç”¨æ³•**:
```lisp
(vectra:regexp-replace str pattern new)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 pattern  : æœªè¯†åˆ«å®šä¹‰;3 new  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:regexp-replace (str pattern new / reg r)
  (setq reg (vlax-create-object "vbscript.regexp"))
  (vlax-put-property reg (quote pattern)
    pattern)
  (vlax-put-property reg (quote global)
    1)
  (vlax-put-property reg (quote ignorecase)
    1)
  (setq r (vlax-invoke reg (quote replace)
      str new))
  (vlax-release-object reg)
  r)
```
</details>

---

### vectra:round

**ç”¨æ³•**:
```lisp
(vectra:round f num)
```

**å‚æ•°**: 1 f  : æœªè¯†åˆ«å®šä¹‰;2 num  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:round (f num /)
  (fix (- f (rem f num)
      (- num))))
```
</details>

---

### vectra:set

**ç”¨æ³•**:
```lisp
(vectra:set lst values)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 values  : å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:set (lst values / old)
  (if (and values (atom (car values)))
    (setq values (list values)))
  (foreach value values (if (setq old (assoc (car value)
          lst))
      (setq lst (subst value old lst))
      (setq lst (append lst (list value)))))
  lst)
```
</details>

---

### vectra:set-symbol-notnull

**ç”¨æ³•**:
```lisp
(vectra:set-symbol-notnull sym val)
```

**å‚æ•°**: 1 sym  : æœªè¯†åˆ«å®šä¹‰;2 val  : å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:set-symbol-notnull (sym val /)
  (if val (set sym val)))
```
</details>

---

### vectra:set-values

**ç”¨æ³•**:
```lisp
(vectra:set-values lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:set-values (lst / old)
  (foreach e lst (setq old (cons (cons (car e)
          (vl-symbol-value (car e)))
        old))
    (set (car e)
      (cdr e)))
  (reverse old))
```
</details>

---

### vectra:set1

**ç”¨æ³•**:
```lisp
(vectra:set1 lst key value)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 key  : é”®ï¼Œå…³é”®å­—;3 value  : å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:set1 (lst key value / old)
  (if (setq old (assoc key lst))
    (setq lst (subst (cons key value)
        old lst))
    (setq lst (append lst (list (cons key value))))))
```
</details>

---

### vectra:setvars

**ç”¨æ³•**:
```lisp
(vectra:setvars pairs)
```

**å‚æ•°**: 1 pairs  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:setvars (pairs / changed name old value)
  (if (atom (car pairs))
    (setq pairs (list pairs)))
  (foreach pair pairs (setq name (car pair)
      value (cdr pair)
      old (getvar name))
    (if old (progn (setq changed (cons (cons name old)
            changed))
        (setvar name value))))
  (reverse changed))
```
</details>

---

### vectra:sqr

**ç”¨æ³•**:
```lisp
(vectra:sqr f)
```

**å‚æ•°**: 1 f  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:sqr (f /)
  (* f f))
```
</details>

---

### vectra:ss->enames

**ç”¨æ³•**:
```lisp
(vectra:ss->enames ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:ss->enames (ss / en handles n)
  (if ss (progn (repeat (setq n (sslength ss))
        (setq en (ssname ss (setq n (1- n)))
          handles (cons en handles)))))
  handles)
```
</details>

---

### vectra:ss->handles

**ç”¨æ³•**:
```lisp
(vectra:ss->handles ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:ss->handles (ss / e)
  (mapcar (function (lambda (e)
        (vectra:dxf e 5)))
    (vectra:ss->enames ss)))
```
</details>

---

### vectra:ss-highlight

**ç”¨æ³•**:
```lisp
(vectra:ss-highlight ss)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:ss-highlight (ss / en n)
  (if $p-ss-highlighted (progn (vectra:ss-highlight-inner $p-ss-highlighted 4)
      (setq $p-ss-highlighted nil)))
  (if ss (progn (vectra:ss-highlight-inner ss 3)
      (setq $p-ss-highlighted ss))))
```
</details>

---

### vectra:ss-highlight-inner

**ç”¨æ³•**:
```lisp
(vectra:ss-highlight-inner ss status)
```

**å‚æ•°**: 1 ss  : é€‰æ‹©é›†;2 status  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:ss-highlight-inner (ss status / en n)
  (if ss (progn (repeat (setq n (sslength ss))
        (setq en (ssname ss (setq n (1- n))))
        (redraw en status)))))
```
</details>

---

### vectra:startundomark

**ç”¨æ³•**:
```lisp
(vectra:startundomark )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:startundomark nil (if (not $p-undo-started)
    (progn (vla-startundomark (vla-get-activedocument (vlax-get-acad-object)))
      (setq $p-undo-started t))))
```
</details>

---

### vectra:string-connect

**ç”¨æ³•**:
```lisp
(vectra:string-connect lst delim)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 delim  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:string-connect (lst delim / e str)
  (setq str (car lst)
    lst (cdr lst))
  (while (setq e (car lst))
    (setq str (strcat str delim e))
    (setq lst (cdr lst)))
  str)
```
</details>

---

### vectra:string-left

**ç”¨æ³•**:
```lisp
(vectra:string-left str n)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 n  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:string-left (str n)
  (substr str 1 n))
```
</details>

---

### vectra:string-right

**ç”¨æ³•**:
```lisp
(vectra:string-right str n)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 n  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:string-right (str n / s sl)
  (setq sl (strlen str)
    s (- sl n -1))
  (if (< s 1)
    (setq s 1))
  (substr str s n))
```
</details>

---

### vectra:string-setnotempty

**ç”¨æ³•**:
```lisp
(vectra:string-setnotempty symbol value)
```

**å‚æ•°**: 1 symbol  : æœªè¯†åˆ«å®šä¹‰;2 value  : å€¼;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:string-setnotempty (symbol value /)
  (if (or (null (vl-symbol-value symbol))
      (equal (vl-symbol-value symbol)
        ""))
    (set symbol value)))
```
</details>

---

### vectra:string-subst

**ç”¨æ³•**:
```lisp
(vectra:string-subst str find repl)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 find  : æœªè¯†åˆ«å®šä¹‰;3 repl  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:string-subst (str find repl / pos len)
  (setq len (strlen repl)
    pos 0)
  (while (setq pos (vl-string-search find str pos))
    (setq str (vl-string-subst repl find str pos)
      pos (+ pos len)))
  str)
```
</details>

---

### vectra:string-substp

**ç”¨æ³•**:
```lisp
(vectra:string-substp str find repl p)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 find  : æœªè¯†åˆ«å®šä¹‰;3 repl  : æœªè¯†åˆ«å®šä¹‰;4 p  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:string-substp (str find repl p / pos len)
  (setq len (strlen find)
    pos 0 occ 0)
  (while (and (setq pos (vl-string-search find str pos))
      (< (setq occ (1+ occ))
        p))
    (setq pos (+ pos len)))
  (if (= occ p)
    (vl-string-subst repl find str pos)
    str))
```
</details>

---

### vectra:string-tokenize

**ç”¨æ³•**:
```lisp
(vectra:string-tokenize str delim)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;2 delim  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:string-tokenize (str delim / buff l2)
  (setq str (vl-string->list str)
    delim (vl-string->list delim))
  (while str (if (member (car str)
        delim)
      (setq l2 (cons (vl-list->string (reverse buff))
          l2)
        buff nil)
      (setq buff (cons (car str)
          buff)))
    (setq str (cdr str)))
  (setq l2 (cons (vl-list->string (reverse buff))
      l2))
  (reverse l2))
```
</details>

---

### vectra:stringp

**ç”¨æ³•**:
```lisp
(vectra:stringp v)
```

**å‚æ•°**: 1 v  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:stringp (v)
  (= (quote str)
    (type v)))
```
</details>

---

### vectra:tan

**ç”¨æ³•**:
```lisp
(vectra:tan a)
```

**å‚æ•°**: 1 a  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:tan (a)
  (/ (sin a)
    (cos a)))
```
</details>

---

### vectra:template-eval

**ç”¨æ³•**:
```lisp
(vectra:template-eval template params)
```

**å‚æ•°**: 1 template  : æœªè¯†åˆ«å®šä¹‰;2 params  : å‚æ•°åˆ—è¡¨;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:template-eval (template params / r)
  (apply (quote strcat)
    (mapcar (function (lambda (e)
          (if (vl-consp e)
            (if (setq r (vectra:get params (car e)))
              (cond ((numberp r)
                  (setq dig (cadr e))
                  (if (null dig)
                    (setq dig 0)
                    (setq dig (atoi dig)))
                  (vectra:number-padding-last r dig))
                (t (vl-princ-to-string r)))
              (strcat "{"
                (car e)
                "}"))
            e)))
      (vectra:template-parse template))))
```
</details>

---

### vectra:template-parse

**ç”¨æ³•**:
```lisp
(vectra:template-parse template)
```

**å‚æ•°**: 1 template  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:template-parse (template /)
  (vectra:template-parse-inner template "{"
    "}"))
```
</details>

---

### vectra:template-parse-inner

**ç”¨æ³•**:
```lisp
(vectra:template-parse-inner template gs ge)
```

**å‚æ•°**: 1 template  : æœªè¯†åˆ«å®šä¹‰;2 gs  : æœªè¯†åˆ«å®šä¹‰;3 ge  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:template-parse-inner (template gs ge / buff ch result)
  (setq template (vl-string->list template))
  (while (setq ch (car template))
    (cond ((= ch (ascii gs))
        (if buff (setq result (cons (vl-list->string (reverse buff))
              result)
            buff nil)))
      ((= ch (ascii ge))
        (if buff (setq result (cons (list (vl-list->string (reverse buff)))
              result)
            buff nil)))
      (t (setq buff (cons ch buff))))
    (setq template (cdr template)))
  (if buff (setq result (cons (vl-list->string (reverse buff))
        result)))
  (mapcar (function (lambda (e)
        (if (atom e)
          e (vectra:string-tokenize (car e)
            ":"))))
    (reverse result)))
```
</details>

---

### vectra:textstyle-get

**ç”¨æ³•**:
```lisp
(vectra:textstyle-get name font bigfont width)
```

**å‚æ•°**: 1 name  : æœªè¯†åˆ«å®šä¹‰;2 font  : æœªè¯†åˆ«å®šä¹‰;3 bigfont  : æœªè¯†åˆ«å®šä¹‰;4 width  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:textstyle-get (name font bigfont width / style styles)
  (setq styles (vla-get-textstyles (vla-get-activedocument (vlax-get-acad-object))))
  (if (vl-catch-all-error-p (setq style (vl-catch-all-apply (quote vla-item)
          (list styles name))))
    (progn (setq style (vla-add styles name))
      (vla-put-fontfile style font)
      (vla-put-bigfontfile style bigfont)
      (vla-put-width style width)))
  style)
```
</details>

---

### vectra:timer-start

**ç”¨æ³•**:
```lisp
(vectra:timer-start )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:timer-start nil (setq $p-timestart (vectra:timestamp)))
```
</details>

---

### vectra:timer-stop

**ç”¨æ³•**:
```lisp
(vectra:timer-stop )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:timer-stop (/ el)
  (setq el (- (vectra:timestamp)
      $p-timestart))
  (setq $p-timestart (vectra:timestamp))
  el)
```
</details>

---

### vectra:timestamp

**ç”¨æ³•**:
```lisp
(vectra:timestamp )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:timestamp nil (getvar "MILLISECS"))
```
</details>

---

### vectra:trp

**ç”¨æ³•**:
```lisp
(vectra:trp m)
```

**å‚æ•°**: 1 m  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:trp (m)
  (apply (quote mapcar)
    (cons (quote list)
      m)))
```
</details>

---

### vectra:uid

**ç”¨æ³•**:
```lisp
(vectra:uid )
```

**å‚æ•°**: None

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:uid (/)
  (if (null $p-uid-base)
    (setq $p-uid-base 1))
  (setq $p-uid-base (abs (vectra:hash-1 (getvar (quote millisecs))
        $p-uid-base))))
```
</details>

---

### vectra:unset

**ç”¨æ³•**:
```lisp
(vectra:unset lst keys)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;2 keys  : é”®ï¼Œå…³é”®å­—;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:unset (lst keys /)
  (if (atom keys)
    (setq keys (list keys)))
  (vl-remove-if (function (lambda (e)
        (member (car e)
          keys)))
    lst))
```
</details>

---

### vectra:var->list

**ç”¨æ³•**:
```lisp
(vectra:var->list var)
```

**å‚æ•°**: 1 var  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:var->list (var / e)
  (cond ((= (quote safearray)
        (type var))
      (mapcar (quote (lambda (e)
            (vectra:var->list e)))
        (vlax-safearray->list var)))
    ((= (quote variant)
        (type var))
      (vectra:var->list (vlax-variant-value var)))
    (t var)))
```
</details>

---

### vectra:vector-angle

**ç”¨æ³•**:
```lisp
(vectra:vector-angle v)
```

**å‚æ•°**: 1 v  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:vector-angle (v /)
  (atan (cadr v)
    (car v)))
```
</details>

---

### vectra:vector-angle2

**ç”¨æ³•**:
```lisp
(vectra:vector-angle2 v1 v2)
```

**å‚æ•°**: 1 v1  : æœªè¯†åˆ«å®šä¹‰;2 v2  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:vector-angle2 (v1 v2 / rt)
  (vectra:acos (vectra:vector-dotproduct (vectra:vector-normal v1)
      (vectra:vector-normal v2))))
```
</details>

---

### vectra:vector-dotproduct

**ç”¨æ³•**:
```lisp
(vectra:vector-dotproduct v1 v2)
```

**å‚æ•°**: 1 v1  : æœªè¯†åˆ«å®šä¹‰;2 v2  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:vector-dotproduct (v1 v2 /)
  (apply (quote +)
    (mapcar (quote *)
      v1 v2)))
```
</details>

---

### vectra:vector-from2p

**ç”¨æ³•**:
```lisp
(vectra:vector-from2p p1 p2)
```

**å‚æ•°**: 1 p1  : æœªè¯†åˆ«å®šä¹‰;2 p2  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:vector-from2p (p1 p2 /)
  (vectra:vector-normal (mapcar (quote -)
      p2 p1)))
```
</details>

---

### vectra:vector-len

**ç”¨æ³•**:
```lisp
(vectra:vector-len v)
```

**å‚æ•°**: 1 v  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:vector-len (v /)
  (sqrt (apply (quote +)
      (mapcar (quote *)
        v v))))
```
</details>

---

### vectra:vector-normal

**ç”¨æ³•**:
```lisp
(vectra:vector-normal v)
```

**å‚æ•°**: 1 v  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:vector-normal (v / len)
  (setq len (vectra:vector-len v))
  (if (equal len 0.0 1.0e-06)
    v (mapcar (function (lambda (e)
          (/ e len)))
      v)))
```
</details>

---

### vectra:vector-reverse

**ç”¨æ³•**:
```lisp
(vectra:vector-reverse v)
```

**å‚æ•°**: 1 v  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:vector-reverse (v /)
  (mapcar (quote -)
    v))
```
</details>

---

### vectra:xdata-all

**ç”¨æ³•**:
```lisp
(vectra:xdata-all ename)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xdata-all (ename /)
  (vectra:xdata-get-inner ename "*"))
```
</details>

---

### vectra:xdata-exist

**ç”¨æ³•**:
```lisp
(vectra:xdata-exist ename key)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 key  : é”®ï¼Œå…³é”®å­—;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xdata-exist (ename key /)
  (member key (vectra:xdata-keys ename)))
```
</details>

---

### vectra:xdata-get

**ç”¨æ³•**:
```lisp
(vectra:xdata-get ename appname)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 appname  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xdata-get (ename appname /)
  (cdar (vectra:xdata-get-inner ename appname)))
```
</details>

---

### vectra:xdata-get-inner

**ç”¨æ³•**:
```lisp
(vectra:xdata-get-inner ename appname)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 appname  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xdata-get-inner (ename appname /)
  (cdr (assoc -3 (entget ename (list appname)))))
```
</details>

---

### vectra:xdata-keys

**ç”¨æ³•**:
```lisp
(vectra:xdata-keys ename)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xdata-keys (ename /)
  (mapcar (quote car)
    (vectra:xdata-all ename)))
```
</details>

---

### vectra:xdata-remove

**ç”¨æ³•**:
```lisp
(vectra:xdata-remove ename appid)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 appid  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xdata-remove (ename appid /)
  (cond ((= "*"
        appid)
      (vectra:xdata-set-inner ename (mapcar (quote list)
          (vectra:xdata-keys ename))))
    ((listp appid)
      (vectra:xdata-set-inner ename (mapcar (quote list)
          appid)))
    (t (vectra:xdata-set-inner ename (list (cons appid nil))))))
```
</details>

---

### vectra:xdata-set

**ç”¨æ³•**:
```lisp
(vectra:xdata-set ename appid xdata)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 appid  : æœªè¯†åˆ«å®šä¹‰;3 xdata  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xdata-set (ename appid xdata /)
  (if (null (tblsearch "APPID"
        appid))
    (regapp appid))
  (vectra:xdata-set-inner ename (list (cons appid xdata))))
```
</details>

---

### vectra:xdata-set-inner

**ç”¨æ³•**:
```lisp
(vectra:xdata-set-inner ename xdata)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 xdata  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xdata-set-inner (ename xdata /)
  (entmod (list (cons -1 ename)
      (cons -3 xdata))))
```
</details>

---

### vectra:xprop-exist

**ç”¨æ³•**:
```lisp
(vectra:xprop-exist ename appname names)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 appname  : æœªè¯†åˆ«å®šä¹‰;3 names  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xprop-exist (ename appname names / rv)
  (setq rv (vectra:xprop-get ename appname names))
  (cond ((atom names)
      rv)
    ((vl-consp names)
      (= (length names)
        (length rv)))))
```
</details>

---

### vectra:xprop-get

**ç”¨æ³•**:
```lisp
(vectra:xprop-get ename appname names)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 appname  : æœªè¯†åˆ«å®šä¹‰;3 names  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xprop-get (ename appname names / xdata rv)
  (setq xdata (vectra:xdata-get ename appname))
  (cond ((atom names)
      (while xdata (if (= names (cdar xdata))
          (setq rv (cdadr xdata)
            xdata nil))
        (setq xdata (cddr xdata))))
    ((vl-consp names)
      (while xdata (if (member (cdar xdata)
            names)
          (setq rv (cons (cons (cdar xdata)
                (cdadr xdata))
              rv)
            names (vl-remove (cdar xdata)
              names)))
        (setq xdata (cddr xdata)))))
  rv)
```
</details>

---

### vectra:xprop-getall

**ç”¨æ³•**:
```lisp
(vectra:xprop-getall ename appname)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 appname  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xprop-getall (ename appname /)
  (vectra:xprop-unpack (vectra:xdata-get ename appname)))
```
</details>

---

### vectra:xprop-pack

**ç”¨æ³•**:
```lisp
(vectra:xprop-pack properties xdatatypes)
```

**å‚æ•°**: 1 properties  : æœªè¯†åˆ«å®šä¹‰;2 xdatatypes  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xprop-pack (properties xdatatypes / enc rv)
  (foreach e properties (setq enc (vectra:xprop-pack1 e xdatatypes))
    (setq rv (cons (car enc)
        rv)
      rv (cons (cadr enc)
        rv)))
  (reverse rv))
```
</details>

---

### vectra:xprop-pack1

**ç”¨æ³•**:
```lisp
(vectra:xprop-pack1 kv xdatatypes)
```

**å‚æ•°**: 1 kv  : æœªè¯†åˆ«å®šä¹‰;2 xdatatypes  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xprop-pack1 (kv xdatatypes / code name value)
  (setq name (car kv)
    value (cdr kv))
  (or (setq code (cdr (assoc name xdatatypes)))
    (setq code (cdr (assoc (type value)
          (quote ((str . 1000)
              (int . 1070)
              (real . 1040)
              (list . 1010)))))))
  (list (cons 1000 name)
    (cons code value)))
```
</details>

---

### vectra:xprop-remove

**ç”¨æ³•**:
```lisp
(vectra:xprop-remove ename appname names)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 appname  : æœªè¯†åˆ«å®šä¹‰;3 names  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xprop-remove (ename appname names / xdata xdata2)
  (if (and names (atom names))
    (setq names (list names)))
  (if names (progn (setq xdata (vectra:xdata-get ename appname))
      (while xdata (if (member (cdar xdata)
            names)
          (setq names (vl-remove (cdar xdata)
              names))
          (setq xdata2 (cons (car xdata)
              xdata2)
            xdata2 (cons (cadr xdata)
              xdata2)))
        (setq xdata (cddr xdata)))
      (setq xdata2 (reverse xdata2))
      (vectra:xdata-set ename appname xdata2))))
```
</details>

---

### vectra:xprop-replace

**ç”¨æ³•**:
```lisp
(vectra:xprop-replace ename appname prop datadef)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 appname  : æœªè¯†åˆ«å®šä¹‰;3 prop  : æœªè¯†åˆ«å®šä¹‰;4 datadef  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xprop-replace (ename appname prop datadef / xdata xdata2 tmp)
  (if (atom (car prop))
    (setq prop (list prop)))
  (vectra:xdata-set ename appname (vectra:xprop-pack prop datadef)))
```
</details>

---

### vectra:xprop-set

**ç”¨æ³•**:
```lisp
(vectra:xprop-set ename appname prop)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 appname  : æœªè¯†åˆ«å®šä¹‰;3 prop  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xprop-set (ename appname prop /)
  (vectra:xprop-set-inner ename appname prop nil))
```
</details>

---

### vectra:xprop-set-inner

**ç”¨æ³•**:
```lisp
(vectra:xprop-set-inner ename appname prop datadef)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 appname  : æœªè¯†åˆ«å®šä¹‰;3 prop  : æœªè¯†åˆ«å®šä¹‰;4 datadef  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xprop-set-inner (ename appname prop datadef / xdata xdata2 tmp)
  (if (atom (car prop))
    (setq prop (list prop)))
  (setq prop (vl-remove-if (quote (lambda (e)
          (or (null (car e))
            (= ""
              (car e))
            (null (cdr e))
            (vl-catch-all-error-p (cdr e)))))
      prop))
  (if prop (progn (setq xdata (vectra:xdata-get ename appname))
      (while xdata (if (setq tmp (assoc (cdar xdata)
              prop))
          (setq xdata2 (cons (car xdata)
              xdata2)
            xdata2 (cons (cons (caadr xdata)
                (cdr tmp))
              xdata2)
            prop (vl-remove tmp prop))
          (setq xdata2 (cons (car xdata)
              xdata2)
            xdata2 (cons (cadr xdata)
              xdata2)))
        (setq xdata (cddr xdata)))
      (if prop (foreach e prop (setq xdata2 (append (reverse (vectra:xprop-pack1 e datadef))
              xdata2))))
      (setq xdata2 (reverse xdata2))
      (vectra:xdata-set ename appname xdata2))))
```
</details>

---

### vectra:xprop-unpack

**ç”¨æ³•**:
```lisp
(vectra:xprop-unpack xdata)
```

**å‚æ•°**: 1 xdata  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vectra:xprop-unpack (xdata / rv)
  (while xdata (setq rv (cons (cons (cdar xdata)
          (cdadr xdata))
        rv)
      xdata (cddr xdata)))
  (reverse rv))
```
</details>

---

## vitalgg

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### vitalgg:helloworld

**è¯´æ˜**: å‡½æ•°åŠŸèƒ½è¯´æ˜ï¼Œä»¥åŠå‚æ•°è¯´æ˜ï¼Œä½œè€…ç­‰ä¿¡æ¯

**ç”¨æ³•**:
```lisp
(vitalgg:helloworld )
```

**å‚æ•°**: None

**è¿”å›å€¼**: è¿”å›å€¼ç±»å‹åŠè¯´æ˜

**ç¤ºä¾‹**:
```lisp
ç¤ºä¾‹
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vitalgg:helloworld nil "å‡½æ•°åŠŸèƒ½è¯´æ˜ï¼Œä»¥åŠå‚æ•°è¯´æ˜ï¼Œä½œè€…ç­‰ä¿¡æ¯"
  "è¿”å›å€¼ç±»å‹åŠè¯´æ˜"
  "ç¤ºä¾‹"
  (alert "Hello autolisp!")
  "æ³¨é‡Šæ–‡å­—ä¼šè¢«æ¸…é™¤æ‰ã€‚å¿…è¦çš„æ–‡å­—ï¼Œè¯·ç›´æ¥å†™å­—ç¬¦ä¸²ï¼Œå°±åƒè¯¥è¡Œè¿™æ ·ã€‚")
```
</details>

---

### vitalgg:test

**è¯´æ˜**: ç”¨äºæµ‹è¯•çš„å‡½æ•°ï¼Œstr ä¸ºå­—ç¬¦ä¸²ï¼Œby VitalGG

**ç”¨æ³•**:
```lisp
(vitalgg:test str)
```

**å‚æ•°**: 1 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: int: å‚æ•°å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—æ¯çš„ ascii ç 

**ç¤ºä¾‹**:
```lisp
(vitalgg:test "Match")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vitalgg:test (str)
  "ç”¨äºæµ‹è¯•çš„å‡½æ•°ï¼Œstr ä¸ºå­—ç¬¦ä¸²ï¼Œby VitalGG"
  "int: å‚æ•°å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—æ¯çš„ ascii ç "
  "(vitalgg:test \"Match\")"
  "ç”Ÿæˆå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªasciiç ã€‚"
  (ascii str))
```
</details>

---

## vla

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### vla:buildfilter

**è¯´æ˜**: æ„å»ºvariantåˆ—è¡¨;  å‚æ•°ï¼š;  filter:ç‚¹å¯¹åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(vla:buildfilter filter)
```

**å‚æ•°**: 1 filter  : è¿‡æ»¤dxfç»„ç ;

**è¿”å›å€¼**: variantåˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(vla:buildFilter '((1 . "123")(2 . "4556")))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vla:buildfilter (filter)
    "æ„å»ºvariantåˆ—è¡¨\nå‚æ•°ï¼š\nfilter:ç‚¹å¯¹åˆ—è¡¨"
    "variantåˆ—è¡¨"
    "(vla:buildfilter '((1 . \"123\")(2 . \"4556\")))"
    (vl-load-com)
    (mapcar (quote (lambda (lst typ)
                (vlax-make-variant (vlax-safearray-fill (vlax-make-safearray typ (cons 0 (1- (length lst))))
                        lst))))
        (list (mapcar (quote car)
                filter)
            (mapcar (quote cdr)
                filter))
        (list vlax-vbinteger vlax-vbvariant)))
```
</details>

---

### vla:dump

**è¯´æ˜**: åˆ—å¯¹è±¡å±æ€§å’Œæ–¹æ³•ã€‚

**ç”¨æ³•**:
```lisp
(vla:dump obj)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vla:dump (obj)
  "åˆ—å¯¹è±¡å±æ€§å’Œæ–¹æ³•ã€‚"
  (vlax-dump-object obj t)
  (setq atoms (atoms-family 1))
  (setq allproperties (mapcar (quote (lambda (x)
          (substr x 9)))
      (vl-remove-if-not (quote (lambda (x)
            (wcmatch x "VLA-GET-*")))
        atoms)))
  (setq allmethods (mapcar (quote (lambda (x)
          (substr x 5)))
      (vl-remove-if-not (quote (lambda (x)
            (and (wcmatch x "VLA-*")
              (wcmatch x "~VLA-GET-*")
              (wcmatch x "~VLA-PUT-*"))))
        atoms)))
  (setq properties (vl-remove-if-not (quote (lambda (x)
          (vlax-property-available-p obj x)))
      allproperties))
  (setq methods (vl-remove-if-not (quote (lambda (x)
          (vlax-method-applicable-p obj x)))
      allmethods))
  (list (cadr (string:to-list (vl-princ-to-string obj)
        "
        "))
    properties methods))
```
</details>

---

### vla:enamelist->vla

**è¯´æ˜**: å›¾å…ƒåˆ—è¡¨è½¬ä¸ºVlaåˆ—è¡¨ã€‚lst:å›¾å…ƒåˆ—è¡¨

**ç”¨æ³•**:
```lisp
(vla:enamelist->vla lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: Vlaåˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(vla:enamelist->vla lst)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vla:enamelist->vla (lst)
  "å›¾å…ƒåˆ—è¡¨è½¬ä¸ºVlaåˆ—è¡¨ã€‚lst:å›¾å…ƒåˆ—è¡¨"
  "Vlaåˆ—è¡¨"
  "(vla:enamelist->vla lst)"
  (mapcar (quote vlax-ename->vla-object)
    lst))
```
</details>

---

### vla:get-property

**è¯´æ˜**: ç‚¹æ“ä½œç¬¦æ–¹å¼è·å–å¯¹è±¡çš„å±æ€§ï¼Œå‚æ•°:sym vlaå¯¹è±¡çš„ç¬¦å·ï¼Œstr ç”¨ç‚¹è¡¨ç¤ºçš„CADå¯¹è±¡å±‚çº§çš„å±æ€§åã€‚strçš„ä¸­é¦–ä¸ªç±»åéœ€ä¸symå¯¹è±¡çš„ç±»ä¸€è‡´ã€‚

**ç”¨æ³•**:
```lisp
(vla:get-property sym str)
```

**å‚æ•°**: 1 sym  : æœªè¯†åˆ«å®šä¹‰;2 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: any

**ç¤ºä¾‹**:
```lisp
(vla:get-property *ACAD* "application.preferences.drafting.autosnapmarkersize")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vla:get-property (sym str / obj-tree res)
  "ç‚¹æ“ä½œç¬¦æ–¹å¼è·å–å¯¹è±¡çš„å±æ€§ï¼Œå‚æ•°:sym vlaå¯¹è±¡çš„ç¬¦å·ï¼Œstr ç”¨ç‚¹è¡¨ç¤ºçš„CADå¯¹è±¡å±‚çº§çš„å±æ€§åã€‚strçš„ä¸­é¦–ä¸ªç±»åéœ€ä¸symå¯¹è±¡çš„ç±»ä¸€è‡´ã€‚"
  "any"
  "(vla:get-property *ACAD* \"application.preferences.drafting.autosnapmarkersize\")"
  (if (null acadobj)
    (setq acadobj (vlax-get-acad-object)))
  (setq obj-tree (string:to-list str "."))
  (setq res sym)
  (while (and (p:vlap res)
      (cdr obj-tree))
    (setq porm (string:to-list (cadr obj-tree)
        "("))
      (cond ((vlax-property-available-p res (read (car porm)))
          (setq res (vlax-get-property res (read (car (setq obj-tree (cdr obj-tree)))))))
        ((vlax-method-applicable-p res (read (car porm)))
          (setq params (mapcar (quote read)
              (string:to-list (vl-string-right-trim ")"
                (cadr porm))
              ",")))
        (setq res (apply (quote vlax-invoke)
            (cons res (cons (read (car porm))
                params))))
        (setq obj-tree (cdr obj-tree)))))
  res)
```
</details>

---

### vla:get-value

**è¯´æ˜**: å˜ä½“é‡Œå–å€¼.å‚æ•° var:å˜ä½“æˆ–è€…æ•°ç»„

**ç”¨æ³•**:
```lisp
(vla:get-value var)
```

**å‚æ•°**: 1 var  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: æ•°æ®åˆ—è¡¨

**ç¤ºä¾‹**:
```lisp
(vla:get-value var)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vla:get-value (var)
  "å˜ä½“é‡Œå–å€¼.å‚æ•° var:å˜ä½“æˆ–è€…æ•°ç»„"
  "æ•°æ®åˆ—è¡¨"
  "(vla:get-value var)"
  (cond ((listp var)
      (mapcar (quote vla:get-value)
        var))
    ((p:variantp var)
      (vla:get-value (vlax-variant-value var)))
    ((p:safearrayp var)
      (mapcar (quote vla:get-value)
        (vlax-safearray->list var)))
    (t var)))
```
</details>

---

### vla:list->array

**è¯´æ˜**: è¡¨->å®‰å…¨æ•°ç»„ç±»å‹ï¼ˆä¸€ç»´æ•°ç»„ï¼‰;  å‚æ•°ï¼š;  nlist:åˆ—è¡¨ï¼Œè¦æ±‚æ•°æ®çš„ç±»å‹è¦å’Œarraytypeä¸€è‡´;  arraytype:å¯æŒ‡å®šå¦‚ä¸‹å¸¸é‡ï¼šå¯ä»¥ç”¨åé¢çš„æ•°å­—ä¹Ÿå¯ä»¥ç”¨å‰é¢çš„ç±»å‹ç¬¦å·;

**ç”¨æ³•**:
```lisp
(vla:list->array nlist arraytype)
```

**å‚æ•°**: 1 nlist  : æœªæ˜ç¡®å®šä¹‰;  2 arraytype  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: ä¸€ç»´æ•°ç»„

**ç¤ºä¾‹**:
```lisp
(vla:List->Array '(1 2 3 4) vlax-vbInteger)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vla:list->array (nlist arraytype)
    "è¡¨->å®‰å…¨æ•°ç»„ç±»å‹ï¼ˆä¸€ç»´æ•°ç»„ï¼‰\nå‚æ•°ï¼š\nnlist:åˆ—è¡¨ï¼Œè¦æ±‚æ•°æ®çš„ç±»å‹è¦å’Œarraytypeä¸€è‡´\narraytype:å¯æŒ‡å®šå¦‚ä¸‹å¸¸é‡ï¼šå¯ä»¥ç”¨åé¢çš„æ•°å­—ä¹Ÿå¯ä»¥ç”¨å‰é¢çš„ç±»å‹ç¬¦å·\n"
    "ä¸€ç»´æ•°ç»„"
    "(vla:list->array '(1 2 3 4)
        vlax-vbinteger)"
    (vlax-safearray-fill (vlax-make-safearray arraytype (cons 0 (1- (length nlist))))
        nlist))
```
</details>

---

### vla:list->arrays

**è¯´æ˜**: è¡¨->å®‰å…¨æ•°ç»„ç±»å‹ï¼ˆå¤šç»´æ•°ç»„ï¼Œå¤šäºäºŒç»´æŠ¥é”™ï¼‰;  arg:;  nlist:åˆ—è¡¨ï¼Œè¦æ±‚æ•°æ®çš„ç±»å‹è¦å’Œarraytypeä¸€è‡´ï¼Œè¡¨çš„å„ç»´å¿…é¡»ä¸ºè¡¨;  arraytype:å¯æŒ‡å®šå¦‚ä¸‹å¸¸é‡ï¼šå¯ä»¥ç”¨åé¢çš„æ•°å­—ä¹Ÿå¯ä»¥ç”¨å‰é¢çš„ç±»å‹ç¬¦å·

**ç”¨æ³•**:
```lisp
(vla:list->arrays nlist arraytype)
```

**å‚æ•°**: 1 nlist  : æœªæ˜ç¡®å®šä¹‰;  2 arraytype  : æœªæ˜ç¡®å®šä¹‰;

**è¿”å›å€¼**: å¤šç»´æ•°ç»„

**ç¤ºä¾‹**:
```lisp
vla:List->Arrays '((1 2) (3 4)) vlax-vbInteger)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vla:list->arrays (nlist arraytype)
    "è¡¨->å®‰å…¨æ•°ç»„ç±»å‹ï¼ˆå¤šç»´æ•°ç»„ï¼Œå¤šäºäºŒç»´æŠ¥é”™ï¼‰\narg:\nnlist:åˆ—è¡¨ï¼Œè¦æ±‚æ•°æ®çš„ç±»å‹è¦å’Œarraytypeä¸€è‡´ï¼Œè¡¨çš„å„ç»´å¿…é¡»ä¸ºè¡¨\narraytype:å¯æŒ‡å®šå¦‚ä¸‹å¸¸é‡ï¼šå¯ä»¥ç”¨åé¢çš„æ•°å­—ä¹Ÿå¯ä»¥ç”¨å‰é¢çš„ç±»å‹ç¬¦å·"
    "å¤šç»´æ•°ç»„"
    "vla:list->arrays '((1 2)
        (3 4))
    vlax-vbinteger)"
(vlax-safearray-fill (apply (quote vlax-make-safearray)
        (cons arraytype (mapcar (quote (lambda (x)
                        (cons 0 (1- (length x)))))
                nlist)))
    nlist))
```
</details>

---

### vla:objarray

**è¯´æ˜**: åˆ›å»ºvlaå¯¹è±¡æ•°ç»„;  å‚    æ•°:lst:vlaå¯¹è±¡è¡¨

**ç”¨æ³•**:
```lisp
(vla:objarray lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: è¿” å› å€¼:vlaå¯¹è±¡æ•°ç»„

**ç¤ºä¾‹**:
```lisp
(vla:ObjArray lst)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vla:objarray (lst)
    "åˆ›å»ºvlaå¯¹è±¡æ•°ç»„\nå‚    æ•°:lst:vlaå¯¹è±¡è¡¨"
    "è¿” å› å€¼:vlaå¯¹è±¡æ•°ç»„"
    "(vla:objarray lst)"
    (vla:list->array lst vlax-vbobject))
```
</details>

---

### vla:objectvariant

**è¯´æ˜**: åˆ›å»ºvlaå¯¹è±¡è¡¨å˜ä½“.;  å‚æ•°ï¼š;  lst:vlaå¯¹è±¡è¡¨

**ç”¨æ³•**:
```lisp
(vla:objectvariant lst)
```

**å‚æ•°**: 1 lst  : åˆ—è¡¨;

**è¿”å›å€¼**: å˜ä½“

**ç¤ºä¾‹**:
```lisp
(vla:ObjectVariant lst)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vla:objectvariant (lst)
    "åˆ›å»ºvlaå¯¹è±¡è¡¨å˜ä½“.\nå‚æ•°ï¼š\nlst:vlaå¯¹è±¡è¡¨"
    "å˜ä½“"
    "(vla:objectvariant lst)"
    (vlax-make-variant (vlax-safearray-fill (vlax-make-safearray vlax-vbobject (cons 0 (1- (length lst))))
            lst)))
```
</details>

---

### vla:prototype

**è¯´æ˜**: è¿”å›å¯¹è±¡ç±»ã€å±æ€§å’Œæ–¹æ³•ç»„æˆçš„åˆ—è¡¨ã€‚

**ç”¨æ³•**:
```lisp
(vla:prototype obj)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vla:prototype (obj)
  "è¿”å›å¯¹è±¡ç±»ã€å±æ€§å’Œæ–¹æ³•ç»„æˆçš„åˆ—è¡¨ã€‚"
  (setq atoms (atoms-family 1))
  (setq allproperties (mapcar (quote (lambda (x)
          (substr x 9)))
      (vl-remove-if-not (quote (lambda (x)
            (wcmatch x "VLA-GET-*")))
        atoms)))
  (setq allmethods (mapcar (quote (lambda (x)
          (substr x 5)))
      (vl-remove-if-not (quote (lambda (x)
            (and (wcmatch x "VLA-*")
              (wcmatch x "~VLA-GET-*")
              (wcmatch x "~VLA-PUT-*"))))
        atoms)))
  (setq properties (vl-remove-if-not (quote (lambda (x)
          (vlax-property-available-p obj x)))
      allproperties))
  (setq methods (vl-remove-if-not (quote (lambda (x)
          (vlax-method-applicable-p obj x)))
      allmethods))
  (list (substr (cadr (string:to-list (vl-princ-to-string obj)
          "
          "))
      6)
    properties methods))
```
</details>

---

### vla:put-property

**è¯´æ˜**: ç‚¹æ“ä½œç¬¦æ–¹å¼è®¾ç½®å¯¹è±¡çš„å±æ€§ï¼Œå‚æ•°:sym vlaå¯¹è±¡çš„ç¬¦å·ï¼Œstr ç”¨ç‚¹è¡¨ç¤ºçš„CADå¯¹è±¡å±‚çº§çš„å±æ€§åã€‚

**ç”¨æ³•**:
```lisp
(vla:put-property sym str value)
```

**å‚æ•°**: 1 sym  : æœªè¯†åˆ«å®šä¹‰;2 str  : å­—ç¬¦ä¸²;3 value  : å€¼;

**è¿”å›å€¼**: any

**ç¤ºä¾‹**:
```lisp
(vla:put-property *ACAD* "application.preferences.drafting.autosnapmarkersize" 5)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vla:put-property (sym str value / obj-tree res)
  "ç‚¹æ“ä½œç¬¦æ–¹å¼è®¾ç½®å¯¹è±¡çš„å±æ€§ï¼Œå‚æ•°:sym vlaå¯¹è±¡çš„ç¬¦å·ï¼Œstr ç”¨ç‚¹è¡¨ç¤ºçš„CADå¯¹è±¡å±‚çº§çš„å±æ€§åã€‚"
  "any"
  "(vla:put-property *ACAD* \"application.preferences.drafting.autosnapmarkersize\"
    5)"
  (if (null acadobj)
    (setq acadobj (vlax-get-acad-object)))
  (setq obj-tree (string:to-list str "."))
  (setq res sym)
  (while (and (p:vlap res)
      (cddr obj-tree))
    (setq porm (string:to-list (cadr obj-tree)
        "("))
      (cond ((vlax-property-available-p res (read (car porm)))
          (setq res (vlax-get-property res (read (car (setq obj-tree (cdr obj-tree)))))))
        ((vlax-method-applicable-p res (read (car porm)))
          (setq params (mapcar (quote read)
              (string:to-list (vl-string-right-trim ")"
                (cadr porm))
              ",")))
        (setq res (apply (quote vlax-invoke)
            (cons res (cons (read (car porm))
                params))))
        (setq obj-tree (cdr obj-tree)))))
  (vlax-put-property res (read (car (setq obj-tree (cdr obj-tree))))
    value))
```
</details>

---

### vla:sel

**è¯´æ˜**: å•é€‰å¯¹è±¡ã€‚

**ç”¨æ³•**:
```lisp
(vla:sel )
```

**å‚æ•°**: None

**è¿”å›å€¼**: VLA-OBJECT å¯¹è±¡

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vla:sel nil "å•é€‰å¯¹è±¡ã€‚"
    "vla-object å¯¹è±¡"
    (e2o (car (entsel))))
```
</details>

---

### vla:to-ename

**è¯´æ˜**: objectè½¬eName,ç®€åŒ–å‡½æ•° o2e.

**ç”¨æ³•**:
```lisp
(vla:to-ename obj)
```

**å‚æ•°**: 1 obj  : activeX å¯¹è±¡;

**è¿”å›å€¼**: ename entity

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun vla:to-ename (obj)
    "objectè½¬ename,ç®€åŒ–å‡½æ•° o2e."
    "ename entity"
    (vlax-vla-object->ename obj))
```
</details>

---

## word

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### word:close

**è¯´æ˜**: å…³é—­ word æ–‡æ¡£

**ç”¨æ³•**:
```lisp
(word:close ax-doc)
```

**å‚æ•°**: 1 ax-doc  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun word:close (ax-doc)
  "å…³é—­ word æ–‡æ¡£"
  (vlax-invoke ax-doc (quote close)))
```
</details>

---

### word:example

**è¯´æ˜**: word ç±»å‡½æ•°è°ƒç”¨ç¤ºä¾‹

**ç”¨æ³•**:
```lisp
(word:example filename str)
```

**å‚æ•°**: 1 filename  : æ–‡ä»¶å;2 str  : å­—ç¬¦ä¸²;

**è¿”å›å€¼**: nil

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun word:example (filename str / ax-word ax-doc)
  "word ç±»å‡½æ•°è°ƒç”¨ç¤ºä¾‹"
  "nil"
  ""
  "å»ºç«‹ word app"
  (setq ax-word (word:open filename nil))
  "æ–‡æ¡£å¯¹è±¡ ax-doc"
  (setq ax-doc (vlax-get-property ax-word (quote activedocument)))
  "å‘æ–‡æ¡£å¯¹è±¡å†™å†…å®¹"
  (word:write-line ax-doc str)
  "å…³é—­æ–‡æ¡£"
  (word:close ax-doc)
  "å…³é—­ app"
  (word:quit ax-word t))
```
</details>

---

### word:new

**è¯´æ˜**: æ–°å»ºword æ–‡æ¡£å‚æ•°:ishide:æ˜¯å¦å¯è§ï¼Œtä¸ºå¯è§ï¼Œnilä¸ºä¸å¯è§

**ç”¨æ³•**:
```lisp
(word:new ishide)
```

**å‚æ•°**: 1 ishide  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: ä¸€ä¸ªè¡¨ç¤ºwordçš„vlaå¯¹è±¡

**ç¤ºä¾‹**:
```lisp
(word:New t)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun word:new (ishide / ax-word)
  "æ–°å»ºword æ–‡æ¡£\nå‚æ•°:ishide:æ˜¯å¦å¯è§ï¼Œtä¸ºå¯è§ï¼Œnilä¸ºä¸å¯è§"
  "ä¸€ä¸ªè¡¨ç¤ºwordçš„vlaå¯¹è±¡"
  "(word:New t)"
  (if (setq ax-word (vlax-get-or-create-object "Word.Application"))
    (progn (vlax-invoke (vlax-get-property ax-word (quote workbooks))
        (quote add))
      (if ishide (vla-put-visible ax-word 1)
        (vla-put-visible ax-word 0))))
  ax-word)
```
</details>

---

### word:open

**è¯´æ˜**: æ‰“å¼€ä¸€ä¸ªwordæ–‡ä»¶å‚æ•°:Filename:æ–‡ä»¶è·¯å¾„å‚æ•°:ishide:æ˜¯å¦å¯è§ï¼Œtä¸ºå¯è§ï¼Œnilä¸ºä¸å¯è§

**ç”¨æ³•**:
```lisp
(word:open filename ishide)
```

**å‚æ•°**: 1 filename  : æ–‡ä»¶å;2 ishide  : æœªè¯†åˆ«å®šä¹‰;

**è¿”å›å€¼**: ä¸€ä¸ªè¡¨ç¤ºæ‰“å¼€çš„ word æ–‡ä»¶çš„vlaå¯¹è±¡

**ç¤ºä¾‹**:
```lisp
(word:open "D:\1.docx" t)
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun word:open (filename ishide / ax-word ax-doc)
  "æ‰“å¼€ä¸€ä¸ªwordæ–‡ä»¶\nå‚æ•°:Filename:æ–‡ä»¶è·¯å¾„\nå‚æ•°:ishide:æ˜¯å¦å¯è§ï¼Œtä¸ºå¯è§ï¼Œnilä¸ºä¸å¯è§"
  "ä¸€ä¸ªè¡¨ç¤ºæ‰“å¼€çš„ word æ–‡ä»¶çš„vlaå¯¹è±¡"
  "(word:open \"D:\\1.docx\"
    t)"
  (if (setq ax-word (vlax-get-or-create-object "Word.Application"))
    (progn (if ishide (vla-put-visible ax-word :vlax-true)
        (vla-put-visible ax-word :vlax-false))
      (if (findfile filename)
        (vlax-invoke (vlax-get-property ax-word (quote documents))
          (quote open)
          filename)
        (progn (vlax-invoke (vlax-get-property ax-word (quote documents))
            (quote add))
          (vlax-invoke (vlax-get-property ax-word (quote activedocument))
            (quote saveas)
            filename)))))
  ax-word)
```
</details>

---

### word:quit

**è¯´æ˜**: é€€å‡ºWordå‚æ•°:ax-word:æ‰“å¼€çš„wordå¯¹è±¡å‚æ•°:SaveYN:æ˜¯å¦ä¿å­˜ï¼Œtä¸ºä¿å­˜ï¼Œnilä¸ºä¸ä¿å­˜

**ç”¨æ³•**:
```lisp
(word:quit ax-word saveyn)
```

**å‚æ•°**: 1 ax-word  : æœªè¯†åˆ«å®šä¹‰;2 saveyn  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun word:quit (ax-word saveyn)
  "é€€å‡ºWord\nå‚æ•°:ax-word:æ‰“å¼€çš„wordå¯¹è±¡\nå‚æ•°:SaveYN:æ˜¯å¦ä¿å­˜ï¼Œtä¸ºä¿å­˜ï¼Œnilä¸ºä¸ä¿å­˜"
  (if (> (vlax-get-property (vlax-get-property ax-word (quote documents))
        (quote count))
      0)
    (if saveyn (vlax-invoke (vlax-get-property ax-word "ActiveDocument")
        (quote close))
      (vlax-invoke (vlax-get-property ax-word "ActiveDocument")
        (quote close)
        :vlax-false)))
  (vlax-invoke ax-word (quote quit))
  (vlax-release-object ax-word)
  (setq ax-word nil)
  (gc))
```
</details>

---

### word:save

**è¯´æ˜**: ä¿å­˜ word æ–‡æ¡£ï¼Œå¦‚æœæ˜¯æ–°å»ºçš„æ–‡æ¡£ï¼Œéœ€è¦å…ˆæŒ‡å®šæ–‡ä»¶è·¯å¾„ã€‚

**ç”¨æ³•**:
```lisp
(word:save ax-doc)
```

**å‚æ•°**: 1 ax-doc  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun word:save (ax-doc)
  "ä¿å­˜ word æ–‡æ¡£ï¼Œå¦‚æœæ˜¯æ–°å»ºçš„æ–‡æ¡£ï¼Œéœ€è¦å…ˆæŒ‡å®šæ–‡ä»¶è·¯å¾„ã€‚"
  (vlax-invoke ax-doc (quote save)))
```
</details>

---

### word:write-line

**è¯´æ˜**: å‘ word çš„æ–‡æ¡£å¯¹è±¡æœ€åå†™å…¥æ–‡æœ¬ã€‚

**ç”¨æ³•**:
```lisp
(word:write-line ax-doc text)
```

**å‚æ•°**: 1 ax-doc  : æœªè¯†åˆ«å®šä¹‰;2 text  : æœªè¯†åˆ«å®šä¹‰;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun word:write-line (ax-doc text / end)
  "å‘ word çš„æ–‡æ¡£å¯¹è±¡æœ€åå†™å…¥æ–‡æœ¬ã€‚"
  (setq end (vlax-get-property (vlax-get-property (vlax-get-property ax-doc (quote paragraphs))
        (quote last))
      (quote range)))
  (vlax-invoke end (quote insertafter)
    text))
```
</details>

---

## xdata

**æ¨¡å—è¯´æ˜**: ä¸“ç”¨åŠŸèƒ½æ¨¡å—

### xdata:delete

**è¯´æ˜**: åˆ é™¤å›¾å…ƒçš„æ‰©å±•æ•°æ®

**ç”¨æ³•**:
```lisp
(xdata:delete ename)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun xdata:delete (ename / lst)
  "åˆ é™¤å›¾å…ƒçš„æ‰©å±•æ•°æ®"
  (cond ((p:enamep ename)
      (entmod (list (cons -1 ename)
          (cons -3 (mapcar (quote list)
              (mapcar (quote car)
                (cdr (assoc -3 (entget ename (quote ("*")))))))))))
    ((p:listp ename)
      (mapcar (quote xdata:delete)
        ename))
    ((p:picksetp ename)
      (mapcar (quote xdata:delete)
        (pickset:to-list ename)))))
```
</details>

---

### xdata:put

**è¯´æ˜**: å‘å›¾å…ƒ ename é™„åŠ æ‰©å±•æ•°æ® values,values ä¸ºä¸€ä¸ªå€¼æˆ–ä¸€äº›å€¼çš„åˆ—è¡¨

**ç”¨æ³•**:
```lisp
(xdata:put ename appid values)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 appid  : æœªè¯†åˆ«å®šä¹‰;3 values  : å€¼;

**è¿”å›å€¼**: ename

**ç¤ºä¾‹**:
```lisp
(xdata:put(car(entsel)) "atlisp"  '(10 100))
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun xdata:put (ename appid values / xdata xdata-new)
  "å‘å›¾å…ƒ ename é™„åŠ æ‰©å±•æ•°æ® values,values ä¸ºä¸€ä¸ªå€¼æˆ–ä¸€äº›å€¼çš„åˆ—è¡¨"
  "ename"
  "(xdata:put(car(entsel))
    \"atlisp\"
     '(10 100))"
  (setq appid (strcase appid))
  (regapp appid)
  (if (atom values)
    (setq values (list values)))
  (setq xdata-new (vl-remove nil (mapcar (quote (lambda (x)
            (cond ((p:stringp x)
                (cons 1000 x))
              ((and (p:intp x)
                  (< (abs x)
                    32767))
                (cons 1070 x))
              ((and (p:intp x)
                  (> (abs x)
                    32767))
                (cons 1071 x))
              ((p:realp x)
                (cons 1040 x)))))
        values)))
  (setq xdata (cdr (assoc -3 (entget ename (quote ("*"))))))
  (if (assoc appid xdata)
    (setq xdata (subst (cons appid (append (cdr (assoc appid xdata))
            xdata-new))
        (assoc appid xdata)
        xdata))
    (setq xdata (append xdata (list (cons appid xdata-new)))))
  (entmod (append (entget ename)
      (list (cons -3 xdata)))))
```
</details>

---

### xdata:remove-all

**è¯´æ˜**: åˆ é™¤å›¾å…ƒçš„æ‰©å±•æ•°æ®

**ç”¨æ³•**:
```lisp
(xdata:remove-all ename)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun xdata:remove-all (ename / lst)
  "åˆ é™¤å›¾å…ƒçš„æ‰©å±•æ•°æ®"
  (cond ((p:enamep ename)
      (entmod (list (cons -1 ename)
          (cons -3 (mapcar (quote list)
              (mapcar (quote car)
                (cdr (assoc -3 (entget ename (quote ("*")))))))))))
    ((p:listp ename)
      (mapcar (quote xdata:remove-all)
        ename))
    ((p:picksetp ename)
      (mapcar (quote xdata:remove-all)
        (pickset:to-list ename)))))
```
</details>

---

### xdata:remove-appid

**è¯´æ˜**: åˆ é™¤å›¾å…ƒçš„åº”ç”¨åä¸ºappidçš„æ‰©å±•æ•°æ®

**ç”¨æ³•**:
```lisp
(xdata:remove-appid ename appid)
```

**å‚æ•°**: 1 ename  : å•ä¸ªå›¾å…ƒ;2 appid  : æœªè¯†åˆ«å®šä¹‰;

**ç¤ºä¾‹**:
```lisp
(xdata:remove-appid (car(entsel)) "ACAD")
```

<details>
<summary><strong>ğŸ“‹ æŸ¥çœ‹æºç </strong></summary>

```lisp
(defun xdata:remove-appid (ename appid / lst)
  "åˆ é™¤å›¾å…ƒçš„åº”ç”¨åä¸ºappidçš„æ‰©å±•æ•°æ®"
  ""
  "(xdata:remove-appid (car(entsel))
    \"ACAD\")"
  (cond ((p:enamep ename)
      (entmod (list (cons -1 ename)
          (cons -3 (mapcar (quote (lambda (x)
                  (if (string-equal appid (car x))
                    (cons (car x)
                      nil)
                    x)))
              (cdr (assoc -3 (entget ename (quote ("*"))))))))))
    ((p:ename-listp ename)
      (mapcar (quote (lambda (x)
            (xdata:remove-appid x appid)))
        ename))
    ((p:picksetp ename)
      (mapcar (quote (lambda (x)
            (xdata:remove-appid x appid)))
        (pickset:to-list ename)))))
```
</details>

---

